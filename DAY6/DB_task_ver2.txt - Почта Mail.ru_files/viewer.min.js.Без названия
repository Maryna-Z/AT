define("feast-tpl!app/feast-tpl!ui-block/viewer/viewer.html",["feast"],function(a){return a.parse('<div>\n\t<bem:mod name="no-close" test="attrs.modal"/>\n\n\t\x3c!-- DON\'T REMOVE: <toolkit:b-viewer/> --\x3e\n\t<div ref="viewer" bem:elem="placeholder"></div>\n</div>\n',"app/feast-tpl!ui-block/viewer/viewer.html")});define("feast-tpl!ui-block/viewer/viewer.html",["feast-tpl!app/feast-tpl!ui-block/viewer/viewer.html"],function(a){return a});define("viewer/b-deferred-collection/b-deferred-collection",["jquery","toolkit/b-toolkit/b-toolkit"],function($,a){return a.create("b-deferred-collection",{init:function(){this._deferredItems={};this._resolvedItems={};this._index=[];this._moreItemsRequestPromises={}},reset:function(){Object.forEach(this._deferredItems,function(a,b){a.reject();delete this._deferredItems[b]},this);Object.forEach(this._resolvedItems,function(a,b){delete this._resolvedItems[b];if(a.destroy){a.destroy()}},this);this._index.length=0;Object.forEach(this._moreItemsRequestPromises,function(a,b){delete this._moreItemsRequestPromises[b]},this)},_requestItem:function(a){return $.Deferred().reject()},_createItem:function(a){return{}},_resolveItem:function(a,b){this._resolvedItems[a]=b;this.emit("itemResolved",[a,b])},syncItems:function(a,b){var c=[],d=[],e={},f=false;var g=this.getIds();g.forEach(function(b){if(a.indexOf(b)==-1){c.push(b)}});if(c.length){this.removeItems(c,b);g=this.getIds()}var h=null;a.forEach(function(a){if(g.indexOf(a)==-1){if(!e[h]){e[h]=[];f=true}e[h].push(a)}else{h=a}},this);if(f){d=Object.keys(e);d.forEach(function(a){this.addIds(e[a],a==="null"?0:g.indexOf(a)+1,b)},this)}return{added:d,removed:c}},addItems:function(a,b,c){a=Array.isArray(a)?a:[a];var d=[],e=false;a.forEach(function(a){if(a.id&&!this._deferredItems[a.id]){if(a.data){this._deferredItems[a.id]=$.Deferred().resolve(this._createItem(a.data)).done(this._resolveItem.bind(this,a.id))}else{this._deferredItems[a.id]=$.Deferred().reject()}d.push(a.id);this.emit("itemAdded",[a.id]);e=true}},this);Array.prototype.splice.apply(this._index,[b===undefined?this._index.length:b,0].concat(d));if(!c&&e){this.emit("dataChanged")}},addIds:function(a,b,c){a=Array.isArray(a)?a:[a];this.addItems(a.map(function(a){return{id:a,data:null}}),b,c)},requestItems:function(a,b){a=Array.isArray(a)?a:[a];var c=$.Deferred(),d=false,e=[],f=[];a.forEach(function(a){if(this._deferredItems[a]){if(this.getDeferredItemState(a)==="rejected"){this._deferredItems[a]=this._requestItem(a).done(this._resolveItem.bind(this,a));d=true}e.push(a);f.push(this._deferredItems[a])}},this);$.when.apply($,f).done(function(){var a={},f=Array.prototype.slice.call(arguments);e.forEach(function(b,c){a[b]=f[c]});c.resolve(a);if(!b&&d){this.emit("dataChanged")}}.bind(this)).fail(function(){c.reject()});return c.promise()},getIds:function(){return this._index},isIdExists:function(a){return this._index.includes(a)},getItemId:function(a){var b;Object.forEach(this._deferredItems,function(c,d){if(c===a){b=d}},this);if(b){return b}Object.forEach(this._resolvedItems,function(c,d){if(c===a){b=d}},this);if(b){return b}if(~this._index.indexOf(a)){return a}},getOffsetItemId:function(a,b){var c=this.getItemIndex(a);return this.getIds()[~c?Math.max(0,Math.min(this.getIds().length-1,+(c+b)||0)):0]},getItemIndex:function(a){return this._index.indexOf(a)},getDeferredItemCount:function(){return Object.keys(this._deferredItems).length},getResolvedItemCount:function(){return Object.keys(this._resolvedItems).length},getDeferredItems:function(a){a=Array.isArray(a)?a:[a];var b={};a.forEach(function(a){if(this._deferredItems[a]){b[a]=this._deferredItems[a]}},this);return b},getResolvedItems:function(a){a=Array.isArray(a)?a:[a];var b={};a.forEach(function(a){if(this._resolvedItems[a]){b[a]=this._resolvedItems[a]}},this);return b},getDeferredItemState:function(a){var b=this._deferredItems[a];if(b.state){return b.state()}if(b.isResolved&&b.isResolved()){return"resolved"}else if(b.isRejected&&b.isRejected()){return"rejected"}else{return"pending"}},removeItems:function(a,b){a=Array.isArray(a)?a:[a];a.forEach(function(a){if(this._deferredItems[a]){this._deferredItems[a].reject();delete this._deferredItems[a];delete this._resolvedItems[a]}},this);this._index=this._index.filter(function(b){return a.indexOf(b)==-1});if(!b){this.emit("dataChanged")}},_requestMoreItems:function(a){return $.Deferred().reject()},requestMoreItems:function(a){var b=this._moreItemsRequestPromises[a];if(b===undefined){b=this._moreItemsRequestPromises[a]=this._requestMoreItems(a);if(b.then){b.then(function(){delete this._moreItemsRequestPromises[a]}.bind(this),function(){this._moreItemsRequestPromises[a]=false}.bind(this))}}return b}})});define("viewer/b-viewer/b-viewer-conveyor-worker",["jquery"],function($){function a(b,c,d,e){var f=this;this._conveyor=b;this.id=a._ids++;if(e){this._$status=$("<div>").appendTo(e)}this._current={};function g(){f._current.item=null;f._current.priority=null;f._current.title=null;f._current.deferred=null;f._waitTimeout=setTimeout(function(){f._logStatus("Waiting");c().done(function(a){var b=$.Deferred();f._current.item=a.item;f._current.priority=a.priority;f._current.title=a.title;f._current.deferred=b;f._logStatus("Processing("+f._current.priority+") "+f._current.title);f._current.deferred.done(function(){d(a);g()}).fail(function(){g()});var c=a.item.start&&a.item.start();var e=a.log;var h;var i=(new Date).getTime();if(c){c.done(function(){h="load";b.resolve()}).fail(function(){h="fail";b.reject()}).always(function(){if(e&&e.type){i=(new Date).getTime()-i;f._conveyor._viewer.log("info",{radarName:"conveyor_"+h+"_"+e.type+"_"+e.state,radars:[e.extension+"="+i,"all="+i],itemId:a.item&&a.item.data&&a.item.data.id})}})}else{b.resolve()}})},0)}g()}a._ids=0;var b=a.prototype;b.destroy=function(){clearTimeout(this._waitTimeout);this._current.item&&this._current.item.stop&&this._current.item.stop();this._current.item=null;this._current.priority=null;this._current.title=null;this._current.deferred=null};b.interrupt=function(){if(this._current.item){if(this._current.item.stop){this._current.item.stop()}if(this._current.deferred){this._current.deferred.reject()}}};b.getCurrentBundle=function(){return{item:this._current.item,priority:this._current.priority,title:this._current.title}};b.setCurrentPriority=function(a){this._current.priority=a;this._logStatus("Processing("+this._current.priority+") "+this._current.title)};b.setCurrentTitle=function(a){this._current.title=a;this._logStatus("Processing("+this._current.priority+") "+this._current.title)};b._logStatus=function(a){if(this._$status){this._$status.text(a);console&&console.info&&console.info("Worker "+this.id+": ",a)}};return a});define("viewer/b-viewer/b-viewer-conveyor",["jquery","viewer/b-viewer/b-viewer-conveyor-worker"],function($,a){function b(b,c){var d;var e;this._viewer=b;try{d=!!JSON.parse(window.localStorage.getItem("ShowConveyorStatus"))}catch(a){}if(d){e=$("<div>").css({position:"fixed",left:0,top:0,padding:2,fontFamily:"sans-serif",fontSize:10,color:"rgba(255, 255, 255, 0.5)",zIndex:999999}).appendTo($(document.body))}this._workers=[];this._waiters=[];this._input=[];this._output=[];this._wait=this._wait.bind(this);this._done=this._done.bind(this);while(c--){this._workers.push(new a(this,this._wait,this._done,e))}}var c=b.prototype;c.destroy=function(){this._workers.forEach(function(a){a.destroy()});this._workers=[];this._waiters=[];this._input=[];this._output=[];this._wait=null;this._done=null};c._wait=function(){var a=$.Deferred();if(this._input.length){var b=this._input.shift();a.resolve(b)}else{this._waiters.push(a)}return a};c._done=function(a){this._output.push(a)};c._fulfillWaiters=function(){while(this._waiters.length&&this._input.length){this._waiters.shift().resolve(this._input.shift())}};c._asyncFulfillWaiters=function(){var a=0;return function(){var b=this;window.clearTimeout(a);a=window.setTimeout(function(){b._fulfillWaiters()})}}();c._addToInput=function(a){this._input=this._input.concat(a).sort(function(a,b){return b.priority-a.priority});this._asyncFulfillWaiters()};c._removeFromInput=function(a){this._input=this._input.filter(function(b){return b.item!==a},this)};c._removeFromOutput=function(a){this._output=this._output.filter(function(b){return b.item!==a},this)};c._isInInput=function(a){return this._input.some(function(b){return b.item===a},this)};c._isInOutput=function(a){return this._output.some(function(b){return b.item===a},this)};c._getBusyWorker=function(a){var b;this._workers.some(function(c){var d=c.getCurrentBundle();if(d.item===a){b=c;return true}},this);return b};c._getAvailableWorker=function(a){var b;if(!this._waiters.length){b=[].concat(this._workers).sort(function(a,b){return a.getCurrentBundle().priority-b.getCurrentBundle().priority})[0];var c=b.getCurrentBundle();if(c.item&&c.priority<=a){return b}}};c.enqueue=function(a,b,c,d){var e=this._getBusyWorker(a),f={item:a,priority:b,title:c,log:d};if(e){if(e.getCurrentBundle().priority>b){this._addToInput([f]);e.interrupt()}else{e.setCurrentPriority(b);e.setCurrentTitle(c)}}else if(!this._isInOutput(a)){this._removeFromInput(a);e=this._getAvailableWorker(b);if(e){this._addToInput([f,e.getCurrentBundle()]);e.interrupt()}else{this._addToInput([f])}}};c.remove=function(a){var b=this._getBusyWorker(a);if(b){b.interrupt()}else{this._removeFromInput(a);this._removeFromOutput(a)}};return b});define("toolkit/b-spinner/b-spinner",["toolkit/b-toolkit/b-toolkit","mrg-device-tools"],function(a,b){"use strict";var c=b.matchUserAgent(navigator.userAgent);return a.create("b-spinner",{init:function(){if(this._isSafari()){this.toggleMod("no-svg",true)}},deferredInit:true,_isSafari:function(){return c&&c.safari}})});define("viewer/b-view/b-view",["jquery","toolkit/b-toolkit/b-toolkit","toolkit/b-spinner/b-spinner"],function($,a,b){var c=a.create("b-view",{isPreloadable:false,isDisabled:false,_isPreloadable:function(){if(typeof this.isPreloadable==="function"){return this.isPreloadable()}else{return this.isPreloadable}},_isDisabled:function(){if(typeof this.isDisabled==="function"){return this.isDisabled()}else{return this.isDisabled}},logHandler:function(a,b){b[0].radarName=this.bemName+(b[0].radarName?"_"+b[0].radarName:"")},init:function(){a["b-toolkit"].fn.init.call(this);if(c.prototype.bemName==this.bemName){this.isDisabled=true}this._radarFilename=(this.getData().filename.extension||"unknown").toLowerCase();this.reset()},reset:function(){this._loading=false;this._loaded=false;this._loadDeferred=$.Deferred()},getData:function(){return $.extend({isPreloadable:this._isPreloadable(),isDisabled:this._isDisabled(),viewActions:this.item.getViewActions(),dummy:this.item.getDummyOptions()},this.data)},_startLoading:function(a,b){b()},_stopLoading:function(){},start:function(){if(this._isDisabled()){a.toggleMod(this.$view,"loading",false);this._showDummy();this.log("info",{radarName:"show_disabled",radars:[this._radarFilename+"=1","all=1"]});this._loadDeferred.reject()}else if(this._isPreloadable()){var b=(new Date).getTime();if(!this._loading&&!this._loaded){this._startLoadTimeout=setTimeout(function(){if(this._loading&&!this._loaded){this._loading=false;this._loadDeferred.reject();a.toggleMod(this.$view,"loading",false);this.stop();b=(new Date).getTime()-b;this.log("info",{radarName:"show_timeout",radars:[this._radarFilename+"="+b,"all="+b]})}}.bind(this),6e4);this._loading=true;a.toggleMod(this.$view,"loading",true);this._startLoading(function(c){clearTimeout(this._startLoadTimeout);this._loading=false;this._loaded=true;this._loadDeferred.resolve(c);a.toggleMod(this.$view,"loading",false);b=(new Date).getTime()-b;this.log("info",{radarName:"show_success",radars:[this._radarFilename+"="+b,"all="+b]})}.bind(this),function(c){clearTimeout(this._startLoadTimeout);this._loading=false;this._loadDeferred.reject(c);a.toggleMod(this.$view,"loading",false);this._showDummy();b=(new Date).getTime()-b;this.log("info",{radarName:"show_fail",radars:[this._radarFilename+"="+b,"all="+b]})}.bind(this))}}else{this._loaded=true;a.toggleMod(this.$view,"loading",false);this._loadDeferred.resolve();this.log("info",{radarName:"show_not-preloadable",radars:[this._radarFilename+"=1","all=1"]})}return this._loadDeferred.promise()},_stop:function(){clearTimeout(this._startLoadTimeout);this._stopLoading();a.toggleMod(this.$view,"loading",false);if(this._loading){this.log("info",{radarName:"stop",radars:[this._radarFilename+"=1","all=1"]})}this._loading=false;this._loadDeferred.reject()},stop:function(){this._stop();this._showDummy()},destroy:function(){this._stop();this._loaded=false;this._loading=false},render:function(){a["b-toolkit"].fn.render.call(this);this.$view=this.$el.find(".js-view");if(this._isPreloadable()){a.toggleMod(this.$view,"loading",true);this._spinner=new b({template:this.template,el:this.$view[0],renderMode:"append",data:{mods:["black","viewer"]}});this._spinner.render()}this.$el.delegate(".js-viewAction","tap",function(a){var b=a.currentTarget.getAttribute("data-name");this.item.doAction(b);this.log("info",{radarName:"action_"+b,radars:[this._radarFilename+"=1","all=1"]})}.bind(this))},_showDummy:function(){if(!this.$view){return}if(!this.$viewDummy){var a=this.getData(),b=$.fest(this.template,{block:"b-view__dummy",params:{filename:a.filename,icon:a.icon,viewActions:a.viewActions,fileInfo:a.dummy.getInfo&&a.dummy.getInfo(this.item.data)}});this.$view.prepend(b);this.$viewDummy=this.$el.find(".js-viewDummy")}else{this.$view.prepend(this.$viewDummy);this.$viewDummy=this.$el.find(".js-viewDummy")}this.$viewDummy.css("display","block");this.log("info",{radarName:"dummy",radars:[this._radarFilename+"=1","all=1"]})},isFreezed:function(){return this._freezed},freeze:function(){if(this._freezed){return}this._freezed=true;this._freeze&&this._freeze()},unfreeze:function(){if(this._freezed===false){return}this._freezed=false;this._unfreeze&&this._unfreeze()},onSpaceKey:function(a){}});return c});define("toolkit/b-resize-detector/b-resize-detector",["jquery","toolkit/b-toolkit/b-toolkit"],function($,a){"use strict";return a.create("b-resize-detector",{init:function(){a["b-toolkit"].fn.init.call(this);this._onScroll=this._onScroll.bind(this);this._width=0;this._height=0},render:function(b){a["b-toolkit"].fn.render.call(this,b);this._iframe=this.$el[0].querySelector(".js-iframe");var c=this;this._iframe.onload=function(){this.contentWindow.addEventListener("resize",c._onScroll);c._onScroll()}},attachTo:function(a){this.renderTo($("<div>"));a.prepend(this.$el.children());this.setElement(a)},_onScroll:function(){var a=this.$el[0].offsetWidth,b=this.$el[0].offsetHeight;if(this._width!==a||this._height!==b){this.emit("resize",[{oldWidth:this._width,newWidth:a,oldHeight:this._height,newHeight:b}])}this._width=a;this._height=b},destroy:function(){this._onScroll=null}})});define("viewer/b-view/_image/b-view_image",["jquery","toolkit/b-toolkit/b-toolkit","viewer/b-view/b-view","toolkit/b-resize-detector/b-resize-detector","toolkit-common/keymaster/keymaster"],function($,a,b,c,d){var e="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==";return b.extend("b-view_image",{isPreloadable:true,init:function(){b.fn.init.call(this);this._image=new Image;this._preloaded=false;this._zoomed=false;this._resizeDetector=new c({template:this.template,onResize:this._updateZoom.bind(this)});this._onViewImageClick=this._onViewImageClick.bind(this);this._scrollToCenter=this._scrollToCenter.bind(this)},render:function(){b.fn.render.call(this);this.$viewImage=this.$el.find(".js-viewImage");this.$viewZoom=this.$el.find(".js-viewZoom");this.$viewImage.bind("tap",this._onViewImageClick);if(this._preloaded){this._showImage()}this._resizeDetector.attachTo(this.$viewImage)},_startLoading:function(a,b){var c=function(){clearTimeout(this._timeout);if(this._image.naturalWidth&&this._image.naturalHeight){this._showThumbnail()}else{this._timeout=setTimeout(c,50)}}.bind(this);this._timeout=setTimeout(c,50);this._image.onload=function(){clearTimeout(this._timeout);this._preloaded=true;this._showImage();a()}.bind(this);this._image.onerror=function(){clearTimeout(this._timeout);b({type:"image",extension:this.data.filename.extension})}.bind(this);this._image.src=this.data.viewUrl},_stopLoading:function(){clearTimeout(this._timeout);this._image.onload=null;this._image.onerror=null;this._image.src=e},_updateThumbnail:function(){var a=this._image.naturalWidth,b=this._image.naturalHeight,c=$(this._thumbnail);if(a&&b){if(this.$viewImage.width()/this.$viewImage.height()<a/b){c.height("auto")}else{c.width("auto")}}},_showThumbnail:function(){var a=this._image.naturalWidth,b=this._image.naturalHeight;if(this.$viewImage.length&&a&&b){this._thumbnail=new Image;this._thumbnail.src=this.data.getThumbnailImageUrl(120,160);var c=$(this._thumbnail).addClass("b-view__image__image");c.attr("width",a);c.attr("height",b);this.$viewImage.find("img").remove();this.$viewImage.prepend(c);this._updateThumbnail();this._updateZoom()}},_showImage:function(){if(this.$viewImage.length){var a=$(this._image).addClass("b-view__image__image");if(!this.$viewImage.is(":visible")){a.css("display","none")}this.$viewImage.find("img").remove();this.$viewImage.prepend(a);this._updateZoom()}},onShow:function(a){this._updateThumbnail();setTimeout(function(){this.$el.find(".js-viewImage img").css("display","inline-block")}.bind(this),200);this.zoom(!!this._zoomed);this._updateZoom()},_updateZoom:function(){if(!this.$viewImage){return}var b=this.$viewImage[0].clientWidth<=this._image.naturalWidth||this.$viewImage[0].clientHeight<=this._image.naturalHeight;a.toggleMod(this.$viewZoom,"available",b);a.toggleMod(this.$viewImage,"zoom-out",b&&this._zoomed);a.toggleMod(this.$viewImage,"zoom-in",b&&!this._zoomed)},_onViewImageClick:function(){this._zoom()},_zoom:function(a){this.zoom(a);this.log("info",{radarName:"zoom",radars:[this._zoomed+"=1"]})},_scrollToCenter:function(){var a=this.$viewImage[0];a.scrollTop=Math.round((a.scrollHeight-a.clientHeight)/2);a.scrollLeft=Math.round((a.scrollWidth-a.clientWidth)/2)},zoom:function(b){this._zoomed=b===undefined?!this._zoomed:!!b;a.toggleMod(this.$viewZoom,"out",this._zoomed);a.toggleMod(this.$viewImage,"zoom-out",this._zoomed);a.toggleMod(this.$viewImage,"zoom-in",!this._zoomed);if(this._zoomed){window.requestAnimationFrame(this._scrollToCenter)}},_showDummy:function(){b.fn._showDummy.call(this);this._updateZoom()},onSpaceKey:function(a){this._zoom()},freeze:function(){this.zoom(false);b.fn.freeze.call(this)},destroy:function(){b.fn.destroy.apply(this,arguments)}})});define("mrg-microevent",function a(){"use strict";var b="_events";var c=0;var d=1;var e=false;var f=/\[native code\]/.test(window.setImmediate);window.setTimeout(function(a,b){e=a===1&&b===2},0,1,2);function g(a){return Object(a)===a}function h(a){return typeof a=="string"}function i(a){return typeof a=="function"}function j(a){return a.split(/\s+/)}function k(a,b,c){var d=a[b];if(!Array.isArray(d)){d=[];a[b]=d}if(d.indexOf(c)==-1){d.push(c)}}function l(a,b,c){var d=a[b];if(Array.isArray(d)){var e=d.indexOf(c);if(e!=-1){d.splice(e,1)}}}function m(a,b){var e=b[c];var f=e.target;if(!i(a)&&g(a)){var h=a.handleEvent;if(i(h)){f=a;a=h}}if(g(f)&&i(a)){var j=b.length;if(j==1){a.call(f,e)}else if(j==2){a.call(f,e,b[d])}else{a.apply(f,b)}}}function n(a,b){for(var c=0,d=a.length;c<d;c++){m(a[c],b)}}function o(a,b){if(f){window.setImmediate(n,a,b)}else if(e){window.setTimeout(n,0,a,b)}else{window.setTimeout(function c(){n(a,b)},0)}}function p(a){this.type=a;this.target=null}function q(){this[b]={}}var r=q.prototype;r.bind=function a(c,d){var e=this;if(h(c)&&g(d)){var f=e[b];if(!g(f)){q.call(e);f=e[b]}c=j(c);for(var i=0,l=c.length;i<l;i++){k(f,c[i],d)}}return e};r.unbind=function a(c,d){var e=this;var f=e[b];if(g(f)&&h(c)&&g(d)){c=j(c);for(var i=0,k=c.length;i<k;i++){var m=c[i];if(d){l(f,m,d)}else{delete f[m]}}}return e};r.trigger=function a(d){var e=this;var f=e[b];if(g(f)&&h(d)){d=j(d);for(var i=0,k=d.length;i<k;i++){var l=d[i];var m=f[l];if(Array.isArray(m)){var n=new p(l);var q=arguments.length;var r=new Array(q);while(--q){r[q]=arguments[q]}n.target=e;r[c]=n;o(m,r)}}}return e};r.on=r.bind;r.off=r.unbind;r.emit=r.trigger;q.mixin=function a(b,c){if(b instanceof Function&&!c){b=b.prototype}var d=["bind","unbind","trigger","emit","on","off"];for(var e=0,f=d.length;e<f;e++){var g=d[e];b[g]=r[g]}};return q});define("mrg-microevent/microevent",["mrg-microevent"],function(a){return a});define("turntable/tools/isObject",function(require,exports,a){"use strict";function b(a){return Object(a)===a}a.exports=b});define("turntable/tools/hasOwnProperty",function(require,exports,a){"use strict";var b=Object.prototype.hasOwnProperty;function c(a,c){return b.call(a,c)}a.exports=c});define("turntable/tools/deepClone",function(require,exports,a){"use strict";var b=require("turntable/tools/isObject");var c=require("turntable/tools/hasOwnProperty");var d="Cannot convert undefined or null to object";var e="A function could not be cloned";var f="Is not array";function g(a,f){if(!b(a)){throw new TypeError(d)}for(var i=1;i<arguments.length;i++){f=arguments[i];if(b(f)){for(var j in f){if(c(f,j)){var k=f[j];if(typeof k=="function"){throw new TypeError(e)}if(Array.isArray(k)){a[j]=h([],k)}else if(b(k)){if(c(a,j)){var l=a[j];if(Array.isArray(l)){a[j]=g({},k)}else if(b(l)){a[j]=g(l,k)}else{a[j]=g({},k)}}else{a[j]=g({},k)}}else{a[j]=k}}}}}return a}function h(a,c){if(!Array.isArray(a)){throw new TypeError(f)}if(!Array.isArray(c)){throw new TypeError(f)}c.forEach(function(c){if(Array.isArray(c)){a.push(h([],c))}else if(b(c)){a.push(g({},c))}else{a.push(c)}});return a}a.exports=g});define("turntable/Config",function(require,exports,a){"use strict";var b=require("turntable/tools/deepClone");function c(a){b(this,this.defaults,a)}c.prototype={constructor:c,plugins:null,defaults:{plugins:{TizenHLS:{enabled:false,priority:3},FlashHLS:{enabled:true,priority:2,flashSrc:"./plugins/FlashHLS/flashlsChromeless.swf"},JSHLS:{enabled:false,priority:1,config:{}},Native:{ignoreCheckingMimeTypes:[],enabled:true,priority:0}}},set:function(a){b(this,a)}};a.exports=c});define("turntable/tools/log",function(require,exports,a){"use strict";var b=require("mrg-microevent");function c(a,b,c){this.type=a;this.target=b;this.targetName=b.name||"";this.timeStamp=Date.now();this.data=c;this.event=null;this.error=null}function d(a,b){this.type=a;this.target=b.target;this.data=b.data}function e(){}e.prototype={constructor:e,EVENT_LOG:"log",EVENT_EVENT:"event",EVENT_DEBUG:"debug",EVENT_INFO:"info",EVENT_WARNING:"warning",EVENT_ERROR:"error",eventEnabled:false,debugEnabled:false,infoEnabled:false,warningEnabled:false,errorEnabled:false,_emit:function(a,b,d){var e=new c(a,b,d);if(a==this.EVENT_EVENT){e.event=d}else if(a==this.EVENT_ERROR){e.error=d}this.emit(a,e);this.emit(this.EVENT_LOG,e)},event:function(a,b,c){if(this.eventEnabled){this._emit(this.EVENT_EVENT,a,new d(b,{target:a,data:c}))}},debug:function(a,b){if(this.debugEnabled){this._emit(this.EVENT_DEBUG,a,b)}},info:function(a,b){if(this.infoEnabled){this._emit(this.EVENT_INFO,a,b)}},warning:function(a,b){if(this.warningEnabled){this._emit(this.EVENT_WARNING,a,b)}},error:function(a,b){if(this.errorEnabled){this._emit(this.EVENT_ERROR,a,b)}},enableEvent:function(){this.eventEnabled=true},disableEvent:function(){this.eventEnabled=false},enableDebug:function(){this.debugEnabled=true},disableDebug:function(){this.debugEnabled=false},enableInfo:function(){this.infoEnabled=true},disableInfo:function(){this.infoEnabled=false},enableWarning:function(){this.warningEnabled=true},disableWarning:function(){this.warningEnabled=false},enableError:function(){this.errorEnabled=true},disableError:function(){this.errorEnabled=false},enable:function(){this.enableEvent();this.enableDebug();this.enableInfo();this.enableWarning();this.enableError()},disable:function(){this.disableEvent();this.disableDebug();this.disableInfo();this.disableWarning();this.disableError()}};b.mixin(e);a.exports=new e});define("turntable/tools/mediaFragmentsParser",function(require,exports,a){"use strict";var b=void 0;var c=true;function d(a){if(c&&typeof console!="undefined"&&console.log){console.log("Media Fragments URI Parsing Warning: "+a)}}function e(a){if(a>59){d("Please ensure that minutes <= 59.");return false}return a}function f(a,b){if(!b&&a>59){d("Please ensure that seconds <= 59.");return false}return a}function g(a,b){if(a>100){d("Please ensure that 0 <= "+b+" <= 100.");return false}return a}function h(a){if(!a){return NaN}var b=0,c=0,d=0,g=a[7]||"";var h=false;if(a[6]){h=true;d=a[6]+g}else if(a[4]&&a[5]){c=a[4];d=a[5]+g}else{b=parseInt(a[1],10);c=a[2];d=a[3]+g}c=e(parseInt(c,10));d=f(parseFloat(d),h);if(c===false||d===false){return false}return b*3600+c*60+d}function i(a){if(!a){return NaN}a[7]=a[7]||"";var b=parseInt(a[2],10);var c=e(parseInt(a[3],10));var d=f(parseInt(a[4],10));var g=parseInt(a[5]||"0",10);var h=parseInt(a[6]||"0",10);if(c===false||d===false){return false}return b*3600+c*60+d+g*.001+h*1e-6}var j={t:function(a){var c=a.split(",");if(c.length>2){return false}var e=c[0],f=c[1]||"";var g,j;var k;var l=/^(?:(?:npt\:)?(?:(?:(\d+)\:(\d\d)\:(\d\d))|(?:(\d\d)\:(\d\d))|(\d+))(\.\d*)?)?$/;var m=e.match(l);var n=f.match(l);if(m&&(!f||n)){g=h(m);j=h(n);e=e.replace(/^npt\:/,"");k="npt"}else{var o=/^(?:(?:smpte(-25|-30|-30-drop)?:)?(?:(\d+):(\d\d):(\d\d)(?::(\d\d)\.(\d\d)?)?)?)$/;m=e.match(o);n=f.match(o);if(e.substring(0,5)==="smpte"&&m&&(!f||n)){g=i(m);j=i(n);e=e.replace(/^smpte(-25|-30|-30-drop)?:/,"");k="smpte"+(m[1]||"")}else{if(b===void 0){b=!isNaN(Date.parse("2009-07-26T11:19:01Z"))}if(b&&e.substring(0,6)==="clock:"){e=e.substring(6);g=e?Date.parse(e):NaN;j=f?Date.parse(f):NaN;k="clock"}}}if((!e||g)&&(!f||j)){if(g&&j&&j<g){d("Please ensure that start < end.");return false}return{value:a,unit:k,start:e,end:f,startNormalized:g,endNormalized:j}}return false},xywh:function(a){var b=a.match(/^((?:(?:pixel)|(?:percent)):)?(\d+),(\d+),(\d+),(\d+)/);if(b){var c=b[1]==="percent:";var e=true;for(var f=2,h=[null,null,"x","y","w","h"],i=b.length;f<i;f++){b[f]=parseInt(b[f],10);if(c&&e){e=g(b[f],h[f])!==false}}if(!e){return false}if(!c&&(b[4]==0||b[5]==0)){d("Please ensure that w > 0 and h > 0");return false}return{value:a,unit:c?"percent":"pixel",x:b[2],y:b[3],w:b[4],h:b[5]}}d("Invalid spatial dimension.");return false},track:function(a){return{value:a,name:a}},id:function(a){return{value:a,name:a}},chapter:function(a){return{value:a,chapter:a}}};function k(a){try{return a?decodeURIComponent(a):""}catch(a){return""}}function l(a){var b={};for(var c=0,d=a.split("&"),e=d.length;c<e;c++){var f=d[c].split("=");var g=k(f.shift());var h=j[g];var i=h?k(f.join("=")):null;i=i&&h(i);if(!i){continue}if(g!=="t"&&b[g]){b[g].push(i)}else{b[g]=[i]}}return b}a.exports={parsePairs:l}});define("turntable/tools/cssSupports",function(require,exports,a){"use strict";function b(a,b){if(window.CSS&&CSS.supports){return CSS.supports(a,b)}return false}a.exports=b});define("turntable/tools/fallbackStorage",function(require,exports,a){"use strict";function b(){this._data=Object.create(null)}b.prototype={constructor:b,_data:null,getItem:function(a){var b=this._data;if(a in b){return b[a]}return null},setItem:function(a,b){if(arguments.length<2){throw new TypeError("2 arguments required")}this._data[a]=String(b)}};a.exports=new b});define("turntable/tools/reflectStorage",function(require,exports,a){"use strict";var b=require("turntable/tools/fallbackStorage");function c(){this._storage=this._getAvailableStorage()}c.prototype={constructor:c,_storage:null,_getAvailableStorage:function(){try{localStorage.setItem("reflectStorage",1);localStorage.removeItem("reflectStorage");return localStorage}catch(a){}return b},get:function(a){try{return JSON.parse(this._storage.getItem(a))}catch(a){}return null},set:function(a,b){try{this._storage.setItem(a,JSON.stringify(b))}catch(a){}},remove:function(a){try{this._storage.removeItem(a)}catch(a){}}};a.exports=new c});define("turntable/tools/getTiming",function(require,exports,a){"use strict";function b(a){var b=0;if(window.performance&&performance.timing){var c=performance.timing[a];if(isFinite(c)){b=c}}return b}a.exports=b});define("turntable/tools/videoQuality",function(require,exports,a){"use strict";var b=require("turntable/tools/reflectStorage");var c=require("turntable/tools/getTiming");function d(){}d.prototype={constructor:d,KEY_USER:"turntable/video/quality/user",KEY_AUTO:"turntable/video/quality/auto",TIMING_START:"navigationStart",TIMING_END:"domContentLoadedEventEnd",TIME_WIFI:3500,TIME_4G:4500,TIME_3G:6e3,QUALITY_1080p:1080,QUALITY_720p:720,QUALITY_480p:480,QUALITY_360p:360,HEIGHT_MIN_1080p:1e3,HEIGHT_MIN_720p:700,RATING_VERY_HIGH:5,RATING_HIGH:4,RATING_MEDIUM:3,RATING_LOW:2,RATING_VERY_LOW:1,_getControlTime:function(){return c(this.TIMING_END)-c(this.TIMING_START)},_getMaxHeight:function(){return window.screen.height},getOptimal:function(){var a=this._getControlTime()||this.TIME_4G;var b=this._getMaxHeight();var c;if(a<this.TIME_WIFI&&b>=this.HEIGHT_MIN_1080p){c=this.QUALITY_1080p}else if(a<this.TIME_4G&&b>=this.HEIGHT_MIN_720p){c=this.QUALITY_720p}else if(a<this.TIME_3G){c=this.QUALITY_480p}else{c=this.QUALITY_360p}return c},getMaxAuto:function(){return b.get(this.KEY_AUTO)||0},setMaxAuto:function(a){var c=this.KEY_AUTO;var d=b.get(c);if(a>d){b.set(c,a)}},getUserDefined:function(){return b.get(this.KEY_USER)||0},setUserDefined:function(a){b.set(this.KEY_USER,a)},getRating:function(a){var b;if(a>1e3){b=this.RATING_VERY_HIGH}else if(a>700){b=this.RATING_HIGH}else if(a>400){b=this.RATING_MEDIUM}else if(a>300){b=this.RATING_LOW}else{b=this.RATING_VERY_LOW}return b}};a.exports=new d});define("turntable/tools/assign",function(require,exports,a){"use strict";var b=require("turntable/tools/isObject");var c=require("turntable/tools/hasOwnProperty");var d="Cannot convert undefined or null to object";function e(a,e){if(!b(a)){throw new TypeError(d)}for(var f=1;f<arguments.length;f++){e=arguments[f];if(b(e)){for(var g in e){if(c(e,g)){a[g]=e[g]}}}}return a}a.exports=Object.assign||e});define("turntable/tools/flash",function(require,exports,a){"use strict";function b(){this.plugin=this.getPlugin();this.isAvailable=this.plugin!==null}b.prototype={constructor:b,plugin:null,isAvailable:false,_getPlugin:function(){if(!navigator.plugins||!navigator.mimeTypes){return null}var a=navigator.mimeTypes["application/x-shockwave-flash"];if(!a||!a.enabledPlugin){return null}var b=navigator.plugins["Shockwave Flash"];if(typeof b!="object"||!b.description){return null}return{name:b.name,filename:b.filename,description:b.description}},_getActiveX:function(){if(!window.ActiveXObject){return null}try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(a){return null}return{name:"ShockwaveFlash",description:"ActiveXObject.ShockwaveFlash"}},getPlugin:function(){return this._getPlugin()||this._getActiveX()}};a.exports=new b});define("turntable/plugins/FlashHLS/FlashVideo",function(require,exports,a){"use strict";var b=require("turntable/tools/log");var c=require("turntable/tools/mediaFragmentsParser");var d=require("turntable/tools/cssSupports");var e=require("turntable/tools/videoQuality");var f=require("turntable/tools/assign");var g=require("turntable/tools/flash");var h="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==";var i=Date.now().toString(36);var j=0;var k=String(document.attachEvent).indexOf("[native code]")!==-1;var l=navigator.userAgent.indexOf("YaBrowser/")!==-1;function m(){var a;try{a=localStorage["turntable/video/quality/auto"]}catch(a){}if(a==null||a==""){a=void 0}else{a=a|0}return a}function n(a){try{if(a.hlsIsAutoLevel()){var b=void 0;var c=a.hlsGetLevel();var d=a.hlsGetLevels()||{};for(var e=Object.keys(d),f=0,g=e.length;f<g;f++){var h=d[e[f]];if(h.index==c){b=h.videoHeight;break}}if(b){localStorage["turntable/video/quality/auto"]=b}}}catch(a){}}var o=void 0;function p(){if(o!==void 0){var a=m();if(a!==void 0&&o>a){return o}return a}o=e.getOptimal();return o}var q=k?{init:function(a,b){var c=this._documentGetElementById=document.getElementById;document.getElementById=function(d){var e=c.apply(this,arguments);if(!e&&d===b){if(!a.__isPluginRemoved){a._removeFlash()}e={SetReturnValue:function(){}}}return e}},documentGetElementById:function(){return this._documentGetElementById.apply(document,arguments)}}:void 0;function r(a){if(a&&a.parentNode){a.parentNode.removeChild(a)}}function s(a,b){if(b&&b.parentNode!=a){a.appendChild(b)}}function t(a,b){return a.replace(/\${(.*?)}/gi,function(a,c){return b[c]||""})}function u(a){var b=c.parsePairs(a.split("#").slice(1).join("#"));var d=b["t"]&&b["t"][0]||{};var e=b["xywh"];e=e&&e[e.length-1]||{};return{startFrom:d["startNormalized"]||0,endAt:d["endNormalized"]||0,videoWidth:e["w"]||0,videoHeight:e["h"]||0}}function v(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];var e=false;if(typeof d==="function"){d=b[c]={on:d}}else if(d===null){d=b[c]={value:null};if(c.indexOf("on")===0){e=true}}else if(typeof d!="object"){d=b[c]={value:d}}if(d.configurable==void 0){d.configurable=true}if(d.enumerable==void 0){d.enumerable=true}var f="on"in d;var g="get"in d||"set"in d;if(d.writable==void 0&&!g&&!f){d.writable=true}if(f&&g){throw new Error("Use only accessor descriptor or auto accessor descriptor")}if(f){if(d.value===void 0){a["_"+c]=null}(function(a,b){d.get=function(){return this["_"+a]};d.set=function(c){var d=b.call(this,c,this["_"+a]);if(d!==void 0){c=d}this["_"+a]=c}})(c,d["on"]);delete d["on"]}else if(e){(function(b){a["_"+b]=d.value;d.get=function(){return this["_"+b]};d.set=function(a){var c=this["_"+b];var d=b.replace(/^on/,"");this["_"+b]=a;if(c){this.removeEventListener(d,c,false)}this.addEventListener(d,a,false)};delete d.value;delete d.writable})(c)}if((g||f)&&d.value!==void 0){a["_"+c]=d.value;delete d.value}}Object.defineProperties(a,b)}var w=function(a,b,c){try{c=new window.CustomEvent(a,{cancelable:false,bubbles:false,detail:b});if(c.type===a&&c.detail===b){return window.CustomEvent}}catch(a){}try{c=new window.Event(a,{cancelable:false,bubbles:false,detail:b});c.detail=b;if(c.type===a&&c.detail===b){return function(a,b){var c=new window.Event(a,b);var d=b&&b.detail;if(d===void 0)d=null;c.detail=d;return c}}}catch(a){}return function(a,b){var c=window.document.createEvent("Events");c.initEvent(a,false,false);var d=b&&b.detail;if(d===void 0)d=null;c.detail=d;return c}}("test-event",{});function x(a,b){return new w(a,{cancelable:false,bubbles:false,detail:b})}function y(a,b,c){a.dispatchEvent(x(b,c))}var z=window.setImmediate||window.setTimeout;function A(a,b,c){z(function(){a.dispatchEvent(x(b,c));a=b=c=null})}function B(){var a=arguments.length;this.length=a;this._ranges=new Array(a);for(var b,c=0;c<a;c++){b=arguments[c];this._ranges[c]=b}this.start=function(a){if(a<0){throw new Error("Failed to execute 'start' on 'TimeRanges': The index provided ("+a+") is lower than 0.")}if(a>this.length-1){throw new Error("Failed to execute 'start' on 'TimeRanges': The index provided ("+a+") is greater than the maximum bound ("+this.length+").")}return this._ranges[a].start};this.end=function(a){if(a<0){throw new Error("Failed to execute 'end' on 'TimeRanges': The index provided ("+a+") is lower than 0.")}if(a>this.length-1){throw new Error("Failed to execute 'end' on 'TimeRanges': The index provided ("+a+") is greater than the maximum bound ("+this.length+").")}return this._ranges[a].end}}var C={getCurrentLevel:null,getNextLevel:null,getLoadLevel:null,getLevels:null,getAutoLevel:null,getDuration:null,getPosition:null,getPlaybackState:null,getSeekState:null,getType:null,getmaxBufferLength:null,getminBufferLength:null,getlowBufferLength:null,getmaxBackBufferLength:null,getbufferLength:null,getbackBufferLength:null,getLogDebug:null,getLogDebug2:null,getUseHardwareVideoDecoder:null,getCapLeveltoStage:null,getAutoLevelCapping:null,getflushLiveURLCache:null,getstartFromLevel:null,getseekFromLowestLevel:null,getJSURLStream:null,getPlayerVersion:null,getAudioTrackList:null,getAudioTrackId:null,getCapLevelToWidth:null,getCapLevelToHeight:null,getCapStartLevelToWidth:null,getCapStartLevelToHeight:null,getseekAutoLevelSkipCount:null,getBandwidthLoadDelay:null,getCheck415Error:null,getFragmentsLoadStrict:null,playerLoad:null,playerPlay:null,playerPause:null,playerResume:null,playerSeek:null,playerStop:null,playerVolume:null,playerSetCurrentLevel:null,playerSetNextLevel:null,playerSetLoadLevel:null,playerSetAudioTrack:null,playerSetJSURLStream:null,playerRetryLoadFragment:null,playerSetmaxBufferLength:true,playerSetminBufferLength:true,playerSetlowBufferLength:true,playerSetbackBufferLength:true,playerSetflushLiveURLCache:true,playerSetstartFromLevel:true,playerSetseekFromLevel:true,playerSetLogDebug:true,playerSetLogDebug2:true,playerSetUseHardwareVideoDecoder:true,playerSetAutoLevelCapping:true,playerCapLeveltoStage:true,playerSetManifestLoadMaxRetry:true,playerSetFragmentLoadMaxRetry:true,playerSetCapLevelToWidth:true,playerSetCapLevelToHeight:true,playerSetCapStartLevelToWidth:true,playerSetCapStartLevelToHeight:true,playerSetseekAutoLevelSkipCount:true,playerSetBandwidthLoadDelay:true,playerSetCheck415Error:true,playerSetFragmentsLoadStrict:true,playerSetSeekMode:true,playerSetKeyLoadMaxRetry:true,playerSetFragmentLoadSkipAfterMaxRetry:true};var D=Array.prototype.slice;var E=Object.keys(C).reduce(function(a,b){if(!a[b]){a[b]=function(){this.__saveCall(b,arguments)}}return a},{__isProxy:true,__isPlayed:false,__newLevel:-1,__settingsInOrder:[],__methodsInOrder:[],__getCalls:function(){return[].concat(this.__settingsInOrder,this.__methodsInOrder)},__clearCalls:function(){this.__settingsInOrder=[];this.__methodsInOrder=[]},__saveCall:function(a,b){var c=C[a];var d=c?this.__settingsInOrder:this.__methodsInOrder;if(this["is"+a]){this.__cancelCall(a)}d.push(a);this["is"+a]=D.call(b,0)},__cancelCall:function(){for(var a=0,b=arguments.length;a<b;a++){var c=arguments[a];if(this["is"+c]){var d=C[c];var e=d?this.__settingsInOrder:this.__methodsInOrder;this["is"+c]=void 0;for(var f=0,g=e.length;f<g;f++){if(e[f]===c){e.splice(f,1);f--}}}}},getAutoLevel:function(){return this.__newLevel===-1},playerSetCurrentLevel:function(a){this.__newLevel=a;this.__saveCall("playerSetCurrentLevel",arguments)},playerSetNextLevel:function(a){this.__newLevel=a;this.__saveCall("playerSetNextLevel",arguments)},getCurrentLevel:function(){return this.__newLevel},playerPlay:function(){this.__saveCall("playerPlay",arguments);this.__cancelCall("playerResume","playerPause","playerStop")},playerPause:function(){if(!this["isplayerStop"]){this.__saveCall("playerPause",arguments)}this.__cancelCall("playerResume","playerPlay")},playerResume:function(){this.__saveCall("playerResume",arguments);this.__cancelCall("playerPause","playerPlay","playerStop")},playerStop:function(){this.__saveCall("playerStop",arguments);this.__cancelCall("playerResume","playerPlay")}});function F(a,b,c){b=b||E.__getCalls();var d=a.flashObject;var e;while(e=b.shift()){var f=E["is"+e];if(f){try{d[e].apply(d,f);E.__cancelCall(e)}catch(f){if(c){E.__cancelCall(e);throw f}else{b.unshift(e);setTimeout(function(){F(a,b,true);a=d=b=null},200);return}}}}}function G(a,b,c,d,e){if(C[b]===void 0){throw new Error("Unknown flash method: "+b)}a._checkFlash();var f=a.flashObject;var h=f[b];var i=false;{c=c||[];try{i=h.apply(f,c)}catch(c){{if(e){return false}else if(d){A(a,"error",[{isFlashAPICall:true,methodName:b,plugin:g.plugin},c.url,c.message]);return c}else{throw c}}}}return i}function H(a){return a&&!a.__isProxy&&typeof a["playerPlay"]==="function"}function I(a){v(a,{name:"flashls",NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3,HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4,autoplay:false,buffered:{get:function(){return this._buffered},value:new B},controller:{get:function(){return null},set:function(){b.warning(this,"FlashVideo.js: set controller() not implemented")}},controls:{get:function(){b.warning(this,"FlashVideo.js: get controls() not implemented");return false},set:function(){b.warning(this,"FlashVideo.js: set controls() not implemented")}},crossorigin:{get:function(){b.warning(this,"FlashVideo.js: get crossorigin() not implemented");return void 0},set:function(){b.warning(this,"FlashVideo.js: set crossorigin() not implemented")}},currentSrc:{get:function(){if(this._networkState==0){return""}return this._src}},currentTime:{on:function(a,b){a=this._updateCurrentTime(a,true,b);return a},value:0},defaultMuted:false,defaultPlaybackRate:{on:function(a){b.warning(this,"FlashVideo.js: get/set defaultPlaybackRate() not implemented")},value:1},duration:{get:function(){return this._duration},value:NaN},ended:false,error:null,loop:{on:function(){b.warning(this,"FlashVideo.js: get/set loop() not implemented")},value:false},mediaGroup:{get:function(){b.warning(this,"FlashVideo.js: get mediaGroup() not implemented");return void 0},set:function(){b.warning(this,"FlashVideo.js: set mediaGroup() not implemented")}},height:{on:function(a){this.style.height=a},value:a.style.height||0},muted:{on:function(a){a=Boolean(a);if(a){G(this,"playerVolume",[0])}else{G(this,"playerVolume",[this._volume*100])}if(this._muted!=a){this._muted==a;A(this,"volumechange")}},value:false},networkState:{get:function(){return this._networkState},value:0},paused:{get:function(){return this._paused},value:true},playbackRate:{on:function(a){b.warning(this,"FlashVideo.js: get/set playbackRate not implemented")},value:1},played:{get:function(){return this._played},value:new B},preload:{on:function(a){if(!a||a!="none"&&a!="metadata"&&a!="auto"){a="auto"}return a},value:"auto"},readyState:{get:function(){return this._readyState},value:0},seekable:{get:function(){return void 0}},seeking:{get:function(){return this._seeking},value:false},src:{on:function(a){this._src=a;this.load()},value:""},__isPosterShowed:true,poster:{on:function(a,b){if(a!=b){this._posterWidth=0;this._posterHeight=0}if(this.__isPosterShowed===true||this.__isPosterShowed===void 0){this._showPoster(a,b,true)}else{this._loadPoster(a,b)}},value:""},videoHeight:{get:function(){return this._videoHeight||this._posterHeight},value:0},videoWidth:{get:function(){return this._videoWidth||this._posterWidth},value:0},width:{on:function(a){this.style.width=a},value:a.style.width||0},volume:{on:function(a){if(a>1){a=1}else if(a<0){a=0}if(!this._muted){G(this,"playerVolume",[a*100])}if(this._volume!=a){this._volume=a;A(this,"volumechange")}return a},value:1},hasAudio:{get:function(){return this._hasAudio},value:false},oncanplay:null,ondurationchange:null,onemptied:null,onended:null,onerror:null,onloadeddata:null,onloadedmetadata:null,onloadstart:null,onpause:null,onplay:null,onplaying:null,onprogress:null,onseeked:null,onseeking:null,ontimeupdate:null,onvolumechange:null,onwaiting:null,canPlayType:{value:function(a){return a=="application/x-mpegurl"?"probably":""}},fastSeek:{value:function(a){this.currentTime=a}},pause:{value:function(){this._paused=true;if(!this.__paused){this.__paused=true;y(this,"pause");G(this,"playerPause")}}},__isStoped:true,__isPlayed:false,play:{value:function(){if(this.__paused){this.__paused=false;y(this,"play")}if(this._isEmptySrc(this._src)){return}if(this.__isStoped===true&&this.preload==="none"){G(this,"playerLoad",[this._src],true);A(this,"loadstart")}if(this.__isPluginRemoved){this._createFlash()}if(this.__isPosterShowed===true){var a=this;setTimeout(function(){if(a.__isPosterShowed===true&&a.__isPluginInactive===true){a._hidePoster()}a=void 0},1e3)}var b;var c=this._paused;this._paused=false;if(this.__isStoped===true){this.__isStoped=false;if(this._readyState>0){this.__isPlayed=true;if(this.ended){this._currentTime=0}b=G(this,"playerPlay",[this._currentTime],true)}}else if(c){b=G(this,"playerResume",null,true)}if(b&&b!==true){this._paused=c}if(!this._paused&&this.__hls_forced_currentLevel!==void 0){this._hlsCheckLevel()}}},hlsGetPrevTimeInfo:{value:function(){return this._prevTimeInfo}},hlsGetLevels:{value:function(){return this.__hls_levelsInfo}},mrgVideoQualityLevels:{get:function(){var a=this.hlsIsAutoLevel();var b=this.__hls_forced_currentLevel||-1;var c=this.hlsGetLevel();var d=this.hlsGetLevels()||{};d=Object.keys(d).map(function(f){var g=d[f];var h=g.videoHeight;var i=g.index;var j=i==c;var k=j&&i==b;var l=j&&!k&&a;return{index:i,name:h+"p",videoWidth:g.videoWidth,videoHeight:h,bitrate:g.bitrate,rating:e.getRating(h),isCurrent:j,isManual:k,isAuto:l}});return d}},hlsSwitchLevel:{value:function(a){if(this.__isStoped&&a>-1){this.__hls_forced_currentLevel=a}if(this.error||this.paused){G(this,"playerSetCurrentLevel",[a],true)}else{G(this,"playerSetNextLevel",[a],true)}}},hlsGetLevel:{value:function(){if(this.__hls_forced_currentLevel!==void 0){return this.__hls_forced_currentLevel}return this.__hls_currentLevel}},mrgVideoQualityLevel:{get:function(){return this.hlsGetLevel()},set:function(a){this.hlsSwitchLevel(a)}},hlsIsAutoLevel:{value:function(){if(this.__hls_forced_currentLevel!==void 0){return false}var a=G(this,"getAutoLevel",null,false,true);if(typeof a!=="boolean"){a=true}return a}},mrgAutoSwitchVideoQuality:{get:function(){return this.hlsIsAutoLevel()},set:function(a){if(a){this.hlsSwitchLevel(-1)}else{this.hlsSwitchLevel(this.hlsGetLevel())}}},_hlsCheckLevel:{value:function(){if(this.__hls_forced_currentLevel!==void 0){var a=G(this,"getAutoLevel",null,false,true);var b=a?-1:G(this,"getCurrentLevel",null,false,true);if(typeof b==="number"){if(b!==this.__hls_forced_currentLevel){this.hlsSwitchLevel(this.__hls_forced_currentLevel)}else{a=G(this,"getAutoLevel",null,false,true);if(!a){this.__hls_forced_currentLevel=void 0}}}}}},_loadPoster:{value:function(a,b){if(this.imageElement.src!==h&&b!=a){this.imageElement.src=h}if(a){this.imageElement.src=a}}},_showPoster:{value:function(a,b,c){if(c){this._loadPoster(a,b)}if(this.imageElement.src&&this.imageElement.src!==h){this._hideOverlay();this.__isPosterShowed=true;this.posterElement.style.display="";this.canvasElement.style.pointerEvents="none"}else{this._hidePoster(true);this._showOverlay()}}},_hidePoster:{value:function(a){this.__isPosterShowed=a?void 0:false;if(this.__isPluginInactive){this._hideOverlay()}else{this._showOverlay()}this.posterElement.style.display="none"}},_showOverlay:{value:function(){this.canvasElement.style.pointerEvents="none";this.overlayElement.style.display=""}},_hideOverlay:{value:function(){this.canvasElement.style.pointerEvents="auto";this.overlayElement.style.display="none"}},_updateRanges:{value:function(a,b,c){var d=false;if(b<0){b=0}var e=b!=void 0?a-b:0;var f=a+(c||0);if(this.__lastBufferStart!=e||this.__lastBufferEnd!=f){this.__lastBufferStart=e;this.__lastBufferEnd=f;this._buffered=new B({start:this.__lastBufferStart,end:this.__lastBufferEnd});d=true}if(this.__lastPlayedStart!=e||this.__lastPlayerEnd!=a){this.__lastPlayedStart=e;this.__lastPlayerEnd=a;this._played=new B({start:this.__lastPlayedStart,end:this.__lastPlayerEnd})}return d}},_updateCurrentTime:{value:function(a,b,c){if(b){a=+a;if(a<0){a=0}if(isNaN(a)){this._currentTime=c;throw new TypeError("Failed to set the 'currentTime' property on 'HTMLMediaElement': The provided double value is non-finite.")}G(this,"playerSeek",[a],true);if(this.__isStoped===true&&this.__isPlayed===false){G(this,"playerPause")}}if(this._currentTime!=a){this._currentTime=a;A(this,"timeupdate")}return a},enumerable:false,configurable:false},_setDefaultSize:{value:function(){var a=this._posterWidth||this._videoWidth;var b=this._posterHeight||this._videoHeight;if(!b||!a){b="100%";a="100%"}else{a=a+"px";b=b+"px"}this.canvasElement.style.width=a;this.canvasElement.style.height=b}},_isEmptySrc:{value:function(a){return!a||String(a).indexOf("about:")===0}},load:{value:function(){this.error=null;this._duration=NaN;this._prevTimeInfo={buffered:null,played:null,currentTime:0};this._currentTime=0;this.__loadCounter=++j;this.__hlsFragmentsLoad={};this.__hls_levelsInfo=null;this.__hls_levelsInfoIndexes=null;this.__hls_currentLevel=-1;this.__hls_forced_currentLevel=void 0;this.__isPluginInactive=!H(this.flashObject);this.__isStoped=true;this.__isPlayed=false;this.__firstFragment=true;this.__endAt=0;this.__whPredefined=false;this._paused=true;this.__paused=true;this._seeking=false;this._readyState=0;this._networkState=0;this._videoHeight=0;this._videoWidth=0;this._played=new B;this._buffered=new B;this.ended=false;this._showPoster();G(this,"playerStop",null,false,true);y(this,"emptied");y(this,"-x-level-switch",0);y(this,"mrgVideoQualityChange");this._src=String(this._src||"");var a=this._src;var b=!a||/^about:/.test(a);if(this._isEmptySrc(a)){this._removeFlash()}else{var c=u(a);this._currentTime=c.startFrom;this.__endAt=c.endAt;if(c.videoHeight&&c.videoWidth){this.__whPredefined=true;this._videoHeight=c.videoHeight;this._videoWidth=c.videoWidth;this._setDefaultSize()}this._networkState=2;if(this.preload!=="auto"){G(this,"playerPause",null,false,true)}this.volume=this._volume;this.muted=this._muted;if(this.preload!="none"){G(this,"playerLoad",[a],true);A(this,"loadstart")}if(this.preload!="none"&&this.__isPluginRemoved){this.__isPluginRemoved=false;this._createFlash()}}}},_checkFlash:{value:function(){var b=false;var c=this.flashObject;if(c&&!c.__isProxy){var d=c["playerLoad"];b=typeof d==="function";if(b&&q&&q.documentGetElementById(a.elementId)==null){b=false}if(!b){this._removeFlash()}}return b}},_removeFlash:{value:function(){a.__isPluginRemoved=true;a.__isPluginInactive=true;this.flashObject=E;this.objectElement=null;this.embedElement=null;a.canvasElement.innerHTML="";if(this.__checkFlashInterval){clearInterval(this.__checkFlashInterval);this.__checkFlashInterval=void 0}}},_createFlash:{value:function(){if(!this.__isPluginRemoved){this._removeFlash()}var a=l?"opaque":"transparent";var b=t('<object data-role="canvas-object" id="${flashElementId}" style="${resetCss};display:block;background:transparent" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="">'+'<param name="movie" value="${flashSrc}">'+'<param name="quality" value="autohigh">'+'<param name="swliveconnect" value="true">'+'<param name="allowscriptaccess" value="always" />'+'<param name="allownetworking" value="all" />'+'<param name="allowFullScreen" value="false">'+'<param name="wmode" value="'+a+'">'+'<param name="menu" value="false" />'+'<param name="FlashVars" value="callback=window.${callbackName}">'+'<embed data-role="canvas-embed" name="${flashElementId}" style="${resetCss};display:block;background:transparent"'+' src="${flashSrc}"'+' quality="autohigh"'+' align="middle"'+' allowfullscreen="false"'+' allowscriptaccess="always"'+' allownetworking="all"'+' type="application/x-shockwave-flash"'+' swliveconnect="true"'+' wmode="'+a+'"'+' menu="false"'+' flashvars="callback=window.${callbackName}" />'+"</object>",this.__elementParams);this.__isPluginRemoved=false;this.canvasElement.insertAdjacentHTML("beforeend",b);this.objectElement=this.canvasElement.querySelector("object");this.embedElement=this.canvasElement.querySelector("embed");s(this,this.overlayElement);s(this,this.posterElement);s(this.posterElement,this.posterPositionElement);s(this.posterElement,this.imageElement);s(this,this.canvasElement);s(this.canvasElement,this.objectElement);s(this.objectElement,this.embedElement);if(String(window["opera"])==="[object Opera]"){this.overlayElement.style.zIndex=2;this.canvasElement.style.position="relative";this.canvasElement.style.zIndex=1;this.objectElement.style.position="absolute";this.objectElement.style.top=0;this.objectElement.style.left=0;this.objectElement.style.right=0;this.objectElement.style.bottom=0}var c=this;if(this.__checkFlashInterval){clearInterval(this.__checkFlashInterval)}this.__checkFlashInterval=setInterval(function(){c._checkFlash()},60*1e3)}},__isPluginInactive:true,__isPluginRemoved:true})}function J(a,b){y(this,"flash-event",[a].concat(b))}var K=3;function L(a,b,c,d){var e=new Error(b);e.details=b;e.url=c||"";e.code=d||0;a.error=e;y(a,"error",b)}function M(a,b,c,d,e){try{if(e>1){if(a.__hls_levelsInfoIndexes[c-1]){c--}}G(a,"playerRetryLoadFragment",[c,d])}catch(c){N(a,b)}}function N(a,b){O();var c=b["httpError"]||{};L(a,c["message"],c["url"],c["code"])}function O(){if(M._timeout){clearTimeout(M._timeout);M._timeout=void 0}}function P(a,b){O();var c=b["fragmentIndex"];var d=b["fragmentLevel"];var e=c+"|"+d;var f=b["hasLoadedFragments"];var g=b["paused"];var h=!f&&!g;var i=(a.__hlsFragmentsLoad[e]|0)+1;if(i+1>K||i===2&&h){N(a,b);return}var j=f||a._paused;var k=(5*(j?3:1)+10*i)*1e3;a.__hlsFragmentsLoad[e]=i;M._loadCounter=a.__loadCounter;M._timeout=setTimeout(function(){if(M._loadCounter!==a.__loadCounter){O();return}M(a,b,c,d,i)},k)}function Q(a){var b=a.detail;var c=b.shift();switch(c){case"error":{L(this,b[2],b[1],b[0])}break;case"ready":{this.__isPluginInactive=false;this._showPoster();var d=this.flashObject&&this.flashObject.__isProxy;G(this,"playerSetstartFromLevel",[1]);G(this,"playerSetseekAutoLevelSkipCount",[3]);G(this,"playerSetBandwidthLoadDelay",[.5]);G(this,"playerSetCheck415Error",[true]);G(this,"playerSetFragmentsLoadStrict",[true]);G(this,"playerSetCapStartLevelToHeight",[p()]);G(this,"playerSetUseHardwareVideoDecoder",[false]);G(this,"playerSetManifestLoadMaxRetry",[3]);G(this,"playerSetKeyLoadMaxRetry",[3]);G(this,"playerSetFragmentLoadMaxRetry",[4]);G(this,"playerSetFragmentLoadSkipAfterMaxRetry",[false]);G(this,"playerSetminBufferLength",[10]);G(this,"playerSetlowBufferLength",[2]);G(this,"playerSetmaxBufferLength",[40]);G(this,"playerSetSeekMode",["ACCURATE"]);G(this,"playerSetseekFromLevel",[false]);if(this.__isStoped===true){this._paused=true;this.__paused=true;if(this.autoplay){this.play()}else{G(this,"playerStop",null,false,true)}}this.flashObject=H(this.objectElement)?this.objectElement:this.embedElement;if(d){F(this)}y(this,"-x-ready")}break;case"videoSize":{var e=this._videoWidth===0&&this._videoHeight===0;if(e){this._videoWidth=b[0];this._videoHeight=b[1];this._setDefaultSize();y(this,"loadedmetadata")}}break;case"switch":{this.__hls_currentLevel=b[0];y(this,"-x-level-switch",b[0]);y(this,"mrgVideoQualityChange");n(this)}break;case"manifest":{this._networkState=1;this._readyState=1;this._duration=b[0];var f=b[1];var g=this.__hls_levelsInfo={};this.__hls_levelsInfoIndexes={};var h=0,i=0;for(var j=0,k=f.length;j<k;j++){var l=f[j];var m=l.width;var o=l.height;g[o]={index:j,videoWidth:m,videoHeight:o,bitrate:l.bitrate};if(m>0&&o>0){h=Math.max(h,l.width);i=Math.max(i,l.height)}this.__hls_levelsInfoIndexes[j]=true}y(this,"-x-levels",g);y(this,"mrgVideoQualityChange");n(this);if(this.__whPredefined){y(this,"loadedmetadata")}else{if(h>0&&i>0){this._videoWidth=h;this._videoHeight=i;this._setDefaultSize();y(this,"loadedmetadata")}else{}}y(this,"durationchange");if(this.__isStoped===false&&this.__isPlayed===false){this.__isPlayed=true;G(this,"playerPlay",[this._currentTime],true)}else{if(this.preload=="auto"){G(this,"playerSeek",[this._currentTime],false,true)}else{E.__cancelCall("playerSeek")}if(this._paused){G(this,"playerPause",null,false,true)}}F(this,["playerSeek","playerPause"])}break;case"state":{var q=b[0];this._networkState=1;this.__surrentState=q;if(this.__isPosterShowed===true&&this.__isStoped===false&&this._readyState&&q!=="IDLE"){this._hidePoster()}if(this.__hls_forced_currentLevel!==void 0){this._hlsCheckLevel()}if(q=="PAUSED"){this._paused=true;this.__isStoped=false;if(!this.__paused){this.__paused=true;y(this,"pause")}}else if(q=="IDLE"){this._paused=true;this.__paused=false}else if(q=="PLAYING"){if(this.__buffering===true){y(this,"canplay")}this.__isStoped=false;this._paused=false;if(this.__paused){this.__paused=false;y(this,"play")}y(this,"playing")}else if(q=="PLAYING_BUFFERING"||q=="PAUSED_BUFFERING"){this._networkState=2;this.__buffering=true;if(q=="PAUSED_BUFFERING"){this._paused=true}y(this,"waiting")}}break;case"seekState":{var r=b[0];if(r=="SEEKING"){this._seeking=true;y(this,"seeking")}else if(r=="SEEKED"){this._seeking=false;this._readyState=2;y(this,"seeked")}else if(r=="IDLE"){this._seeking=false}}break;case"audioTrackChange":{this._hasAudio=true}break;case"fragmentPlaying":{}break;case"fragmentLoaded":{if(this.__firstFragment){y(this,"loadeddata");this.__firstFragment=false}}break;case"fragmentLoadError":{P(this,b[0])}break;case"complete":{this._showPoster();this._networkState=1;var s=this.__isStoped;this._currentTime=this._duration;this.ended=true;this._paused=true;this.__isStoped=true;this.__isPlayed=false;if(!s){setTimeout(function(){y(this,"ended")}.bind(this),200)}}break;case"position":{if(this._readyState===0){break}b=b[0];if(this.__isStoped&&this.preload==="none"){}if(this._duration!=b.duration){this._duration=b.duration;y(this,"durationchange")}if(this.__isStoped){return}var t=b.position;if(t<0){t=0}var u=this._updateRanges(t,b.backbuffer,b.buffer);this._prevTimeInfo={buffered:this._buffered,played:this._played,currentTime:this._currentTime};var v=this._updateCurrentTime(t,false);if(v!=t){u=this._updateRanges(t,b.backbuffer,b.buffer)}if(u){y(this,"progress")}if(this.__endAt&&t>=this.__endAt){this.__endAt=0;this.pause()}}break}}var R=false;function S(){if(R){return}R=true;var a=["target","srcElement","toElement","detail","path"];for(var b=0,c=a.length;b<c;b++){var d=a[b];var e=Object.getOwnPropertyDescriptor(Event.prototype,d);if(!e){continue}(function(a,b){e.get=function(){if(this["__"+b]!==void 0){return this["__"+b]}else{return a.call(this)}}})(e.get,d);Object.defineProperty(Event.prototype,d,e)}}function T(a){var b=a.detail&&a.detail.__needToResetTarget__;var c=b&&a.detail.prevDetail;var d=false;if(b||a.__needToResetTarget__){var e=Array.isArray(a.path);var f=e&&a.path.slice(1);var g=["target",true,this,"srcElement",true,this,"toElement",true,this,"detail",b,c,"path",e,f];for(var h=0,i=g.length;h<i;h+=3){var j=g[h],k=g[h+1],l=g[h+2];if(k){if(R){a["__"+j]=l;continue}try{delete a[j]}catch(a){}if(a[j]!==l){try{Object.defineProperty(a,j,{value:l,configurable:true,enumerable:true})}catch(a){}}if(a[j]!==l){d=true;a["__"+j]=l}}}delete a.__needToResetTarget__}if(d&&!R){S()}}var U={keydown:null,keyup:null,keypress:null,input:null,click:null,dblclick:null,mousedown:null,mouseup:null,mouseover:null,mousemove:null,mouseout:null,mouseenter:null,mouseleave:null,mousewheel:null,wheel:null,contextmenu:null,touchstart:null,touchmove:null,touchend:null,touchcancel:null,pointerdown:null,pointerenter:null,pointerleave:null,pointermove:null,pointerout:null,pointerup:null};function V(a){var b={prevDetail:a.detail,__needToResetTarget__:true};Object.defineProperty(a,"detail",{value:b,configurable:true,enumerable:true});Object.defineProperty(a,"__needToResetTarget__",{value:true,configurable:true,enumerable:false});if(a.detail!=b){S();a.__detail=b}}function W(a,b,c,d){var e="on"+c.toLowerCase();var f="__is"+e+"__";if(U[c]!==void 0&&!b[f]){b[e]=V;b[f]=1;a.__addEventListener(c,T,d)}else if(b[f]){b[f]++}}function X(a,b,c){a=String(a);W(this,this.imageElement,a,c);W(this,this.posterElement,a,c);W(this,this.overlayElement,a,c);this.__addEventListener(a,b,c)}function Y(a,b,c){var d="on"+String(a).toLowerCase();var e="__is"+d+"__";var f=this.imageElement;if(U[a]!==void 0&&f[e]){f[e]--;if(f[e]==0){f[d]=null}}this.__removeEventListener(a,b,c)}function Z(a){a._showPoster();a.removeEventListener("flash-event",Q,false);a._removeFlash();r(a.overlayElement);a.imageElement.onload=null;a.imageElement.onerror=function(){this.src=h};a.imageElement=null;a.posterPositionElement=null;a.posterElement=null;a.objectElement=null;a.canvasElement=null;a.embedElement=null;a.overlayElement=null;a.id="";var b=a.callbackName;a.callbackName=window[b]=void 0;for(var c in a)if(a.hasOwnProperty(c))if(c.substring(0,1)=="_"){a[c]=void 0}delete a.addEventListener;delete a.removeEventListener;delete window[b]}function _(a){if(!a.flashSrc){throw new Error('need a flash root in "flashUrl" param')}var b="width:100%;height:100%;max-width:none;max-height:none;min-width:0;min-height:0";var c="margin:0;padding:0;opacity:1;line-height:normal;white-space:nowrap";var e="flashhls"+i+(Math.random()*1e7|0).toString(32);var g=e+"___callback";var j='<div data-role="video" id="${elementId}" class="${elementId}" style="width:${defaultWidth}px;height:${defaultHeight}px;position: absolute;visibility: hidden;display: none;">'+'<div data-role="overlay" style="${resetCss};display:block;position: absolute;top: 0;bottom: 0;left: 0;right: 0;background: transparent;"></div>'+'<div data-role="poster" style="${resetCss};display:none;position: absolute;top: 0;bottom: 0;left: 0;right: 0;text-align:center;background:transparent">'+'<span data-role="poster-position" style="${resetCssOther};width:auto;height:100%;max-width:none;max-height:none;min-height:0;min-width:0;display:inline-block;vertical-align:middle;"></span>'+'<img data-role="poster-image" src="${emptyImage}" style="${resetCssOther};width:auto;height:auto;max-width:100%;max-height:100%;min-height:0;min-width:0;display:inline-block;vertical-align:middle;background:transparent;object-fit:contain;" />'+"</div>"+'<div data-role="canvas" style="${resetCss};width:100%;height:100%;max-width:100%;max-height:100%;min-width:100%;min-height:100%;display:block;background: transparent"></div>'+"</div>";var l=e+"Flash";var m=f({defaultWidth:300,defaultHeight:150},a,{callbackName:g,elementId:e,flashElementId:l,emptyImage:h,resetCss:b+";"+c,resetCssSize:b,resetCssOther:c});j=t(j,m);document.head.insertAdjacentHTML("afterbegin",t('<style id="${elementId}Style">.${elementId} {${resetCssOther};display: inline-block;width: auto;height: auto;vertical-align: bottom;}</style>',m));document.body.insertAdjacentHTML("beforeend",j);var n=document.getElementById(e);document.body.removeChild(n);n.__elementParams=m;n.style.width="";n.style.height="";n.style.position="relative";n.style.visibility="";n.style.display="";window[g]=J.bind(n);n.addEventListener("flash-event",Q,false);I(n);n.callbackName=g;n.elementId=e;var o=n.querySelectorAll("div");n.overlayElement=o[0];n.posterElement=o[1];n.imageElement=n.posterElement.querySelector("img");n.posterPositionElement=n.posterElement.querySelector("span");n.canvasElement=o[2];if(k){n.overlayElement.style.backgroundColor="#000";n.overlayElement.style.opacity="0";q.init(n,l)}var p=d("object-fit","contain")||d("-o-object-fit","contain");var r,s;if(!p){r=function(a,b){if(a>b&&b<=n.offsetHeight){if(s!==true){s=true;n.imageElement.style.width="100%";n.imageElement.style.height="auto"}}else{if(s!==false){s=false;n.imageElement.style.width="auto";n.imageElement.style.height="100%"}}};if(k){n.attachEvent("onresize",function(){if(this._posterWidth&&this._posterHeight){r(n._posterWidth,n._posterHeight)}})}}n._posterWidth=0;n._posterHeight=0;n.imageElement.onerror=function(){n._hidePoster(true);n._posterWidth=0;n._posterHeight=0;n._setDefaultSize();this.src=h};n.imageElement.onload=function(){if(this.src==h){n._posterWidth=0;n._posterHeight=0;return}var a=this.naturalWidth;var b=this.naturalHeight;if(!a||!b){this.onerror();return}n._posterWidth=a;n._posterHeight=b;if(!p){r(n._posterWidth,n._posterHeight)}else{this.style.width="100%";this.style.height="100%"}n._setDefaultSize()};n.flashObject=E;n.__destroyElement=Z.bind(null,n);var u=function(a){if(n.__isPluginInactive&&!n.__isPluginRemoved){a.stopPropagation()}};n.canvasElement.addEventListener("click",u,false);n.canvasElement.addEventListener("mousemove",u,false);n.canvasElement.addEventListener("mousedown",u,false);n.__addEventListener=n.addEventListener;n.addEventListener=X;n.__removeEventListener=n.removeEventListener;n.removeEventListener=Y;return n}a.exports={createElement:_,destroyElement:Z}});define("turntable/plugins/FlashHLS/FlashHLS",function(require,exports,a){"use strict";var b=require("turntable/tools/log");var c=require("turntable/plugins/FlashHLS/FlashVideo");var d=require("turntable/tools/flash");function e(a){var b=c.createElement({flashSrc:a});b.isFlash=true;b.pluginName="FlashHLS";return b}function f(a){this._flashSrc=a.flashSrc;b.debug(this,"construct")}f.prototype={constructor:f,HLS_MIME_TYPE:"application/x-mpegurl",name:"FlashHLS",_flashSrc:"./flashlsChromeless.swf",_mediaElement:null,getMediaElement:function(){if(!this._mediaElement){this._mediaElement=new e(this._flashSrc)}return this._mediaElement},isCanPlay:function(a){return d.isAvailable&&a==this.HLS_MIME_TYPE},hasVideoQualitySettings:function(){return true}};a.exports=f});define("turntable/plugins/TizenHLS",function(require,exports,a){"use strict";var b=require("turntable/tools/log");function c(a){b.debug(this,"construct")}c.prototype={constructor:c,HLS_MIME_TYPE:"application/x-mpegurl",name:"TizenHLS",getMediaElement:function(){return null},isCanPlay:function(a){return false},hasVideoQualitySettings:function(){return false}};a.exports=c});define("turntable/plugins/Native",function(require,exports,a){"use strict";var b=require("turntable/tools/log");function c(){var a=document.createElement("video");a.isNative=true;a.pluginName="Native";a.loop=false;a.autoplay=false;a.controls=false;a.preload="none";return a}function d(a){this._isCanPlayCache={};this._ignoreCheckingMimeTypes=a.ignoreCheckingMimeTypes;b.debug(this,"construct")}d.prototype={constructor:d,HLS_MIME_TYPE:"application/x-mpegurl",name:"Native",_isCanPlayCache:null,_mediaElement:null,setPreload:function(a){var b=this.getMediaElement();if(a){b.preload=""}else{b.preload="none"}},getMediaElement:function(){if(!this._mediaElement){this._mediaElement=new c}return this._mediaElement},isCanPlay:function(a){var b=this._isCanPlayCache;a=a.toLowerCase();if(this._ignoreCheckingMimeTypes.indexOf(a)!==-1){return true}if(a in b){return b[a]}if(a==this.HLS_MIME_TYPE){var c=navigator.userAgent;var d=/ iemobile\//i.test(c);var e=c.match(/android\s([0-9\.]*)/i);if(!d&&e&&e[0]>="4.2"){return b[a]=true}}var f=this.getMediaElement();var g=Boolean(f.canPlayType(a));b[a]=g;return g},hasVideoQualitySettings:function(){return false}};a.exports=d});(function(a){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=a()}else if(typeof define==="function"&&define.amd){define("hls.js/./dist/hls",[],a)}else{var b;if(typeof window!=="undefined"){b=window}else if(typeof global!=="undefined"){b=global}else if(typeof self!=="undefined"){b=self}else{b=this}b.Hls=a()}})(function(){var define,a,exports;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i=typeof require=="function"&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}var f=typeof require=="function"&&require;for(var g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,exports){function c(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}b.exports=c;c.EventEmitter=c;c.prototype._events=undefined;c.prototype._maxListeners=undefined;c.defaultMaxListeners=10;c.prototype.setMaxListeners=function(a){if(!e(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");this._maxListeners=a;return this};c.prototype.emit=function(a){var b,c,e,h,i,j;if(!this._events)this._events={};if(a==="error"){if(!this._events.error||f(this._events.error)&&!this._events.error.length){b=arguments[1];if(b instanceof Error){throw b}else{var k=new Error('Uncaught, unspecified "error" event. ('+b+")");k.context=b;throw k}}}c=this._events[a];if(g(c))return false;if(d(c)){switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:h=Array.prototype.slice.call(arguments,1);c.apply(this,h)}}else if(f(c)){h=Array.prototype.slice.call(arguments,1);j=c.slice();e=j.length;for(i=0;i<e;i++)j[i].apply(this,h)}return true};c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",a,d(b.listener)?b.listener:b);if(!this._events[a])this._events[a]=b;else if(f(this._events[a]))this._events[a].push(b);else this._events[a]=[this._events[a],b];if(f(this._events[a])&&!this._events[a].warned){if(!g(this._maxListeners)){e=this._maxListeners}else{e=c.defaultMaxListeners}if(e&&e>0&&this._events[a].length>e){this._events[a].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[a].length);if(typeof console.trace==="function"){console.trace()}}}return this};c.prototype.on=c.prototype.addListener;c.prototype.once=function(a,b){if(!d(b))throw TypeError("listener must be a function");var c=false;function e(){this.removeListener(a,e);if(!c){c=true;b.apply(this,arguments)}}e.listener=b;this.on(a,e);return this};c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;c=this._events[a];g=c.length;e=-1;if(c===b||d(c.listener)&&c.listener===b){delete this._events[a];if(this._events.removeListener)this.emit("removeListener",a,b)}else if(f(c)){for(h=g;h-- >0;){if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}}if(e<0)return this;if(c.length===1){c.length=0;delete this._events[a]}else{c.splice(e,1)}if(this._events.removeListener)this.emit("removeListener",a,b)}return this};c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[a])delete this._events[a];return this}if(arguments.length===0){for(b in this._events){if(b==="removeListener")continue;this.removeAllListeners(b)}this.removeAllListeners("removeListener");this._events={};return this}c=this._events[a];if(d(c)){this.removeListener(a,c)}else if(c){while(c.length)this.removeListener(a,c[c.length-1])}delete this._events[a];return this};c.prototype.listeners=function(a){var b;if(!this._events||!this._events[a])b=[];else if(d(this._events[a]))b=[this._events[a]];else b=this._events[a].slice();return b};c.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(d(b))return 1;else if(b)return b.length}return 0};c.listenerCount=function(a,b){return a.listenerCount(b)};function d(a){return typeof a==="function"}function e(a){return typeof a==="number"}function f(a){return typeof a==="object"&&a!==null}function g(a){return a===void 0}},{}],2:[function(a,b,exports){(function(a){var c=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/;var d=/^([^\/;?#]*)(.*)$/;var e=/(?:\/|^)\.(?=\/)/g;var f=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g;var g={buildAbsoluteURL:function(a,b,c){c=c||{};a=a.trim();b=b.trim();if(!b){if(!c.alwaysNormalize){return a}var e=this.parseURL(a);if(!h){throw new Error("Error trying to parse base URL.")}e.path=g.normalizePath(e.path);return g.buildURLFromParts(e)}var f=this.parseURL(b);if(!f){throw new Error("Error trying to parse relative URL.")}if(f.scheme){if(!c.alwaysNormalize){return b}f.path=g.normalizePath(f.path);return g.buildURLFromParts(f)}var h=this.parseURL(a);if(!h){throw new Error("Error trying to parse base URL.")}if(!h.netLoc&&h.path&&h.path[0]!=="/"){var i=d.exec(h.path);h.netLoc=i[1];h.path=i[2]}if(h.netLoc&&!h.path){h.path="/"}var j={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc){j.netLoc=h.netLoc;if(f.path[0]!=="/"){if(!f.path){j.path=h.path;if(!f.params){j.params=h.params;if(!f.query){j.query=h.query}}}else{var k=h.path;var l=k.substring(0,k.lastIndexOf("/")+1)+f.path;j.path=g.normalizePath(l)}}}if(j.path===null){j.path=c.alwaysNormalize?g.normalizePath(f.path):f.path}return g.buildURLFromParts(j)},parseURL:function(a){var b=c.exec(a);if(!b){return null}return{scheme:b[1]||"",netLoc:b[2]||"",path:b[3]||"",params:b[4]||"",query:b[5]||"",fragment:b[6]||""}},normalizePath:function(a){a=a.split("").reverse().join("").replace(e,"");while(a.length!==(a=a.replace(f,"")).length){}return a.split("").reverse().join("")},buildURLFromParts:function(a){return a.scheme+a.netLoc+a.path+a.params+a.query+a.fragment}};if(typeof exports==="object"&&typeof b==="object")b.exports=g;else if(typeof define==="function"&&define.amd)define([],function(){return g});else if(typeof exports==="object")exports["URLToolkit"]=g;else a["URLToolkit"]=g})(this)},{}],3:[function(a,b,exports){var c=arguments[3];var d=arguments[4];var e=arguments[5];var f=JSON.stringify;b.exports=function(a,b){var g;var h=Object.keys(e);for(var i=0,j=h.length;i<j;i++){var k=h[i];var l=e[k].exports;if(l===a||l&&l.default===a){g=k;break}}if(!g){g=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var m={};for(var i=0,j=h.length;i<j;i++){var k=h[i];m[k]=k}d[g]=[Function(["require","module","exports"],"("+a+")(self)"),m]}var n=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var o={};o[g]=g;d[n]=[Function(["require"],"var f = require("+f(g)+");"+"(f.default ? f.default : f)(self);"),o];var p={};q(n);function q(a){p[a]=true;for(var b in d[a][1]){var c=d[a][1][b];if(!p[c]){q(c)}}}var r="("+c+")({"+Object.keys(p).map(function(a){return f(a)+":["+d[a][0]+","+f(d[a][1])+"]"}).join(",")+"},{},["+f(n)+"])";var s=window.URL||window.webkitURL||window.mozURL||window.msURL;var t=new Blob([r],{type:"text/javascript"});if(b&&b.bare){return t}var u=s.createObjectURL(t);var v=new Worker(u);v.objectURL=u;return v}},{}],4:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.hlsDefaultConfig=undefined;var c=a(5);var d=y(c);var e=a(8);var f=y(e);var g=a(9);var h=y(g);var i=a(10);var j=y(i);var k=a(59);var l=y(k);var m=a(7);var n=y(m);var o=a(6);var p=y(o);var q=a(50);var r=y(q);var s=a(16);var t=y(s);var u=a(15);var v=y(u);var w=a(14);var x=y(w);function y(a){return a&&a.__esModule?a:{default:a}}var z=exports.hlsDefaultConfig={autoStartLoad:true,startPosition:-1,defaultAudioCodec:undefined,debug:false,capLevelOnFPSDrop:false,capLevelToPlayerSize:false,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:60*1e3*1e3,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:Infinity,liveSyncDuration:undefined,liveMaxLatencyDuration:undefined,maxMaxBufferLength:600,enableWorker:true,enableSoftwareAES:true,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:undefined,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:false,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:l.default,fLoader:undefined,pLoader:undefined,xhrSetup:undefined,fetchSetup:undefined,abrController:d.default,bufferController:f.default,capLevelController:h.default,fpsController:j.default,audioStreamController:p.default,audioTrackController:n.default,subtitleStreamController:x.default,subtitleTrackController:v.default,timelineController:t.default,cueHandler:r.default,enableCEA708Captions:true,enableWebVTT:true,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",stretchShortVideoTrack:false,forceKeyFrameOnDiscontinuity:true,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:false,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}},{10:10,14:14,15:15,16:16,5:5,50:50,59:59,6:6,7:7,8:8,9:9}],5:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(35);var e=n(d);var f=a(34);var g=n(f);var h=a(37);var i=n(h);var j=a(33);var k=a(54);var l=a(52);var m=n(l);function n(a){return a&&a.__esModule?a:{default:a}}function o(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function p(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function q(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var r=function(a){q(b,a);function b(a){o(this,b);var c=p(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,e.default.FRAG_LOADING,e.default.FRAG_LOADED,e.default.FRAG_BUFFERED,e.default.ERROR));c.lastLoadedFragLevel=0;c._nextAutoLevel=-1;c.hls=a;c.timer=null;c._bwEstimator=null;c.onCheck=c._abandonRulesCheck.bind(c);return c}c(b,[{key:"destroy",value:function a(){this.clearTimer();g.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function a(b){var c=b.frag;if(c.type==="main"){if(!this.timer){this.timer=setInterval(this.onCheck,100)}if(!this._bwEstimator){var d=this.hls,e=b.frag.level,f=d.levels[e].details.live,g=d.config,h=void 0,i=void 0;if(f){h=g.abrEwmaFastLive;i=g.abrEwmaSlowLive}else{h=g.abrEwmaFastVoD;i=g.abrEwmaSlowVoD}this._bwEstimator=new m.default(d,i,h,g.abrEwmaDefaultEstimate)}this.fragCurrent=c}}},{key:"_abandonRulesCheck",value:function a(){var b=this.hls,c=b.media,d=this.fragCurrent,f=d.loader,g=b.minAutoLevel;if(!f||f.stats&&f.stats.aborted){k.logger.warn("frag loader destroy or aborted, disarm abandonRules");this.clearTimer();return}var h=f.stats;if(c&&h&&(!c.paused&&c.playbackRate!==0||!c.readyState)&&d.autoLevel&&d.level){var j=performance.now()-h.trequest,l=Math.abs(c.playbackRate);if(j>500*d.duration/l){var m=b.levels,n=Math.max(1,h.bw?h.bw/8:h.loaded*1e3/j),o=m[d.level],p=o.realBitrate?Math.max(o.realBitrate,o.bitrate):o.bitrate,q=h.total?h.total:Math.max(h.loaded,Math.round(d.duration*p/8)),r=c.currentTime,s=(q-h.loaded)/n,t=(i.default.bufferInfo(c,r,b.config.maxBufferHole).end-r)/l;if(t<2*d.duration/l&&s>t){var u=void 0,v=void 0;for(v=d.level-1;v>g;v--){var w=m[v].realBitrate?Math.max(m[v].realBitrate,m[v].bitrate):m[v].bitrate;u=d.duration*w/(8*.8*n);if(u<t){break}}if(u<s){k.logger.warn("loading too slow, abort fragment loading and switch to level "+v+":fragLoadedDelay["+v+"]<fragLoadedDelay["+(d.level-1)+"];bufferStarvationDelay:"+u.toFixed(1)+"<"+s.toFixed(1)+":"+t.toFixed(1));b.nextLoadLevel=v;this._bwEstimator.sample(j,h.loaded);f.abort();this.clearTimer();b.trigger(e.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:d,stats:h})}}}}}},{key:"onFragLoaded",value:function a(b){var c=b.frag;if(c.type==="main"&&!isNaN(c.sn)){this.clearTimer();this.lastLoadedFragLevel=c.level;this._nextAutoLevel=-1;if(this.hls.config.abrMaxWithRealBitrate){var d=this.hls.levels[c.level];var e=(d.loaded?d.loaded.bytes:0)+b.stats.loaded;var f=(d.loaded?d.loaded.duration:0)+b.frag.duration;d.loaded={bytes:e,duration:f};d.realBitrate=Math.round(8*e/f)}if(b.frag.bitrateTest){var g=b.stats;g.tparsed=g.tbuffered=g.tload;this.onFragBuffered(b)}}}},{key:"onFragBuffered",value:function a(b){var c=b.stats,d=b.frag;if(c.aborted!==true&&d.loadCounter===1&&d.type==="main"&&!isNaN(d.sn)&&(!d.bitrateTest||c.tload===c.tbuffered)){var e=c.tparsed-c.trequest;k.logger.log("latency/loading/parsing/append/kbps:"+Math.round(c.tfirst-c.trequest)+"/"+Math.round(c.tload-c.tfirst)+"/"+Math.round(c.tparsed-c.tload)+"/"+Math.round(c.tbuffered-c.tparsed)+"/"+Math.round(8*c.loaded/(c.tbuffered-c.trequest)));this._bwEstimator.sample(e,c.loaded);c.bwEstimate=this._bwEstimator.getEstimate();if(d.bitrateTest){this.bitrateTestDelay=e/1e3}else{this.bitrateTestDelay=0}}}},{key:"onError",value:function a(b){switch(b.details){case j.ErrorDetails.FRAG_LOAD_ERROR:case j.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}}},{key:"clearTimer",value:function a(){clearInterval(this.timer);this.timer=null}},{key:"_findBestLevel",value:function a(b,c,d,e,f,g,h,i,j){for(var l=f;l>=e;l--){var m=j[l],n=m.details,o=n?n.totalduration/n.fragments.length:c,p=n?n.live:false,q=void 0;if(l<=b){q=h*d}else{q=i*d}var r=j[l].realBitrate?Math.max(j[l].realBitrate,j[l].bitrate):j[l].bitrate,s=r*o/q;k.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+l+"/"+Math.round(q)+"/"+r+"/"+o+"/"+g+"/"+s);if(q>r&&(!s||p&&!this.bitrateTestDelay||s<g)){return l}}return-1}},{key:"nextAutoLevel",get:function a(){var b=this._nextAutoLevel;var c=this._bwEstimator;if(b!==-1&&(!c||!c.canEstimate())){return b}var d=this._nextABRAutoLevel;if(b!==-1){d=Math.min(b,d)}return d},set:function a(b){this._nextAutoLevel=b}},{key:"_nextABRAutoLevel",get:function a(){var b=this.hls,c=b.maxAutoLevel,d=b.levels,e=b.config,f=b.minAutoLevel;var g=b.media,h=this.lastLoadedFragLevel,j=this.fragCurrent?this.fragCurrent.duration:0,l=g?g.currentTime:0,m=g&&g.playbackRate!==0?Math.abs(g.playbackRate):1,n=this._bwEstimator?this._bwEstimator.getEstimate():e.abrEwmaDefaultEstimate,o=(i.default.bufferInfo(g,l,e.maxBufferHole).end-l)/m;var p=this._findBestLevel(h,j,n,f,c,o,e.abrBandWidthFactor,e.abrBandWidthUpFactor,d);if(p>=0){return p}else{k.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var q=j?Math.min(j,e.maxStarvationDelay):e.maxStarvationDelay,r=e.abrBandWidthFactor,s=e.abrBandWidthUpFactor;if(o===0){var t=this.bitrateTestDelay;if(t){var u=j?Math.min(j,e.maxLoadingDelay):e.maxLoadingDelay;q=u-t;k.logger.trace("bitrate test took "+Math.round(1e3*t)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*q)+" ms");r=s=1}}p=this._findBestLevel(h,j,n,f,c,o+q,r,s,d);return Math.max(p,0)}}}]);return b}(g.default);exports.default=r},{33:33,34:34,35:35,37:37,52:52,54:54}],6:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(48);var e=u(d);var f=a(37);var g=u(f);var h=a(25);var i=u(h);var j=a(35);var k=u(j);var l=a(34);var m=u(l);var n=a(38);var o=u(n);var p=a(55);var q=u(p);var r=a(33);var s=a(54);var t=a(51);function u(a){return a&&a.__esModule?a:{default:a}}function v(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function w(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function x(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var y={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"};var z=function(a){x(b,a);function b(a){v(this,b);var c=w(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,k.default.MEDIA_ATTACHED,k.default.MEDIA_DETACHING,k.default.AUDIO_TRACKS_UPDATED,k.default.AUDIO_TRACK_SWITCHING,k.default.AUDIO_TRACK_LOADED,k.default.KEY_LOADED,k.default.FRAG_LOADED,k.default.FRAG_PARSING_INIT_SEGMENT,k.default.FRAG_PARSING_DATA,k.default.FRAG_PARSED,k.default.ERROR,k.default.BUFFER_CREATED,k.default.BUFFER_APPENDED,k.default.BUFFER_FLUSHED,k.default.INIT_PTS_FOUND));c.config=a.config;c.audioCodecSwap=false;c.ticks=0;c._state=y.STOPPED;c.ontick=c.tick.bind(c);c.initPTS=[];c.waitingFragment=null;c.videoTrackCC=null;return c}c(b,[{key:"destroy",value:function a(){this.stopLoad();if(this.timer){clearInterval(this.timer);this.timer=null}m.default.prototype.destroy.call(this);this.state=y.STOPPED}},{key:"onInitPtsFound",value:function a(b){var c=b.id,d=b.frag.cc,e=b.initPTS;if(c==="main"){this.initPTS[d]=e;this.videoTrackCC=d;s.logger.log("InitPTS for cc:"+d+" found from video track:"+e);if(this.state===y.WAITING_INIT_PTS){this.tick()}}}},{key:"startLoad",value:function a(b){if(this.tracks){var c=this.lastCurrentTime;this.stopLoad();if(!this.timer){this.timer=setInterval(this.ontick,100)}this.fragLoadError=0;if(c>0&&b===-1){s.logger.log("audio:override startPosition with lastCurrentTime @"+c.toFixed(3));this.state=y.IDLE}else{this.lastCurrentTime=this.startPosition?this.startPosition:b;this.state=y.STARTING}this.nextLoadPosition=this.startPosition=this.lastCurrentTime;this.tick()}else{this.startPosition=b;this.state=y.STOPPED}}},{key:"stopLoad",value:function a(){var b=this.fragCurrent;if(b){if(b.loader){b.loader.abort()}this.fragCurrent=null}this.fragPrevious=null;if(this.demuxer){this.demuxer.destroy();this.demuxer=null}this.state=y.STOPPED}},{key:"tick",value:function a(){this.ticks++;if(this.ticks===1){this.doTick();if(this.ticks>1){setTimeout(this.tick,1)}this.ticks=0}}},{key:"doTick",value:function a(){var b,c,d,f=this.hls,h=f.config;switch(this.state){case y.ERROR:case y.PAUSED:case y.BUFFER_FLUSHING:break;case y.STARTING:this.state=y.WAITING_TRACK;this.loadedmetadata=false;break;case y.IDLE:var i=this.tracks;if(!i){break}if(!this.media&&(this.startFragRequested||!h.startFragPrefetch)){break}if(this.loadedmetadata){b=this.media.currentTime}else{b=this.nextLoadPosition;if(b===undefined){break}}var j=this.mediaBuffer?this.mediaBuffer:this.media,l=g.default.bufferInfo(j,b,h.maxBufferHole),m=l.len,n=l.end,o=this.fragPrevious,p=h.maxMaxBufferLength,q=this.audioSwitch,u=this.trackId;if((m<p||q)&&u<i.length){d=i[u].details;if(typeof d==="undefined"){this.state=y.WAITING_TRACK;break}if(!q&&!d.live&&o&&o.sn===d.endSN){if(!this.media.seeking||this.media.duration-n<o.duration/2){this.hls.trigger(k.default.BUFFER_EOS,{type:"audio"});this.state=y.ENDED;break}}var v=d.fragments,w=v.length,x=v[0].start,z=v[w-1].start+v[w-1].duration,A=void 0;if(q){if(d.live&&!d.PTSKnown){s.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment");n=0}else{n=b;if(d.PTSKnown&&b<x){if(l.end>x||l.nextStart){s.logger.log("alt audio track ahead of main track, seek to start of alt audio track");this.media.currentTime=x+.05}else{return}}}}if(d.initSegment&&!d.initSegment.data){A=d.initSegment}else if(n<=x){A=v[0];if(this.videoTrackCC!==null&&A.cc!==this.videoTrackCC){A=(0,t.findFragWithCC)(v,this.videoTrackCC)}if(d.live&&A.loadIdx&&A.loadIdx===this.fragLoadIdx){var B=l.nextStart?l.nextStart:x;s.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(B+.05));this.media.currentTime=B+.05;return}}else{var C=void 0;var D=h.maxFragLookUpTolerance;var E=o?v[o.sn-v[0].sn+1]:undefined;var F=function a(b){var c=Math.min(D,b.duration);if(b.start+b.duration-c<=n){return 1}else if(b.start-c>n&&b.start){return-1}return 0};if(n<z){if(n>z-D){D=0}if(E&&!F(E)){C=E}else{C=e.default.search(v,F)}}else{C=v[w-1]}if(C){A=C;x=C.start;if(o&&A.level===o.level&&A.sn===o.sn){if(A.sn<d.endSN){A=v[A.sn+1-d.startSN];s.logger.log("SN just loaded, load next one: "+A.sn)}else{A=null}}}}if(A){if(A.decryptdata&&A.decryptdata.uri!=null&&A.decryptdata.key==null){s.logger.log("Loading key for "+A.sn+" of ["+d.startSN+" ,"+d.endSN+"],track "+u);this.state=y.KEY_LOADING;f.trigger(k.default.KEY_LOADING,{frag:A})}else{s.logger.log("Loading "+A.sn+", cc: "+A.cc+" of ["+d.startSN+" ,"+d.endSN+"],track "+u+", currentTime:"+b+",bufferEnd:"+n.toFixed(3));if(this.fragLoadIdx!==undefined){this.fragLoadIdx++}else{this.fragLoadIdx=0}if(A.loadCounter){A.loadCounter++;var G=h.fragLoadingLoopThreshold;if(A.loadCounter>G&&Math.abs(this.fragLoadIdx-A.loadIdx)<G){f.trigger(k.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:false,frag:A});return}}else{A.loadCounter=1}A.loadIdx=this.fragLoadIdx;this.fragCurrent=A;this.startFragRequested=true;if(!isNaN(A.sn)){this.nextLoadPosition=A.start+A.duration}f.trigger(k.default.FRAG_LOADING,{frag:A});this.state=y.FRAG_LOADING}}}break;case y.WAITING_TRACK:c=this.tracks[this.trackId];if(c&&c.details){this.state=y.IDLE}break;case y.FRAG_LOADING_WAITING_RETRY:var H=performance.now();var I=this.retryDate;j=this.media;var J=j&&j.seeking;if(!I||H>=I||J){s.logger.log("audioStreamController: retryDate reached, switch back to IDLE state");this.state=y.IDLE}break;case y.WAITING_INIT_PTS:var K=this.videoTrackCC;if(this.initPTS[K]===undefined){break}var L=this.waitingFragment;if(L){var M=L.frag.cc;if(K!==M){c=this.tracks[this.trackId];if(c.details&&c.details.live){s.logger.warn("Waiting fragment CC ("+M+") does not match video track CC ("+K+")");this.waitingFragment=null;this.state=y.IDLE}}else{this.state=y.FRAG_LOADING;this.onFragLoaded(this.waitingFragment);this.waitingFragment=null}}else{this.state=y.IDLE}break;case y.STOPPED:case y.FRAG_LOADING:case y.PARSING:case y.PARSED:case y.ENDED:break;default:break}}},{key:"onMediaAttached",value:function a(b){var c=this.media=this.mediaBuffer=b.media;this.onvseeking=this.onMediaSeeking.bind(this);this.onvended=this.onMediaEnded.bind(this);c.addEventListener("seeking",this.onvseeking);c.addEventListener("ended",this.onvended);var d=this.config;if(this.tracks&&d.autoStartLoad){this.startLoad(d.startPosition)}}},{key:"onMediaDetaching",value:function a(){var b=this.media;if(b&&b.ended){s.logger.log("MSE detaching and video ended, reset startPosition");this.startPosition=this.lastCurrentTime=0}var c=this.tracks;if(c){c.forEach(function(a){if(a.details){a.details.fragments.forEach(function(a){a.loadCounter=undefined})}})}if(b){b.removeEventListener("seeking",this.onvseeking);b.removeEventListener("ended",this.onvended);this.onvseeking=this.onvseeked=this.onvended=null}this.media=this.mediaBuffer=null;this.loadedmetadata=false;this.stopLoad()}},{key:"onMediaSeeking",value:function a(){if(this.state===y.ENDED){this.state=y.IDLE}if(this.media){this.lastCurrentTime=this.media.currentTime}if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}this.tick()}},{key:"onMediaEnded",value:function a(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function a(b){s.logger.log("audio tracks updated");this.tracks=b.audioTracks}},{key:"onAudioTrackSwitching",value:function a(b){var c=!!b.url;this.trackId=b.id;this.fragCurrent=null;this.state=y.PAUSED;this.waitingFragment=null;if(!c){if(this.demuxer){this.demuxer.destroy();this.demuxer=null}}else{if(!this.timer){this.timer=setInterval(this.ontick,100)}}if(c){this.audioSwitch=true;this.state=y.IDLE;if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}}this.tick()}},{key:"onAudioTrackLoaded",value:function a(b){var c=b.details,d=b.id,e=this.tracks[d],f=c.totalduration,g=0;s.logger.log("track "+d+" loaded ["+c.startSN+","+c.endSN+"],duration:"+f);if(c.live){var h=e.details;if(h&&c.fragments.length>0){o.default.mergeDetails(h,c);g=c.fragments[0].start;if(c.PTSKnown){s.logger.log("live audio playlist sliding:"+g.toFixed(3))}else{s.logger.log("live audio playlist - outdated PTS, unknown sliding")}}else{c.PTSKnown=false;s.logger.log("live audio playlist - first load, unknown sliding")}}else{c.PTSKnown=false}e.details=c;if(!this.startFragRequested){if(this.startPosition===-1){var i=c.startTimeOffset;if(!isNaN(i)){s.logger.log("start time offset found in playlist, adjust startPosition to "+i);this.startPosition=i}else{this.startPosition=0}}this.nextLoadPosition=this.startPosition}if(this.state===y.WAITING_TRACK){this.state=y.IDLE}this.tick()}},{key:"onKeyLoaded",value:function a(){if(this.state===y.KEY_LOADING){this.state=y.IDLE;this.tick()}}},{key:"onFragLoaded",value:function a(b){var c=this.fragCurrent,d=b.frag;if(this.state===y.FRAG_LOADING&&c&&d.type==="audio"&&d.level===c.level&&d.sn===c.sn){var e=this.tracks[this.trackId],f=e.details,g=f.totalduration,h=c.level,j=c.sn,l=c.cc,m=this.config.defaultAudioCodec||e.audioCodec||"mp4a.40.2",n=this.stats=b.stats;if(j==="initSegment"){this.state=y.IDLE;n.tparsed=n.tbuffered=performance.now();f.initSegment.data=b.payload;this.hls.trigger(k.default.FRAG_BUFFERED,{stats:n,frag:c,id:"audio"});this.tick()}else{this.state=y.PARSING;this.appended=false;if(!this.demuxer){this.demuxer=new i.default(this.hls,"audio")}var o=this.initPTS[l];var p=f.initSegment?f.initSegment.data:[];if(f.initSegment||o!==undefined){this.pendingBuffering=true;s.logger.log("Demuxing "+j+" of ["+f.startSN+" ,"+f.endSN+"],track "+h);var q=false;this.demuxer.push(b.payload,p,m,null,c,g,q,o)}else{s.logger.log("unknown video PTS for continuity counter "+l+", waiting for video PTS before demuxing audio frag "+j+" of ["+f.startSN+" ,"+f.endSN+"],track "+h);this.waitingFragment=b;this.state=y.WAITING_INIT_PTS}}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function a(b){var c=this.fragCurrent;var d=b.frag;if(c&&b.id==="audio"&&d.sn===c.sn&&d.level===c.level&&this.state===y.PARSING){var e=b.tracks,f=void 0;if(e.video){delete e.video}f=e.audio;if(f){f.levelCodec=f.codec;f.id=b.id;this.hls.trigger(k.default.BUFFER_CODECS,e);s.logger.log("audio track:audio,container:"+f.container+",codecs[level/parsed]=["+f.levelCodec+"/"+f.codec+"]");var g=f.initSegment;if(g){var h={type:"audio",data:g,parent:"audio",content:"initSegment"};if(this.audioSwitch){this.pendingData=[h]}else{this.appended=true;this.pendingBuffering=true;this.hls.trigger(k.default.BUFFER_APPENDING,h)}}this.tick()}}}},{key:"onFragParsingData",value:function a(b){var c=this;var d=this.fragCurrent;var e=b.frag;if(d&&b.id==="audio"&&b.type==="audio"&&e.sn===d.sn&&e.level===d.level&&this.state===y.PARSING){var f=this.trackId,g=this.tracks[f],h=this.hls;if(isNaN(b.endPTS)){b.endPTS=b.startPTS+d.duration;b.endDTS=b.startDTS+d.duration}s.logger.log("parsed "+b.type+",PTS:["+b.startPTS.toFixed(3)+","+b.endPTS.toFixed(3)+"],DTS:["+b.startDTS.toFixed(3)+"/"+b.endDTS.toFixed(3)+"],nb:"+b.nb);o.default.updateFragPTSDTS(g.details,d,b.startPTS,b.endPTS);var i=this.audioSwitch,j=this.media,l=false;if(i&&j){if(j.readyState){var m=j.currentTime;s.logger.log("switching audio track : currentTime:"+m);if(m>=b.startPTS){s.logger.log("switching audio track : flushing all audio");this.state=y.BUFFER_FLUSHING;h.trigger(k.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"});l=true;this.audioSwitch=false;h.trigger(k.default.AUDIO_TRACK_SWITCHED,{id:f})}}else{this.audioSwitch=false;h.trigger(k.default.AUDIO_TRACK_SWITCHED,{id:f})}}var n=this.pendingData;if(!this.audioSwitch){[b.data1,b.data2].forEach(function(a){if(a&&a.length){n.push({type:b.type,data:a,parent:"audio",content:"data"})}});if(!l&&n.length){n.forEach(function(a){if(c.state===y.PARSING){c.pendingBuffering=true;c.hls.trigger(k.default.BUFFER_APPENDING,a)}});this.pendingData=[];this.appended=true}}this.tick()}}},{key:"onFragParsed",value:function a(b){var c=this.fragCurrent;var d=b.frag;if(c&&b.id==="audio"&&d.sn===c.sn&&d.level===c.level&&this.state===y.PARSING){this.stats.tparsed=performance.now();this.state=y.PARSED;this._checkAppendedParsed()}}},{key:"onBufferCreated",value:function a(b){var c=b.tracks.audio;if(c){this.mediaBuffer=c.buffer;this.loadedmetadata=true}}},{key:"onBufferAppended",value:function a(b){if(b.parent==="audio"){var c=this.state;if(c===y.PARSING||c===y.PARSED){this.pendingBuffering=b.pending>0;this._checkAppendedParsed()}}}},{key:"_checkAppendedParsed",value:function a(){if(this.state===y.PARSED&&(!this.appended||!this.pendingBuffering)){var b=this.fragCurrent,c=this.stats,d=this.hls;if(b){this.fragPrevious=b;c.tbuffered=performance.now();d.trigger(k.default.FRAG_BUFFERED,{stats:c,frag:b,id:"audio"});var e=this.mediaBuffer?this.mediaBuffer:this.media;s.logger.log("audio buffered : "+q.default.toString(e.buffered));if(this.audioSwitch&&this.appended){this.audioSwitch=false;d.trigger(k.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})}this.state=y.IDLE}this.tick()}}},{key:"onError",value:function a(b){var c=b.frag;if(c&&c.type!=="audio"){return}switch(b.details){case r.ErrorDetails.FRAG_LOAD_ERROR:case r.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!b.fatal){var d=this.fragLoadError;if(d){d++}else{d=1}var e=this.config;if(d<=e.fragLoadingMaxRetry){this.fragLoadError=d;c.loadCounter=0;var f=Math.min(Math.pow(2,d-1)*e.fragLoadingRetryDelay,e.fragLoadingMaxRetryTimeout);s.logger.warn("audioStreamController: frag loading failed, retry in "+f+" ms");this.retryDate=performance.now()+f;this.state=y.FRAG_LOADING_WAITING_RETRY}else{s.logger.error("audioStreamController: "+b.details+" reaches max retry, redispatch as fatal ...");b.fatal=true;this.state=y.ERROR}}break;case r.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case r.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case r.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case r.ErrorDetails.KEY_LOAD_ERROR:case r.ErrorDetails.KEY_LOAD_TIMEOUT:if(this.state!==y.ERROR){this.state=b.fatal?y.ERROR:y.IDLE;s.logger.warn("audioStreamController: "+b.details+" while loading frag,switch to "+this.state+" state ...")}break;case r.ErrorDetails.BUFFER_FULL_ERROR:if(b.parent==="audio"&&(this.state===y.PARSING||this.state===y.PARSED)){var h=this.mediaBuffer,i=this.media.currentTime,j=h&&g.default.isBuffered(h,i)&&g.default.isBuffered(h,i+.5);if(j){var l=this.config;if(l.maxMaxBufferLength>=l.maxBufferLength){l.maxMaxBufferLength/=2;s.logger.warn("audio:reduce max buffer length to "+l.maxMaxBufferLength+"s");this.fragLoadIdx+=2*l.fragLoadingLoopThreshold}this.state=y.IDLE}else{s.logger.warn("buffer full error also media.currentTime is not buffered, flush audio buffer");this.fragCurrent=null;this.state=y.BUFFER_FLUSHING;this.hls.trigger(k.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}break;default:break}}},{key:"onBufferFlushed",value:function a(){var b=this;var c=this.pendingData;if(c&&c.length){s.logger.log("appending pending audio data on Buffer Flushed");c.forEach(function(a){b.hls.trigger(k.default.BUFFER_APPENDING,a)});this.appended=true;this.pendingData=[];this.state=y.PARSED}else{this.state=y.IDLE;this.fragPrevious=null;this.tick()}}},{key:"state",set:function a(b){if(this.state!==b){var c=this.state;this._state=b;s.logger.log("audio stream:"+c+"->"+b)}},get:function a(){return this._state}}]);return b}(m.default);exports.default=z},{25:25,33:33,34:34,35:35,37:37,38:38,48:48,51:51,54:54,55:55}],7:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(35);var e=j(d);var f=a(34);var g=j(f);var h=a(54);var i=a(33);function j(a){return a&&a.__esModule?a:{default:a}}function k(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function l(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function m(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var n=function(a){m(b,a);function b(a){k(this,b);var c=l(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,e.default.MANIFEST_LOADING,e.default.MANIFEST_LOADED,e.default.AUDIO_TRACK_LOADED,e.default.ERROR));c.ticks=0;c.ontick=c.tick.bind(c);return c}c(b,[{key:"destroy",value:function a(){this.cleanTimer();g.default.prototype.destroy.call(this)}},{key:"cleanTimer",value:function a(){if(this.timer){clearTimeout(this.timer);this.timer=null}}},{key:"tick",value:function a(){this.ticks++;if(this.ticks===1){this.doTick();if(this.ticks>1){setTimeout(this.tick,1)}this.ticks=0}}},{key:"doTick",value:function a(){this.updateTrack(this.trackId)}},{key:"onError",value:function a(b){if(b.fatal&&b.type===i.ErrorTypes.NETWORK_ERROR){this.cleanTimer()}}},{key:"onManifestLoading",value:function a(){this.tracks=[];this.trackId=-1}},{key:"onManifestLoaded",value:function a(b){var c=this;var d=b.audioTracks||[];var f=false;this.tracks=d;this.hls.trigger(e.default.AUDIO_TRACKS_UPDATED,{audioTracks:d});var g=0;d.forEach(function(a){if(a.default&&!f){c.audioTrack=g;f=true;return}g++});if(f===false&&d.length){h.logger.log("no default audio track defined, use first audio track as default");this.audioTrack=0}}},{key:"onAudioTrackLoaded",value:function a(b){if(b.id<this.tracks.length){h.logger.log("audioTrack "+b.id+" loaded");this.tracks[b.id].details=b.details;if(b.details.live&&!this.timer){this.timer=setInterval(this.ontick,1e3*b.details.targetduration)}if(!b.details.live&&this.timer){this.cleanTimer()}}}},{key:"setAudioTrackInternal",value:function a(b){if(b>=0&&b<this.tracks.length){this.cleanTimer();this.trackId=b;h.logger.log("switching to audioTrack "+b);var c=this.tracks[b],d=this.hls,f=c.type,g=c.url,i={id:b,type:f,url:g};d.trigger(e.default.AUDIO_TRACK_SWITCH,i);d.trigger(e.default.AUDIO_TRACK_SWITCHING,i);var j=c.details;if(g&&(j===undefined||j.live===true)){h.logger.log("(re)loading playlist for audioTrack "+b);d.trigger(e.default.AUDIO_TRACK_LOADING,{url:g,id:b})}}}},{key:"updateTrack",value:function a(b){if(b>=0&&b<this.tracks.length){this.cleanTimer();this.trackId=b;h.logger.log("updating audioTrack "+b);var c=this.tracks[b],d=c.url;var f=c.details;if(d&&(f===undefined||f.live===true)){h.logger.log("(re)loading playlist for audioTrack "+b);this.hls.trigger(e.default.AUDIO_TRACK_LOADING,{url:d,id:b})}}}},{key:"audioTracks",get:function a(){return this.tracks}},{key:"audioTrack",get:function a(){return this.trackId},set:function a(b){if(this.trackId!==b||this.tracks[b].details===undefined){this.setAudioTrackInternal(b)}}}]);return b}(g.default);exports.default=n},{33:33,34:34,35:35,54:54}],8:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(35);var e=j(d);var f=a(34);var g=j(f);var h=a(54);var i=a(33);function j(a){return a&&a.__esModule?a:{default:a}}function k(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function l(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function m(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var n=function(a){m(b,a);function b(a){k(this,b);var c=l(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,e.default.MEDIA_ATTACHING,e.default.MEDIA_DETACHING,e.default.MANIFEST_PARSED,e.default.BUFFER_RESET,e.default.BUFFER_APPENDING,e.default.BUFFER_CODECS,e.default.BUFFER_EOS,e.default.BUFFER_FLUSHING,e.default.LEVEL_PTS_UPDATED,e.default.LEVEL_UPDATED));c._msDuration=null;c._levelDuration=null;c.onsbue=c.onSBUpdateEnd.bind(c);c.onsbe=c.onSBUpdateError.bind(c);c.pendingTracks={};c.tracks={};return c}c(b,[{key:"destroy",value:function a(){g.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function a(b){var c=b.type;var d=this.tracks.audio;if(c==="audio"&&d&&d.container==="audio/mpeg"){var e=this.sourceBuffer.audio;var f=Math.abs(e.timestampOffset-b.start);if(f>.1){var g=e.updating;try{e.abort()}catch(a){g=true;h.logger.warn("can not abort audio buffer: "+a)}if(!g){h.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+b.start);e.timestampOffset=b.start}else{this.audioTimestampOffset=b.start}}}}},{key:"onManifestParsed",value:function a(b){var c=b.audio,d=b.video||b.levels.length&&b.audio,e=0;if(b.altAudio&&(c||d)){e=(c?1:0)+(d?1:0);h.logger.log(e+" sourceBuffer(s) expected")}this.sourceBufferNb=e}},{key:"onMediaAttaching",value:function a(b){var c=this.media=b.media;if(c){var d=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this);this.onmse=this.onMediaSourceEnded.bind(this);this.onmsc=this.onMediaSourceClose.bind(this);d.addEventListener("sourceopen",this.onmso);d.addEventListener("sourceended",this.onmse);d.addEventListener("sourceclose",this.onmsc);c.src=URL.createObjectURL(d)}}},{key:"onMediaDetaching",value:function a(){h.logger.log("media source detaching");var b=this.mediaSource;if(b){if(b.readyState==="open"){try{b.endOfStream()}catch(a){h.logger.warn("onMediaDetaching:"+a.message+" while calling endOfStream")}}b.removeEventListener("sourceopen",this.onmso);b.removeEventListener("sourceended",this.onmse);b.removeEventListener("sourceclose",this.onmsc);if(this.media){URL.revokeObjectURL(this.media.src);this.media.removeAttribute("src");this.media.load()}this.mediaSource=null;this.media=null;this.pendingTracks={};this.tracks={};this.sourceBuffer={};this.flushRange=[];this.segments=[];this.appended=0}this.onmso=this.onmse=this.onmsc=null;this.hls.trigger(e.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function a(){h.logger.log("media source opened");this.hls.trigger(e.default.MEDIA_ATTACHED,{media:this.media});var b=this.mediaSource;if(b){b.removeEventListener("sourceopen",this.onmso)}this.checkPendingTracks()}},{key:"checkPendingTracks",value:function a(){var b=this.pendingTracks,c=Object.keys(b).length;if(c&&(this.sourceBufferNb<=c||this.sourceBufferNb===0)){this.createSourceBuffers(b);this.pendingTracks={};this.doAppending()}}},{key:"onMediaSourceClose",value:function a(){h.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function a(){h.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function a(){if(this.audioTimestampOffset){var b=this.sourceBuffer.audio;h.logger.warn("change mpeg audio timestamp offset from "+b.timestampOffset+" to "+this.audioTimestampOffset);b.timestampOffset=this.audioTimestampOffset;delete this.audioTimestampOffset}if(this._needsFlush){this.doFlush()}if(this._needsEos){this.checkEos()}this.appending=false;var c=this.parent;var d=this.segments.reduce(function(a,b){return b.parent===c?a+1:a},0);this.hls.trigger(e.default.BUFFER_APPENDED,{parent:c,pending:d});if(!this._needsFlush){this.doAppending()}this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function a(b){h.logger.error("sourceBuffer error:",b);this.hls.trigger(e.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:false})}},{key:"onBufferReset",value:function a(){var b=this.sourceBuffer;for(var c in b){var d=b[c];try{this.mediaSource.removeSourceBuffer(d);d.removeEventListener("updateend",this.onsbue);d.removeEventListener("error",this.onsbe)}catch(a){}}this.sourceBuffer={};this.flushRange=[];this.segments=[];this.appended=0}},{key:"onBufferCodecs",value:function a(b){if(Object.keys(this.sourceBuffer).length===0){for(var c in b){this.pendingTracks[c]=b[c]}var d=this.mediaSource;if(d&&d.readyState==="open"){this.checkPendingTracks()}}}},{key:"createSourceBuffers",value:function a(b){var c=this.sourceBuffer,d=this.mediaSource;for(var f in b){if(!c[f]){var g=b[f];var j=g.levelCodec||g.codec;var k=g.container+";codecs="+j;h.logger.log("creating sourceBuffer("+k+")");try{var l=c[f]=d.addSourceBuffer(k);l.addEventListener("updateend",this.onsbue);l.addEventListener("error",this.onsbe);this.tracks[f]={codec:j,container:g.container};g.buffer=l}catch(a){h.logger.error("error while trying to add sourceBuffer:"+a.message);this.hls.trigger(e.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:false,err:a,mimeType:k})}}}this.hls.trigger(e.default.BUFFER_CREATED,{tracks:b})}},{key:"onBufferAppending",value:function a(b){if(!this._needsFlush){if(!this.segments){this.segments=[b]}else{this.segments.push(b)}this.doAppending()}}},{key:"onBufferAppendFail",value:function a(b){h.logger.error("sourceBuffer error:",b.event);this.hls.trigger(e.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:false})}},{key:"onBufferEos",value:function a(b){var c=this.sourceBuffer;var d=b.type;for(var e in c){if(!d||e===d){if(!c[e].ended){c[e].ended=true;h.logger.log(e+" sourceBuffer now EOS")}}}this.checkEos()}},{key:"checkEos",value:function a(){var b=this.sourceBuffer,c=this.mediaSource;if(!c||c.readyState!=="open"){this._needsEos=false;return}for(var d in b){var e=b[d];if(!e.ended){return}if(e.updating){this._needsEos=true;return}}h.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{c.endOfStream()}catch(a){h.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=false}},{key:"onBufferFlushing",value:function a(b){this.flushRange.push({start:b.startOffset,end:b.endOffset,type:b.type});this.flushBufferCounter=0;this.doFlush()}},{key:"onLevelUpdated",value:function a(b){var c=b.details;if(c.fragments.length===0){return}this._levelDuration=c.totalduration+c.fragments[0].start;this.updateMediaElementDuration()}},{key:"updateMediaElementDuration",value:function a(){var b=this.media,c=this.mediaSource,d=this.sourceBuffer,e=this._levelDuration;if(e===null||!b||!c||!d||b.readyState===0||c.readyState!=="open"){return}for(var f in d){if(d[f].updating){return}}if(this._msDuration===null){this._msDuration=c.duration}var g=b.duration;if(e>this._msDuration&&e>g||g===Infinity||isNaN(g)){h.logger.log("Updating mediasource duration to "+e.toFixed(3));this._msDuration=c.duration=e}}},{key:"doFlush",value:function a(){while(this.flushRange.length){var b=this.flushRange[0];if(this.flushBuffer(b.start,b.end,b.type)){this.flushRange.shift();this.flushBufferCounter=0}else{this._needsFlush=true;return}}if(this.flushRange.length===0){this._needsFlush=false;var c=0;var d=this.sourceBuffer;try{for(var f in d){c+=d[f].buffered.length}}catch(a){h.logger.error("error while accessing sourceBuffer.buffered")}this.appended=c;this.hls.trigger(e.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function a(){var b=this.hls,c=this.sourceBuffer,d=this.segments;if(Object.keys(c).length){if(this.media.error){this.segments=[];h.logger.error("trying to append although a media error occured, flush segment and abort");return}if(this.appending){return}if(d&&d.length){var f=d.shift();try{var g=f.type,j=c[g];if(j){if(!j.updating){j.ended=false;this.parent=f.parent;j.appendBuffer(f.data);this.appendError=0;this.appended++;this.appending=true}else{d.unshift(f)}}else{this.onSBUpdateEnd()}}catch(a){h.logger.error("error while trying to append buffer:"+a.message);d.unshift(f);var k={type:i.ErrorTypes.MEDIA_ERROR,parent:f.parent};if(a.code!==22){if(this.appendError){this.appendError++}else{this.appendError=1}k.details=i.ErrorDetails.BUFFER_APPEND_ERROR;if(this.appendError>b.config.appendErrorMaxRetry){h.logger.log("fail "+b.config.appendErrorMaxRetry+" times to append segment in sourceBuffer");d=[];k.fatal=true;b.trigger(e.default.ERROR,k);return}else{k.fatal=false;b.trigger(e.default.ERROR,k)}}else{this.segments=[];k.details=i.ErrorDetails.BUFFER_FULL_ERROR;k.fatal=false;b.trigger(e.default.ERROR,k);return}}}}}},{key:"flushBuffer",value:function a(b,c,d){var e,f,g,i,j,k,l=this.sourceBuffer;if(Object.keys(l).length){h.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+b+"/"+c);if(this.flushBufferCounter<this.appended){for(var m in l){if(d&&m!==d){continue}e=l[m];e.ended=false;if(!e.updating){try{for(f=0;f<e.buffered.length;f++){g=e.buffered.start(f);i=e.buffered.end(f);if(navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&c===Number.POSITIVE_INFINITY){j=b;k=c}else{j=Math.max(g,b);k=Math.min(i,c)}if(Math.min(k,i)-j>.5){this.flushBufferCounter++;h.logger.log("flush "+m+" ["+j+","+k+"], of ["+g+","+i+"], pos:"+this.media.currentTime);e.remove(j,k);return false}}}catch(a){h.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}else{h.logger.warn("cannot flush, sb updating in progress");return false}}}else{h.logger.warn("abort flushing too many retries")}h.logger.log("buffer flushed")}return true}}]);return b}(g.default);exports.default=n},{33:33,34:34,35:35,54:54}],9:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(35);var e=h(d);var f=a(34);var g=h(f);function h(a){return a&&a.__esModule?a:{default:a}}function i(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function j(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function k(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var l=function(a){k(b,a);function b(a){i(this,b);return j(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,e.default.FPS_DROP_LEVEL_CAPPING,e.default.MEDIA_ATTACHING,e.default.MANIFEST_PARSED))}c(b,[{key:"destroy",value:function a(){if(this.hls.config.capLevelToPlayerSize){this.media=this.restrictedLevels=null;this.autoLevelCapping=Number.POSITIVE_INFINITY;if(this.timer){this.timer=clearInterval(this.timer)}}}},{key:"onFpsDropLevelCapping",value:function a(c){if(b.isLevelAllowed(c.droppedLevel,this.restrictedLevels)){this.restrictedLevels.push(c.droppedLevel)}}},{key:"onMediaAttaching",value:function a(b){this.media=b.media instanceof HTMLVideoElement?b.media:null}},{key:"onManifestParsed",value:function a(b){var c=this.hls;this.restrictedLevels=[];if(c.config.capLevelToPlayerSize){this.autoLevelCapping=Number.POSITIVE_INFINITY;this.levels=b.levels;c.firstLevel=this.getMaxLevel(b.firstLevel);clearInterval(this.timer);this.timer=setInterval(this.detectPlayerSize.bind(this),1e3);this.detectPlayerSize()}}},{key:"detectPlayerSize",value:function a(){if(this.media){var b=this.levels?this.levels.length:0;if(b){var c=this.hls;c.autoLevelCapping=this.getMaxLevel(b-1);if(c.autoLevelCapping>this.autoLevelCapping){c.streamController.nextLevelSwitch()}this.autoLevelCapping=c.autoLevelCapping}}}},{key:"getMaxLevel",value:function a(c){var d=this;if(!this.levels){return-1}var e=this.levels.filter(function(a,e){return b.isLevelAllowed(e,d.restrictedLevels)&&e<=c});return b.getMaxLevelByMediaSize(e,this.mediaWidth,this.mediaHeight)}},{key:"mediaWidth",get:function a(){var c=void 0;var d=this.media;if(d){c=d.width||d.clientWidth||d.offsetWidth;c*=b.contentScaleFactor}return c}},{key:"mediaHeight",get:function a(){var c=void 0;var d=this.media;if(d){c=d.height||d.clientHeight||d.offsetHeight;c*=b.contentScaleFactor}return c}}],[{key:"isLevelAllowed",value:function a(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return c.indexOf(b)===-1}},{key:"getMaxLevelByMediaSize",value:function a(b,c,d){if(!b||b&&!b.length){return-1}var e=function a(b,c){if(!c){return true}return b.width!==c.width||b.height!==c.height};var f=b.length-1;for(var g=0;g<b.length;g+=1){var h=b[g];if((h.width>=c||h.height>=d)&&e(h,b[g+1])){f=g;break}}return f}},{key:"contentScaleFactor",get:function a(){var b=1;try{b=window.devicePixelRatio}catch(a){}return b}}]);return b}(g.default);exports.default=l},{34:34,35:35}],10:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(35);var e=i(d);var f=a(34);var g=i(f);var h=a(54);function i(a){return a&&a.__esModule?a:{default:a}}function j(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function k(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function l(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var m=function(a){l(b,a);function b(a){j(this,b);return k(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,e.default.MEDIA_ATTACHING))}c(b,[{key:"destroy",value:function a(){if(this.timer){clearInterval(this.timer)}this.isVideoPlaybackQualityAvailable=false}},{key:"onMediaAttaching",value:function a(b){var c=this.hls.config;if(c.capLevelOnFPSDrop){var d=this.video=b.media instanceof HTMLVideoElement?b.media:null;if(typeof d.getVideoPlaybackQuality==="function"){this.isVideoPlaybackQualityAvailable=true}clearInterval(this.timer);this.timer=setInterval(this.checkFPSInterval.bind(this),c.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function a(b,c,d){var f=performance.now();if(c){if(this.lastTime){var g=f-this.lastTime,i=d-this.lastDroppedFrames,j=c-this.lastDecodedFrames,k=1e3*i/g,l=this.hls;l.trigger(e.default.FPS_DROP,{currentDropped:i,currentDecoded:j,totalDroppedFrames:d});if(k>0){if(i>l.config.fpsDroppedMonitoringThreshold*j){var m=l.currentLevel;h.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+m);if(m>0&&(l.autoLevelCapping===-1||l.autoLevelCapping>=m)){m=m-1;l.trigger(e.default.FPS_DROP_LEVEL_CAPPING,{level:m,droppedLevel:l.currentLevel});l.autoLevelCapping=m;l.streamController.nextLevelSwitch()}}}}this.lastTime=f;this.lastDroppedFrames=d;this.lastDecodedFrames=c}}},{key:"checkFPSInterval",value:function a(){var b=this.video;if(b){if(this.isVideoPlaybackQualityAvailable){var c=b.getVideoPlaybackQuality();this.checkFPS(b,c.totalVideoFrames,c.droppedVideoFrames)}else{this.checkFPS(b,b.webkitDecodedFrameCount,b.webkitDroppedFrameCount)}}}}]);return b}(g.default);exports.default=m},{34:34,35:35,54:54}],11:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(35);var e=j(d);var f=a(34);var g=j(f);var h=a(27);var i=j(h);function j(a){return a&&a.__esModule?a:{default:a}}function k(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function l(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function m(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var n=function(a){m(b,a);function b(a){k(this,b);var c=l(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,e.default.MEDIA_ATTACHED,e.default.MEDIA_DETACHING,e.default.FRAG_PARSING_METADATA));c.id3Track=undefined;c.media=undefined;return c}c(b,[{key:"destroy",value:function a(){g.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function a(b){this.media=b.media;if(!this.media){return}this.id3Track=this.media.addTextTrack("metadata","id3");this.id3Track.mode="hidden"}},{key:"onMediaDetaching",value:function a(){this.media=undefined}},{key:"onFragParsingMetadata",value:function a(b){var c=b.frag;var d=b.samples;var e=window.WebKitDataCue||window.VTTCue||window.TextTrackCue;for(var f=0;f<d.length;f++){var g=i.default.getID3Frames(d[f].data);if(g){var h=d[f].pts;var j=f<d.length-1?d[f+1].pts:c.endPTS;if(h===j){j+=1e-4}for(var k=0;k<g.length;k++){var l=g[k];if(!i.default.isTimeStampFrame(l)){var m=new e(h,j,"");m.value=l;this.id3Track.addCue(m)}}}}}}]);return b}(g.default);exports.default=n},{27:27,34:34,35:35}],12:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(35);var e=l(d);var f=a(34);var g=l(f);var h=a(54);var i=a(33);var j=a(37);var k=l(j);function l(a){return a&&a.__esModule?a:{default:a}}function m(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function n(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function o(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var p=function(a){o(b,a);function b(a){m(this,b);var c=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,e.default.MANIFEST_LOADED,e.default.LEVEL_LOADED,e.default.FRAG_LOADED,e.default.ERROR));c.ontick=c.tick.bind(c);c._manualLevel=-1;return c}c(b,[{key:"destroy",value:function a(){this.cleanTimer();this._manualLevel=-1}},{key:"cleanTimer",value:function a(){if(this.timer){clearTimeout(this.timer);this.timer=null}}},{key:"startLoad",value:function a(){this.canload=true;var b=this._levels;if(b){b.forEach(function(a){a.loadError=0;var b=a.details;if(b&&b.live){a.details=undefined}})}if(this.timer){this.tick()}}},{key:"stopLoad",value:function a(){this.canload=false}},{key:"onManifestLoaded",value:function a(b){var c=[],d=[],f,g={},j=false,k=false,l=this.hls,m=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n=function a(b,c){return MediaSource.isTypeSupported(b+"/mp4;codecs="+c)};b.levels.forEach(function(a){if(a.videoCodec){j=true}if(m&&a.audioCodec&&a.audioCodec.indexOf("mp4a.40.34")!==-1){a.audioCodec=undefined}if(a.audioCodec||a.attrs&&a.attrs.AUDIO){k=true}var b=g[a.bitrate];if(b===undefined){g[a.bitrate]=c.length;a.url=[a.url];a.urlId=0;c.push(a)}else{c[b].url.push(a.url)}});if(j&&k){c.forEach(function(a){if(a.videoCodec){d.push(a)}})}else{d=c}d=d.filter(function(a){var b=a.audioCodec,c=a.videoCodec;return(!b||n("audio",b))&&(!c||n("video",c))});if(d.length){f=d[0].bitrate;d.sort(function(a,b){return a.bitrate-b.bitrate});this._levels=d;for(var o=0;o<d.length;o++){if(d[o].bitrate===f){this._firstLevel=o;h.logger.log("manifest loaded,"+d.length+" level(s) found, first bitrate:"+f);break}}l.trigger(e.default.MANIFEST_PARSED,{levels:d,firstLevel:this._firstLevel,stats:b.stats,audio:k,video:j,altAudio:b.audioTracks.length>0})}else{l.trigger(e.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:true,url:l.url,reason:"no level with compatible codecs found in manifest"})}return}},{key:"setLevelInternal",value:function a(b){var c=this._levels;var d=this.hls;if(b>=0&&b<c.length){this.cleanTimer();if(this._level!==b){h.logger.log("switching to level "+b);this._level=b;var f=c[b];f.level=b;d.trigger(e.default.LEVEL_SWITCH,f);d.trigger(e.default.LEVEL_SWITCHING,f)}var g=c[b],j=g.details;if(!j||j.live===true){var k=g.urlId;d.trigger(e.default.LEVEL_LOADING,{url:g.url[k],level:b,id:k})}}else{d.trigger(e.default.ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.LEVEL_SWITCH_ERROR,level:b,fatal:false,reason:"invalid level idx"})}}},{key:"onError",value:function a(b){if(b.fatal){if(b.type===i.ErrorTypes.NETWORK_ERROR){this.cleanTimer()}return}var c=b.details,d=this.hls,e=void 0,f=void 0,g=false;switch(c){case i.ErrorDetails.FRAG_LOAD_ERROR:case i.ErrorDetails.FRAG_LOAD_TIMEOUT:case i.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case i.ErrorDetails.KEY_LOAD_ERROR:case i.ErrorDetails.KEY_LOAD_TIMEOUT:e=b.frag.level;break;case i.ErrorDetails.LEVEL_LOAD_ERROR:case i.ErrorDetails.LEVEL_LOAD_TIMEOUT:e=b.context.level;g=true;break;case i.ErrorDetails.REMUX_ALLOC_ERROR:e=b.level;break;default:break}if(e!==undefined){f=this._levels[e];if(!f.loadError){f.loadError=1}else{f.loadError++}var j=f.url.length;if(j>1&&f.loadError<j){f.urlId=(f.urlId+1)%j;f.details=undefined;h.logger.warn("level controller,"+c+" for level "+e+": switching to redundant stream id "+f.urlId)}else{var l=this._manualLevel===-1&&e;if(l){h.logger.warn("level controller,"+c+": switch-down for next fragment");d.nextAutoLevel=Math.max(0,e-1)}else if(f&&f.details&&f.details.live){h.logger.warn("level controller,"+c+" on live stream, discard");if(g){this._level=undefined}}else if(c===i.ErrorDetails.LEVEL_LOAD_ERROR||c===i.ErrorDetails.LEVEL_LOAD_TIMEOUT){var m=d.media,n=m&&k.default.isBuffered(m,m.currentTime)&&k.default.isBuffered(m,m.currentTime+.5);if(n){var o=d.config.levelLoadingRetryDelay;h.logger.warn("level controller,"+c+", but media buffered, retry in "+o+"ms");this.timer=setTimeout(this.ontick,o);b.levelRetry=true}else{h.logger.error("cannot recover "+c+" error");this._level=undefined;this.cleanTimer();b.fatal=true}}}}}},{key:"onFragLoaded",value:function a(b){var c=b.frag;if(c&&c.type==="main"){var d=this._levels[c.level];if(d){d.loadError=0}}}},{key:"onLevelLoaded",value:function a(b){var c=b.level;if(c===this._level){var d=this._levels[c];d.loadError=0;var e=b.details;if(e.live){var f=1e3*(e.averagetargetduration?e.averagetargetduration:e.targetduration),g=d.details;if(g&&e.endSN===g.endSN){f/=2;h.logger.log("same live playlist, reload twice faster")}f-=performance.now()-b.stats.trequest;f=Math.max(1e3,Math.round(f));h.logger.log("live playlist, reload in "+f+" ms");this.timer=setTimeout(this.ontick,f)}else{this.timer=null}}}},{key:"tick",value:function a(){var b=this._level;if(b!==undefined&&this.canload){var c=this._levels[b];if(c&&c.url){var d=c.urlId;this.hls.trigger(e.default.LEVEL_LOADING,{url:c.url[d],level:b,id:d})}}}},{key:"levels",get:function a(){return this._levels}},{key:"level",get:function a(){return this._level},set:function a(b){var c=this._levels;if(c&&c.length>b){if(this._level!==b||c[b].details===undefined){this.setLevelInternal(b)}}}},{key:"manualLevel",get:function a(){return this._manualLevel},set:function a(b){this._manualLevel=b;if(this._startLevel===undefined){this._startLevel=b}if(b!==-1){this.level=b}}},{key:"firstLevel",get:function a(){return this._firstLevel},set:function a(b){this._firstLevel=b}},{key:"startLevel",get:function a(){if(this._startLevel===undefined){var b=this.hls.config.startLevel;if(b!==undefined){return b}else{return this._firstLevel}}else{return this._startLevel}},set:function a(b){this._startLevel=b}},{key:"nextLoadLevel",get:function a(){if(this._manualLevel!==-1){return this._manualLevel}else{return this.hls.nextAutoLevel}},set:function a(b){this.level=b;if(this._manualLevel===-1){this.hls.nextAutoLevel=b}}}]);return b}(g.default);exports.default=p},{33:33,34:34,35:35,37:37,54:54}],13:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(48);var e=t(d);var f=a(37);var g=t(f);var h=a(25);var i=t(h);var j=a(35);var k=t(j);var l=a(34);var m=t(l);var n=a(38);var o=t(n);var p=a(55);var q=t(p);var r=a(33);var s=a(54);function t(a){return a&&a.__esModule?a:{default:a}}function u(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function v(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function w(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var x={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"};var y=function(a){w(b,a);function b(a){u(this,b);var c=v(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,k.default.MEDIA_ATTACHED,k.default.MEDIA_DETACHING,k.default.MANIFEST_LOADING,k.default.MANIFEST_PARSED,k.default.LEVEL_LOADED,k.default.KEY_LOADED,k.default.FRAG_LOADED,k.default.FRAG_LOAD_EMERGENCY_ABORTED,k.default.FRAG_PARSING_INIT_SEGMENT,k.default.FRAG_PARSING_DATA,k.default.FRAG_PARSED,k.default.ERROR,k.default.AUDIO_TRACK_SWITCHING,k.default.AUDIO_TRACK_SWITCHED,k.default.BUFFER_CREATED,k.default.BUFFER_APPENDED,k.default.BUFFER_FLUSHED));c.config=a.config;c.audioCodecSwap=false;c.ticks=0;c._state=x.STOPPED;c.ontick=c.tick.bind(c);return c}c(b,[{key:"destroy",value:function a(){this.stopLoad();if(this.timer){clearInterval(this.timer);this.timer=null}m.default.prototype.destroy.call(this);this.state=x.STOPPED}},{key:"startLoad",value:function a(b){if(this.levels){var c=this.lastCurrentTime,d=this.hls;this.stopLoad();if(!this.timer){this.timer=setInterval(this.ontick,100)}this.level=-1;this.fragLoadError=0;if(!this.startFragRequested){var e=d.startLevel;if(e===-1){e=0;this.bitrateTest=true}this.level=d.nextLoadLevel=e;this.loadedmetadata=false}if(c>0&&b===-1){s.logger.log("override startPosition with lastCurrentTime @"+c.toFixed(3));b=c}this.state=x.IDLE;this.nextLoadPosition=this.startPosition=this.lastCurrentTime=b;this.tick()}else{this.forceStartLoad=true;this.state=x.STOPPED}}},{key:"stopLoad",value:function a(){var b=this.fragCurrent;if(b){if(b.loader){b.loader.abort()}this.fragCurrent=null}this.fragPrevious=null;if(this.demuxer){this.demuxer.destroy();this.demuxer=null}this.state=x.STOPPED;this.forceStartLoad=false}},{key:"tick",value:function a(){this.ticks++;if(this.ticks===1){this.doTick();if(this.ticks>1){setTimeout(this.tick,1)}this.ticks=0}}},{key:"doTick",value:function a(){switch(this.state){case x.ERROR:break;case x.BUFFER_FLUSHING:this.fragLoadError=0;break;case x.IDLE:this._doTickIdle();break;case x.WAITING_LEVEL:var b=this.levels[this.level];if(b&&b.details){this.state=x.IDLE}break;case x.FRAG_LOADING_WAITING_RETRY:var c=performance.now();var d=this.retryDate;if(!d||c>=d||this.media&&this.media.seeking){s.logger.log("mediaController: retryDate reached, switch back to IDLE state");this.state=x.IDLE}break;case x.ERROR:case x.STOPPED:case x.FRAG_LOADING:case x.PARSING:case x.PARSED:case x.ENDED:break;default:break}this._checkBuffer();this._checkFragmentChanged()}},{key:"_doTickIdle",value:function a(){var b=this.hls,c=b.config,d=this.media;if(this.levelLastLoaded!==undefined&&!d&&(this.startFragRequested||!c.startFragPrefetch)){return}var e=void 0;if(this.loadedmetadata){e=d.currentTime}else{e=this.nextLoadPosition}var f=b.nextLoadLevel,h=this.levels[f];if(!h){return}var i=h.bitrate,j=void 0;if(i){j=Math.max(8*c.maxBufferSize/i,c.maxBufferLength)}else{j=c.maxBufferLength}j=Math.min(j,c.maxMaxBufferLength);var l=g.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:d,e,c.maxBufferHole),m=l.len;if(m>=j){return}s.logger.trace("buffer length of "+m.toFixed(3)+" is below max of "+j.toFixed(3)+". checking for more payload ...");this.level=b.nextLoadLevel=f;var n=h.details;if(typeof n==="undefined"||n.live&&this.levelLastLoaded!==f){this.state=x.WAITING_LEVEL;return}var o=this.fragPrevious;if(!n.live&&o&&o.sn===n.endSN&&m&&!l.nextStart){var p=Math.min(d.duration,o.start+o.duration);if(p-Math.max(l.end,o.start)<=Math.max(.2,o.duration)){var q={};if(this.altAudio){q.type="video"}this.hls.trigger(k.default.BUFFER_EOS,q);this.state=x.ENDED;return}}this._fetchPayloadOrEos(e,l,n)}},{key:"_fetchPayloadOrEos",value:function a(b,c,d){var e=this.fragPrevious,f=this.level,g=d.fragments,h=g.length;if(h===0){return}var i=g[0].start,j=g[h-1].start+g[h-1].duration,k=c.end,l=void 0;if(d.initSegment&&!d.initSegment.data){l=d.initSegment}else{if(d.live){var m=this.config.initialLiveManifestSize;if(h<m){s.logger.warn("Can not start playback of a level, reason: not enough fragments "+h+" < "+m);return}l=this._ensureFragmentAtLivePoint(d,k,i,j,e,g,h);if(l===null){return}}else{if(k<i){l=g[0]}}}if(!l){l=this._findFragment(i,e,h,g,k,j,d)}if(l){this._loadFragmentOrKey(l,f,d,b,k)}return}},{key:"_ensureFragmentAtLivePoint",value:function a(b,c,d,f,g,h,i){var j=this.hls.config,k=this.media;var l=void 0;var m=j.liveMaxLatencyDuration!==undefined?j.liveMaxLatencyDuration:j.liveMaxLatencyDurationCount*b.targetduration;if(c<Math.max(d-j.maxFragLookUpTolerance,f-m)){var n=this.liveSyncPosition=this.computeLivePosition(d,b);s.logger.log("buffer end: "+c.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+n.toFixed(3));c=n;if(k&&k.readyState&&k.duration>n){k.currentTime=n}this.nextLoadPosition=n}if(b.PTSKnown&&c>f&&k&&k.readyState){return null}if(this.startFragRequested&&!b.PTSKnown){if(g){var o=g.sn+1;if(o>=b.startSN&&o<=b.endSN){var p=h[o-b.startSN];if(g.cc===p.cc){l=p;s.logger.log("live playlist, switching playlist, load frag with next SN: "+l.sn)}}if(!l){l=e.default.search(h,function(a){return g.cc-a.cc});if(l){s.logger.log("live playlist, switching playlist, load frag with same CC: "+l.sn)}}}if(!l){l=h[Math.min(i-1,Math.round(i/2))];s.logger.log("live playlist, switching playlist, unknown, load middle frag : "+l.sn)}}return l}},{key:"_findFragment",value:function a(b,c,d,f,g,h,i){var j=this.hls.config;var k=void 0;var l=void 0;var m=j.maxFragLookUpTolerance;var n=c?f[c.sn-f[0].sn+1]:undefined;var o=function a(b){var c=Math.min(m,b.duration);if(b.start+b.duration-c<=g){return 1}else if(b.start-c>g&&b.start){return-1}return 0};if(g<h){if(g>h-m){m=0}if(n&&!o(n)){l=n}else{l=e.default.search(f,o)}}else{l=f[d-1]}if(l){k=l;var p=k.sn-i.startSN;var q=c&&k.level===c.level;var r=f[p-1];var t=f[p+1];if(c&&k.sn===c.sn){if(q&&!k.backtracked){if(k.sn<i.endSN){var u=c.deltaPTS;if(u&&u>j.maxBufferHole&&c.dropped&&p){k=r;s.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this");c.loadCounter--}else{k=t;s.logger.log("SN just loaded, load next one: "+k.sn)}}else{k=null}}else if(k.backtracked){if(t&&t.backtracked){s.logger.warn("Already backtracked from fragment "+t.sn+", will not backtrack to fragment "+k.sn+". Loading fragment "+t.sn);k=t}else{s.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe");k.dropped=0;if(r){if(r.loadCounter){r.loadCounter--}k=r;k.backtracked=true}else if(p){k=null}}}}}return k}},{key:"_loadFragmentOrKey",value:function a(b,c,d,e,f){var g=this.hls,h=g.config;if(b.decryptdata&&b.decryptdata.uri!=null&&b.decryptdata.key==null){s.logger.log("Loading key for "+b.sn+" of ["+d.startSN+" ,"+d.endSN+"],level "+c);this.state=x.KEY_LOADING;g.trigger(k.default.KEY_LOADING,{frag:b})}else{s.logger.log("Loading "+b.sn+" of ["+d.startSN+" ,"+d.endSN+"],level "+c+", currentTime:"+e.toFixed(3)+",bufferEnd:"+f.toFixed(3));if(this.fragLoadIdx!==undefined){this.fragLoadIdx++}else{this.fragLoadIdx=0}if(b.loadCounter){b.loadCounter++;var j=h.fragLoadingLoopThreshold;if(b.loadCounter>j&&Math.abs(this.fragLoadIdx-b.loadIdx)<j){g.trigger(k.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:false,frag:b});return}}else{b.loadCounter=1}b.loadIdx=this.fragLoadIdx;this.fragCurrent=b;this.startFragRequested=true;if(!isNaN(b.sn)){this.nextLoadPosition=b.start+b.duration}b.autoLevel=g.autoLevelEnabled;b.bitrateTest=this.bitrateTest;g.trigger(k.default.FRAG_LOADING,{frag:b});if(!this.demuxer){this.demuxer=new i.default(g,"main")}this.state=x.FRAG_LOADING;return}}},{key:"getBufferedFrag",value:function a(b){return e.default.search(this._bufferedFrags,function(a){if(b<a.startPTS){return-1}else if(b>a.endPTS){return 1}return 0})}},{key:"followingBufferedFrag",value:function a(b){if(b){return this.getBufferedFrag(b.endPTS+.5)}return null}},{key:"_checkFragmentChanged",value:function a(){var b,c,d=this.media;if(d&&d.readyState&&d.seeking===false){c=d.currentTime;if(c>d.playbackRate*this.lastCurrentTime){this.lastCurrentTime=c}if(g.default.isBuffered(d,c)){b=this.getBufferedFrag(c)}else if(g.default.isBuffered(d,c+.1)){b=this.getBufferedFrag(c+.1)}if(b){var e=b;if(e!==this.fragPlaying){this.hls.trigger(k.default.FRAG_CHANGED,{frag:e});var f=e.level;if(!this.fragPlaying||this.fragPlaying.level!==f){this.hls.trigger(k.default.LEVEL_SWITCHED,{level:f})}this.fragPlaying=e}}}}},{key:"immediateLevelSwitch",value:function a(){s.logger.log("immediateLevelSwitch");if(!this.immediateSwitch){this.immediateSwitch=true;var b=this.media,c=void 0;if(b){c=b.paused;b.pause()}else{c=true}this.previouslyPaused=c}var d=this.fragCurrent;if(d&&d.loader){d.loader.abort()}this.fragCurrent=null;this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold;this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function a(){var b=this.media;if(b&&b.buffered.length){this.immediateSwitch=false;if(g.default.isBuffered(b,b.currentTime)){b.currentTime-=1e-4}if(!this.previouslyPaused){b.play()}}}},{key:"nextLevelSwitch",value:function a(){var b=this.media;if(b&&b.readyState){var c=void 0,d=void 0,e=void 0;this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold;d=this.getBufferedFrag(b.currentTime);if(d&&d.startPTS>1){this.flushMainBuffer(0,d.startPTS-1)}if(!b.paused){var f=this.hls.nextLoadLevel,g=this.levels[f],h=this.fragLastKbps;if(h&&this.fragCurrent){c=this.fragCurrent.duration*g.bitrate/(1e3*h)+1}else{c=0}}else{c=0}e=this.getBufferedFrag(b.currentTime+c);if(e){e=this.followingBufferedFrag(e);if(e){var i=this.fragCurrent;if(i&&i.loader){i.loader.abort()}this.fragCurrent=null;this.flushMainBuffer(e.maxStartPTS,Number.POSITIVE_INFINITY)}}}}},{key:"flushMainBuffer",value:function a(b,c){this.state=x.BUFFER_FLUSHING;var d={startOffset:b,endOffset:c};if(this.altAudio){d.type="video"}this.hls.trigger(k.default.BUFFER_FLUSHING,d)}},{key:"onMediaAttached",value:function a(b){var c=this.media=this.mediaBuffer=b.media;this.onvseeking=this.onMediaSeeking.bind(this);this.onvseeked=this.onMediaSeeked.bind(this);this.onvended=this.onMediaEnded.bind(this);c.addEventListener("seeking",this.onvseeking);c.addEventListener("seeked",this.onvseeked);c.addEventListener("ended",this.onvended);var d=this.config;if(this.levels&&d.autoStartLoad){this.hls.startLoad(d.startPosition)}}},{key:"onMediaDetaching",value:function a(){var b=this.media;if(b&&b.ended){s.logger.log("MSE detaching and video ended, reset startPosition");this.startPosition=this.lastCurrentTime=0}var c=this.levels;if(c){c.forEach(function(a){if(a.details){a.details.fragments.forEach(function(a){a.loadCounter=undefined;a.backtracked=undefined})}})}if(b){b.removeEventListener("seeking",this.onvseeking);b.removeEventListener("seeked",this.onvseeked);b.removeEventListener("ended",this.onvended);this.onvseeking=this.onvseeked=this.onvended=null}this.media=this.mediaBuffer=null;this.loadedmetadata=false;this.stopLoad()}},{key:"onMediaSeeking",value:function a(){var b=this.media,c=b?b.currentTime:undefined,d=this.config;if(!isNaN(c)){s.logger.log("media seeking to "+c.toFixed(3))}var e=this.mediaBuffer?this.mediaBuffer:b;var f=g.default.bufferInfo(e,c,this.config.maxBufferHole);if(this.state===x.FRAG_LOADING){var h=this.fragCurrent;if(f.len===0&&h){var i=d.maxFragLookUpTolerance,j=h.start-i,k=h.start+h.duration+i;if(c<j||c>k){if(h.loader){s.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load");h.loader.abort()}this.fragCurrent=null;this.fragPrevious=null;this.state=x.IDLE}else{s.logger.log("seeking outside of buffer but within currently loaded fragment range")}}}else if(this.state===x.ENDED){if(f.len===0){this.fragPrevious=0}this.state=x.IDLE}if(b){this.lastCurrentTime=c}if(this.state!==x.FRAG_LOADING&&this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*d.fragLoadingLoopThreshold}if(!this.loadedmetadata){this.nextLoadPosition=this.startPosition=c}this.tick()}},{key:"onMediaSeeked",value:function a(){var b=this.media,c=b?b.currentTime:undefined;if(!isNaN(c)){s.logger.log("media seeked to "+c.toFixed(3))}this.tick()}},{key:"onMediaEnded",value:function a(){s.logger.log("media ended");this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function a(){s.logger.log("trigger BUFFER_RESET");this.hls.trigger(k.default.BUFFER_RESET);this._bufferedFrags=[];this.stalled=false;this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function a(b){var c=false,d=false,e;b.levels.forEach(function(a){e=a.audioCodec;if(e){if(e.indexOf("mp4a.40.2")!==-1){c=true}if(e.indexOf("mp4a.40.5")!==-1){d=true}}});this.audioCodecSwitch=c&&d;if(this.audioCodecSwitch){s.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC")}this.levels=b.levels;this.startLevelLoaded=false;this.startFragRequested=false;var f=this.config;if(f.autoStartLoad||this.forceStartLoad){this.hls.startLoad(f.startPosition)}}},{key:"onLevelLoaded",value:function a(b){var c=b.details,d=b.level,e=this.levels[d],f=c.totalduration,g=0;s.logger.log("level "+d+" loaded ["+c.startSN+","+c.endSN+"],duration:"+f);this.levelLastLoaded=d;if(c.live){var h=e.details;if(h&&c.fragments.length>0){o.default.mergeDetails(h,c);g=c.fragments[0].start;this.liveSyncPosition=this.computeLivePosition(g,h);if(c.PTSKnown){s.logger.log("live playlist sliding:"+g.toFixed(3))}else{s.logger.log("live playlist - outdated PTS, unknown sliding")}}else{c.PTSKnown=false;s.logger.log("live playlist - first load, unknown sliding")}}else{c.PTSKnown=false}e.details=c;this.hls.trigger(k.default.LEVEL_UPDATED,{details:c,level:d});if(this.startFragRequested===false){if(this.startPosition===-1||this.lastCurrentTime===-1){var i=c.startTimeOffset;if(!isNaN(i)){if(i<0){s.logger.log("negative start time offset "+i+", count from end of last fragment");i=g+f+i}s.logger.log("start time offset found in playlist, adjust startPosition to "+i);this.startPosition=i}else{if(c.live){this.startPosition=this.computeLivePosition(g,c);s.logger.log("configure startPosition to "+this.startPosition)}else{this.startPosition=0}}this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}if(this.state===x.WAITING_LEVEL){this.state=x.IDLE}this.tick()}},{key:"onKeyLoaded",value:function a(){if(this.state===x.KEY_LOADING){this.state=x.IDLE;this.tick()}}},{key:"onFragLoaded",value:function a(b){var c=this.fragCurrent,d=b.frag;if(this.state===x.FRAG_LOADING&&c&&d.type==="main"&&d.level===c.level&&d.sn===c.sn){var e=b.stats,f=this.levels[c.level],g=f.details;s.logger.log("Loaded  "+c.sn+" of ["+g.startSN+" ,"+g.endSN+"],level "+c.level);this.bitrateTest=false;this.stats=e;if(d.bitrateTest===true&&this.hls.nextLoadLevel){this.state=x.IDLE;this.startFragRequested=false;e.tparsed=e.tbuffered=performance.now();this.hls.trigger(k.default.FRAG_BUFFERED,{stats:e,frag:c,id:"main"});this.tick()}else if(d.sn==="initSegment"){this.state=x.IDLE;e.tparsed=e.tbuffered=performance.now();g.initSegment.data=b.payload;this.hls.trigger(k.default.FRAG_BUFFERED,{stats:e,frag:c,id:"main"});this.tick()}else{this.state=x.PARSING;var h=g.totalduration,j=c.level,l=c.sn,m=this.config.defaultAudioCodec||f.audioCodec;if(this.audioCodecSwap){s.logger.log("swapping playlist audio codec");if(m===undefined){m=this.lastAudioCodec}if(m){if(m.indexOf("mp4a.40.5")!==-1){m="mp4a.40.2"}else{m="mp4a.40.5"}}}this.pendingBuffering=true;this.appended=false;s.logger.log("Parsing "+l+" of ["+g.startSN+" ,"+g.endSN+"],level "+j+", cc "+c.cc);var n=this.demuxer;if(!n){n=this.demuxer=new i.default(this.hls,"main")}var o=this.media;var p=o&&o.seeking;var q=!p&&(g.PTSKnown||!g.live);var r=g.initSegment?g.initSegment.data:[];n.push(b.payload,r,m,f.videoCodec,c,h,q,undefined)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function a(b){var c=this.fragCurrent;var d=b.frag;if(c&&b.id==="main"&&d.sn===c.sn&&d.level===c.level&&this.state===x.PARSING){var e=b.tracks,f,g;if(e.audio&&this.altAudio){delete e.audio}g=e.audio;if(g){var h=this.levels[this.level].audioCodec,i=navigator.userAgent.toLowerCase();if(h&&this.audioCodecSwap){s.logger.log("swapping playlist audio codec");if(h.indexOf("mp4a.40.5")!==-1){h="mp4a.40.2"}else{h="mp4a.40.5"}}if(this.audioCodecSwitch){if(g.metadata.channelCount!==1&&i.indexOf("firefox")===-1){h="mp4a.40.5"}}if(i.indexOf("android")!==-1&&g.container!=="audio/mpeg"){h="mp4a.40.2";s.logger.log("Android: force audio codec to "+h)}g.levelCodec=h;g.id=b.id}g=e.video;if(g){g.levelCodec=this.levels[this.level].videoCodec;g.id=b.id}this.hls.trigger(k.default.BUFFER_CODECS,e);for(f in e){g=e[f];s.logger.log("main track:"+f+",container:"+g.container+",codecs[level/parsed]=["+g.levelCodec+"/"+g.codec+"]");var j=g.initSegment;if(j){this.appended=true;this.pendingBuffering=true;this.hls.trigger(k.default.BUFFER_APPENDING,{type:f,data:j,parent:"main",content:"initSegment"})}}this.tick()}}},{key:"onFragParsingData",value:function a(b){var c=this;var d=this.fragCurrent;var e=b.frag;if(d&&b.id==="main"&&e.sn===d.sn&&e.level===d.level&&!(b.type==="audio"&&this.altAudio)&&this.state===x.PARSING){var f=this.levels[this.level],g=d;if(isNaN(b.endPTS)){b.endPTS=b.startPTS+d.duration;b.endDTS=b.startDTS+d.duration}s.logger.log("Parsed "+b.type+",PTS:["+b.startPTS.toFixed(3)+","+b.endPTS.toFixed(3)+"],DTS:["+b.startDTS.toFixed(3)+"/"+b.endDTS.toFixed(3)+"],nb:"+b.nb+",dropped:"+(b.dropped||0));if(b.type==="video"){g.dropped=b.dropped;if(g.dropped){if(!g.backtracked){s.logger.warn("missing video frame(s), backtracking fragment");g.backtracked=true;this.nextLoadPosition=b.startPTS;this.state=x.IDLE;this.fragPrevious=g;this.tick();return}else{s.logger.warn("Already backtracked on this fragment, appending with the gap")}}else{g.backtracked=false}}var h=o.default.updateFragPTSDTS(f.details,g,b.startPTS,b.endPTS,b.startDTS,b.endDTS),i=this.hls;i.trigger(k.default.LEVEL_PTS_UPDATED,{details:f.details,level:this.level,drift:h,type:b.type,start:b.startPTS,end:b.endPTS});[b.data1,b.data2].forEach(function(a){if(a&&a.length&&c.state===x.PARSING){c.appended=true;c.pendingBuffering=true;i.trigger(k.default.BUFFER_APPENDING,{type:b.type,data:a,parent:"main",content:"data"})}});this.tick()}}},{key:"onFragParsed",value:function a(b){var c=this.fragCurrent;var d=b.frag;if(c&&b.id==="main"&&d.sn===c.sn&&d.level===c.level&&this.state===x.PARSING){this.stats.tparsed=performance.now();this.state=x.PARSED;this._checkAppendedParsed()}}},{key:"onAudioTrackSwitching",value:function a(b){var c=!!b.url,d=b.id;if(!c){if(this.mediaBuffer!==this.media){s.logger.log("switching on main audio, use media.buffered to schedule main fragment loading");this.mediaBuffer=this.media;var e=this.fragCurrent;if(e.loader){s.logger.log("switching to main audio track, cancel main fragment load");e.loader.abort()}this.fragCurrent=null;this.fragPrevious=null;if(this.demuxer){this.demuxer.destroy();this.demuxer=null}this.state=x.IDLE}var f=this.hls;f.trigger(k.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"});f.trigger(k.default.AUDIO_TRACK_SWITCHED,{id:d});this.altAudio=false}}},{key:"onAudioTrackSwitched",value:function a(b){var c=b.id,d=!!this.hls.audioTracks[c].url;if(d){var e=this.videoBuffer;if(e&&this.mediaBuffer!==e){s.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading");this.mediaBuffer=e}}this.altAudio=d;this.tick()}},{key:"onBufferCreated",value:function a(b){var c=b.tracks,d=void 0,e=void 0,f=false;for(var g in c){var h=c[g];if(h.id==="main"){e=g;d=h;if(g==="video"){this.videoBuffer=c[g].buffer}}else{f=true}}if(f&&d){s.logger.log("alternate track found, use "+e+".buffered to schedule main fragment loading");this.mediaBuffer=d.buffer}else{this.mediaBuffer=this.media}}},{key:"onBufferAppended",value:function a(b){if(b.parent==="main"){var c=this.state;if(c===x.PARSING||c===x.PARSED){this.pendingBuffering=b.pending>0;this._checkAppendedParsed()}}}},{key:"_checkAppendedParsed",value:function a(){if(this.state===x.PARSED&&(!this.appended||!this.pendingBuffering)){var b=this.fragCurrent;if(b){var c=this.mediaBuffer?this.mediaBuffer:this.media;s.logger.log("main buffered : "+q.default.toString(c.buffered));var d=this._bufferedFrags.filter(function(a){return g.default.isBuffered(c,(a.startPTS+a.endPTS)/2)});d.push(b);this._bufferedFrags=d.sort(function(a,b){return a.startPTS-b.startPTS});this.fragPrevious=b;var e=this.stats;e.tbuffered=performance.now();this.fragLastKbps=Math.round(8*e.total/(e.tbuffered-e.tfirst));this.hls.trigger(k.default.FRAG_BUFFERED,{stats:e,frag:b,id:"main"});this.state=x.IDLE}this.tick()}}},{key:"onError",value:function a(b){var c=b.frag||this.fragCurrent;if(c&&c.type!=="main"){return}var d=this.media,e=d&&g.default.isBuffered(d,d.currentTime)&&g.default.isBuffered(d,d.currentTime+.5);switch(b.details){case r.ErrorDetails.FRAG_LOAD_ERROR:case r.ErrorDetails.FRAG_LOAD_TIMEOUT:case r.ErrorDetails.KEY_LOAD_ERROR:case r.ErrorDetails.KEY_LOAD_TIMEOUT:if(!b.fatal){var f=this.fragLoadError;if(f){f++}else{f=1}var h=this.config;if(f<=h.fragLoadingMaxRetry||e||c.autoLevel&&c.level){this.fragLoadError=f;c.loadCounter=0;var i=Math.min(Math.pow(2,f-1)*h.fragLoadingRetryDelay,h.fragLoadingMaxRetryTimeout);s.logger.warn("mediaController: frag loading failed, retry in "+i+" ms");this.retryDate=performance.now()+i;if(!this.loadedmetadata){this.startFragRequested=false;this.nextLoadPosition=this.startPosition}this.state=x.FRAG_LOADING_WAITING_RETRY}else{s.logger.error("mediaController: "+b.details+" reaches max retry, redispatch as fatal ...");b.fatal=true;this.state=x.ERROR}}break;case r.ErrorDetails.FRAG_LOOP_LOADING_ERROR:if(!b.fatal){if(e){this._reduceMaxBufferLength(c.duration);this.state=x.IDLE}else{if(!c.autoLevel||c.level===0){b.fatal=true;this.state=x.ERROR}}}break;case r.ErrorDetails.LEVEL_LOAD_ERROR:case r.ErrorDetails.LEVEL_LOAD_TIMEOUT:if(this.state!==x.ERROR){if(b.fatal){this.state=x.ERROR;s.logger.warn("streamController: "+b.details+",switch to "+this.state+" state ...")}else{if(!b.levelRetry&&this.state===x.WAITING_LEVEL){this.state=x.IDLE}}}break;case r.ErrorDetails.BUFFER_FULL_ERROR:if(b.parent==="main"&&(this.state===x.PARSING||this.state===x.PARSED)){if(e){this._reduceMaxBufferLength(this.config.maxBufferLength);this.state=x.IDLE}else{s.logger.warn("buffer full error also media.currentTime is not buffered, flush everything");this.fragCurrent=null;this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}}break;default:break}}},{key:"_reduceMaxBufferLength",value:function a(b){var c=this.config;if(c.maxMaxBufferLength>=b){c.maxMaxBufferLength/=2;s.logger.warn("main:reduce max buffer length to "+c.maxMaxBufferLength+"s");this.fragLoadIdx+=2*c.fragLoadingLoopThreshold}}},{key:"_checkBuffer",value:function a(){var b=this.media,c=this.config;if(b&&b.readyState){var d=b.currentTime,e=this.mediaBuffer?this.mediaBuffer:b,f=e.buffered;if(!this.loadedmetadata&&f.length){this.loadedmetadata=true;var h=b.seeking?d:this.startPosition,i=g.default.isBuffered(e,h),j=f.start(0);if(d!==h||!i&&Math.abs(h-j)<c.maxSeekHole){s.logger.log("target start position:"+h);if(!i){h=j;s.logger.log("target start position not buffered, seek to buffered.start(0) "+h)}s.logger.log("adjust currentTime from "+d+" to "+h);b.currentTime=h}}else if(this.immediateSwitch){this.immediateLevelSwitchEnd()}else{var l=g.default.bufferInfo(b,d,0),m=!(b.paused||b.ended||b.buffered.length===0),n=.5,o=d!==this.lastCurrentTime;if(o){if(this.stallReported){s.logger.warn("playback not stuck anymore @"+d+", after "+Math.round(performance.now()-this.stalled)+"ms");this.stallReported=false}this.stalled=undefined;this.nudgeRetry=0}else{if(m){var p=performance.now();var q=this.hls;if(!this.stalled){this.stalled=p;this.stallReported=false}else{var t=p-this.stalled;var u=l.len;var v=this.nudgeRetry||0;if(u<=n&&t>c.lowBufferWatchdogPeriod*1e3){if(!this.stallReported){this.stallReported=true;s.logger.warn("playback stalling in low buffer @"+d);q.trigger(k.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.BUFFER_STALLED_ERROR,fatal:false,buffer:u})}var w=l.nextStart,x=w-d;if(w&&x<c.maxSeekHole&&x>0){this.nudgeRetry=++v;var y=v*c.nudgeOffset;s.logger.log("adjust currentTime from "+b.currentTime+" to next buffered @ "+w+" + nudge "+y);b.currentTime=w+y;this.stalled=undefined;q.trigger(k.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:false,hole:w+y-d})}}else if(u>n&&t>c.highBufferWatchdogPeriod*1e3){if(!this.stallReported){this.stallReported=true;s.logger.warn("playback stalling in high buffer @"+d);q.trigger(k.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.BUFFER_STALLED_ERROR,fatal:false,buffer:u})}this.stalled=undefined;this.nudgeRetry=++v;if(v<c.nudgeMaxRetry){var z=b.currentTime;var A=z+v*c.nudgeOffset;s.logger.log("adjust currentTime from "+z+" to "+A);b.currentTime=A;q.trigger(k.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:false})}else{s.logger.error("still stuck in high buffer @"+d+" after "+c.nudgeMaxRetry+", raise fatal error");q.trigger(k.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.BUFFER_STALLED_ERROR,fatal:true})}}}}}}}}},{key:"onFragLoadEmergencyAborted",value:function a(){this.state=x.IDLE;if(!this.loadedmetadata){this.startFragRequested=false;this.nextLoadPosition=this.startPosition}this.tick()}},{key:"onBufferFlushed",value:function a(){var b=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(a){return g.default.isBuffered(b,(a.startPTS+a.endPTS)/2)});this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold;this.state=x.IDLE;this.fragPrevious=null}},{key:"swapAudioCodec",value:function a(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function a(b,c){var d=this.config.liveSyncDuration!==undefined?this.config.liveSyncDuration:this.config.liveSyncDurationCount*c.targetduration;return b+Math.max(0,c.totalduration-d)}},{key:"state",set:function a(b){if(this.state!==b){var c=this.state;this._state=b;s.logger.log("main stream:"+c+"->"+b);this.hls.trigger(k.default.STREAM_STATE_TRANSITION,{previousState:c,nextState:b})}},get:function a(){return this._state}},{key:"currentLevel",get:function a(){var b=this.media;if(b){var c=this.getBufferedFrag(b.currentTime);if(c){return c.level}}return-1}},{key:"nextBufferedFrag",get:function a(){var b=this.media;if(b){return this.followingBufferedFrag(this.getBufferedFrag(b.currentTime))}else{return null}}},{key:"nextLevel",get:function a(){var b=this.nextBufferedFrag;if(b){return b.level}else{return-1}}},{key:"liveSyncPosition",get:function a(){return this._liveSyncPosition},set:function a(b){this._liveSyncPosition=b}}]);return b}(m.default);exports.default=y},{25:25,33:33,34:34,35:35,37:37,38:38,48:48,54:54,55:55}],14:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(35);var e=i(d);var f=a(34);var g=i(f);var h=a(54);function i(a){return a&&a.__esModule?a:{default:a}}function j(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function k(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function l(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var m=function(a){l(b,a);function b(a){j(this,b);var c=k(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,e.default.ERROR,e.default.SUBTITLE_TRACKS_UPDATED,e.default.SUBTITLE_TRACK_SWITCH,e.default.SUBTITLE_TRACK_LOADED,e.default.SUBTITLE_FRAG_PROCESSED));c.config=a.config;c.vttFragSNsProcessed={};c.vttFragQueues=undefined;c.currentlyProcessing=null;c.currentTrackId=-1;return c}c(b,[{key:"destroy",value:function a(){g.default.prototype.destroy.call(this)}},{key:"clearVttFragQueues",value:function a(){var b=this;this.vttFragQueues={};this.tracks.forEach(function(a){b.vttFragQueues[a.id]=[]})}},{key:"nextFrag",value:function a(){if(this.currentlyProcessing===null&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var b=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.hls.trigger(e.default.FRAG_LOADING,{frag:b})}}},{key:"onSubtitleFragProcessed",value:function a(b){if(b.success){this.vttFragSNsProcessed[b.frag.trackId].push(b.frag.sn)}this.currentlyProcessing=null;this.nextFrag()}},{key:"onError",value:function a(b){var c=b.frag;if(c&&c.type!=="subtitle"){return}if(this.currentlyProcessing){this.currentlyProcessing=null;this.nextFrag()}}},{key:"onSubtitleTracksUpdated",value:function a(b){var c=this;h.logger.log("subtitle tracks updated");this.tracks=b.subtitleTracks;this.clearVttFragQueues();this.vttFragSNsProcessed={};this.tracks.forEach(function(a){c.vttFragSNsProcessed[a.id]=[]})}},{key:"onSubtitleTrackSwitch",value:function a(b){this.currentTrackId=b.id;this.clearVttFragQueues()}},{key:"onSubtitleTrackLoaded",value:function a(b){var c=this.vttFragSNsProcessed[b.id],d=this.vttFragQueues[b.id],e=!!this.currentlyProcessing?this.currentlyProcessing.sn:-1;var f=function a(b){return c.indexOf(b.sn)>-1};var g=function a(b){return d.some(function(a){return a.sn===b.sn})};b.details.fragments.forEach(function(a){if(!(f(a)||a.sn===e||g(a))){a.trackId=b.id;d.push(a)}});this.nextFrag()}}]);return b}(g.default);exports.default=m},{34:34,35:35,54:54}],15:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(35);var e=i(d);var f=a(34);var g=i(f);var h=a(54);function i(a){return a&&a.__esModule?a:{default:a}}function j(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function k(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function l(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}function m(a){var b=[];for(var c=0;c<a.length;c++){if(a[c].kind==="subtitles"){b.push(a[c])}}return b}var n=function(a){l(b,a);function b(a){j(this,b);var c=k(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,e.default.MEDIA_ATTACHED,e.default.MEDIA_DETACHING,e.default.MANIFEST_LOADING,e.default.MANIFEST_LOADED,e.default.SUBTITLE_TRACK_LOADED));c.tracks=[];c.trackId=-1;c.media=undefined;return c}c(b,[{key:"_onTextTracksChanged",value:function a(){if(!this.media){return}var b=-1;var c=m(this.media.textTracks);for(var d=0;d<c.length;d++){if(c[d].mode==="showing"){b=d}}this.subtitleTrack=b}},{key:"destroy",value:function a(){g.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function a(b){this.media=b.media;if(!this.media){return}this.trackChangeListener=this._onTextTracksChanged.bind(this);this.media.textTracks.addEventListener("change",this.trackChangeListener)}},{key:"onMediaDetaching",value:function a(){if(!this.media){return}this.media.textTracks.removeEventListener("change",this.trackChangeListener);this.media=undefined}},{key:"onManifestLoading",value:function a(){this.tracks=[];this.trackId=-1}},{key:"onManifestLoaded",value:function a(b){var c=this;var d=b.subtitles||[];var f=false;this.tracks=d;this.trackId=-1;this.hls.trigger(e.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:d});d.forEach(function(a){if(a.default){c.subtitleTrack=a.id;f=true}})}},{key:"onTick",value:function a(){var b=this.trackId;var c=this.tracks[b];if(!c){return}var d=c.details;if(d===undefined||d.live===true){h.logger.log("(re)loading playlist for subtitle track "+b);this.hls.trigger(e.default.SUBTITLE_TRACK_LOADING,{url:c.url,id:b})}}},{key:"onSubtitleTrackLoaded",value:function a(b){var c=this;if(b.id<this.tracks.length){h.logger.log("subtitle track "+b.id+" loaded");this.tracks[b.id].details=b.details;if(b.details.live&&!this.timer){this.timer=setInterval(function(){c.onTick()},1e3*b.details.targetduration,this)}if(!b.details.live&&this.timer){clearInterval(this.timer);this.timer=null}}}},{key:"setSubtitleTrackInternal",value:function a(b){if(b>=0&&b<this.tracks.length){if(this.timer){clearInterval(this.timer);this.timer=null}this.trackId=b;h.logger.log("switching to subtitle track "+b);var c=this.tracks[b];this.hls.trigger(e.default.SUBTITLE_TRACK_SWITCH,{id:b});var d=c.details;if(d===undefined||d.live===true){h.logger.log("(re)loading playlist for subtitle track "+b);this.hls.trigger(e.default.SUBTITLE_TRACK_LOADING,{url:c.url,id:b})}}}},{key:"subtitleTracks",get:function a(){return this.tracks}},{key:"subtitleTrack",get:function a(){return this.trackId},set:function a(b){if(this.trackId!==b){this.setSubtitleTrackInternal(b)}}}]);return b}(g.default);exports.default=n},{34:34,35:35,54:54}],16:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(35);var e=m(d);var f=a(34);var g=m(f);var h=a(49);var i=m(h);var j=a(58);var k=m(j);var l=a(54);function m(a){return a&&a.__esModule?a:{default:a}}function n(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function o(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function p(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}function q(a){if(a&&a.cues){while(a.cues.length>0){a.removeCue(a.cues[0])}}}function r(a,b){return a&&a.label===b.name&&!(a.textTrack1||a.textTrack2)}function s(a,b,c,d){return Math.min(b,d)-Math.max(a,c)}var t=function(a){p(b,a);function b(a){n(this,b);var c=o(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,e.default.MEDIA_ATTACHING,e.default.MEDIA_DETACHING,e.default.FRAG_PARSING_USERDATA,e.default.MANIFEST_LOADING,e.default.MANIFEST_LOADED,e.default.FRAG_LOADED,e.default.LEVEL_SWITCHING,e.default.INIT_PTS_FOUND));c.hls=a;c.config=a.config;c.enabled=true;c.Cues=a.config.cueHandler;c.textTracks=[];c.tracks=[];c.unparsedVttFrags=[];c.initPTS=undefined;c.cueRanges=[];if(c.config.enableCEA708Captions){var d=c;var f=function a(b,c){var d=null;try{d=new window.Event("addtrack")}catch(a){d=document.createEvent("Event");d.initEvent("addtrack",false,false)}d.track=b;c.dispatchEvent(d)};var g={newCue:function a(b,c,e){if(!d.textTrack1){var g=d.getExistingTrack("1");if(!g){var h=d.createTextTrack("captions",d.config.captionsTextTrack1Label,d.config.captionsTextTrack1LanguageCode);if(h){h.textTrack1=true;d.textTrack1=h}}else{d.textTrack1=g;q(d.textTrack1);f(d.textTrack1,d.media)}}d.addCues("textTrack1",b,c,e)}};var h={newCue:function a(b,c,e){if(!d.textTrack2){var g=d.getExistingTrack("2");if(!g){var h=d.createTextTrack("captions",d.config.captionsTextTrack2Label,d.config.captionsTextTrack1LanguageCode);if(h){h.textTrack2=true;d.textTrack2=h}}else{d.textTrack2=g;q(d.textTrack2);f(d.textTrack2,d.media)}}d.addCues("textTrack2",b,c,e)}};c.cea608Parser=new i.default(0,g,h)}return c}c(b,[{key:"addCues",value:function a(b,c,d,e){var f=this.cueRanges;var g=false;for(var h=f.length;h--;){var i=f[h];var j=s(i[0],i[1],c,d);if(j>=0){i[0]=Math.min(i[0],c);i[1]=Math.max(i[1],d);g=true;if(j/(d-c)>.5){return}}}if(!g){f.push([c,d])}this.Cues.newCue(this[b],c,d,e)}},{key:"onInitPtsFound",value:function a(b){var c=this;if(typeof this.initPTS==="undefined"){this.initPTS=b.initPTS}if(this.unparsedVttFrags.length){this.unparsedVttFrags.forEach(function(a){c.onFragLoaded(a)});this.unparsedVttFrags=[]}}},{key:"getExistingTrack",value:function a(b){var c=this.media;if(c){for(var d=0;d<c.textTracks.length;d++){var e=c.textTracks[d];var f="textTrack"+b;if(e[f]===true){return e}}}return null}},{key:"createTextTrack",value:function a(b,c,d){var e=this.media;if(e){return e.addTextTrack(b,c,d)}}},{key:"destroy",value:function a(){g.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function a(b){this.media=b.media}},{key:"onMediaDetaching",value:function a(){q(this.textTrack1);q(this.textTrack2)}},{key:"onManifestLoading",value:function a(){this.lastSn=-1;this.prevCC=-1;this.vttCCs={ccOffset:0,presentationOffset:0};var b=this.media;if(b){var c=b.textTracks;if(c){for(var d=0;d<c.length;d++){q(c[d])}}}}},{key:"onManifestLoaded",value:function a(b){var c=this;this.textTracks=[];this.unparsedVttFrags=this.unparsedVttFrags||[];this.initPTS=undefined;this.cueRanges=[];if(this.config.enableWebVTT){this.tracks=b.subtitles||[];var d=this.media?this.media.textTracks:[];this.tracks.forEach(function(a,b){var e=void 0;if(b<d.length){var f=d[b];if(r(f,a)){e=f}}if(!e){e=c.createTextTrack("subtitles",a.name,a.lang)}e.mode=a.default?"showing":"hidden";c.textTracks.push(e)})}}},{key:"onLevelSwitching",value:function a(){this.enabled=this.hls.currentLevel.closedCaptions!=="NONE"}},{key:"onFragLoaded",value:function a(b){var c=b.frag,d=b.payload;if(c.type==="main"){var f=c.sn;if(f!==this.lastSn+1){var g=this.cea608Parser;if(g){g.reset()}}this.lastSn=f}else if(c.type==="subtitle"){if(d.byteLength){if(typeof this.initPTS==="undefined"){this.unparsedVttFrags.push(b);return}var h=this.vttCCs;if(!h[c.cc]){h[c.cc]={start:c.start,prevCC:this.prevCC,new:true};this.prevCC=c.cc}var i=this.textTracks,j=this.hls;k.default.parse(d,this.initPTS,h,c.cc,function(a){var b=i[c.trackId];a.forEach(function(a){if(!b.cues.getCueById(a.id)){try{b.addCue(a)}catch(d){var c=new window.TextTrackCue(a.startTime,a.endTime,a.text);c.id=a.id;b.addCue(c)}}});j.trigger(e.default.SUBTITLE_FRAG_PROCESSED,{success:true,frag:c})},function(a){l.logger.log("Failed to parse VTT cue: "+a);j.trigger(e.default.SUBTITLE_FRAG_PROCESSED,{success:false,frag:c})})}else{this.hls.trigger(e.default.SUBTITLE_FRAG_PROCESSED,{success:false,frag:c})}}}},{key:"onFragParsingUserdata",value:function a(b){if(this.enabled&&this.config.enableCEA708Captions){for(var c=0;c<b.samples.length;c++){var d=this.extractCea608Data(b.samples[c].bytes);this.cea608Parser.addData(b.samples[c].pts,d)}}}},{key:"extractCea608Data",value:function a(b){var c=b[0]&31;var d=2;var e,f,g,h,i;var j=[];for(var k=0;k<c;k++){e=b[d++];f=127&b[d++];g=127&b[d++];h=(4&e)!==0;i=3&e;if(f===0&&g===0){continue}if(h){if(i===0){j.push(f);j.push(g)}}}return j}}]);return b}(g.default);exports.default=t},{34:34,35:35,49:49,54:54,58:58}],17:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function d(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var e=function(){function a(b,c){d(this,a);this.subtle=b;this.aesIV=c}c(a,[{key:"decrypt",value:function a(b,c){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},c,b)}}]);return a}();exports.default=e},{}],18:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function d(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var e=function(){function a(){d(this,a);this.rcon=[0,1,2,4,8,16,32,64,128,27,54];this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.sBox=new Uint32Array(256);this.invSBox=new Uint32Array(256);this.key=new Uint32Array(0);this.initTable()}c(a,[{key:"uint8ArrayToUint32Array_",value:function a(b){var c=new DataView(b);var d=new Uint32Array(4);for(var e=0;e<4;e++){d[e]=c.getUint32(e*4)}return d}},{key:"initTable",value:function a(){var b=this.sBox;var c=this.invSBox;var d=this.subMix;var e=d[0];var f=d[1];var g=d[2];var h=d[3];var i=this.invSubMix;var j=i[0];var k=i[1];var l=i[2];var m=i[3];var n=new Uint32Array(256);var o=0;var p=0;var q=0;for(q=0;q<256;q++){if(q<128){n[q]=q<<1}else{n[q]=q<<1^283}}for(q=0;q<256;q++){var r=p^p<<1^p<<2^p<<3^p<<4;r=r>>>8^r&255^99;b[o]=r;c[r]=o;var s=n[o];var t=n[s];var u=n[t];var v=n[r]*257^r*16843008;e[o]=v<<24|v>>>8;f[o]=v<<16|v>>>16;g[o]=v<<8|v>>>24;h[o]=v;v=u*16843009^t*65537^s*257^o*16843008;j[r]=v<<24|v>>>8;k[r]=v<<16|v>>>16;l[r]=v<<8|v>>>24;m[r]=v;if(!o){o=p=1}else{o=s^n[n[n[u^s]]];p^=n[n[p]]}}}},{key:"expandKey",value:function a(b){var c=this.uint8ArrayToUint32Array_(b);var d=true;var e=0;while(e<c.length&&d){d=c[e]===this.key[e];e++}if(d){return}this.key=c;var f=this.keySize=c.length;if(f!==4&&f!==6&&f!==8){throw new Error("Invalid aes key size="+f)}var g=this.ksRows=(f+6+1)*4;var h=void 0;var i=void 0;var j=this.keySchedule=new Uint32Array(g);var k=this.invKeySchedule=new Uint32Array(g);var l=this.sBox;var m=this.rcon;var n=this.invSubMix;var o=n[0];var p=n[1];var q=n[2];var r=n[3];var s=void 0;var t=void 0;for(h=0;h<g;h++){if(h<f){s=j[h]=c[h];continue}t=s;if(h%f===0){t=t<<8|t>>>24;t=l[t>>>24]<<24|l[t>>>16&255]<<16|l[t>>>8&255]<<8|l[t&255];t^=m[h/f|0]<<24}else if(f>6&&h%f===4){t=l[t>>>24]<<24|l[t>>>16&255]<<16|l[t>>>8&255]<<8|l[t&255]}j[h]=s=(j[h-f]^t)>>>0}for(i=0;i<g;i++){h=g-i;if(i&3){t=j[h]}else{t=j[h-4]}if(i<4||h<=4){k[i]=t}else{k[i]=o[l[t>>>24]]^p[l[t>>>16&255]]^q[l[t>>>8&255]]^r[l[t&255]]}k[i]=k[i]>>>0}}},{key:"networkToHostOrderSwap",value:function a(b){return b<<24|(b&65280)<<8|(b&16711680)>>8|b>>>24}},{key:"decrypt",value:function a(b,c,d){var e=this.keySize+6;var f=this.invKeySchedule;var g=this.invSBox;var h=this.invSubMix;var i=h[0];var j=h[1];var k=h[2];var l=h[3];var m=this.uint8ArrayToUint32Array_(d);var n=m[0];var o=m[1];var p=m[2];var q=m[3];var r=new Int32Array(b);var s=new Int32Array(r.length);var t=void 0,u=void 0,v=void 0,w=void 0;var x=void 0,y=void 0,z=void 0,A=void 0;var B=void 0,C=void 0,D=void 0,E=void 0;var F,G;var H=this.networkToHostOrderSwap;while(c<r.length){B=H(r[c]);C=H(r[c+1]);D=H(r[c+2]);E=H(r[c+3]);x=B^f[0];y=E^f[1];z=D^f[2];A=C^f[3];F=4;for(G=1;G<e;G++){t=i[x>>>24]^j[y>>16&255]^k[z>>8&255]^l[A&255]^f[F];u=i[y>>>24]^j[z>>16&255]^k[A>>8&255]^l[x&255]^f[F+1];v=i[z>>>24]^j[A>>16&255]^k[x>>8&255]^l[y&255]^f[F+2];w=i[A>>>24]^j[x>>16&255]^k[y>>8&255]^l[z&255]^f[F+3];x=t;y=u;z=v;A=w;F=F+4}t=g[x>>>24]<<24^g[y>>16&255]<<16^g[z>>8&255]<<8^g[A&255]^f[F];u=g[y>>>24]<<24^g[z>>16&255]<<16^g[A>>8&255]<<8^g[x&255]^f[F+1];v=g[z>>>24]<<24^g[A>>16&255]<<16^g[x>>8&255]<<8^g[y&255]^f[F+2];w=g[A>>>24]<<24^g[x>>16&255]<<16^g[y>>8&255]<<8^g[z&255]^f[F+3];F=F+3;s[c]=H(t^n);s[c+1]=H(w^o);s[c+2]=H(v^p);s[c+3]=H(u^q);n=B;o=C;p=D;q=E;c=c+4}return s.buffer}},{key:"destroy",value:function a(){this.key=undefined;this.keySize=undefined;this.ksRows=undefined;this.sBox=undefined;this.invSBox=undefined;this.subMix=undefined;this.invSubMix=undefined;this.keySchedule=undefined;this.invKeySchedule=undefined;this.rcon=undefined}}]);return a}();exports.default=e},{}],19:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(17);var e=l(d);var f=a(20);var g=l(f);var h=a(18);var i=l(h);var j=a(33);var k=a(54);function l(a){return a&&a.__esModule?a:{default:a}}function m(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var n=function(){function a(b,c){m(this,a);this.observer=b;this.config=c;this.logEnabled=true;try{var d=crypto?crypto:self.crypto;this.subtle=d.subtle||d.webkitSubtle}catch(a){}this.disableWebCrypto=!this.subtle}c(a,[{key:"isSync",value:function a(){return this.disableWebCrypto&&this.config.enableSoftwareAES}},{key:"decrypt",value:function a(b,c,d,f){var h=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){if(this.logEnabled){k.logger.log("JS AES decrypt");this.logEnabled=false}var j=this.decryptor;if(!j){this.decryptor=j=new i.default}j.expandKey(c);f(j.decrypt(b,0,d))}else{if(this.logEnabled){k.logger.log("WebCrypto AES decrypt");this.logEnabled=false}var l=this.subtle;if(this.key!==c){this.key=c;this.fastAesKey=new g.default(l,c)}this.fastAesKey.expandKey().then(function(a){var g=new e.default(l,d);g.decrypt(b,a).catch(function(a){h.onWebCryptoError(a,b,c,d,f)}).then(function(a){f(a)})}).catch(function(a){h.onWebCryptoError(a,b,c,d,f)})}}},{key:"onWebCryptoError",value:function a(b,c,d,e,f){if(this.config.enableSoftwareAES){k.logger.log("WebCrypto Error, disable WebCrypto API");this.disableWebCrypto=true;this.logEnabled=true;this.decrypt(c,d,e,f)}else{k.logger.error("decrypting error : "+b.message);this.observer.trigger(Event.ERROR,{type:j.ErrorTypes.MEDIA_ERROR,details:j.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:true,reason:b.message})}}},{key:"destroy",value:function a(){var b=this.decryptor;if(b){b.destroy();this.decryptor=undefined}}}]);return a}();exports.default=n},{17:17,18:18,20:20,33:33,54:54}],20:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function d(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var e=function(){function a(b,c){d(this,a);this.subtle=b;this.key=c}c(a,[{key:"expandKey",value:function a(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},false,["encrypt","decrypt"])}}]);return a}();exports.default=e},{}],21:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(22);var e=i(d);var f=a(54);var g=a(27);var h=i(g);function i(a){return a&&a.__esModule?a:{default:a}}function j(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var k=function(){function a(b,c,d){j(this,a);this.observer=b;this.config=d;this.remuxer=c}c(a,[{key:"resetInitSegment",value:function a(b,c,d,e){this._audioTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:true,samples:[],len:0,manifestCodec:c,duration:e,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function a(){}},{key:"append",value:function a(b,c,d,g){var i=this._audioTrack,j=h.default.getID3Data(b,0),k=90*h.default.getTimeStamp(j),l=0,m=k,n=b.length,o=j.length;var p=[{pts:m,dts:m,data:j}];while(o<n-1){if(e.default.isHeader(b,o)&&o+5<n){e.default.initTrackConfig(i,this.observer,b,o,i.manifestCodec);var q=e.default.appendFrame(i,b,o,k,l);if(q){o+=q.length;m=q.sample.pts;l++}else{f.logger.log("Unable to parse AAC frame");break}}else if(h.default.isHeader(b,o)){j=h.default.getID3Data(b,o);p.push({pts:m,dts:m,data:j});o+=j.length}else{o++}}this.remuxer.remux(i,{samples:[]},{samples:p,inputTimeScale:9e4},{samples:[]},c,d,g)}},{key:"destroy",value:function a(){}}],[{key:"probe",value:function a(b){var c,d;var g=h.default.getID3Data(b,0);if(g&&h.default.getTimeStamp(g)!==undefined){for(c=g.length,d=Math.min(b.length-1,c+100);c<d;c++){if(e.default.probe(b,c)){f.logger.log("ADTS sync word found !");return true}}}return false}}]);return a}();exports.default=k},{22:22,27:27,54:54}],22:[function(a,b,exports){"use strict";var c=a(54);var d=a(33);var e={getAudioConfig:function a(b,e,f,g){var h,i,j,k,l,m=navigator.userAgent.toLowerCase(),n=g,o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];h=((e[f+2]&192)>>>6)+1;i=(e[f+2]&60)>>>2;if(i>o.length-1){b.trigger(Event.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:true,reason:"invalid ADTS sampling index:"+i});return}k=(e[f+2]&1)<<2;k|=(e[f+3]&192)>>>6;c.logger.log("manifest codec:"+g+",ADTS data:type:"+h+",sampleingIndex:"+i+"["+o[i]+"Hz],channelConfig:"+k);if(/firefox/i.test(m)){if(i>=6){h=5;l=new Array(4);j=i-3}else{h=2;l=new Array(2);j=i}}else if(m.indexOf("android")!==-1){h=2;l=new Array(2);j=i}else{h=5;l=new Array(4);if(g&&(g.indexOf("mp4a.40.29")!==-1||g.indexOf("mp4a.40.5")!==-1)||!g&&i>=6){j=i-3}else{if(g&&g.indexOf("mp4a.40.2")!==-1&&(i>=6&&k===1||/vivaldi/i.test(m))||!g&&k===1){h=2;l=new Array(2)}j=i}}l[0]=h<<3;l[0]|=(i&14)>>1;l[1]|=(i&1)<<7;l[1]|=k<<3;if(h===5){l[1]|=(j&14)>>1;l[2]=(j&1)<<7;l[2]|=2<<2;l[3]=0}return{config:l,samplerate:o[i],channelCount:k,codec:"mp4a.40."+h,manifestCodec:n}},isHeaderPattern:function a(b,c){return b[c]===255&&(b[c+1]&246)===240},getHeaderLength:function a(b,c){return!!(b[c+1]&1)?7:9},getFullFrameLength:function a(b,c){return(b[c+3]&3)<<11|b[c+4]<<3|(b[c+5]&224)>>>5},isHeader:function a(b,c){if(c+1<b.length&&this.isHeaderPattern(b,c)){return true}return false},probe:function a(b,c){if(c+1<b.length&&this.isHeaderPattern(b,c)){var d=this.getHeaderLength(b,c);var e=d;if(c+5<b.length){e=this.getFullFrameLength(b,c)}var f=c+e;if(f===b.length||f+1<b.length&&this.isHeaderPattern(b,f)){return true}}return false},initTrackConfig:function a(b,d,e,f,g){if(!b.samplerate){var h=this.getAudioConfig(d,e,f,g);b.config=h.config;b.samplerate=h.samplerate;b.channelCount=h.channelCount;b.codec=h.codec;b.manifestCodec=h.manifestCodec;c.logger.log("parsed codec:"+b.codec+",rate:"+h.samplerate+",nb channel:"+h.channelCount)}},getFrameDuration:function a(b){return 1024*9e4/b},appendFrame:function a(b,c,d,e,f){var g=this.getFrameDuration(b.samplerate);var h=this.parseFrameHeader(c,d,e,f,g);if(h){var i=h.stamp;var j=h.headerLength;var k=h.frameLength;var l={unit:c.subarray(d+j,d+j+k),pts:i,dts:i};b.samples.push(l);b.len+=k;return{sample:l,length:k+j}}return undefined},parseFrameHeader:function a(b,c,d,e,f){var g,h,i;var j=b.length;g=this.getHeaderLength(b,c);h=this.getFullFrameLength(b,c);h-=g;if(h>0&&c+g+h<=j){i=d+e*f;return{headerLength:g,frameLength:h,stamp:i}}return undefined}};b.exports=e},{33:33,54:54}],23:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(35);var e=u(d);var f=a(33);var g=a(19);var h=u(g);var i=a(21);var j=u(i);var k=a(29);var l=u(k);var m=a(32);var n=u(m);var o=a(28);var p=u(o);var q=a(45);var r=u(q);var s=a(46);var t=u(s);function u(a){return a&&a.__esModule?a:{default:a}}function v(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var w=function(){function a(b,c,d,e){v(this,a);this.observer=b;this.typeSupported=c;this.config=d;this.vendor=e}c(a,[{key:"destroy",value:function a(){var b=this.demuxer;if(b){b.destroy()}}},{key:"push",value:function a(b,c,d,f,g,i,j,k,l,m,n,o){if(b.byteLength>0&&c!=null&&c.key!=null&&c.method==="AES-128"){var p=this.decrypter;if(p==null){p=this.decrypter=new h.default(this.observer,this.config)}var q=this;var r;try{r=performance.now()}catch(a){r=Date.now()}p.decrypt(b,c.key.buffer,c.iv.buffer,function(a){var b;try{b=performance.now()}catch(a){b=Date.now()}q.observer.trigger(e.default.FRAG_DECRYPTED,{stats:{tstart:r,tdecrypt:b}});q.pushDecrypted(new Uint8Array(a),c,new Uint8Array(d),f,g,i,j,k,l,m,n,o)})}else{this.pushDecrypted(new Uint8Array(b),c,new Uint8Array(d),f,g,i,j,k,l,m,n,o)}}},{key:"pushDecrypted",value:function a(b,c,d,g,h,i,k,m,o,q,s,u){var v=this.demuxer;if(!v||k&&!this.probe(b)){var w=this.observer;var x=this.typeSupported;var y=this.config;var z=[{demux:j.default,remux:r.default},{demux:p.default,remux:r.default},{demux:n.default,remux:r.default},{demux:l.default,remux:t.default}];for(var A=0,B=z.length;A<B;A++){var C=z[A];var D=C.demux.probe;if(D(b)){var E=this.remuxer=new C.remux(w,y,x,this.vendor);v=new C.demux(w,E,y,x);this.probe=D;break}}if(!v){w.trigger(e.default.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:true,reason:"no demux matching with content found"});return}this.demuxer=v}var F=this.remuxer;if(k||m){v.resetInitSegment(d,g,h,q);F.resetInitSegment()}if(k){v.resetTimeStamp(u);F.resetTimeStamp(u)}if(typeof v.setDecryptData==="function"){v.setDecryptData(c)}v.append(b,i,o,s)}}]);return a}();exports.default=w},{19:19,21:21,28:28,29:29,32:32,33:33,35:35,45:45,46:46}],24:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=a(23);var d=j(c);var e=a(35);var f=j(e);var g=a(54);var h=a(1);var i=j(h);function j(a){return a&&a.__esModule?a:{default:a}}var k=function a(b){var c=new i.default;c.trigger=function a(b){for(var d=arguments.length,e=Array(d>1?d-1:0),f=1;f<d;f++){e[f-1]=arguments[f]}c.emit.apply(c,[b,b].concat(e))};c.off=function a(b){for(var d=arguments.length,e=Array(d>1?d-1:0),f=1;f<d;f++){e[f-1]=arguments[f]}c.removeListener.apply(c,[b].concat(e))};var e=function a(c,d){b.postMessage({event:c,data:d})};b.addEventListener("message",function(a){var f=a.data;switch(f.cmd){case"init":var h=JSON.parse(f.config);b.demuxer=new d.default(c,f.typeSupported,h,f.vendor);try{(0,g.enableLogs)(h.debug===true)}catch(a){console.warn("demuxerWorker: unable to enable logs")}e("init",null);break;case"demux":b.demuxer.push(f.data,f.decryptdata,f.initSegment,f.audioCodec,f.videoCodec,f.timeOffset,f.discontinuity,f.trackSwitch,f.contiguous,f.duration,f.accurateTimeOffset,f.defaultInitPTS);break;default:break}});c.on(f.default.FRAG_DECRYPTED,e);c.on(f.default.FRAG_PARSING_INIT_SEGMENT,e);c.on(f.default.FRAG_PARSED,e);c.on(f.default.ERROR,e);c.on(f.default.FRAG_PARSING_METADATA,e);c.on(f.default.FRAG_PARSING_USERDATA,e);c.on(f.default.INIT_PTS_FOUND,e);c.on(f.default.FRAG_PARSING_DATA,function(a,c){var d=[];var e={event:a,data:c};if(c.data1){e.data1=c.data1.buffer;d.push(c.data1.buffer);delete c.data1}if(c.data2){e.data2=c.data2.buffer;d.push(c.data2.buffer);delete c.data2}b.postMessage(e,d)})};exports.default=k},{1:1,23:23,35:35,54:54}],25:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(35);var e=n(d);var f=a(23);var g=n(f);var h=a(24);var i=n(h);var j=a(54);var k=a(33);var l=a(1);var m=n(l);function n(a){return a&&a.__esModule?a:{default:a}}function o(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var p=function(){function b(c,d){o(this,b);this.hls=c;this.id=d;var f=this.observer=new m.default;var h=c.config;f.trigger=function a(b){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++){d[e-1]=arguments[e]}f.emit.apply(f,[b,b].concat(d))};f.off=function a(b){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++){d[e-1]=arguments[e]}f.removeListener.apply(f,[b].concat(d))};var l=function(a,b){b=b||{};b.frag=this.frag;b.id=this.id;c.trigger(a,b)}.bind(this);f.on(e.default.FRAG_DECRYPTED,l);f.on(e.default.FRAG_PARSING_INIT_SEGMENT,l);f.on(e.default.FRAG_PARSING_DATA,l);f.on(e.default.FRAG_PARSED,l);f.on(e.default.ERROR,l);f.on(e.default.FRAG_PARSING_METADATA,l);f.on(e.default.FRAG_PARSING_USERDATA,l);f.on(e.default.INIT_PTS_FOUND,l);var n={mp4:MediaSource.isTypeSupported("video/mp4"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')};var p=navigator.vendor;if(h.enableWorker&&typeof Worker!=="undefined"){j.logger.log("demuxing in webworker");var q=void 0;try{var r=a(3);q=this.w=r(i.default);this.onwmsg=this.onWorkerMessage.bind(this);q.addEventListener("message",this.onwmsg);q.onerror=function(a){c.trigger(e.default.ERROR,{type:k.ErrorTypes.OTHER_ERROR,details:k.ErrorDetails.INTERNAL_EXCEPTION,fatal:true,event:"demuxerWorker",err:{message:a.message+" ("+a.filename+":"+a.lineno+")"}})};q.postMessage({cmd:"init",typeSupported:n,vendor:p,id:d,config:JSON.stringify(h)})}catch(a){j.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline");if(q){URL.revokeObjectURL(q.objectURL)}this.demuxer=new g.default(f,n,h,p);this.w=undefined}}else{this.demuxer=new g.default(f,n,h,p)}}c(b,[{key:"destroy",value:function a(){var b=this.w;if(b){b.removeEventListener("message",this.onwmsg);b.terminate();this.w=null}else{var c=this.demuxer;if(c){c.destroy();this.demuxer=null}}var d=this.observer;if(d){d.removeAllListeners();this.observer=null}}},{key:"push",value:function a(b,c,d,e,f,g,h,i){var k=this.w;var l=!isNaN(f.startDTS)?f.startDTS:f.start;var m=f.decryptdata;var n=this.frag;var o=!(n&&f.cc===n.cc);var p=!(n&&f.level===n.level);var q=n&&f.sn===n.sn+1;var r=!p&&q;if(o){j.logger.log(this.id+":discontinuity detected")}if(p){j.logger.log(this.id+":switch detected")}this.frag=f;if(k){k.postMessage({cmd:"demux",data:b,decryptdata:m,initSegment:c,audioCodec:d,videoCodec:e,timeOffset:l,discontinuity:o,trackSwitch:p,contiguous:r,duration:g,accurateTimeOffset:h,defaultInitPTS:i},[b])}else{var s=this.demuxer;if(s){s.push(b,m,c,d,e,l,o,p,r,g,h,i)}}}},{key:"onWorkerMessage",value:function a(b){var c=b.data,d=this.hls;switch(c.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case e.default.FRAG_PARSING_DATA:c.data.data1=new Uint8Array(c.data1);if(c.data2){c.data.data2=new Uint8Array(c.data2)}default:c.data=c.data||{};c.data.frag=this.frag;c.data.id=this.id;d.trigger(c.event,c.data);break}}}]);return b}();exports.default=p},{1:1,23:23,24:24,3:3,33:33,35:35,54:54}],26:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(54);function e(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var f=function(){function a(b){e(this,a);this.data=b;this.bytesAvailable=b.byteLength;this.word=0;this.bitsAvailable=0}c(a,[{key:"loadWord",value:function a(){var b=this.data,c=this.bytesAvailable,d=b.byteLength-c,e=new Uint8Array(4),f=Math.min(4,c);if(f===0){throw new Error("no bytes available")}e.set(b.subarray(d,d+f));this.word=new DataView(e.buffer).getUint32(0);this.bitsAvailable=f*8;this.bytesAvailable-=f}},{key:"skipBits",value:function a(b){var c;if(this.bitsAvailable>b){this.word<<=b;this.bitsAvailable-=b}else{b-=this.bitsAvailable;c=b>>3;b-=c>>3;this.bytesAvailable-=c;this.loadWord();this.word<<=b;this.bitsAvailable-=b}}},{key:"readBits",value:function a(b){var c=Math.min(this.bitsAvailable,b),e=this.word>>>32-c;if(b>32){d.logger.error("Cannot read more than 32 bits at a time")}this.bitsAvailable-=c;if(this.bitsAvailable>0){this.word<<=c}else if(this.bytesAvailable>0){this.loadWord()}c=b-c;if(c>0&&this.bitsAvailable){return e<<c|this.readBits(c)}else{return e}}},{key:"skipLZ",value:function a(){var b;for(b=0;b<this.bitsAvailable;++b){if(0!==(this.word&2147483648>>>b)){this.word<<=b;this.bitsAvailable-=b;return b}}this.loadWord();return b+this.skipLZ()}},{key:"skipUEG",value:function a(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function a(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function a(){var b=this.skipLZ();return this.readBits(b+1)-1}},{key:"readEG",value:function a(){var b=this.readUEG();if(1&b){return 1+b>>>1}else{return-1*(b>>>1)}}},{key:"readBoolean",value:function a(){return 1===this.readBits(1)}},{key:"readUByte",value:function a(){return this.readBits(8)}},{key:"readUShort",value:function a(){return this.readBits(16)}},{key:"readUInt",value:function a(){return this.readBits(32)}},{key:"skipScalingList",value:function a(b){var c=8,d=8,e,f;for(e=0;e<b;e++){if(d!==0){f=this.readEG();d=(c+f+256)%256}c=d===0?c:d}}},{key:"readSPS",value:function a(){var b=0,c=0,d=0,e=0,f,g,h,i,j,k,l,m,n,o=this.readUByte.bind(this),p=this.readBits.bind(this),q=this.readUEG.bind(this),r=this.readBoolean.bind(this),s=this.skipBits.bind(this),t=this.skipEG.bind(this),u=this.skipUEG.bind(this),v=this.skipScalingList.bind(this);o();f=o();g=p(5);s(3);h=o();u();if(f===100||f===110||f===122||f===244||f===44||f===83||f===86||f===118||f===128){var w=q();if(w===3){s(1)}u();u();s(1);if(r()){m=w!==3?8:12;for(n=0;n<m;n++){if(r()){if(n<6){v(16)}else{v(64)}}}}}u();var x=q();if(x===0){q()}else if(x===1){s(1);t();t();i=q();for(n=0;n<i;n++){t()}}u();s(1);j=q();k=q();l=p(1);if(l===0){s(1)}s(1);if(r()){b=q();c=q();d=q();e=q()}var y=[1,1];if(r()){if(r()){var z=o();switch(z){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:{y=[o()<<8|o(),o()<<8|o()];break}}}}return{width:Math.ceil((j+1)*16-b*2-c*2),height:(2-l)*(k+1)*16-(l?2:4)*(d+e),pixelRatio:y}}},{key:"readSliceType",value:function a(){this.readUByte();this.readUEG();return this.readUEG()}}]);return a}();exports.default=f},{54:54}],27:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function d(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var e=function(){function a(){d(this,a)}c(a,null,[{key:"isHeader",value:function a(b,c){if(c+10<=b.length){if(b[c]===73&&b[c+1]===68&&b[c+2]===51){if(b[c+3]<255&&b[c+4]<255){if(b[c+6]<128&&b[c+7]<128&&b[c+8]<128&&b[c+9]<128){return true}}}}return false}},{key:"isFooter",value:function a(b,c){if(c+10<=b.length){if(b[c]===51&&b[c+1]===68&&b[c+2]===73){if(b[c+3]<255&&b[c+4]<255){if(b[c+6]<128&&b[c+7]<128&&b[c+8]<128&&b[c+9]<128){return true}}}}return false}},{key:"getID3Data",value:function b(c,d){var e=d;var f=0;while(a.isHeader(c,d)){f+=10;var g=a._readSize(c,d+6);f+=g;if(a.isFooter(c,d+10)){f+=10}d+=f}if(f>0){return c.subarray(e,e+f)}return undefined}},{key:"_readSize",value:function a(b,c){var d=0;d=(b[c]&127)<<21;d|=(b[c+1]&127)<<14;d|=(b[c+2]&127)<<7;d|=b[c+3]&127;return d}},{key:"getTimeStamp",value:function b(c){var d=a.getID3Frames(c);for(var e=0;e<d.length;e++){var f=d[e];if(a.isTimeStampFrame(f)){return a._readTimeStamp(f)}}return undefined}},{key:"isTimeStampFrame",value:function a(b){return b&&b.key==="PRIV"&&b.info==="com.apple.streaming.transportStreamTimestamp"}},{key:"_getFrameData",value:function b(c){var d=String.fromCharCode(c[0],c[1],c[2],c[3]);var e=a._readSize(c,4);var f=10;return{type:d,size:e,data:c.subarray(f,f+e)}}},{key:"getID3Frames",value:function b(c){var d=0;var e=[];while(a.isHeader(c,d)){var f=a._readSize(c,d+6);d+=10;var g=d+f;while(d+8<g){var h=a._getFrameData(c.subarray(d));var i=a._decodeFrame(h);if(i){e.push(i)}d+=h.size+10}if(a.isFooter(c,d)){d+=10}}return e}},{key:"_decodeFrame",value:function b(c){if(c.type==="PRIV"){return a._decodePrivFrame(c)}else if(c.type[0]==="T"){return a._decodeTextFrame(c)}else if(c.type[0]==="W"){return a._decodeURLFrame(c)}return undefined}},{key:"_readTimeStamp",value:function a(b){if(b.data.byteLength===8){var c=new Uint8Array(b.data);var d=c[3]&1;var e=(c[4]<<23)+(c[5]<<15)+(c[6]<<7)+c[7];e/=45;if(d){e+=47721858.84}return Math.round(e)}return undefined}},{key:"_decodePrivFrame",value:function b(c){if(c.size<2){return undefined}var d=a._utf8ArrayToStr(c.data);var e=new Uint8Array(c.data.subarray(d.length+1));return{key:c.type,info:d,data:e.buffer}}},{key:"_decodeTextFrame",value:function b(c){if(c.size<2){return undefined}if(c.type==="TXXX"){var d=1;var e=a._utf8ArrayToStr(c.data.subarray(d));d+=e.length+1;var f=a._utf8ArrayToStr(c.data.subarray(d));return{key:c.type,info:e,data:f}}else{var g=a._utf8ArrayToStr(c.data.subarray(1));return{key:c.type,data:g}}}},{key:"_decodeURLFrame",value:function b(c){if(c.type==="WXXX"){if(c.size<2){return undefined}var d=1;var e=a._utf8ArrayToStr(c.data.subarray(d));d+=e.length+1;var f=a._utf8ArrayToStr(c.data.subarray(d));return{key:c.type,info:e,data:f}}else{var g=a._utf8ArrayToStr(c.data);return{key:c.type,data:g}}}},{key:"_utf8ArrayToStr",value:function a(b){var c=void 0;var d=void 0;var e="";var f=0;var g=b.length;while(f<g){var h=b[f++];switch(h>>4){case 0:return e;case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(h);break;case 12:case 13:c=b[f++];e+=String.fromCharCode((h&31)<<6|c&63);break;case 14:c=b[f++];d=b[f++];e+=String.fromCharCode((h&15)<<12|(c&63)<<6|(d&63)<<0);break}}return e}}]);return a}();exports.default=e},{}],28:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(27);var e=i(d);var f=a(54);var g=a(30);var h=i(g);function i(a){return a&&a.__esModule?a:{default:a}}function j(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var k=function(){function a(b,c,d){j(this,a);this.observer=b;this.config=d;this.remuxer=c}c(a,[{key:"resetInitSegment",value:function a(b,c,d,e){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:false,samples:[],len:0,manifestCodec:c,duration:e,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function a(){}},{key:"append",value:function a(b,c,d,f){var g=e.default.getID3Data(b,0);var i=90*e.default.getTimeStamp(g);var j=g.length;var k=b.length;var l=0,m=0;var n=this._audioTrack;var o=[{pts:i,dts:i,data:g}];while(j<k){if(h.default.isHeader(b,j)){var p=h.default.appendFrame(n,b,j,i,l);if(p){j+=p.length;m=p.sample.pts;l++}else{break}}else if(e.default.isHeader(b,j)){g=e.default.getID3Data(b,j);o.push({pts:m,dts:m,data:g});j+=g.length}else{j++}}this.remuxer.remux(n,{samples:[]},{samples:o,inputTimeScale:9e4},{samples:[]},c,d,f)}},{key:"destroy",value:function a(){}}],[{key:"probe",value:function a(b){var c,d;var g=e.default.getID3Data(b,0);if(g&&e.default.getTimeStamp(g)!==undefined){for(c=g.length,d=Math.min(b.length-1,c+100);c<d;c++){if(h.default.probe(b,c)){f.logger.log("MPEG Audio sync word found !");return true}}}return false}}]);return a}();exports.default=k},{27:27,30:30,54:54}],29:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(35);var e=f(d);function f(a){return a&&a.__esModule?a:{default:a}}function g(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var h=Math.pow(2,32)-1;var i=function(){function a(b,c){g(this,a);this.observer=b;this.remuxer=c}c(a,[{key:"resetTimeStamp",value:function a(b){this.initPTS=b}},{key:"resetInitSegment",value:function b(c,d,f,g){if(c&&c.byteLength){var h=this.initData=a.parseInitSegment(c);var i={};if(h.audio){i.audio={container:"audio/mp4",codec:d,initSegment:g?c:null}}if(h.video){i.video={container:"video/mp4",codec:f,initSegment:g?c:null}}this.observer.trigger(e.default.FRAG_PARSING_INIT_SEGMENT,{tracks:i})}else{if(d){this.audioCodec=d}if(f){this.videoCodec=f}}}},{key:"append",value:function b(c,d,f,g){var h=this.initData;if(!h){this.resetInitSegment(c,this.audioCodec,this.videoCodec);h=this.initData}var i=void 0,j=this.initPTS;if(j===undefined){var k=a.getStartDTS(h,c);this.initPTS=j=k-d;this.observer.trigger(e.default.INIT_PTS_FOUND,{initPTS:j})}a.offsetStartDTS(h,c,j);i=a.getStartDTS(h,c);this.remuxer.remux(h.audio,h.video,null,null,i,f,g,c)}},{key:"destroy",value:function a(){}}],[{key:"probe",value:function b(c){if(c.length>=8){var d=a.bin2str(c.subarray(4,8));return["moof","ftyp","styp"].indexOf(d)>=0}return false}},{key:"bin2str",value:function a(b){return String.fromCharCode.apply(null,b)}},{key:"readUint32",value:function a(b,c){if(b.data){c+=b.start;b=b.data}var d=b[c]<<24|b[c+1]<<16|b[c+2]<<8|b[c+3];return d<0?4294967296+d:d}},{key:"writeUint32",value:function a(b,c,d){if(b.data){c+=b.start;b=b.data}b[c]=d>>24;b[c+1]=d>>16&255;b[c+2]=d>>8&255;b[c+3]=d&255}},{key:"findBox",value:function b(c,d){var e=[],f,g,h,i,j,k,l;if(c.data){k=c.start;i=c.end;c=c.data}else{k=0;i=c.byteLength}if(!d.length){return null}for(f=k;f<i;){g=a.readUint32(c,f);h=a.bin2str(c.subarray(f+4,f+8));l=g>1?f+g:i;if(h===d[0]){if(d.length===1){e.push({data:c,start:f+8,end:l})}else{j=a.findBox({data:c,start:f+8,end:l},d.slice(1));if(j.length){e=e.concat(j)}}}f=l}return e}},{key:"parseInitSegment",value:function b(c){var d=[];var e=a.findBox(c,["moov","trak"]);e.forEach(function(b){var c=a.findBox(b,["tkhd"])[0];if(c){var e=c.data[c.start];var f=e===0?12:20;var g=a.readUint32(c,f);var h=a.findBox(b,["mdia","mdhd"])[0];if(h){e=h.data[h.start];f=e===0?12:20;var i=a.readUint32(h,f);var j=a.findBox(b,["mdia","hdlr"])[0];if(j){var k=a.bin2str(j.data.subarray(j.start+8,j.start+12));var l={soun:"audio",vide:"video"}[k];if(l){d[g]={timescale:i,type:l};d[l]={timescale:i,id:g}}}}}});return d}},{key:"getStartDTS",value:function b(c,d){var e,f,g;e=a.findBox(d,["moof","traf"]);f=[].concat.apply([],e.map(function(b){return a.findBox(b,["tfhd"]).map(function(d){var e,f,g;e=a.readUint32(d,4);f=c[e].timescale||9e4;g=a.findBox(b,["tfdt"]).map(function(b){var c,d;c=b.data[b.start];d=a.readUint32(b,4);if(c===1){d*=Math.pow(2,32);d+=a.readUint32(b,8)}return d})[0];g=g||Infinity;return g/f})}));g=Math.min.apply(null,f);return isFinite(g)?g:0}},{key:"offsetStartDTS",value:function b(c,d,e){a.findBox(d,["moof","traf"]).map(function(b){return a.findBox(b,["tfhd"]).map(function(d){var f=a.readUint32(d,4);var g=c[f].timescale||9e4;a.findBox(b,["tfdt"]).map(function(b){var c=b.data[b.start];var d=a.readUint32(b,4);if(c===0){a.writeUint32(b,4,d-e*g)}else{d*=Math.pow(2,32);d+=a.readUint32(b,8);d-=e*g;var f=Math.floor(d/(h+1));var i=Math.floor(d%(h+1));a.writeUint32(b,4,f);a.writeUint32(b,8,i)}})})})}}]);return a}();exports.default=i},{35:35}],30:[function(a,b,exports){"use strict";var c={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],appendFrame:function a(b,c,d,e,f){if(d+24>c.length){return undefined}var g=this.parseHeader(c,d);if(g&&d+g.frameLength<=c.length){var h=1152*9e4/g.sampleRate;var i=e+f*h;var j={unit:c.subarray(d,d+g.frameLength),pts:i,dts:i};b.config=[];b.channelCount=g.channelCount;b.samplerate=g.sampleRate;b.samples.push(j);b.len+=g.frameLength;return{sample:j,length:g.frameLength}}return undefined},parseHeader:function a(b,d){var e=b[d+1]>>3&3;var f=b[d+1]>>1&3;var g=b[d+2]>>4&15;var h=b[d+2]>>2&3;var i=!!(b[d+2]&2);if(e!==1&&g!==0&&g!==15&&h!==3){var j=e===3?3-f:f===3?3:4;var k=c.BitratesMap[j*14+g-1]*1e3;var l=e===3?0:e===2?1:2;var m=c.SamplingRateMap[l*3+h];var n=i?1:0;var o=b[d+3]>>6===3?1:2;var p=f===3?(e===3?12:6)*k/m+n<<2:(e===3?144:72)*k/m+n|0;return{sampleRate:m,channelCount:o,frameLength:p}}return undefined},isHeaderPattern:function a(b,c){return b[c]===255&&(b[c+1]&224)===224&&(b[c+1]&6)!==0},isHeader:function a(b,c){if(c+1<b.length&&this.isHeaderPattern(b,c)){return true}return false},probe:function a(b,c){if(c+1<b.length&&this.isHeaderPattern(b,c)){var d=4;var e=this.parseHeader(b,c);var f=d;if(e&&e.frameLength){f=e.frameLength}var g=c+f;if(g===b.length||g+1<b.length&&this.isHeaderPattern(b,g)){return true}}return false}};b.exports=c},{}],31:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(19);var e=f(d);function f(a){return a&&a.__esModule?a:{default:a}}function g(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var h=function(){function a(b,c,d,f){g(this,a);this.decryptdata=d;this.discardEPB=f;this.decrypter=new e.default(b,c)}c(a,[{key:"decryptBuffer",value:function a(b,c){this.decrypter.decrypt(b,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,c)}},{key:"decryptAacSample",value:function a(b,c,d,e){var f=b[c].unit;var g=f.subarray(16,f.length-f.length%16);var h=g.buffer.slice(g.byteOffset,g.byteOffset+g.length);var i=this;this.decryptBuffer(h,function(a){a=new Uint8Array(a);f.set(a,16);if(!e){i.decryptAacSamples(b,c+1,d)}})}},{key:"decryptAacSamples",value:function a(b,c,d){for(;;c++){if(c>=b.length){d();return}if(b[c].unit.length<32){continue}var e=this.decrypter.isSync();this.decryptAacSample(b,c,d,e);if(!e){return}}}},{key:"getAvcEncryptedData",value:function a(b){var c=Math.floor((b.length-48)/160)*16+16;var d=new Int8Array(c);var e=0;for(var f=32;f<=b.length-16;f+=160,e+=16){d.set(b.subarray(f,f+16),e)}return d}},{key:"getAvcDecryptedUnit",value:function a(b,c){c=new Uint8Array(c);var d=0;for(var e=32;e<=b.length-16;e+=160,d+=16){b.set(c.subarray(d,d+16),e)}return b}},{key:"decryptAvcSample",value:function a(b,c,d,e,f,g){var h=this.discardEPB(f.data);var i=this.getAvcEncryptedData(h);var j=this;this.decryptBuffer(i.buffer,function(a){f.data=j.getAvcDecryptedUnit(h,a);if(!g){j.decryptAvcSamples(b,c,d+1,e)}})}},{key:"decryptAvcSamples",value:function a(b,c,d,e){for(;;c++,d=0){if(c>=b.length){e();return}var f=b[c].units;for(;;d++){if(d>=f.length){break}var g=f[d];if(g.length<=48||g.type!==1&&g.type!==5){continue}var h=this.decrypter.isSync();this.decryptAvcSample(b,c,d,e,g,h);if(!h){return}}}}}]);return a}();exports.default=h},{19:19}],32:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(22);var e=p(d);var f=a(30);var g=p(f);var h=a(35);var i=p(h);var j=a(26);var k=p(j);var l=a(31);var m=p(l);var n=a(54);var o=a(33);function p(a){return a&&a.__esModule?a:{default:a}}function q(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var r=function(){function a(b,c,d,e){q(this,a);this.observer=b;this.config=d;this.typeSupported=e;this.remuxer=c;this.sampleAes=null}c(a,[{key:"setDecryptData",value:function a(b){if(b!=null&&b.key!=null&&b.method==="SAMPLE-AES"){this.sampleAes=new m.default(this.observer,this.config,b,this.discardEPB)}else{this.sampleAes=null}}},{key:"resetInitSegment",value:function a(b,c,d,e){this.pmtParsed=false;this._pmtId=-1;this._avcTrack={container:"video/mp2t",type:"video",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:0};this._audioTrack={container:"video/mp2t",type:"audio",id:-1,inputTimeScale:9e4,duration:e,sequenceNumber:0,samples:[],len:0,isAAC:true};this._id3Track={type:"id3",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0};this._txtTrack={type:"text",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0};this.aacOverFlow=null;this.aacLastPTS=null;this.avcSample=null;this.audioCodec=c;this.videoCodec=d;this._duration=e}},{key:"resetTimeStamp",value:function a(){}},{key:"append",value:function a(b,c,d,e){var f,g=b.length,h,j,k,l,m,p=false;this.contiguous=d;var q=this.pmtParsed,r=this._avcTrack,s=this._audioTrack,t=this._id3Track,u=r.id,v=s.id,w=t.id,x=this._pmtId,y=r.pesData,z=s.pesData,A=t.pesData,B=this._parsePAT,C=this._parsePMT,D=this._parsePES,E=this._parseAVCPES.bind(this),F=this._parseAACPES.bind(this),G=this._parseMPEGPES.bind(this),H=this._parseID3PES.bind(this);g-=g%188;for(f=0;f<g;f+=188){if(b[f]===71){h=!!(b[f+1]&64);j=((b[f+1]&31)<<8)+b[f+2];k=(b[f+3]&48)>>4;if(k>1){l=f+5+b[f+4];if(l===f+188){continue}}else{l=f+4}switch(j){case u:if(h){if(y&&(m=D(y))){E(m,false)}y={data:[],size:0}}if(y){y.data.push(b.subarray(l,f+188));y.size+=f+188-l}break;case v:if(h){if(z&&(m=D(z))){if(s.isAAC){F(m)}else{G(m)}}z={data:[],size:0}}if(z){z.data.push(b.subarray(l,f+188));z.size+=f+188-l}break;case w:if(h){if(A&&(m=D(A))){H(m)}A={data:[],size:0}}if(A){A.data.push(b.subarray(l,f+188));A.size+=f+188-l}break;case 0:if(h){l+=b[l]+1}x=this._pmtId=B(b,l);break;case x:if(h){l+=b[l]+1}var I=C(b,l,this.typeSupported.mpeg===true||this.typeSupported.mp3===true,this.sampleAes!=null);u=I.avc;if(u>0){r.id=u}v=I.audio;if(v>0){s.id=v;s.isAAC=I.isAAC}w=I.id3;if(w>0){t.id=w}if(p&&!q){n.logger.log("reparse from beginning");p=false;f=-188}q=this.pmtParsed=true;break;case 17:case 8191:break;default:p=true;break}}else{this.observer.trigger(i.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:false,reason:"TS packet did not start with 0x47"})}}if(y&&(m=D(y))){E(m,true);r.pesData=null}else{r.pesData=y}if(z&&(m=D(z))){if(s.isAAC){F(m)}else{G(m)}s.pesData=null}else{if(z&&z.size){n.logger.log("last AAC PES packet truncated,might overlap between fragments")}s.pesData=z}if(A&&(m=D(A))){H(m);t.pesData=null}else{t.pesData=A}if(this.sampleAes==null){this.remuxer.remux(s,r,t,this._txtTrack,c,d,e)}else{this.decryptAndRemux(s,r,t,this._txtTrack,c,d,e)}}},{key:"decryptAndRemux",value:function a(b,c,d,e,f,g,h){if(b.samples&&b.isAAC){var i=this;this.sampleAes.decryptAacSamples(b.samples,0,function(){i.decryptAndRemuxAvc(b,c,d,e,f,g,h)})}else{this.decryptAndRemuxAvc(b,c,d,e,f,g,h)}}},{key:"decryptAndRemuxAvc",value:function a(b,c,d,e,f,g,h){if(c.samples){var i=this;this.sampleAes.decryptAvcSamples(c.samples,0,0,function(){i.remuxer.remux(b,c,d,e,f,g,h)})}else{this.remuxer.remux(b,c,d,e,f,g,h)}}},{key:"destroy",value:function a(){this._initPTS=this._initDTS=undefined;this._duration=0}},{key:"_parsePAT",value:function a(b,c){return(b[c+10]&31)<<8|b[c+11]}},{key:"_parsePMT",value:function a(b,c,d,e){var f,g,h,i,j={audio:-1,avc:-1,id3:-1,isAAC:true};f=(b[c+1]&15)<<8|b[c+2];g=c+3+f-4;h=(b[c+10]&15)<<8|b[c+11];c+=12+h;while(c<g){i=(b[c+1]&31)<<8|b[c+2];switch(b[c]){case 207:if(!e){n.logger.log("unkown stream type:"+b[c]);break}case 15:if(j.audio===-1){j.audio=i}break;case 21:if(j.id3===-1){j.id3=i}break;case 219:if(!e){n.logger.log("unkown stream type:"+b[c]);break}case 27:if(j.avc===-1){j.avc=i}break;case 3:case 4:if(!d){n.logger.log("MPEG audio found, not supported in this browser for now")}else if(j.audio===-1){j.audio=i;j.isAAC=false}break;case 36:n.logger.warn("HEVC stream type found, not supported for now");break;default:n.logger.log("unkown stream type:"+b[c]);break}c+=((b[c+3]&15)<<8|b[c+4])+5}return j}},{key:"_parsePES",value:function a(b){var c=0,d,e,f,g,h,i,j,k,l,m=b.data;if(!b||b.size===0){return null}while(m[0].length<19&&m.length>1){var o=new Uint8Array(m[0].length+m[1].length);o.set(m[0]);o.set(m[1],m[0].length);m[0]=o;m.splice(1,1)}d=m[0];f=(d[0]<<16)+(d[1]<<8)+d[2];if(f===1){g=(d[4]<<8)+d[5];if(g&&g>b.size-6){return null}e=d[7];if(e&192){j=(d[9]&14)*536870912+(d[10]&255)*4194304+(d[11]&254)*16384+(d[12]&255)*128+(d[13]&254)/2;if(j>4294967295){j-=8589934592}if(e&64){k=(d[14]&14)*536870912+(d[15]&255)*4194304+(d[16]&254)*16384+(d[17]&255)*128+(d[18]&254)/2;if(k>4294967295){k-=8589934592}if(j-k>60*9e4){n.logger.warn(Math.round((j-k)/9e4)+"s delta between PTS and DTS, align them");j=k}}else{k=j}}h=d[8];l=h+9;b.size-=l;i=new Uint8Array(b.size);for(var p=0,q=m.length;p<q;p++){d=m[p];var r=d.byteLength;if(l){if(l>r){l-=r;continue}else{d=d.subarray(l);r-=l;l=0}}i.set(d,c);c+=r}if(g){g-=h+3}return{data:i,pts:j,dts:k,len:g}}else{return null}}},{key:"pushAccesUnit",value:function a(b,c){if(b.units.length&&b.frame){var d=c.samples;var e=d.length;if(!this.config.forceKeyFrameOnDiscontinuity||b.key===true||c.sps&&(e||this.contiguous)){b.id=e;d.push(b)}else{c.dropped++}}if(b.debug.length){n.logger.log(b.pts+"/"+b.dts+":"+b.debug)}}},{key:"_parseAVCPES",value:function a(b,c){var d=this;var e=this._avcTrack,f=this._parseAVCNALu(b.data),g=false,h,i=this.avcSample,j,l=false,m,n=this.pushAccesUnit.bind(this),o=function a(b,c,d,e){return{key:b,pts:c,dts:d,units:[],debug:e}};b.data=null;if(i&&f.length){n(i,e);i=this.avcSample=o(false,b.pts,b.dts,"")}f.forEach(function(a){switch(a.type){case 1:j=true;if(g&&i){i.debug+="NDR "}i.frame=true;var c=a.data;if(l&&c.length>4){var f=new k.default(c).readSliceType();if(f===2||f===4||f===7||f===9){i.key=true}}break;case 5:j=true;if(!i){i=d.avcSample=o(true,b.pts,b.dts,"")}if(g){i.debug+="IDR "}i.key=true;i.frame=true;break;case 6:j=true;if(g&&i){i.debug+="SEI "}h=new k.default(d.discardEPB(a.data));h.readUByte();var p=0;var q=0;var r=false;var s=0;while(!r&&h.bytesAvailable>1){p=0;do{s=h.readUByte();p+=s}while(s===255);q=0;do{s=h.readUByte();q+=s}while(s===255);if(p===4&&h.bytesAvailable!==0){r=true;var t=h.readUByte();if(t===181){var u=h.readUShort();if(u===49){var v=h.readUInt();if(v===1195456820){var w=h.readUByte();if(w===3){var x=h.readUByte();var y=h.readUByte();var z=31&x;var A=[x,y];for(m=0;m<z;m++){A.push(h.readUByte());A.push(h.readUByte());A.push(h.readUByte())}d._insertSampleInOrder(d._txtTrack.samples,{type:3,pts:b.pts,bytes:A})}}}}}else if(q<h.bytesAvailable){for(m=0;m<q;m++){h.readUByte()}}}break;case 7:j=true;l=true;if(g&&i){i.debug+="SPS "}if(!e.sps){h=new k.default(a.data);var B=h.readSPS();e.width=B.width;e.height=B.height;e.pixelRatio=B.pixelRatio;e.sps=[a.data];e.duration=d._duration;var C=a.data.subarray(1,4);var D="avc1.";for(m=0;m<3;m++){var E=C[m].toString(16);if(E.length<2){E="0"+E}D+=E}e.codec=D}break;case 8:j=true;if(g&&i){i.debug+="PPS "}if(!e.pps){e.pps=[a.data]}break;case 9:j=false;if(i){n(i,e)}i=d.avcSample=o(false,b.pts,b.dts,g?"AUD ":"");break;case 12:j=false;break;default:j=false;if(i){i.debug+="unknown NAL "+a.type+" "}break}if(i&&j){var F=i.units;F.push(a)}});if(c&&i){n(i,e);this.avcSample=null}}},{key:"_insertSampleInOrder",value:function a(b,c){var d=b.length;if(d>0){if(c.pts>=b[d-1].pts){b.push(c)}else{for(var e=d-1;e>=0;e--){if(c.pts<b[e].pts){b.splice(e,0,c);break}}}}else{b.push(c)}}},{key:"_getLastNalUnit",value:function a(){var b=this.avcSample,c=void 0;if(!b||b.units.length===0){var d=this._avcTrack,e=d.samples;b=e[e.length-1]}if(b){var f=b.units;c=f[f.length-1]}return c}},{key:"_parseAVCNALu",value:function a(b){var c=0,d=b.byteLength,e,f,g=this._avcTrack,h=g.naluState||0,i=h;var j=[],k,l,m=-1,n;if(h===-1){m=0;n=b[0]&31;h=0;c=1}while(c<d){e=b[c++];if(!h){h=e?0:1;continue}if(h===1){h=e?0:2;continue}if(!e){h=3}else if(e===1){if(m>=0){k={data:b.subarray(m,c-h-1),type:n};j.push(k)}else{var o=this._getLastNalUnit();if(o){if(i&&c<=4-i){if(o.state){o.data=o.data.subarray(0,o.data.byteLength-i)}}f=c-h-1;if(f>0){var p=new Uint8Array(o.data.byteLength+f);p.set(o.data,0);p.set(b.subarray(0,f),o.data.byteLength);o.data=p}}}if(c<d){l=b[c]&31;m=c;n=l;h=0}else{h=-1}}else{h=0}}if(m>=0&&h>=0){k={data:b.subarray(m,d),type:n,state:h};j.push(k)}if(j.length===0){var q=this._getLastNalUnit();if(q){var r=new Uint8Array(q.data.byteLength+b.byteLength);r.set(q.data,0);r.set(b,q.data.byteLength);q.data=r}}g.naluState=h;return j}},{key:"discardEPB",value:function a(b){var c=b.byteLength,d=[],e=1,f,g;while(e<c-2){if(b[e]===0&&b[e+1]===0&&b[e+2]===3){d.push(e+2);e+=2}else{e++}}if(d.length===0){return b}f=c-d.length;g=new Uint8Array(f);var h=0;for(e=0;e<f;h++,e++){if(h===d[0]){h++;d.shift()}g[e]=b[h]}return g}},{key:"_parseAACPES",value:function a(b){var c=this._audioTrack,d=b.data,f=b.pts,g=0,h=this.aacOverFlow,j=this.aacLastPTS,k,l,m,p,q;if(h){var r=new Uint8Array(h.byteLength+d.byteLength);r.set(h,0);r.set(d,h.byteLength);d=r}for(m=g,q=d.length;m<q-1;m++){if(e.default.isHeader(d,m)){break}}if(m){var s,t;if(m<q-1){s="AAC PES did not start with ADTS header,offset:"+m;t=false}else{s="no ADTS header found in AAC PES";t=true}n.logger.warn("parsing error:"+s);this.observer.trigger(i.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:t,reason:s});if(t){return}}e.default.initTrackConfig(c,this.observer,d,m,this.audioCodec);l=0;k=e.default.getFrameDuration(c.samplerate);if(h&&j){var u=j+k;if(Math.abs(u-f)>1){n.logger.log("AAC: align PTS for overlapping frames by "+Math.round((u-f)/90));f=u}}while(m<q){if(e.default.isHeader(d,m)&&m+5<q){var v=e.default.appendFrame(c,d,m,f,l);if(v){m+=v.length;p=v.sample.pts;l++}else{break}}else{m++}}if(m<q){h=d.subarray(m,q)}else{h=null}this.aacOverFlow=h;this.aacLastPTS=p}},{key:"_parseMPEGPES",value:function a(b){var c=b.data;var d=c.length;var e=0;var f=0;var h=b.pts;while(f<d){if(g.default.isHeader(c,f)){var i=g.default.appendFrame(this._audioTrack,c,f,h,e);if(i){f+=i.length;e++}else{break}}else{f++}}}},{key:"_parseID3PES",value:function a(b){this._id3Track.samples.push(b)}}],[{key:"probe",value:function a(b){if(b.length>=3*188&&b[0]===71&&b[188]===71&&b[2*188]===71){return true}else{return false}}}]);return a}();exports.default=r},{22:22,26:26,30:30,31:31,33:33,35:35,54:54}],33:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=exports.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"};var d=exports.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException",WEBVTT_EXCEPTION:"webVTTException"}},{}],34:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var e=a(54);var f=a(33);var g=a(35);var h=i(g);function i(a){return a&&a.__esModule?a:{default:a}}function j(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var k=function(){function a(b){j(this,a);this.hls=b;this.onEvent=this.onEvent.bind(this);for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++){d[e-1]=arguments[e]}this.handledEvents=d;this.useGenericHandler=true;this.registerListeners()}d(a,[{key:"destroy",value:function a(){this.unregisterListeners()}},{key:"isEventHandler",value:function a(){return c(this.handledEvents)==="object"&&this.handledEvents.length&&typeof this.onEvent==="function"}},{key:"registerListeners",value:function a(){if(this.isEventHandler()){this.handledEvents.forEach(function(a){if(a==="hlsEventGeneric"){throw new Error("Forbidden event name: "+a)}this.hls.on(a,this.onEvent)},this)}}},{key:"unregisterListeners",value:function a(){if(this.isEventHandler()){this.handledEvents.forEach(function(a){this.hls.off(a,this.onEvent)},this)}}},{key:"onEvent",value:function a(b,c){this.onEventGeneric(b,c)}},{key:"onEventGeneric",value:function a(b,c){var d=function a(b,c){var d="on"+b.replace("hls","");if(typeof this[d]!=="function"){throw new Error("Event "+b+" has no generic handler in this "+this.constructor.name+" class (tried "+d+")")}return this[d].bind(this,c)};try{d.call(this,b,c).call()}catch(a){e.logger.error("internal error happened while processing "+b+":"+a.message);this.hls.trigger(h.default.ERROR,{type:f.ErrorTypes.OTHER_ERROR,details:f.ErrorDetails.INTERNAL_EXCEPTION,fatal:false,event:b,err:a})}}}]);return a}();exports.default=k},{33:33,35:35,54:54}],35:[function(a,b,exports){"use strict";b.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],36:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function d(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var e=function(){function a(){d(this,a)}c(a,null,[{key:"getSilentFrame",value:function a(b,c){switch(b){case"mp4a.40.2":if(c===1){return new Uint8Array([0,200,0,128,35,128])}else if(c===2){return new Uint8Array([33,0,73,144,2,25,0,35,128])}else if(c===3){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142])}else if(c===4){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56])}else if(c===5){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56])}else if(c===6){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}break;default:if(c===1){return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}else if(c===2){return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}else if(c===3){return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}break}return null}}]);return a}();exports.default=e},{}],37:[function(a,b,exports){"use strict";var c={isBuffered:function a(b,c){if(b){var d=b.buffered;for(var e=0;e<d.length;e++){if(c>=d.start(e)&&c<=d.end(e)){return true}}}return false},bufferInfo:function a(b,c,d){if(b){var e=b.buffered,f=[],g;for(g=0;g<e.length;g++){f.push({start:e.start(g),end:e.end(g)})}return this.bufferedInfo(f,c,d)}else{return{len:0,start:c,end:c,nextStart:undefined}}},bufferedInfo:function a(b,c,d){var e=[],f,g,h,i,j;b.sort(function(a,b){var c=a.start-b.start;if(c){return c}else{return b.end-a.end}});for(j=0;j<b.length;j++){var k=e.length;if(k){var l=e[k-1].end;if(b[j].start-l<d){if(b[j].end>l){e[k-1].end=b[j].end}}else{e.push(b[j])}}else{e.push(b[j])}}for(j=0,f=0,g=h=c;j<e.length;j++){var m=e[j].start,n=e[j].end;if(c+d>=m&&c<n){g=m;h=n;f=h-c}else if(c+d<m){i=m;break}}return{len:f,start:g,end:h,nextStart:i}}};b.exports=c},{}],38:[function(a,b,exports){"use strict";var c=a(54);var d={mergeDetails:function a(b,e){var f=Math.max(b.startSN,e.startSN)-e.startSN,g=Math.min(b.endSN,e.endSN)-e.startSN,h=e.startSN-b.startSN,i=b.fragments,j=e.fragments,k=0,l;if(g<f){e.PTSKnown=false;return}for(var m=f;m<=g;m++){var n=i[h+m],o=j[m];if(o&&n){k=n.cc-o.cc;if(!isNaN(n.startPTS)){o.start=o.startPTS=n.startPTS;o.endPTS=n.endPTS;o.duration=n.duration;o.backtracked=n.backtracked;o.dropped=n.dropped;l=o}}}if(k){c.logger.log("discontinuity sliding from playlist, take drift into account");for(m=0;m<j.length;m++){j[m].cc+=k}}if(l){d.updateFragPTSDTS(e,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS)}else{if(h>=0&&h<i.length){var p=i[h].start;for(m=0;m<j.length;m++){j[m].start+=p}}}e.PTSKnown=b.PTSKnown;return},updateFragPTSDTS:function a(b,c,e,f,g,h){var i=e;if(!isNaN(c.startPTS)){var j=Math.abs(c.startPTS-e);if(isNaN(c.deltaPTS)){c.deltaPTS=j}else{c.deltaPTS=Math.max(j,c.deltaPTS)}i=Math.max(e,c.startPTS);e=Math.min(e,c.startPTS);f=Math.max(f,c.endPTS);g=Math.min(g,c.startDTS);h=Math.max(h,c.endDTS)}var k=e-c.start;c.start=c.startPTS=e;c.maxStartPTS=i;c.endPTS=f;c.startDTS=g;c.endDTS=h;c.duration=f-e;var l=c.sn;if(!b||l<b.startSN||l>b.endSN){return 0}var m,n,o;m=l-b.startSN;n=b.fragments;n[m]=c;for(o=m;o>0;o--){d.updatePTS(n,o,o-1)}for(o=m;o<n.length-1;o++){d.updatePTS(n,o,o+1)}b.PTSKnown=true;return k},updatePTS:function a(b,d,e){var f=b[d],g=b[e],h=g.startPTS;if(!isNaN(h)){if(e>d){f.duration=h-f.start;if(f.duration<0){c.logger.warn("negative duration computed for frag "+f.sn+",level "+f.level+", there should be some duration drift between playlist and fragment!")}}else{g.duration=f.start-h;if(g.duration<0){c.logger.warn("negative duration computed for frag "+g.sn+",level "+g.level+", there should be some duration drift between playlist and fragment!")}}}else{if(e>d){g.start=f.start+f.duration}else{g.start=Math.max(f.start-g.duration,0)}}}};b.exports=d},{54:54}],39:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(2);var e=y(d);var f=a(35);var g=y(f);var h=a(33);var i=a(43);var j=y(i);var k=a(41);var l=y(k);var m=a(42);var n=y(m);var o=a(13);var p=y(o);var q=a(12);var r=y(q);var s=a(11);var t=y(s);var u=a(54);var v=a(1);var w=y(v);var x=a(4);function y(a){return a&&a.__esModule?a:{default:a}}function z(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var A=function(){c(a,null,[{key:"isSupported",value:function a(){var b=window.MediaSource=window.MediaSource||window.WebKitMediaSource;var c=window.SourceBuffer=window.SourceBuffer||window.WebKitSourceBuffer;var d=b&&typeof b.isTypeSupported==="function"&&b.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');var e=!c||c.prototype&&typeof c.prototype.appendBuffer==="function"&&typeof c.prototype.remove==="function";return d&&e}},{key:"version",get:function a(){return"0.7.11"}},{key:"Events",get:function a(){return g.default}},{key:"ErrorTypes",get:function a(){return h.ErrorTypes}},{key:"ErrorDetails",get:function a(){return h.ErrorDetails}},{key:"DefaultConfig",get:function b(){if(!a.defaultConfig){return x.hlsDefaultConfig}return a.defaultConfig},set:function b(c){a.defaultConfig=c}}]);function a(){var b=this;var c=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};z(this,a);var d=a.DefaultConfig;if((c.liveSyncDurationCount||c.liveMaxLatencyDurationCount)&&(c.liveSyncDuration||c.liveMaxLatencyDuration)){throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration")}for(var e in d){if(e in c){continue}c[e]=d[e]}if(c.liveMaxLatencyDurationCount!==undefined&&c.liveMaxLatencyDurationCount<=c.liveSyncDurationCount){throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"')}if(c.liveMaxLatencyDuration!==undefined&&(c.liveMaxLatencyDuration<=c.liveSyncDuration||c.liveSyncDuration===undefined)){throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"')}(0,u.enableLogs)(c.debug);this.config=c;this._autoLevelCapping=-1;var f=this.observer=new w.default;f.trigger=function a(b){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++){d[e-1]=arguments[e]}f.emit.apply(f,[b,b].concat(d))};f.off=function a(b){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++){d[e-1]=arguments[e]}f.removeListener.apply(f,[b].concat(d))};this.on=f.on.bind(f);this.off=f.off.bind(f);this.trigger=f.trigger.bind(f);var g=this.abrController=new c.abrController(this);var h=new c.bufferController(this);var i=new c.capLevelController(this);var k=new c.fpsController(this);var m=new j.default(this);var o=new l.default(this);var q=new n.default(this);var s=new t.default(this);var v=this.levelController=new r.default(this);var x=this.streamController=new p.default(this);var y=[v,x];var A=c.audioStreamController;if(A){y.push(new A(this))}this.networkControllers=y;var B=[m,o,q,g,h,i,k,s];A=c.audioTrackController;if(A){var C=new A(this);this.audioTrackController=C;B.push(C)}A=c.subtitleTrackController;if(A){var D=new A(this);this.subtitleTrackController=D;B.push(D)}[c.subtitleStreamController,c.timelineController].forEach(function(a){if(a){B.push(new a(b))}});this.coreComponents=B}c(a,[{key:"destroy",value:function a(){u.logger.log("destroy");this.trigger(g.default.DESTROYING);this.detachMedia();this.coreComponents.concat(this.networkControllers).forEach(function(a){a.destroy()});this.url=null;this.observer.removeAllListeners();this._autoLevelCapping=-1}},{key:"attachMedia",value:function a(b){u.logger.log("attachMedia");this.media=b;this.trigger(g.default.MEDIA_ATTACHING,{media:b})}},{key:"detachMedia",value:function a(){u.logger.log("detachMedia");this.trigger(g.default.MEDIA_DETACHING);this.media=null}},{key:"loadSource",value:function a(b){b=e.default.buildAbsoluteURL(window.location.href,b,{alwaysNormalize:true});u.logger.log("loadSource:"+b);this.url=b;this.trigger(g.default.MANIFEST_LOADING,{url:b})}},{key:"startLoad",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:-1;u.logger.log("startLoad("+b+")");this.networkControllers.forEach(function(a){a.startLoad(b)})}},{key:"stopLoad",value:function a(){u.logger.log("stopLoad");this.networkControllers.forEach(function(a){a.stopLoad()})}},{key:"swapAudioCodec",value:function a(){u.logger.log("swapAudioCodec");this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function a(){u.logger.log("recoverMediaError");var b=this.media;this.detachMedia();this.attachMedia(b)}},{key:"levels",get:function a(){return this.levelController.levels}},{key:"currentLevel",get:function a(){return this.streamController.currentLevel},set:function a(b){u.logger.log("set currentLevel:"+b);this.loadLevel=b;this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function a(){return this.streamController.nextLevel},set:function a(b){u.logger.log("set nextLevel:"+b);this.levelController.manualLevel=b;this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function a(){return this.levelController.level},set:function a(b){u.logger.log("set loadLevel:"+b);this.levelController.manualLevel=b}},{key:"nextLoadLevel",get:function a(){return this.levelController.nextLoadLevel},set:function a(b){this.levelController.nextLoadLevel=b}},{key:"firstLevel",get:function a(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function a(b){u.logger.log("set firstLevel:"+b);this.levelController.firstLevel=b}},{key:"startLevel",get:function a(){return this.levelController.startLevel},set:function a(b){u.logger.log("set startLevel:"+b);var c=this;if(b!==-1){b=Math.max(b,c.minAutoLevel)}c.levelController.startLevel=b}},{key:"autoLevelCapping",get:function a(){return this._autoLevelCapping},set:function a(b){u.logger.log("set autoLevelCapping:"+b);this._autoLevelCapping=b}},{key:"autoLevelEnabled",get:function a(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function a(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function a(){var b=this,c=b.levels,d=b.config.minAutoBitrate,e=c?c.length:0;for(var f=0;f<e;f++){var g=c[f].realBitrate?Math.max(c[f].realBitrate,c[f].bitrate):c[f].bitrate;if(g>d){return f}}return 0}},{key:"maxAutoLevel",get:function a(){var b=this;var c=b.levels;var d=b.autoLevelCapping;var e=void 0;if(d===-1&&c&&c.length){e=c.length-1}else{e=d}return e}},{key:"nextAutoLevel",get:function a(){var b=this;return Math.min(Math.max(b.abrController.nextAutoLevel,b.minAutoLevel),b.maxAutoLevel)},set:function a(b){var c=this;c.abrController.nextAutoLevel=Math.max(c.minAutoLevel,b)}},{key:"audioTracks",get:function a(){var b=this.audioTrackController;return b?b.audioTracks:[]}},{key:"audioTrack",get:function a(){var b=this.audioTrackController;return b?b.audioTrack:-1},set:function a(b){var c=this.audioTrackController;if(c){c.audioTrack=b}}},{key:"liveSyncPosition",get:function a(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function a(){var b=this.subtitleTrackController;return b?b.subtitleTracks:[]}},{key:"subtitleTrack",get:function a(){var b=this.subtitleTrackController;return b?b.subtitleTrack:-1},set:function a(b){var c=this.subtitleTrackController;if(c){c.subtitleTrack=b}}}]);return a}();exports.default=A},{1:1,11:11,12:12,13:13,2:2,33:33,35:35,4:4,41:41,42:42,43:43,54:54}],40:[function(a,b,exports){"use strict";b.exports=a(39).default},{39:39}],41:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(35);var e=j(d);var f=a(34);var g=j(f);var h=a(33);var i=a(54);function j(a){return a&&a.__esModule?a:{default:a}}function k(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function l(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function m(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var n=function(a){m(b,a);function b(a){k(this,b);var c=l(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,e.default.FRAG_LOADING));c.loaders={};return c}c(b,[{key:"destroy",value:function a(){var b=this.loaders;for(var c in b){var d=b[c];if(d){d.destroy()}}this.loaders={};g.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function a(b){var c=b.frag,d=c.type,e=this.loaders[d],f=this.hls.config;c.loaded=0;if(e){i.logger.warn("abort previous fragment loader for type:"+d);e.abort()}e=this.loaders[d]=c.loader=typeof f.fLoader!=="undefined"?new f.fLoader(f):new f.loader(f);var g=void 0,h=void 0,j=void 0;g={url:c.url,frag:c,responseType:"arraybuffer",progressData:false};var k=c.byteRangeStartOffset,l=c.byteRangeEndOffset;if(!isNaN(k)&&!isNaN(l)){g.rangeStart=k;g.rangeEnd=l}h={timeout:f.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:f.fragLoadingMaxRetryTimeout};j={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)};e.load(g,h,j)}},{key:"loadsuccess",value:function a(b,c,d){var f=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var g=b.data,h=d.frag;h.loader=undefined;this.loaders[h.type]=undefined;this.hls.trigger(e.default.FRAG_LOADED,{payload:g,frag:h,stats:c,networkDetails:f})}},{key:"loaderror",value:function a(b,c){var d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var f=c.loader;if(f){f.abort()}this.loaders[c.type]=undefined;this.hls.trigger(e.default.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_ERROR,fatal:false,frag:c.frag,response:b,networkDetails:d})}},{key:"loadtimeout",value:function a(b,c){var d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var f=c.loader;if(f){f.abort()}this.loaders[c.type]=undefined;this.hls.trigger(e.default.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:false,frag:c.frag,networkDetails:d})}},{key:"loadprogress",value:function a(b,c,d){var f=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var g=c.frag;g.loaded=b.loaded;this.hls.trigger(e.default.FRAG_LOAD_PROGRESS,{frag:g,stats:b,networkDetails:f})}}]);return b}(g.default);exports.default=n},{33:33,34:34,35:35,54:54}],42:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(35);var e=j(d);var f=a(34);var g=j(f);var h=a(33);var i=a(54);function j(a){return a&&a.__esModule?a:{default:a}}function k(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function l(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function m(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var n=function(a){m(b,a);function b(a){k(this,b);var c=l(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,e.default.KEY_LOADING));c.loaders={};c.decryptkey=null;c.decrypturl=null;return c}c(b,[{key:"destroy",value:function a(){for(var b in this.loaders){var c=this.loaders[b];if(c){c.destroy()}}this.loaders={};g.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function a(b){var c=b.frag,d=c.type,f=this.loaders[d],g=c.decryptdata,h=g.uri;if(h!==this.decrypturl||this.decryptkey===null){var j=this.hls.config;if(f){i.logger.warn("abort previous key loader for type:"+d);f.abort()}c.loader=this.loaders[d]=new j.loader(j);this.decrypturl=h;this.decryptkey=null;var k=void 0,l=void 0,m=void 0;k={url:h,frag:c,responseType:"arraybuffer"};l={timeout:j.fragLoadingTimeOut,maxRetry:j.fragLoadingMaxRetry,retryDelay:j.fragLoadingRetryDelay,maxRetryDelay:j.fragLoadingMaxRetryTimeout};m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};c.loader.load(k,l,m)}else if(this.decryptkey){g.key=this.decryptkey;this.hls.trigger(e.default.KEY_LOADED,{frag:c})}}},{key:"loadsuccess",value:function a(b,c,d){var f=d.frag;this.decryptkey=f.decryptdata.key=new Uint8Array(b.data);f.loader=undefined;this.loaders[f.type]=undefined;this.hls.trigger(e.default.KEY_LOADED,{frag:f})}},{key:"loaderror",value:function a(b,c){var d=c.frag,f=d.loader;if(f){f.abort()}this.loaders[c.type]=undefined;this.hls.trigger(e.default.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.KEY_LOAD_ERROR,fatal:false,frag:d,response:b})}},{key:"loadtimeout",value:function a(b,c){var d=c.frag,f=d.loader;if(f){f.abort()}this.loaders[c.type]=undefined;this.hls.trigger(e.default.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:false,frag:d})}}]);return b}(g.default);exports.default=n},{33:33,34:34,35:35,54:54}],43:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(2);var e=n(d);var f=a(35);var g=n(f);var h=a(34);var i=n(h);var j=a(33);var k=a(47);var l=n(k);var m=a(54);function n(a){return a&&a.__esModule?a:{default:a}}function o(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function p(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}function q(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var r=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g;var s=/#EXT-X-MEDIA:(.*)/g;var t=new RegExp([/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g");var u=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/;var v=function(){function a(){q(this,a);this.method=null;this.key=null;this.iv=null;this._uri=null}c(a,[{key:"uri",get:function a(){if(!this._uri&&this.reluri){this._uri=e.default.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:true})}return this._uri}}]);return a}();var w=function(){function a(){q(this,a);this._url=null;this._byteRange=null;this._decryptdata=null;this.tagList=[]}c(a,[{key:"createInitializationVector",value:function a(b){var c=new Uint8Array(16);for(var d=12;d<16;d++){c[d]=b>>8*(15-d)&255}return c}},{key:"fragmentDecryptdataFromLevelkey",value:function a(b,c){var d=b;if(b&&b.method&&b.uri&&!b.iv){d=new v;d.method=b.method;d.baseuri=b.baseuri;d.reluri=b.reluri;d.iv=this.createInitializationVector(c)}return d}},{key:"cloneObj",value:function a(b){return JSON.parse(JSON.stringify(b))}},{key:"url",get:function a(){if(!this._url&&this.relurl){this._url=e.default.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:true})}return this._url},set:function a(b){this._url=b}},{key:"programDateTime",get:function a(){if(!this._programDateTime&&this.rawProgramDateTime){this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))}return this._programDateTime}},{key:"byteRange",get:function a(){if(!this._byteRange){var b=this._byteRange=[];if(this.rawByteRange){var c=this.rawByteRange.split("@",2);if(c.length===1){var d=this.lastByteRangeEndOffset;b[0]=d?d:0}else{b[0]=parseInt(c[1])}b[1]=parseInt(c[0])+b[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function a(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function a(){return this.byteRange[1]}},{key:"decryptdata",get:function a(){if(!this._decryptdata){this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)}return this._decryptdata}}]);return a}();var x=function(a){p(b,a);function b(a){q(this,b);var c=o(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,g.default.MANIFEST_LOADING,g.default.LEVEL_LOADING,g.default.AUDIO_TRACK_LOADING,g.default.SUBTITLE_TRACK_LOADING));c.loaders={};return c}c(b,[{key:"destroy",value:function a(){for(var b in this.loaders){var c=this.loaders[b];if(c){c.destroy()}}this.loaders={};i.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function a(b){this.load(b.url,{type:"manifest"})}},{key:"onLevelLoading",value:function a(b){this.load(b.url,{type:"level",level:b.level,id:b.id})}},{key:"onAudioTrackLoading",value:function a(b){this.load(b.url,{type:"audioTrack",id:b.id})}},{key:"onSubtitleTrackLoading",value:function a(b){this.load(b.url,{type:"subtitleTrack",id:b.id})}},{key:"load",value:function a(b,c){var d=this.loaders[c.type];if(d){var e=d.context;if(e&&e.url===b){m.logger.trace("playlist request ongoing");return}else{m.logger.warn("abort previous loader for type:"+c.type);d.abort()}}var f=this.hls.config,g=void 0,h=void 0,i=void 0,j=void 0;if(c.type==="manifest"){g=f.manifestLoadingMaxRetry;h=f.manifestLoadingTimeOut;i=f.manifestLoadingRetryDelay;j=f.manifestLoadingMaxRetryTimeout}else{g=f.levelLoadingMaxRetry;h=f.levelLoadingTimeOut;i=f.levelLoadingRetryDelay;j=f.levelLoadingMaxRetryTimeout;m.logger.log("loading playlist for "+c.type+" "+(c.level||c.id))}d=this.loaders[c.type]=c.loader=typeof f.pLoader!=="undefined"?new f.pLoader(f):new f.loader(f);c.url=b;c.responseType="";var k=void 0,l=void 0;k={timeout:h,maxRetry:g,retryDelay:i,maxRetryDelay:j};l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};d.load(c,k,l)}},{key:"resolve",value:function a(b,c){return e.default.buildAbsoluteURL(c,b,{alwaysNormalize:true})}},{key:"parseMasterPlaylist",value:function a(b,c){var d=[],e=void 0;r.lastIndex=0;while((e=r.exec(b))!=null){var f={};var g=f.attrs=new l.default(e[1]);f.url=this.resolve(e[2],c);var h=g.decimalResolution("RESOLUTION");if(h){f.width=h.width;f.height=h.height}f.bitrate=g.decimalInteger("AVERAGE-BANDWIDTH")||g.decimalInteger("BANDWIDTH");f.name=g.NAME;var i=g.CODECS;if(i){i=i.split(/[ ,]+/);for(var j=0;j<i.length;j++){var k=i[j];if(k.indexOf("avc1")!==-1){f.videoCodec=this.avc1toavcoti(k)}else if(k.indexOf("hvc1")!==-1){f.videoCodec=k}else{f.audioCodec=k}}}d.push(f)}return d}},{key:"parseMasterPlaylistMedia",value:function a(b,c,d){var e=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var f=void 0,g=[],h=0;s.lastIndex=0;while((f=s.exec(b))!=null){var i={};var j=new l.default(f[1]);if(j.TYPE===d){i.groupId=j["GROUP-ID"];i.name=j.NAME;i.type=d;i.default=j.DEFAULT==="YES";i.autoselect=j.AUTOSELECT==="YES";i.forced=j.FORCED==="YES";if(j.URI){i.url=this.resolve(j.URI,c)}i.lang=j.LANGUAGE;if(!i.name){i.name=i.lang}if(e){i.audioCodec=e}i.id=h++;g.push(i)}}return g}},{key:"avc1toavcoti",value:function a(b){var c,d=b.split(".");if(d.length>2){c=d.shift()+".";c+=parseInt(d.shift()).toString(16);c+=("000"+parseInt(d.shift()).toString(16)).substr(-4)}else{c=b}return c}},{key:"parseLevelPlaylist",value:function a(b,c,d,e){var f=0,g=0,h={type:null,version:null,url:c,fragments:[],live:true,startSN:0},i=new v,j=0,k=null,n=new w,o,p;t.lastIndex=0;while((o=t.exec(b))!==null){var q=o[1];if(q){n.duration=parseFloat(q);var r=(" "+o[2]).slice(1);n.title=r?r:null;n.tagList.push(r?["INF",q,r]:["INF",q])}else if(o[3]){if(!isNaN(n.duration)){var s=f++;n.type=e;n.start=g;n.levelkey=i;n.sn=s;n.level=d;n.cc=j;n.baseurl=c;n.relurl=(" "+o[3]).slice(1);h.fragments.push(n);k=n;g+=n.duration;n=new w}}else if(o[4]){n.rawByteRange=(" "+o[4]).slice(1);if(k){var x=k.byteRangeEndOffset;if(x){n.lastByteRangeEndOffset=x}}}else if(o[5]){n.rawProgramDateTime=(" "+o[5]).slice(1);n.tagList.push(["PROGRAM-DATE-TIME",n.rawProgramDateTime])}else{o=o[0].match(u);for(p=1;p<o.length;p++){if(o[p]!==undefined){break}}var y=(" "+o[p+1]).slice(1);var z=(" "+o[p+2]).slice(1);switch(o[p]){case"#":n.tagList.push(z?[y,z]:[y]);break;case"PLAYLIST-TYPE":h.type=y.toUpperCase();break;case"MEDIA-SEQUENCE":f=h.startSN=parseInt(y);break;case"TARGETDURATION":h.targetduration=parseFloat(y);break;case"VERSION":h.version=parseInt(y);break;case"EXTM3U":break;case"ENDLIST":h.live=false;break;case"DIS":j++;n.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":j=parseInt(y);break;case"KEY":var A=y;var B=new l.default(A);var C=B.enumeratedString("METHOD"),D=B.URI,E=B.hexadecimalInteger("IV");if(C){i=new v;if(D&&["AES-128","SAMPLE-AES"].indexOf(C)>=0){i.method=C;i.baseuri=c;i.reluri=D;i.key=null;i.iv=E}}break;case"START":var F=y;var G=new l.default(F);var H=G.decimalFloatingPoint("TIME-OFFSET");if(!isNaN(H)){h.startTimeOffset=H}break;case"MAP":var I=new l.default(y);n.relurl=I.URI;n.rawByteRange=I.BYTERANGE;n.baseurl=c;n.level=d;n.type=e;n.sn="initSegment";h.initSegment=n;n=new w;break;default:m.logger.warn("line parsed but not handled: "+o);break}}}n=k;if(n&&!n.relurl){h.fragments.pop();g-=n.duration}h.totalduration=g;h.averagetargetduration=g/h.fragments.length;h.endSN=f-1;return h}},{key:"loadsuccess",value:function a(b,c,d){var e=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var f=b.data,h=b.url,i=d.type,k=d.id,l=d.level,n=this.hls;this.loaders[i]=undefined;if(h===undefined||h.indexOf("data:")===0){h=d.url}c.tload=performance.now();if(f.indexOf("#EXTM3U")===0){if(f.indexOf("#EXTINF:")>0){var o=i!=="audioTrack"&&i!=="subtitleTrack",p=!isNaN(l)?l:!isNaN(k)?k:0,q=this.parseLevelPlaylist(f,h,p,i==="audioTrack"?"audio":i==="subtitleTrack"?"subtitle":"main");q.tload=c.tload;if(i==="manifest"){n.trigger(g.default.MANIFEST_LOADED,{levels:[{url:h,details:q}],audioTracks:[],url:h,stats:c,networkDetails:e})}c.tparsed=performance.now();if(q.targetduration){if(o){n.trigger(g.default.LEVEL_LOADED,{details:q,level:l||0,id:k||0,stats:c,networkDetails:e})}else{if(i==="audioTrack"){n.trigger(g.default.AUDIO_TRACK_LOADED,{details:q,id:k,stats:c,networkDetails:e})}else if(i==="subtitleTrack"){n.trigger(g.default.SUBTITLE_TRACK_LOADED,{details:q,id:k,stats:c,networkDetails:e})}}}else{n.trigger(g.default.ERROR,{type:j.ErrorTypes.NETWORK_ERROR,details:j.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:true,url:h,reason:"invalid targetduration",networkDetails:e})}}else{var r=this.parseMasterPlaylist(f,h);if(r.length){var s=this.parseMasterPlaylistMedia(f,h,"AUDIO",r[0].audioCodec);var t=this.parseMasterPlaylistMedia(f,h,"SUBTITLES");if(s.length){var u=false;s.forEach(function(a){if(!a.url){u=true}});if(u===false&&r[0].audioCodec&&!r[0].attrs.AUDIO){m.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one");s.unshift({type:"main",name:"main"})}}n.trigger(g.default.MANIFEST_LOADED,{levels:r,audioTracks:s,subtitles:t,url:h,stats:c,networkDetails:e})}else{n.trigger(g.default.ERROR,{type:j.ErrorTypes.NETWORK_ERROR,details:j.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:true,url:h,reason:"no level found in manifest",networkDetails:e})}}}else{n.trigger(g.default.ERROR,{type:j.ErrorTypes.NETWORK_ERROR,details:j.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:true,url:h,reason:"no EXTM3U delimiter",networkDetails:e})}}},{key:"loaderror",value:function a(b,c){var d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var e,f,h=c.loader;switch(c.type){case"manifest":e=j.ErrorDetails.MANIFEST_LOAD_ERROR;f=true;break;case"level":e=j.ErrorDetails.LEVEL_LOAD_ERROR;f=false;break;case"audioTrack":e=j.ErrorDetails.AUDIO_TRACK_LOAD_ERROR;f=false;break}if(h){h.abort();this.loaders[c.type]=undefined}this.hls.trigger(g.default.ERROR,{type:j.ErrorTypes.NETWORK_ERROR,details:e,fatal:f,url:h.url,loader:h,response:b,context:c,networkDetails:d})}},{key:"loadtimeout",value:function a(b,c){var d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var e,f,h=c.loader;switch(c.type){case"manifest":e=j.ErrorDetails.MANIFEST_LOAD_TIMEOUT;f=true;break;case"level":e=j.ErrorDetails.LEVEL_LOAD_TIMEOUT;f=false;break;case"audioTrack":e=j.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT;f=false;break}if(h){h.abort();this.loaders[c.type]=undefined}this.hls.trigger(g.default.ERROR,{type:j.ErrorTypes.NETWORK_ERROR,details:e,fatal:f,url:h.url,loader:h,context:c,networkDetails:d})}}]);return b}(i.default);exports.default=x},{2:2,33:33,34:34,35:35,47:47,54:54}],44:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function d(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var e=Math.pow(2,32)-1;var f=function(){function a(){d(this,a)}c(a,null,[{key:"init",value:function b(){a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var c;for(c in a.types){if(a.types.hasOwnProperty(c)){a.types[c]=[c.charCodeAt(0),c.charCodeAt(1),c.charCodeAt(2),c.charCodeAt(3)]}}var d=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);var e=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:d,audio:e};var f=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);var g=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=g;a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]);a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var h=new Uint8Array([105,115,111,109]);var i=new Uint8Array([97,118,99,49]);var j=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,h,j,h,i);a.DINF=a.box(a.types.dinf,a.box(a.types.dref,f))}},{key:"box",value:function a(b){var c=Array.prototype.slice.call(arguments,1),d=8,e=c.length,f=e,g;while(e--){d+=c[e].byteLength}g=new Uint8Array(d);g[0]=d>>24&255;g[1]=d>>16&255;g[2]=d>>8&255;g[3]=d&255;g.set(b,4);for(e=0,d=8;e<f;e++){g.set(c[e],d);d+=c[e].byteLength}return g}},{key:"hdlr",value:function b(c){return a.box(a.types.hdlr,a.HDLR_TYPES[c])}},{key:"mdat",value:function b(c){return a.box(a.types.mdat,c)}},{key:"mdhd",value:function b(c,d){d*=c;var f=Math.floor(d/(e+1));var g=Math.floor(d%(e+1));return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,c>>24&255,c>>16&255,c>>8&255,c&255,f>>24,f>>16&255,f>>8&255,f&255,g>>24,g>>16&255,g>>8&255,g&255,85,196,0,0]))}},{key:"mdia",value:function b(c){return a.box(a.types.mdia,a.mdhd(c.timescale,c.duration),a.hdlr(c.type),a.minf(c))}},{key:"mfhd",value:function b(c){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,c&255]))}},{key:"minf",value:function b(c){if(c.type==="audio"){return a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(c))}else{return a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(c))}}},{key:"moof",value:function b(c,d,e){return a.box(a.types.moof,a.mfhd(c),a.traf(e,d))}},{key:"moov",value:function b(c){var d=c.length,e=[];while(d--){e[d]=a.trak(c[d])}return a.box.apply(null,[a.types.moov,a.mvhd(c[0].timescale,c[0].duration)].concat(e).concat(a.mvex(c)))}},{key:"mvex",value:function b(c){var d=c.length,e=[];while(d--){e[d]=a.trex(c[d])}return a.box.apply(null,[a.types.mvex].concat(e))}},{key:"mvhd",value:function b(c,d){d*=c;var f=Math.floor(d/(e+1));var g=Math.floor(d%(e+1));var h=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,c>>24&255,c>>16&255,c>>8&255,c&255,f>>24,f>>16&255,f>>8&255,f&255,g>>24,g>>16&255,g>>8&255,g&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,h)}},{key:"sdtp",value:function b(c){var d=c.samples||[],e=new Uint8Array(4+d.length),f,g;for(g=0;g<d.length;g++){f=d[g].flags;e[g+4]=f.dependsOn<<4|f.isDependedOn<<2|f.hasRedundancy}return a.box(a.types.sdtp,e)}},{key:"stbl",value:function b(c){return a.box(a.types.stbl,a.stsd(c),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))}},{key:"avc1",value:function b(c){var d=[],e=[],f,g,h;for(f=0;f<c.sps.length;f++){g=c.sps[f];h=g.byteLength;d.push(h>>>8&255);d.push(h&255);d=d.concat(Array.prototype.slice.call(g))}for(f=0;f<c.pps.length;f++){g=c.pps[f];h=g.byteLength;e.push(h>>>8&255);e.push(h&255);e=e.concat(Array.prototype.slice.call(g))}var i=a.box(a.types.avcC,new Uint8Array([1,d[3],d[4],d[5],252|3,224|c.sps.length].concat(d).concat([c.pps.length]).concat(e))),j=c.width,k=c.height,l=c.pixelRatio[0],m=c.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,j>>8&255,j&255,k>>8&255,k&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,l&255,m>>24,m>>16&255,m>>8&255,m&255])))}},{key:"esds",value:function a(b){var c=b.config.length;return new Uint8Array([0,0,0,0,3,23+c,0,1,0,4,15+c,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([c]).concat(b.config).concat([6,1,2]))}},{key:"mp4a",value:function b(c){var d=c.samplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,c.channelCount,0,16,0,0,0,0,d>>8&255,d&255,0,0]),a.box(a.types.esds,a.esds(c)))}},{key:"mp3",value:function b(c){var d=c.samplerate;return a.box(a.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,c.channelCount,0,16,0,0,0,0,d>>8&255,d&255,0,0]))}},{key:"stsd",value:function b(c){if(c.type==="audio"){if(!c.isAAC&&c.codec==="mp3"){return a.box(a.types.stsd,a.STSD,a.mp3(c))}return a.box(a.types.stsd,a.STSD,a.mp4a(c))}else{return a.box(a.types.stsd,a.STSD,a.avc1(c))}}},{key:"tkhd",value:function b(c){var d=c.id,f=c.duration*c.timescale,g=c.width,h=c.height,i=Math.floor(f/(e+1)),j=Math.floor(f%(e+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,d>>24&255,d>>16&255,d>>8&255,d&255,0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,j>>24,j>>16&255,j>>8&255,j&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,g>>8&255,g&255,0,0,h>>8&255,h&255,0,0]))}},{key:"traf",value:function b(c,d){var f=a.sdtp(c),g=c.id,h=Math.floor(d/(e+1)),i=Math.floor(d%(e+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,h>>24,h>>16&255,h>>8&255,h&255,i>>24,i>>16&255,i>>8&255,i&255])),a.trun(c,f.length+16+20+8+16+8+8),f)}},{key:"trak",value:function b(c){c.duration=c.duration||4294967295;return a.box(a.types.trak,a.tkhd(c),a.mdia(c))}},{key:"trex",value:function b(c){var d=c.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,d>>24,d>>16&255,d>>8&255,d&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function b(c,d){var e=c.samples||[],f=e.length,g=12+16*f,h=new Uint8Array(g),i,j,k,l,m,n;d+=8+g;h.set([0,0,15,1,f>>>24&255,f>>>16&255,f>>>8&255,f&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255],0);for(i=0;i<f;i++){j=e[i];k=j.duration;l=j.size;m=j.flags;n=j.cts;h.set([k>>>24&255,k>>>16&255,k>>>8&255,k&255,l>>>24&255,l>>>16&255,l>>>8&255,l&255,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,m.degradPrio&240<<8,m.degradPrio&15,n>>>24&255,n>>>16&255,n>>>8&255,n&255],12+16*i)}return a.box(a.types.trun,h)}},{key:"initSegment",value:function b(c){if(!a.types){a.init()}var d=a.moov(c),e;e=new Uint8Array(a.FTYP.byteLength+d.byteLength);e.set(a.FTYP);e.set(d,a.FTYP.byteLength);return e}}]);return a}();exports.default=f},{}],45:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(36);var e=l(d);var f=a(35);var g=l(f);var h=a(54);var i=a(44);var j=l(i);var k=a(33);function l(a){return a&&a.__esModule?a:{default:a}}function m(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var n=10*1e3;var o=function(){function a(b,c,d,e){m(this,a);this.observer=b;this.config=c;this.typeSupported=d;var f=navigator.userAgent;this.isSafari=e&&e.indexOf("Apple")>-1&&f&&!f.match("CriOS");this.ISGenerated=false}c(a,[{key:"destroy",value:function a(){}},{key:"resetTimeStamp",value:function a(b){this._initPTS=this._initDTS=b}},{key:"resetInitSegment",value:function a(){this.ISGenerated=false}},{key:"remux",value:function a(b,c,d,e,f,i,j){if(!this.ISGenerated){this.generateIS(b,c,f)}else{if(j){var k=this._initPTS;var l=this._PTSNormalize;var m=b.inputTimeScale||c.inputTimeScale;var n=Infinity,o=Infinity;var p=b.samples;if(p.length){n=o=l(p[0].pts-m*f,k)}p=c.samples;if(p.length){var q=p[0];n=Math.min(n,l(q.pts-m*f,k));o=Math.min(o,l(q.dts-m*f,k))}if(n!==Infinity){var r=k-n;if(Math.abs(r)>10*m){h.logger.warn("timestamp inconsistency, "+(r/m).toFixed(3)+"s delta against expected value: missing discontinuity ? reset initPTS/initDTS");this._initPTS=n;this._initDTS=o;this.observer.trigger(g.default.INIT_PTS_FOUND,{initPTS:n})}}}}if(this.ISGenerated){if(b.samples.length){if(!b.timescale){h.logger.warn("regenerate InitSegment as audio detected");this.generateIS(b,c,f)}var s=this.remuxAudio(b,f,i,j);if(c.samples.length){var t=void 0;if(s){t=s.endPTS-s.startPTS}if(!c.timescale){h.logger.warn("regenerate InitSegment as video detected");this.generateIS(b,c,f)}this.remuxVideo(c,f,i,t,j)}}else{var u=void 0;if(c.samples.length){u=this.remuxVideo(c,f,i,j)}if(u&&b.codec){this.remuxEmptyAudio(b,f,i,u)}}}if(d.samples.length){this.remuxID3(d,f)}if(e.samples.length){this.remuxText(e,f)}this.observer.trigger(g.default.FRAG_PARSED)}},{key:"generateIS",value:function a(b,c,d){var e=this.observer,f=b.samples,i=c.samples,l=this.typeSupported,m="audio/mp4",n={},o={tracks:n},p=this._initPTS===undefined,q,r;if(p){q=r=Infinity}if(b.config&&f.length){b.timescale=b.samplerate;h.logger.log("audio sampling rate : "+b.samplerate);if(!b.isAAC){if(l.mpeg){m="audio/mpeg";b.codec=""}else if(l.mp3){b.codec="mp3"}}n.audio={container:m,codec:b.codec,initSegment:!b.isAAC&&l.mpeg?new Uint8Array:j.default.initSegment([b]),metadata:{channelCount:b.channelCount}};if(p){q=r=f[0].pts-b.inputTimeScale*d}}if(c.sps&&c.pps&&i.length){var s=c.inputTimeScale;c.timescale=s;n.video={container:"video/mp4",codec:c.codec,initSegment:j.default.initSegment([c]),metadata:{width:c.width,height:c.height}};if(p){q=Math.min(q,i[0].pts-s*d);r=Math.min(r,i[0].dts-s*d);this.observer.trigger(g.default.INIT_PTS_FOUND,{initPTS:q})}}if(Object.keys(n).length){e.trigger(g.default.FRAG_PARSING_INIT_SEGMENT,o);this.ISGenerated=true;if(p){this._initPTS=q;this._initDTS=r}}else{e.trigger(g.default.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_PARSING_ERROR,fatal:false,reason:"no audio/video samples found"})}}},{key:"remuxVideo",value:function a(b,c,d,e,f){var i=8,l=b.timescale,m,n,o,p,q,r,s,t,u=b.samples,v=[],w=u.length,x=this._PTSNormalize,y=this._initDTS;var z=this.nextAvcDts;var A=this.isSafari;if(A){d|=u.length&&z&&(f&&Math.abs(c-z/l)<.1||Math.abs(u[0].pts-z-y)<l/5)}if(!d){z=c*l}u.forEach(function(a){a.pts=x(a.pts-y,z);a.dts=x(a.dts-y,z)});u.sort(function(a,b){var c=a.dts-b.dts;var d=a.pts-b.pts;return c?c:d?d:a.id-b.id});var B=u.reduce(function(a,b){return Math.max(Math.min(a,b.pts-b.dts),-18e3)},0);if(B<0){h.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(B/90)+" ms to overcome this issue");for(var C=0;C<u.length;C++){u[C].dts+=B}}var D=u[0];q=Math.max(D.dts,0);p=Math.max(D.pts,0);var E=Math.round((q-z)/90);if(d){if(E){if(E>1){h.logger.log("AVC:"+E+" ms hole between fragments detected,filling it")}else if(E<-1){h.logger.log("AVC:"+-E+" ms overlapping between fragments detected")}q=z;u[0].dts=q;p=Math.max(p-E,z);u[0].pts=p;h.logger.log("Video/PTS/DTS adjusted: "+Math.round(p/90)+"/"+Math.round(q/90)+",delta:"+E+" ms")}}r=q;D=u[u.length-1];t=Math.max(D.dts,0);s=Math.max(D.pts,0,t);if(A){m=Math.round((t-q)/(u.length-1))}var F=0,G=0;for(var H=0;H<w;H++){var I=u[H],J=I.units,K=J.length,L=0;for(var M=0;M<K;M++){L+=J[M].data.length}G+=L;F+=K;I.length=L;if(A){I.dts=q+H*m}else{I.dts=Math.max(I.dts,q)}I.pts=Math.max(I.pts,I.dts)}var N=G+4*F+8;try{n=new Uint8Array(N)}catch(a){this.observer.trigger(g.default.ERROR,{type:k.ErrorTypes.MUX_ERROR,details:k.ErrorDetails.REMUX_ALLOC_ERROR,fatal:false,bytes:N,reason:"fail allocating video mdat "+N});return}var O=new DataView(n.buffer);O.setUint32(0,N);n.set(j.default.types.mdat,4);for(var P=0;P<w;P++){var Q=u[P],R=Q.units,S=0,T=void 0;for(var U=0,V=R.length;U<V;U++){var W=R[U],X=W.data,Y=W.data.byteLength;O.setUint32(i,Y);i+=4;n.set(X,i);i+=Y;S+=4+Y}if(!A){if(P<w-1){m=u[P+1].dts-Q.dts}else{var Z=this.config,_=Q.dts-u[P>0?P-1:P].dts;if(Z.stretchShortVideoTrack){var aa=Z.maxBufferHole,ba=Z.maxSeekHole,ca=Math.floor(Math.min(aa,ba)*l),da=(e?p+e*l:this.nextAudioPts)-Q.pts;if(da>ca){m=da-_;if(m<0){m=_}h.logger.log("It is approximately "+da/90+" ms to the next segment; using duration "+m/90+" ms for the last video frame.")}else{m=_}}else{m=_}}T=Math.round(Q.pts-Q.dts)}else{T=Math.max(0,m*Math.round((Q.pts-Q.dts)/m))}v.push({size:S,duration:m,cts:T,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:Q.key?2:1,isNonSync:Q.key?0:1}})}this.nextAvcDts=t+m;var ea=b.dropped;b.len=0;b.nbNalu=0;b.dropped=0;if(v.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var fa=v[0].flags;fa.dependsOn=2;fa.isNonSync=0}b.samples=v;o=j.default.moof(b.sequenceNumber++,q,b);b.samples=[];var ga={data1:o,data2:n,startPTS:p/l,endPTS:(s+m)/l,startDTS:q/l,endDTS:this.nextAvcDts/l,type:"video",nb:v.length,dropped:ea};this.observer.trigger(g.default.FRAG_PARSING_DATA,ga);return ga}},{key:"remuxAudio",value:function a(b,c,d,f){var i=b.inputTimeScale,l=b.timescale,m=i/l,o=b.isAAC?1024:1152,p=o*m,q=this._PTSNormalize,r=this._initDTS,s=!b.isAAC&&this.typeSupported.mpeg;var t,u,v,w,x,y,z,A=b.samples,B=[],C=this.nextAudioPts;d|=A.length&&C&&(f&&Math.abs(c-C/i)<.1||Math.abs(A[0].pts-C-r)<20*p);if(!d){C=c*i}A.forEach(function(a){a.pts=a.dts=q(a.pts-r,C)});A.sort(function(a,b){return a.pts-b.pts});if(f&&b.isAAC){for(var D=0,E=C;D<A.length;){var F=A[D],G;var H=F.pts;G=H-E;var I=Math.abs(1e3*G/i);if(G<=-p){h.logger.warn("Dropping 1 audio frame @ "+(E/i).toFixed(3)+"s due to "+I+" ms overlap.");A.splice(D,1);b.len-=F.unit.length}else if(G>=p&&I<n&&E){var J=Math.round(G/p);h.logger.warn("Injecting "+J+" audio frame @ "+(E/i).toFixed(3)+"s due to "+Math.round(1e3*G/i)+" ms gap.");for(var K=0;K<J;K++){var L=Math.max(E,0);v=e.default.getSilentFrame(b.manifestCodec||b.codec,b.channelCount);if(!v){h.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead.");v=F.unit.subarray()}A.splice(D,0,{unit:v,pts:L,dts:L});b.len+=v.length;E+=p;D++}F.pts=F.dts=E;E+=p;D++}else{if(Math.abs(G)>.1*p){}F.pts=F.dts=E;E+=p;D++}}}for(var M=0,N=A.length;M<N;M++){var O=A[M];var P=O.unit;var Q=O.pts;if(z!==undefined){u.duration=Math.round((Q-z)/m)}else{var R=Math.round(1e3*(Q-C)/i),S=0;if(d&&b.isAAC){if(R){if(R>0&&R<n){S=Math.round((Q-C)/p);h.logger.log(R+" ms hole between AAC samples detected,filling it");if(S>0){v=e.default.getSilentFrame(b.manifestCodec||b.codec,b.channelCount);if(!v){v=P.subarray()}b.len+=S*v.length}}else if(R<-12){h.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(C/i).toFixed(3)+"s/"+(Q/i).toFixed(3)+"s/"+-R+"ms");b.len-=P.byteLength;continue}Q=C}}y=Math.max(0,Q);if(b.len>0){var T=s?b.len:b.len+8;t=s?0:8;try{w=new Uint8Array(T)}catch(a){this.observer.trigger(g.default.ERROR,{type:k.ErrorTypes.MUX_ERROR,details:k.ErrorDetails.REMUX_ALLOC_ERROR,fatal:false,bytes:T,reason:"fail allocating audio mdat "+T});return}if(!s){var U=new DataView(w.buffer);U.setUint32(0,T);w.set(j.default.types.mdat,4)}}else{return}for(var V=0;V<S;V++){v=e.default.getSilentFrame(b.manifestCodec||b.codec,b.channelCount);if(!v){h.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead.");v=P.subarray()}w.set(v,t);t+=v.byteLength;u={size:v.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};B.push(u)}}w.set(P,t);var W=P.byteLength;t+=W;u={size:W,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};B.push(u);z=Q}var X=0;var Y=B.length;if(Y>=2){X=B[Y-2].duration;u.duration=X}if(Y){this.nextAudioPts=C=z+m*X;b.len=0;b.samples=B;if(s){x=new Uint8Array}else{x=j.default.moof(b.sequenceNumber++,y/m,b)}b.samples=[];var Z=y/i;var _=C/i;var aa={data1:x,data2:w,startPTS:Z,endPTS:_,startDTS:Z,endDTS:_,type:"audio",nb:Y};this.observer.trigger(g.default.FRAG_PARSING_DATA,aa);return aa}return null}},{key:"remuxEmptyAudio",value:function a(b,c,d,f){var g=b.inputTimeScale,i=b.samplerate?b.samplerate:g,j=g/i,k=this.nextAudioPts,l=(k!==undefined?k:f.startDTS*g)+this._initDTS,m=f.endDTS*g+this._initDTS,n=1024,o=j*n,p=Math.ceil((m-l)/o),q=e.default.getSilentFrame(b.manifestCodec||b.codec,b.channelCount);h.logger.warn("remux empty Audio");if(!q){h.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");return}var r=[];for(var s=0;s<p;s++){var t=l+s*o;r.push({unit:q,pts:t,dts:t});b.len+=q.length}b.samples=r;this.remuxAudio(b,c,d)}},{key:"remuxID3",value:function a(b,c){var d=b.samples.length,e;var f=b.inputTimeScale;var h=this._initPTS;var i=this._initDTS;if(d){for(var j=0;j<d;j++){e=b.samples[j];e.pts=(e.pts-h)/f;e.dts=(e.dts-i)/f}this.observer.trigger(g.default.FRAG_PARSING_METADATA,{samples:b.samples})}b.samples=[];c=c}},{key:"remuxText",value:function a(b,c){b.samples.sort(function(a,b){return a.pts-b.pts});var d=b.samples.length,e;var f=b.inputTimeScale;var h=this._initPTS;if(d){for(var i=0;i<d;i++){e=b.samples[i];e.pts=(e.pts-h)/f}this.observer.trigger(g.default.FRAG_PARSING_USERDATA,{samples:b.samples})}b.samples=[];c=c}},{key:"_PTSNormalize",value:function a(b,c){var d;if(c===undefined){return b}if(c<b){d=-8589934592}else{d=8589934592}while(Math.abs(b-c)>4294967296){b+=d}return b}}]);return a}();exports.default=o},{33:33,35:35,36:36,44:44,54:54}],46:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(35);var e=f(d);function f(a){return a&&a.__esModule?a:{default:a}}function g(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var h=function(){function a(b){g(this,a);this.observer=b}c(a,[{key:"destroy",value:function a(){}},{key:"resetTimeStamp",value:function a(){}},{key:"resetInitSegment",value:function a(){}},{key:"remux",value:function a(b,c,d,f,g,h,i,j){var k=this.observer;var l="";if(b){l+="audio"}if(c){l+="video"}k.trigger(e.default.FRAG_PARSING_DATA,{data1:j,startPTS:g,startDTS:g,type:l,nb:1,dropped:0});k.trigger(e.default.FRAG_PARSED)}}]);return a}();exports.default=h},{35:35}],47:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function d(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var e=/^(\d+)x(\d+)$/;var f=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g;var g=function(){function a(b){d(this,a);if(typeof b==="string"){b=a.parseAttrList(b)}for(var c in b){if(b.hasOwnProperty(c)){this[c]=b[c]}}}c(a,[{key:"decimalInteger",value:function a(b){var c=parseInt(this[b],10);if(c>Number.MAX_SAFE_INTEGER){return Infinity}return c}},{key:"hexadecimalInteger",value:function a(b){if(this[b]){var c=(this[b]||"0x").slice(2);c=(c.length&1?"0":"")+c;var d=new Uint8Array(c.length/2);for(var e=0;e<c.length/2;e++){d[e]=parseInt(c.slice(e*2,e*2+2),16)}return d}else{return null}}},{key:"hexadecimalIntegerAsNumber",value:function a(b){var c=parseInt(this[b],16);if(c>Number.MAX_SAFE_INTEGER){return Infinity}return c}},{key:"decimalFloatingPoint",value:function a(b){return parseFloat(this[b])}},{key:"enumeratedString",value:function a(b){return this[b]}},{key:"decimalResolution",value:function a(b){var c=e.exec(this[b]);if(c===null){return undefined}return{width:parseInt(c[1],10),height:parseInt(c[2],10)}}}],[{key:"parseAttrList",value:function a(b){var c,d={};f.lastIndex=0;while((c=f.exec(b))!==null){var e=c[2],g='"';if(e.indexOf(g)===0&&e.lastIndexOf(g)===e.length-1){e=e.slice(1,-1)}d[c[1]]=e}return d}}]);return a}();exports.default=g},{}],48:[function(a,b,exports){"use strict";var c={search:function a(b,c){var d=0;var e=b.length-1;var f=null;var g=null;while(d<=e){f=(d+e)/2|0;g=b[f];var h=c(g);if(h>0){d=f+1}else if(h<0){e=f-1}else{return g}}return null}};b.exports=c},{}],49:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function d(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var e={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499};var f=function a(b){var c=b;if(e.hasOwnProperty(b)){c=e[b]}return String.fromCharCode(c)};var g=15,h=100;var i={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14};var j={17:2,18:4,21:6,22:8,23:10,19:13,20:15};var k={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14};var l={25:2,26:4,29:6,30:8,31:10,27:13,28:15};var m=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];var n={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function a(b){this.time=b},log:function a(b,c){var d=this.verboseFilter[b];if(this.verboseLevel>=d){console.log(this.time+" ["+b+"] "+c)}}};var o=function a(b){var c=[];for(var d=0;d<b.length;d++){c.push(b[d].toString(16))}return c};var p=function(){function a(b,c,e,f,g){d(this,a);this.foreground=b||"white";this.underline=c||false;this.italics=e||false;this.background=f||"black";this.flash=g||false}c(a,[{key:"reset",value:function a(){this.foreground="white";this.underline=false;this.italics=false;this.background="black";this.flash=false}},{key:"setStyles",value:function a(b){var c=["foreground","underline","italics","background","flash"];for(var d=0;d<c.length;d++){var e=c[d];if(b.hasOwnProperty(e)){this[e]=b[e]}}}},{key:"isDefault",value:function a(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}},{key:"equals",value:function a(b){return this.foreground===b.foreground&&this.underline===b.underline&&this.italics===b.italics&&this.background===b.background&&this.flash===b.flash}},{key:"copy",value:function a(b){this.foreground=b.foreground;this.underline=b.underline;this.italics=b.italics;this.background=b.background;this.flash=b.flash}},{key:"toString",value:function a(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]);return a}();var q=function(){function a(b,c,e,f,g,h){d(this,a);this.uchar=b||" ";this.penState=new p(c,e,f,g,h)}c(a,[{key:"reset",value:function a(){this.uchar=" ";this.penState.reset()}},{key:"setChar",value:function a(b,c){this.uchar=b;this.penState.copy(c)}},{key:"setPenState",value:function a(b){this.penState.copy(b)}},{key:"equals",value:function a(b){return this.uchar===b.uchar&&this.penState.equals(b.penState)}},{key:"copy",value:function a(b){this.uchar=b.uchar;this.penState.copy(b.penState)}},{key:"isEmpty",value:function a(){return this.uchar===" "&&this.penState.isDefault()}}]);return a}();var r=function(){function a(){d(this,a);this.chars=[];for(var b=0;b<h;b++){this.chars.push(new q)}this.pos=0;this.currPenState=new p}c(a,[{key:"equals",value:function a(b){var c=true;for(var d=0;d<h;d++){if(!this.chars[d].equals(b.chars[d])){c=false;break}}return c}},{key:"copy",value:function a(b){for(var c=0;c<h;c++){this.chars[c].copy(b.chars[c])}}},{key:"isEmpty",value:function a(){var b=true;for(var c=0;c<h;c++){if(!this.chars[c].isEmpty()){b=false;break}}return b}},{key:"setCursor",value:function a(b){if(this.pos!==b){this.pos=b}if(this.pos<0){n.log("ERROR","Negative cursor position "+this.pos);this.pos=0}else if(this.pos>h){n.log("ERROR","Too large cursor position "+this.pos);this.pos=h}}},{key:"moveCursor",value:function a(b){var c=this.pos+b;if(b>1){for(var d=this.pos+1;d<c+1;d++){this.chars[d].setPenState(this.currPenState)}}this.setCursor(c)}},{key:"backSpace",value:function a(){this.moveCursor(-1);this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function a(b){if(b>=144){this.backSpace()}var c=f(b);if(this.pos>=h){n.log("ERROR","Cannot insert "+b.toString(16)+" ("+c+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(c,this.currPenState);this.moveCursor(1)}},{key:"clearFromPos",value:function a(b){var c;for(c=b;c<h;c++){this.chars[c].reset()}}},{key:"clear",value:function a(){this.clearFromPos(0);this.pos=0;this.currPenState.reset()}},{key:"clearToEndOfRow",value:function a(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function a(){var b=[];var c=true;for(var d=0;d<h;d++){var e=this.chars[d].uchar;if(e!==" "){c=false}b.push(e)}if(c){return""}else{return b.join("")}}},{key:"setPenStyles",value:function a(b){this.currPenState.setStyles(b);var c=this.chars[this.pos];c.setPenState(this.currPenState)}}]);return a}();var s=function(){function a(){d(this,a);this.rows=[];for(var b=0;b<g;b++){this.rows.push(new r)}this.currRow=g-1;this.nrRollUpRows=null;this.reset()}c(a,[{key:"reset",value:function a(){for(var b=0;b<g;b++){this.rows[b].clear()}this.currRow=g-1}},{key:"equals",value:function a(b){var c=true;for(var d=0;d<g;d++){if(!this.rows[d].equals(b.rows[d])){c=false;break}}return c}},{key:"copy",value:function a(b){for(var c=0;c<g;c++){this.rows[c].copy(b.rows[c])}}},{key:"isEmpty",value:function a(){var b=true;for(var c=0;c<g;c++){if(!this.rows[c].isEmpty()){b=false;break}}return b}},{key:"backSpace",value:function a(){var b=this.rows[this.currRow];b.backSpace()}},{key:"clearToEndOfRow",value:function a(){var b=this.rows[this.currRow];b.clearToEndOfRow()}},{key:"insertChar",value:function a(b){var c=this.rows[this.currRow];c.insertChar(b)}},{key:"setPen",value:function a(b){var c=this.rows[this.currRow];c.setPenStyles(b)}},{key:"moveCursor",value:function a(b){var c=this.rows[this.currRow];c.moveCursor(b)}},{key:"setCursor",value:function a(b){n.log("INFO","setCursor: "+b);var c=this.rows[this.currRow];c.setCursor(b)}},{key:"setPAC",value:function a(b){n.log("INFO","pacData = "+JSON.stringify(b));var c=b.row-1;if(this.nrRollUpRows&&c<this.nrRollUpRows-1){c=this.nrRollUpRows-1}if(this.nrRollUpRows&&this.currRow!==c){for(var d=0;d<g;d++){this.rows[d].clear()}var e=this.currRow+1-this.nrRollUpRows;var f=this.lastOutputScreen;if(f){var h=f.rows[e].cueStartTime;if(h&&h<n.time){for(var i=0;i<this.nrRollUpRows;i++){this.rows[c-this.nrRollUpRows+i+1].copy(f.rows[e+i])}}}}this.currRow=c;var j=this.rows[this.currRow];if(b.indent!==null){var k=b.indent;var l=Math.max(k-1,0);j.setCursor(b.indent);b.color=j.chars[l].penState.foreground}var m={foreground:b.color,underline:b.underline,italics:b.italics,background:"black",flash:false};this.setPen(m)}},{key:"setBkgData",value:function a(b){n.log("INFO","bkgData = "+JSON.stringify(b));this.backSpace();this.setPen(b);this.insertChar(32)}},{key:"setRollUpRows",value:function a(b){this.nrRollUpRows=b}},{key:"rollUp",value:function a(){if(this.nrRollUpRows===null){n.log("DEBUG","roll_up but nrRollUpRows not set yet");return}n.log("TEXT",this.getDisplayText());var b=this.currRow+1-this.nrRollUpRows;var c=this.rows.splice(b,1)[0];c.clear();this.rows.splice(this.currRow,0,c);n.log("INFO","Rolling up")}},{key:"getDisplayText",value:function a(b){b=b||false;var c=[];var d="";var e=-1;for(var f=0;f<g;f++){var h=this.rows[f].getTextString();if(h){e=f+1;if(b){c.push("Row "+e+": '"+h+"'")}else{c.push(h.trim())}}}if(c.length>0){if(b){d="["+c.join(" | ")+"]"}else{d=c.join("\n")}}return d}},{key:"getTextAndFormat",value:function a(){return this.rows}}]);return a}();var t=function(){function a(b,c){d(this,a);this.chNr=b;this.outputFilter=c;this.mode=null;this.verbose=0;this.displayedMemory=new s;this.nonDisplayedMemory=new s;this.lastOutputScreen=new s;this.currRollUpRow=this.displayedMemory.rows[g-1];this.writeScreen=this.displayedMemory;this.mode=null;this.cueStartTime=null}c(a,[{key:"reset",value:function a(){this.mode=null;this.displayedMemory.reset();this.nonDisplayedMemory.reset();this.lastOutputScreen.reset();this.currRollUpRow=this.displayedMemory.rows[g-1];this.writeScreen=this.displayedMemory;this.mode=null;this.cueStartTime=null;this.lastCueEndTime=null}},{key:"getHandler",value:function a(){return this.outputFilter}},{key:"setHandler",value:function a(b){this.outputFilter=b}},{key:"setPAC",value:function a(b){this.writeScreen.setPAC(b)}},{key:"setBkgData",value:function a(b){this.writeScreen.setBkgData(b)}},{key:"setMode",value:function a(b){if(b===this.mode){return}this.mode=b;n.log("INFO","MODE="+b);if(this.mode==="MODE_POP-ON"){this.writeScreen=this.nonDisplayedMemory}else{this.writeScreen=this.displayedMemory;this.writeScreen.reset()}if(this.mode!=="MODE_ROLL-UP"){this.displayedMemory.nrRollUpRows=null;this.nonDisplayedMemory.nrRollUpRows=null}this.mode=b}},{key:"insertChars",value:function a(b){for(var c=0;c<b.length;c++){this.writeScreen.insertChar(b[c])}var d=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";n.log("INFO",d+": "+this.writeScreen.getDisplayText(true));if(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP"){n.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(true));this.outputDataUpdate()}}},{key:"ccRCL",value:function a(){n.log("INFO","RCL - Resume Caption Loading");this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function a(){n.log("INFO","BS - BackSpace");if(this.mode==="MODE_TEXT"){return}this.writeScreen.backSpace();if(this.writeScreen===this.displayedMemory){this.outputDataUpdate()}}},{key:"ccAOF",value:function a(){return}},{key:"ccAON",value:function a(){return}},{key:"ccDER",value:function a(){n.log("INFO","DER- Delete to End of Row");this.writeScreen.clearToEndOfRow();this.outputDataUpdate()}},{key:"ccRU",value:function a(b){n.log("INFO","RU("+b+") - Roll Up");this.writeScreen=this.displayedMemory;this.setMode("MODE_ROLL-UP");this.writeScreen.setRollUpRows(b)}},{key:"ccFON",value:function a(){n.log("INFO","FON - Flash On");this.writeScreen.setPen({flash:true})}},{key:"ccRDC",value:function a(){n.log("INFO","RDC - Resume Direct Captioning");this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function a(){n.log("INFO","TR");this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function a(){n.log("INFO","RTD");this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function a(){n.log("INFO","EDM - Erase Displayed Memory");this.displayedMemory.reset();this.outputDataUpdate()}},{key:"ccCR",value:function a(){n.log("CR - Carriage Return");this.writeScreen.rollUp();this.outputDataUpdate()}},{key:"ccENM",value:function a(){n.log("INFO","ENM - Erase Non-displayed Memory");this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function a(){n.log("INFO","EOC - End Of Caption");if(this.mode==="MODE_POP-ON"){var b=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory;this.nonDisplayedMemory=b;this.writeScreen=this.nonDisplayedMemory;n.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function a(b){n.log("INFO","TO("+b+") - Tab Offset");this.writeScreen.moveCursor(b)}},{key:"ccMIDROW",value:function a(b){var c={flash:false};c.underline=b%2===1;c.italics=b>=46;if(!c.italics){var d=Math.floor(b/2)-16;var e=["white","green","blue","cyan","red","yellow","magenta"];c.foreground=e[d]}else{c.foreground="white"}n.log("INFO","MIDROW: "+JSON.stringify(c));this.writeScreen.setPen(c)}},{key:"outputDataUpdate",value:function a(){var b=n.time;if(b===null){return}if(this.outputFilter){if(this.outputFilter.updateData){this.outputFilter.updateData(b,this.displayedMemory)}if(this.cueStartTime===null&&!this.displayedMemory.isEmpty()){this.cueStartTime=b}else{if(!this.displayedMemory.equals(this.lastOutputScreen)){if(this.outputFilter.newCue){this.outputFilter.newCue(this.cueStartTime,b,this.lastOutputScreen)}this.cueStartTime=this.displayedMemory.isEmpty()?null:b}}this.lastOutputScreen.copy(this.displayedMemory)}}},{key:"cueSplitAtTime",value:function a(b){if(this.outputFilter){if(!this.displayedMemory.isEmpty()){if(this.outputFilter.newCue){this.outputFilter.newCue(this.cueStartTime,b,this.displayedMemory)}this.cueStartTime=b}}}}]);return a}();var u=function(){function a(b,c,e){d(this,a);this.field=b||1;this.outputs=[c,e];this.channels=[new t(1,c),new t(2,e)];this.currChNr=-1;this.lastCmdA=null;this.lastCmdB=null;this.bufferedData=[];this.startTime=null;this.lastTime=null;this.dataCounters={padding:0,char:0,cmd:0,other:0}}c(a,[{key:"getHandler",value:function a(b){return this.channels[b].getHandler()}},{key:"setHandler",value:function a(b,c){this.channels[b].setHandler(c)}},{key:"addData",value:function a(b,c){var d,e,f,g=false;this.lastTime=b;n.setTime(b);for(var h=0;h<c.length;h+=2){e=c[h]&127;f=c[h+1]&127;if(e===0&&f===0){this.dataCounters.padding+=2;continue}else{n.log("DATA","["+o([c[h],c[h+1]])+"] -> ("+o([e,f])+")")}d=this.parseCmd(e,f);if(!d){d=this.parseMidrow(e,f)}if(!d){d=this.parsePAC(e,f)}if(!d){d=this.parseBackgroundAttributes(e,f)}if(!d){g=this.parseChars(e,f);if(g){if(this.currChNr&&this.currChNr>=0){var i=this.channels[this.currChNr-1];i.insertChars(g)}else{n.log("WARNING","No channel found yet. TEXT-MODE?")}}}if(d){this.dataCounters.cmd+=2}else if(g){this.dataCounters.char+=2}else{this.dataCounters.other+=2;n.log("WARNING","Couldn't parse cleaned data "+o([e,f])+" orig: "+o([c[h],c[h+1]]))}}}},{key:"parseCmd",value:function a(b,c){var d=null;var e=(b===20||b===28)&&32<=c&&c<=47;var f=(b===23||b===31)&&33<=c&&c<=35;if(!(e||f)){return false}if(b===this.lastCmdA&&c===this.lastCmdB){this.lastCmdA=null;this.lastCmdB=null;n.log("DEBUG","Repeated command ("+o([b,c])+") is dropped");return true}if(b===20||b===23){d=1}else{d=2}var g=this.channels[d-1];if(b===20||b===28){if(c===32){g.ccRCL()}else if(c===33){g.ccBS()}else if(c===34){g.ccAOF()}else if(c===35){g.ccAON()}else if(c===36){g.ccDER()}else if(c===37){g.ccRU(2)}else if(c===38){g.ccRU(3)}else if(c===39){g.ccRU(4)}else if(c===40){g.ccFON()}else if(c===41){g.ccRDC()}else if(c===42){g.ccTR()}else if(c===43){g.ccRTD()}else if(c===44){g.ccEDM()}else if(c===45){g.ccCR()}else if(c===46){g.ccENM()}else if(c===47){g.ccEOC()}}else{g.ccTO(c-32)}this.lastCmdA=b;this.lastCmdB=c;this.currChNr=d;return true}},{key:"parseMidrow",value:function a(b,c){var d=null;if((b===17||b===25)&&32<=c&&c<=47){if(b===17){d=1}else{d=2}if(d!==this.currChNr){n.log("ERROR","Mismatch channel in midrow parsing");return false}var e=this.channels[d-1];e.ccMIDROW(c);n.log("DEBUG","MIDROW ("+o([b,c])+")");return true}return false}},{key:"parsePAC",value:function a(b,c){var d=null;var e=null;var f=(17<=b&&b<=23||25<=b&&b<=31)&&64<=c&&c<=127;var g=(b===16||b===24)&&64<=c&&c<=95;if(!(f||g)){return false}if(b===this.lastCmdA&&c===this.lastCmdB){this.lastCmdA=null;this.lastCmdB=null;return true}d=b<=23?1:2;if(64<=c&&c<=95){e=d===1?i[b]:k[b]}else{e=d===1?j[b]:l[b]}var h=this.interpretPAC(e,c);var m=this.channels[d-1];m.setPAC(h);this.lastCmdA=b;this.lastCmdB=c;this.currChNr=d;return true}},{key:"interpretPAC",value:function a(b,c){var d=c;var e={color:null,italics:false,indent:null,underline:false,row:b};if(c>95){d=c-96}else{d=c-64}e.underline=(d&1)===1;if(d<=13){e.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(d/2)]}else if(d<=15){e.italics=true;e.color="white"}else{e.indent=Math.floor((d-16)/2)*4}return e}},{key:"parseChars",value:function a(b,c){var d=null,e=null,g=null;if(b>=25){d=2;g=b-8}else{d=1;g=b}if(17<=g&&g<=19){var h=c;if(g===17){h=c+80}else if(g===18){h=c+112}else{h=c+144}n.log("INFO","Special char '"+f(h)+"' in channel "+d);e=[h]}else if(32<=b&&b<=127){e=c===0?[b]:[b,c]}if(e){var i=o(e);n.log("DEBUG","Char codes =  "+i.join(","));this.lastCmdA=null;this.lastCmdB=null}return e}},{key:"parseBackgroundAttributes",value:function a(b,c){var d,e,f,g;var h=(b===16||b===24)&&32<=c&&c<=47;var i=(b===23||b===31)&&45<=c&&c<=47;if(!(h||i)){return false}d={};if(b===16||b===24){e=Math.floor((c-32)/2);d.background=m[e];if(c%2===1){d.background=d.background+"_semi"}}else if(c===45){d.background="transparent"}else{d.foreground="black";if(c===47){d.underline=true}}f=b<24?1:2;g=this.channels[f-1];g.setBkgData(d);this.lastCmdA=null;this.lastCmdB=null;return true}},{key:"reset",value:function a(){for(var b=0;b<this.channels.length;b++){if(this.channels[b]){this.channels[b].reset()}}this.lastCmdA=null;this.lastCmdB=null}},{key:"cueSplitAtTime",value:function a(b){for(var c=0;c<this.channels.length;c++){if(this.channels[c]){this.channels[c].cueSplitAtTime(b)}}}}]);return a}();exports.default=u},{}],50:[function(a,b,exports){"use strict";var c=a(57);var d={newCue:function a(b,d,e,f){var g;var h;var i;var j;var k;var l=window.VTTCue||window.TextTrackCue;for(var m=0;m<f.rows.length;m++){g=f.rows[m];i=true;j=0;k="";if(!g.isEmpty()){for(var n=0;n<g.chars.length;n++){if(g.chars[n].uchar.match(/\s/)&&i){j++}else{k+=g.chars[n].uchar;i=false}}g.cueStartTime=d;if(d===e){e+=1e-4}h=new l(d,e,(0,c.fixLineBreaks)(k.trim()));if(j>=16){j--}else{j++}if(navigator.userAgent.match(/Firefox\//)){h.line=m+1}else{h.line=m>7?m-2:m+1}h.align="left";h.position=Math.max(0,Math.min(100,100*(j/32)+(navigator.userAgent.match(/Firefox\//)?50:0)));b.addCue(h)}}}};b.exports=d},{57:57}],51:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.findFragWithCC=f;var c=a(48);var d=e(c);function e(a){return a&&a.__esModule?a:{default:a}}function f(a,b){return d.default.search(a,function(a){if(a.cc<b){return 1}else if(a.cc>b){return-1}else{return 0}})}},{48:48}],52:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(53);var e=f(d);function f(a){return a&&a.__esModule?a:{default:a}}function g(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var h=function(){function a(b,c,d,f){g(this,a);this.hls=b;this.defaultEstimate_=f;this.minWeight_=.001;this.minDelayMs_=50;this.slow_=new e.default(c);this.fast_=new e.default(d)}c(a,[{key:"sample",value:function a(b,c){b=Math.max(b,this.minDelayMs_);var d=8e3*c/b,e=b/1e3;this.fast_.sample(e,d);this.slow_.sample(e,d)}},{key:"canEstimate",value:function a(){var b=this.fast_;return b&&b.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function a(){if(this.canEstimate()){return Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())}else{return this.defaultEstimate_}}},{key:"destroy",value:function a(){}}]);return a}();exports.default=h},{53:53}],53:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function d(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var e=function(){function a(b){d(this,a);this.alpha_=b?Math.exp(Math.log(.5)/b):0;this.estimate_=0;this.totalWeight_=0}c(a,[{key:"sample",value:function a(b,c){var d=Math.pow(this.alpha_,b);this.estimate_=c*(1-d)+d*this.estimate_;this.totalWeight_+=b}},{key:"getTotalWeight",value:function a(){return this.totalWeight_}},{key:"getEstimate",value:function a(){if(this.alpha_){var b=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/b}else{return this.estimate_}}}]);return a}();exports.default=e},{}],54:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function d(){}var e={trace:d,debug:d,log:d,warn:d,info:d,error:d};var f=e;function g(a,b){b="["+a+"] > "+b;return b}function h(a){var b=self.console[a];if(b){return function(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++){d[e]=arguments[e]}if(d[0]){d[0]=g(a,d[0])}b.apply(self.console,d)}}return d}function i(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++){c[d-1]=arguments[d]}c.forEach(function(b){f[b]=a[b]?a[b].bind(a):h(b)})}var j=exports.enableLogs=function a(b){if(b===true||(typeof b==="undefined"?"undefined":c(b))==="object"){i(b,"debug","log","info","warn","error");try{f.log()}catch(a){f=e}}else{f=e}};var k=exports.logger=f},{}],55:[function(a,b,exports){"use strict";var c={toString:function a(b){var c="",d=b.length;for(var e=0;e<d;e++){c+="["+b.start(e).toFixed(3)+","+b.end(e).toFixed(3)+"]"}return c}};b.exports=c},{}],56:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){if(typeof window!=="undefined"&&window.VTTCue){return window.VTTCue}var a="auto";var b={"":true,lr:true,rl:true};var c={start:true,middle:true,end:true,left:true,right:true};function d(a){if(typeof a!=="string"){return false}var c=b[a.toLowerCase()];return c?a.toLowerCase():false}function e(a){if(typeof a!=="string"){return false}var b=c[a.toLowerCase()];return b?a.toLowerCase():false}function f(a){var b=1;for(;b<arguments.length;b++){var c=arguments[b];for(var d in c){a[d]=c[d]}}return a}function g(b,c,g){var h=this;var i=function(){if(typeof navigator==="undefined"){return}return/MSIE\s8\.0/.test(navigator.userAgent)}();var j={};if(i){h=document.createElement("custom")}else{j.enumerable=true}h.hasBeenReset=false;var k="";var l=false;var m=b;var n=c;var o=g;var p=null;var q="";var r=true;var s="auto";var t="start";var u=50;var v="middle";var w=50;var x="middle";Object.defineProperty(h,"id",f({},j,{get:function a(){return k},set:function a(b){k=""+b}}));Object.defineProperty(h,"pauseOnExit",f({},j,{get:function a(){return l},set:function a(b){l=!!b}}));Object.defineProperty(h,"startTime",f({},j,{get:function a(){return m},set:function a(b){if(typeof b!=="number"){throw new TypeError("Start time must be set to a number.")}m=b;this.hasBeenReset=true}}));Object.defineProperty(h,"endTime",f({},j,{get:function a(){return n},set:function a(b){if(typeof b!=="number"){throw new TypeError("End time must be set to a number.")}n=b;this.hasBeenReset=true}}));Object.defineProperty(h,"text",f({},j,{get:function a(){return o},set:function a(b){o=""+b;this.hasBeenReset=true}}));Object.defineProperty(h,"region",f({},j,{get:function a(){return p},set:function a(b){p=b;this.hasBeenReset=true}}));Object.defineProperty(h,"vertical",f({},j,{get:function a(){return q},set:function a(b){var c=d(b);if(c===false){throw new SyntaxError("An invalid or illegal string was specified.")}q=c;this.hasBeenReset=true}}));Object.defineProperty(h,"snapToLines",f({},j,{get:function a(){return r},set:function a(b){r=!!b;this.hasBeenReset=true}}));Object.defineProperty(h,"line",f({},j,{get:function a(){return s},set:function b(c){if(typeof c!=="number"&&c!==a){throw new SyntaxError("An invalid number or illegal string was specified.")}s=c;this.hasBeenReset=true}}));Object.defineProperty(h,"lineAlign",f({},j,{get:function a(){return t},set:function a(b){var c=e(b);if(!c){throw new SyntaxError("An invalid or illegal string was specified.")}t=c;this.hasBeenReset=true}}));Object.defineProperty(h,"position",f({},j,{get:function a(){return u},set:function a(b){if(b<0||b>100){throw new Error("Position must be between 0 and 100.")}u=b;this.hasBeenReset=true}}));Object.defineProperty(h,"positionAlign",f({},j,{get:function a(){return v},set:function a(b){var c=e(b);if(!c){throw new SyntaxError("An invalid or illegal string was specified.")}v=c;this.hasBeenReset=true}}));Object.defineProperty(h,"size",f({},j,{get:function a(){return w},set:function a(b){if(b<0||b>100){throw new Error("Size must be between 0 and 100.")}w=b;this.hasBeenReset=true}}));Object.defineProperty(h,"align",f({},j,{get:function a(){return x},set:function a(b){var c=e(b);if(!c){throw new SyntaxError("An invalid or illegal string was specified.")}x=c;this.hasBeenReset=true}}));h.displayState=undefined;if(i){return h}}g.prototype.getCueAsHTML=function(){var a=window.WebVTT;return a.convertCueToDOMTree(window,this.text)};return g}()},{}],57:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fixLineBreaks=undefined;var c=a(56);var d=e(c);function e(a){return a&&a.__esModule?a:{default:a}}var f=function a(){return{decode:function a(b){if(!b){return""}if(typeof b!=="string"){throw new Error("Error - expected string data.")}return decodeURIComponent(encodeURIComponent(b))}}};function g(){this.window=window;this.state="INITIAL";this.buffer="";this.decoder=new f;this.regionList=[]}function h(a){function b(a,b,c,d){return(a|0)*3600+(b|0)*60+(c|0)+(d|0)/1e3}var c=a.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);if(!c){return null}if(c[3]){return b(c[1],c[2],c[3].replace(":",""),c[4])}else if(c[1]>59){return b(c[1],c[2],0,c[4])}else{return b(0,c[1],c[2],c[4])}}function i(){this.values=Object.create(null)}i.prototype={set:function a(b,c){if(!this.get(b)&&c!==""){this.values[b]=c}},get:function a(b,c,d){if(d){return this.has(b)?this.values[b]:c[d]}return this.has(b)?this.values[b]:c},has:function a(b){return b in this.values},alt:function a(b,c,d){for(var e=0;e<d.length;++e){if(c===d[e]){this.set(b,c);break}}},integer:function a(b,c){if(/^-?\d+$/.test(c)){this.set(b,parseInt(c,10))}},percent:function a(b,c){var d;if(d=c.match(/^([\d]{1,3})(\.[\d]*)?%$/)){c=parseFloat(c);if(c>=0&&c<=100){this.set(b,c);return true}}return false}};function j(a,b,c,d){var e=d?a.split(d):[a];for(var f in e){if(typeof e[f]!=="string"){continue}var g=e[f].split(c);if(g.length!==2){continue}var h=g[0];var i=g[1];b(h,i)}}var k=new d.default(0,0,0);var l=k.align==="middle"?"middle":"center";function m(a,b,c){var d=a;function e(){var b=h(a);if(b===null){throw new Error("Malformed timestamp: "+d)}a=a.replace(/^[^\sa-zA-Z-]+/,"");return b}function f(a,b){var d=new i;j(a,function(a,b){switch(a){case"region":for(var e=c.length-1;e>=0;e--){if(c[e].id===b){d.set(a,c[e].region);break}}break;case"vertical":d.alt(a,b,["rl","lr"]);break;case"line":var f=b.split(","),g=f[0];d.integer(a,g);if(d.percent(a,g)){d.set("snapToLines",false)}d.alt(a,g,["auto"]);if(f.length===2){d.alt("lineAlign",f[1],["start",l,"end"])}break;case"position":f=b.split(",");d.percent(a,f[0]);if(f.length===2){d.alt("positionAlign",f[1],["start",l,"end","line-left","line-right","auto"])}break;case"size":d.percent(a,b);break;case"align":d.alt(a,b,["start",l,"end","left","right"]);break}},/:/,/\s/);b.region=d.get("region",null);b.vertical=d.get("vertical","");var e=d.get("line","auto");if(e==="auto"&&k.line===-1){e=-1}b.line=e;b.lineAlign=d.get("lineAlign","start");b.snapToLines=d.get("snapToLines",true);b.size=d.get("size",100);b.align=d.get("align",l);var f=d.get("position","auto");if(f==="auto"&&k.position===50){f=b.align==="start"||b.align==="left"?0:b.align==="end"||b.align==="right"?100:50}b.position=f}function g(){a=a.replace(/^\s+/,"")}g();b.startTime=e();g();if(a.substr(0,3)!=="--\x3e"){throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+d)}a=a.substr(3);g();b.endTime=e();g();f(a,b)}function n(a){return a.replace(/<br(?: \/)?>/gi,"\n")}g.prototype={parse:function a(b){var c=this;if(b){c.buffer+=c.decoder.decode(b,{stream:true})}function e(){var a=c.buffer;var b=0;a=n(a);while(b<a.length&&a[b]!=="\r"&&a[b]!=="\n"){++b}var d=a.substr(0,b);if(a[b]==="\r"){++b}if(a[b]==="\n"){++b}c.buffer=a.substr(b);return d}function f(a){j(a,function(a,b){switch(a){case"Region":console.log("parse region",b);break}},/:/)}try{var g;if(c.state==="INITIAL"){if(!/\r\n|\n/.test(c.buffer)){return this}g=e();var h=g.match(/^WEBVTT([ \t].*)?$/);if(!h||!h[0]){throw new Error("Malformed WebVTT signature.")}c.state="HEADER"}var i=false;while(c.buffer){if(!/\r\n|\n/.test(c.buffer)){return this}if(!i){g=e()}else{i=false}switch(c.state){case"HEADER":if(/:/.test(g)){f(g)}else if(!g){c.state="ID"}continue;case"NOTE":if(!g){c.state="ID"}continue;case"ID":if(/^NOTE($|[ \t])/.test(g)){c.state="NOTE";break}if(!g){continue}c.cue=new d.default(0,0,"");c.state="CUE";if(g.indexOf("--\x3e")===-1){c.cue.id=g;continue}case"CUE":try{m(g,c.cue,c.regionList)}catch(a){c.cue=null;c.state="BADCUE";continue}c.state="CUETEXT";continue;case"CUETEXT":var k=g.indexOf("--\x3e")!==-1;if(!g||k&&(i=true)){if(c.oncue){c.oncue(c.cue)}c.cue=null;c.state="ID";continue}if(c.cue.text){c.cue.text+="\n"}c.cue.text+=g;continue;case"BADCUE":if(!g){c.state="ID"}continue}}}catch(a){if(c.state==="CUETEXT"&&c.cue&&c.oncue){c.oncue(c.cue)}c.cue=null;c.state=c.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function a(){var b=this;try{b.buffer+=b.decoder.decode();if(b.cue||b.state==="HEADER"){b.buffer+="\n\n";b.parse()}if(b.state==="INITIAL"){throw new Error("Malformed WebVTT signature.")}}catch(a){throw a}if(b.onflush){b.onflush()}return this}};exports.fixLineBreaks=n;exports.default=g},{56:56}],58:[function(a,b,exports){"use strict";var c=a(57);var d=e(c);function e(a){return a&&a.__esModule?a:{default:a}}var f=function a(b,c,d){return b.substr(d||0,c.length)===c};var g=function a(b){var c=parseInt(b.substr(-3));var d=parseInt(b.substr(-6,2));var e=parseInt(b.substr(-9,2));var f=b.length>9?parseInt(b.substr(0,b.indexOf(":"))):0;if(isNaN(c)||isNaN(d)||isNaN(e)||isNaN(f)){return-1}c+=1e3*d;c+=60*1e3*e;c+=60*60*1e3*f;return c};var h=function a(b){var a=5381;var c=b.length;while(c){a=a*33^b.charCodeAt(--c)}return(a>>>0).toString()};var i=function a(b,c,d){var e=b[c];var f=b[e.prevCC];if(!f||!f.new&&e.new){b.ccOffset=b.presentationOffset=e.start;e.new=false;return}while(f&&f.new){b.ccOffset+=e.start-f.start;e.new=false;e=f;f=b[e.prevCC]}b.presentationOffset=d};var j={parse:function a(b,c,e,j,k,l){var m=/\r\n|\n\r|\n|\r/g;var n=String.fromCharCode.apply(null,new Uint8Array(b)).trim().replace(m,"\n").split("\n");var o="00:00.000";var p=0;var q=0;var r=0;var s=[];var t=void 0;var u=true;var v=new d.default;v.oncue=function(a){var b=e[j];var c=e.ccOffset;if(b&&b.new){if(q!==undefined){c=e.ccOffset=b.start}else{i(e,j,r)}}if(r){c=r+e.ccOffset-e.presentationOffset}a.startTime+=c-q;a.endTime+=c-q;a.id=h(a.startTime)+h(a.endTime)+h(a.text);a.text=decodeURIComponent(escape(a.text));if(a.endTime>0){s.push(a)}};v.onparsingerror=function(a){t=a};v.onflush=function(){if(t&&l){l(t);return}k(s)};n.forEach(function(a){if(u){if(f(a,"X-TIMESTAMP-MAP=")){u=false;a.substr(16).split(",").forEach(function(a){if(f(a,"LOCAL:")){o=a.substr(6)}else if(f(a,"MPEGTS:")){p=parseInt(a.substr(7))}});try{c=c<0?c+8589934592:c;p-=c;q=g(o)/1e3;r=p/9e4;if(q===-1){t=new Error("Malformed X-TIMESTAMP-MAP: "+a)}}catch(b){t=new Error("Malformed X-TIMESTAMP-MAP: "+a)}return}else if(a===""){u=false}}v.parse(a+"\n")});v.flush()}};b.exports=j},{57:57}],59:[function(a,b,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var d=a(54);function e(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var f=function(){function a(b){e(this,a);if(b&&b.xhrSetup){this.xhrSetup=b.xhrSetup}}c(a,[{key:"destroy",value:function a(){this.abort();this.loader=null}},{key:"abort",value:function a(){var b=this.loader;if(b&&b.readyState!==4){this.stats.aborted=true;b.abort()}window.clearTimeout(this.requestTimeout);this.requestTimeout=null;window.clearTimeout(this.retryTimeout);this.retryTimeout=null}},{key:"load",value:function a(b,c,d){this.context=b;this.config=c;this.callbacks=d;this.stats={trequest:performance.now(),retry:0};this.retryDelay=c.retryDelay;this.loadInternal()}},{key:"loadInternal",value:function a(){var b,c=this.context;if(typeof XDomainRequest!=="undefined"){b=this.loader=new XDomainRequest}else{b=this.loader=new XMLHttpRequest}var d=this.stats;d.tfirst=0;d.loaded=0;var e=this.xhrSetup;try{if(e){try{e(b,c.url)}catch(a){b.open("GET",c.url,true);e(b,c.url)}}if(!b.readyState){b.open("GET",c.url,true)}}catch(a){this.callbacks.onError({code:b.status,text:a.message},c,b);return}if(c.rangeEnd){b.setRequestHeader("Range","bytes="+c.rangeStart+"-"+(c.rangeEnd-1))}b.onreadystatechange=this.readystatechange.bind(this);b.onprogress=this.loadprogress.bind(this);b.responseType=c.responseType;this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout);b.send()}},{key:"readystatechange",value:function a(b){var c=b.currentTarget,e=c.readyState,f=this.stats,g=this.context,h=this.config;if(f.aborted){return}if(e>=2){window.clearTimeout(this.requestTimeout);if(f.tfirst===0){f.tfirst=Math.max(performance.now(),f.trequest)}if(e===4){var i=c.status;if(i>=200&&i<300){f.tload=Math.max(f.tfirst,performance.now());var j=void 0,k=void 0;if(g.responseType==="arraybuffer"){j=c.response;k=j.byteLength}else{j=c.responseText;k=j.length}f.loaded=f.total=k;var l={url:c.responseURL,data:j};this.callbacks.onSuccess(l,f,g,c)}else{if(f.retry>=h.maxRetry||i>=400&&i<499){d.logger.error(i+" while loading "+g.url);this.callbacks.onError({code:i,text:c.statusText},g,c)}else{d.logger.warn(i+" while loading "+g.url+", retrying in "+this.retryDelay+"...");this.destroy();this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay);this.retryDelay=Math.min(2*this.retryDelay,h.maxRetryDelay);f.retry++}}}else{this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),h.timeout)}}}},{key:"loadtimeout",value:function a(){d.logger.warn("timeout while loading "+this.context.url);this.callbacks.onTimeout(this.stats,this.context,null)}},{key:"loadprogress",value:function a(b){var c=b.currentTarget,d=this.stats;d.loaded=b.loaded;if(b.lengthComputable){d.total=b.total}var e=this.callbacks.onProgress;if(e){e(d,this.context,null,c)}}}]);return a}();exports.default=f},{54:54}]},{},[40])(40)});define("hls.js",["hls.js/./dist/hls"],function(a){return a});define("turntable/plugins/JSHLS/HlsMediaEvent",function(require,exports,a){"use strict";function b(a,b){var c=document.createEvent("HTMLEvents");if(!b){b={cancelable:false,bubbles:false}}c.initEvent(a,b.bubbles,b.cancelable);for(var d in b){c[d]=b[d]}return c}try{new Event("test",{});a.exports=Event}catch(c){a.exports=b}});define("turntable/plugins/JSHLS/HlsMediaError",function(require,exports,a){"use strict";var b=require("turntable/tools/assign");var c=require("hls.js");function d(a){var e;var f=a.type;var g=c.ErrorTypes;switch(f){case g.NETWORK_ERROR:e=d.MEDIA_ERR_NETWORK;break;case g.MEDIA_ERROR:e=d.MEDIA_ERR_MEDIA;break;case g.MUX_ERROR:e=d.MEDIA_ERR_MUX;break;case g.OTHER_ERROR:e=d.MEDIA_ERR_OTHER;break;default:e=d.MEDIA_ERR_UNKNOWN}this.code=e;this.message=f;b(this,a)}b(d,{MEDIA_ERR_NETWORK:2,MEDIA_ERR_MEDIA:100,MEDIA_ERR_MUX:101,MEDIA_ERR_OTHER:102,MEDIA_ERR_UNKNOWN:103,getHlsErrorDetails:function(a){var b={type:a.type,details:a.details,fatal:a.fatal};if(a.networkDetails){b.networkDetails={status:a.networkDetails.status,readyState:a.networkDetails.readyState}}if(a.frag){b.frag={url:a.frag.url,autoLevel:a.frag.autoLevel,duration:a.frag.duration,loadCounter:a.frag.loadCounter};if(a.frag.loader){b.frag.loader={};if(a.frag.loader.stats){b.frag.loader.stats={aborted:Boolean(a.frag.loader.stats.aborted),loaded:a.frag.loader.stats.loaded,retry:a.frag.loader.stats.retry,tfirst:a.frag.loader.stats.tfirst,trequest:a.frag.loader.stats.trequest}}}}return b}});b(d.prototype,{isHlsError:true,toString:function(){var a="HlsMediaError: {FATAL}{TYPE}: {DETAILS}";a=a.replace("{FATAL}",this.fatal?"fatal ":"");a=a.replace("{TYPE}",this.type);a=a.replace("{DETAILS}",this.details);return a}});a.exports=d});define("turntable/plugins/JSHLS/getHlsLevelsDetails",function(require,exports,a){"use strict";function b(a){var b={};if(Array.isArray(a.levels)){b.levels=a.levels.map(function(a){var b={height:a.height,fragmentError:a.fragmentError,loadError:a.loadError};if(a.details){b.details={totalduration:a.details.totalduration,tload:a.details.tload}}return b})}return b}a.exports=b});define("turntable/tools/InlineWorker",function(require,exports,a){"use strict";function b(){throw new Error("not implemented")}b.isAvailable=false;(function a(){var c;var d;var e=function(){try{d.onmessage=null;d.onerror=null;d.terminate();URL.revokeObjectURL(c)}catch(a){}};var f=function(){b.isAvailable=true;e()};var g=function(){b.isAvailable=false;e()};try{var h=new Blob(["postMessage(1)"],{type:"text/javascript"});c=URL.createObjectURL(h);d=new Worker(c);d.onmessage=f;d.onerror=g}catch(a){g()}})();a.exports=b});define("turntable/plugins/JSHLS/HlsElement",function(require,exports,a){"use strict";var b=require("hls.js");var c=require("turntable/plugins/JSHLS/HlsMediaEvent");var d=require("turntable/plugins/JSHLS/HlsMediaError");var e=require("turntable/plugins/JSHLS/getHlsLevelsDetails");var f=require("turntable/tools/videoQuality");var g=require("turntable/tools/deepClone");var h=require("turntable/tools/InlineWorker");var i=require("turntable/tools/assign");function j(a){this.applyConfig(a);this.bindListeners();this.createVideoElement();this.createHlsElement();return this.hlsElement}j.prototype={constructor:j,MIME_TYPE_HLS:"application/x-mpegurl",EVENT_VIDEO_QUALITY_CHANGE:"mrgVideoQualityChange",name:"hlsElement",tagName:"hls",hls:null,error:null,hlsElement:null,videoElement:null,src:"",mrgVideoQualityChangeTimeoutId:0,publicInterface:{autoplay:{enumerable:true,get:function a(){return this._private.videoElement.autoplay},set:function a(b){this._private.videoElement.autoplay=b}},buffered:{enumerable:true,get:function a(){return this._private.videoElement.buffered}},controls:{enumerable:true,get:function a(){return this._private.videoElement.controls},set:function a(b){this._private.videoElement.controls=b}},currentTime:{enumerable:true,get:function a(){return this._private.videoElement.currentTime},set:function a(b){this._private.videoElement.currentTime=b}},defaultMuted:{enumerable:true,get:function a(){return this._private.videoElement.defaultMuted},set:function a(b){this._private.videoElement.defaultMuted=b}},defaultPlaybackRate:{enumerable:true,get:function a(){return this._private.videoElement.defaultPlaybackRate},set:function a(b){this._private.videoElement.defaultPlaybackRate=b}},duration:{enumerable:true,get:function a(){return this._private.videoElement.duration}},ended:{enumerable:true,get:function a(){return this._private.videoElement.ended}},error:{enumerable:true,get:function a(){var b=this._private;return b.error||b.videoElement.error}},initialTime:{enumerable:true,get:function a(){return this._private.videoElement.initialTime},set:function a(b){this._private.videoElement.initialTime=b}},loop:{enumerable:true,get:function a(){return this._private.videoElement.loop},set:function a(b){this._private.videoElement.loop=b}},muted:{enumerable:true,get:function a(){return this._private.videoElement.muted},set:function a(b){this._private.videoElement.muted=b}},networkState:{enumerable:true,get:function a(){return this._private.videoElement.networkState}},paused:{enumerable:true,get:function a(){return this._private.videoElement.paused}},playbackRate:{enumerable:true,get:function a(){return this._private.videoElement.playbackRate},set:function a(b){this._private.videoElement.playbackRate=b}},played:{enumerable:true,get:function a(){return this._private.videoElement.played}},poster:{enumerable:true,get:function a(){return this._private.videoElement.poster},set:function a(b){this._private.videoElement.poster=b}},preload:{enumerable:true,get:function a(){return this._private.videoElement.preload},set:function a(b){this._private.videoElement.preload=b}},readyState:{enumerable:true,get:function a(){return this._private.videoElement.readyState}},seekable:{enumerable:true,get:function a(){return this._private.videoElement.seekable}},seeking:{enumerable:true,get:function a(){return this._private.videoElement.seeking}},src:{enumerable:true,get:function a(){return this._private.src},set:function a(b){var c=this._private;c.destroyHls();c.videoElement.removeAttribute("src");c.src=b}},srcObject:{enumerable:true,get:function a(){return this._private.videoElement.srcObject},set:function a(){throw new Error("not available")}},volume:{enumerable:true,get:function a(){return this._private.videoElement.volume},set:function a(b){this._private.videoElement.volume=b}},canPlayType:{enumerable:true,value:function a(c){var d=this._private;var e="";if(typeof c!="string"){c=String(c)}c=c.toLowerCase();if(c==d.MIME_TYPE_HLS&&b.isSupported()){e="probably"}return e}},fastSeek:{enumerable:true,value:function a(){return this._private.videoElement.fastSeek()}},pause:{enumerable:true,value:function a(){return this._private.videoElement.pause()}},play:{enumerable:true,value:function a(){var b=this._private;if(b.src&&!b.hls){b.createHls();b.loadHls()}return b.videoElement.play()}},load:{enumerable:true,value:function a(){var b=this._private;var c=b.src;b.destroyHls();if(c){b.createHls();b.loadHls()}return b.videoElement.load()}},height:{enumerable:true,get:function a(){return this._private.videoElement.height},set:function a(b){this._private.videoElement.height=b}},width:{enumerable:true,get:function a(){return this._private.videoElement.width},set:function a(b){this._private.videoElement.height=b}},videoHeight:{enumerable:true,get:function a(){return this._private.videoElement.videoHeight}},videoWidth:{enumerable:true,get:function a(){return this._private.videoElement.videoWidth}},onabort:{enumarable:true,get:function a(){return this._private.videoElement.onabort},set:function a(b){this._private.videoElement.onabort=b}},oncanplay:{enumarable:true,get:function a(){return this._private.videoElement.oncanplay},set:function a(b){this._private.videoElement.oncanplay=b}},oncanplaythrough:{enumarable:true,get:function a(){return this._private.videoElement.oncanplaythrough},set:function a(b){this._private.videoElement.oncanplaythrough=b}},ondurationchange:{enumarable:true,get:function a(){return this._private.videoElement.ondurationchange},set:function a(b){this._private.videoElement.ondurationchange=b}},onemptied:{enumarable:true,get:function a(){return this._private.videoElement.onemptied},set:function a(b){this._private.videoElement.onemptied=b}},onencrypted:{enumarable:true,get:function a(){return this._private.videoElement.onencrypted},set:function a(b){this._private.videoElement.onencrypted=b}},onended:{enumarable:true,get:function a(){return this._private.videoElement.onended},set:function a(b){this._private.videoElement.onended=b}},onerror:{enumarable:true,get:function a(){return this._private.videoElement.onerror},set:function a(b){this._private.videoElement.onerror=b}},oninterruptbegin:{enumarable:true,get:function a(){return this._private.videoElement.oninterruptbegin},set:function a(b){this._private.videoElement.oninterruptbegin=b}},oninterruptend:{enumarable:true,get:function a(){return this._private.videoElement.oninterruptend},set:function a(b){this._private.videoElement.oninterruptend=b}},onloadeddata:{enumarable:true,get:function a(){return this._private.videoElement.onloadeddata},set:function a(b){this._private.videoElement.onloadeddata=b}},onloadedmetadata:{enumarable:true,get:function a(){return this._private.videoElement.onloadedmetadata},set:function a(b){this._private.videoElement.onloadedmetadata=b}},onloadstart:{enumarable:true,get:function a(){return this._private.videoElement.onloadstart},set:function a(b){this._private.videoElement.onloadstart=b}},onpause:{enumarable:true,get:function a(){return this._private.videoElement.onpause},set:function a(b){this._private.videoElement.onpause=b}},onplay:{enumarable:true,get:function a(){return this._private.videoElement.onplay},set:function a(b){this._private.videoElement.onplay=b}},onplaying:{enumarable:true,get:function a(){return this._private.videoElement.onplaying},set:function a(b){this._private.videoElement.onplaying=b}},onprogress:{enumarable:true,get:function a(){return this._private.videoElement.onprogress},set:function a(b){this._private.videoElement.onprogress=b}},onratechange:{enumarable:true,get:function a(){return this._private.videoElement.onratechange},set:function a(b){this._private.videoElement.onratechange=b}},onseeked:{enumarable:true,get:function a(){return this._private.videoElement.onseeked},set:function a(b){this._private.videoElement.onseeked=b}},onseeking:{enumarable:true,get:function a(){return this._private.videoElement.onseeking},set:function a(b){this._private.videoElement.onseeking=b}},onstalled:{enumarable:true,get:function a(){return this._private.videoElement.onstalled},set:function a(b){this._private.videoElement.onstalled=b}},onsuspend:{enumarable:true,get:function a(){return this._private.videoElement.onsuspend},set:function a(b){this._private.videoElement.onsuspend=b}},ontimeupdate:{enumarable:true,get:function a(){return this._private.videoElement.ontimeupdate},set:function a(b){this._private.videoElement.ontimeupdate=b}},onvolumechange:{enumarable:true,get:function a(){return this._private.videoElement.onvolumechange},set:function a(b){this._private.videoElement.onvolumechange=b}},onwaiting:{enumarable:true,get:function a(){return this._private.videoElement.onwaiting},set:function a(b){this._private.videoElement.onwaiting=b}},hlsIsAutoLevel:{enumerable:true,value:function a(){return this.mrgAutoSwitchVideoQuality}},mrgAutoSwitchVideoQuality:{enumerable:true,get:function a(){return this._private.hls.autoLevelEnabled},set:function a(b){if(b){this.mrgVideoQualityLevel=-1}else{this.mrgVideoQualityLevel=this.mrgVideoQualityLevel}}},hlsGetLevels:{enumerable:true,value:function a(){return this._private.hls.levels.reduce(function(a,b,c){a[b.height]={index:c,bitrate:b.bitrate,videoWidth:b.width,videoHeight:b.height};return a},{})}},mrgVideoQualityLevels:{enumerable:true,get:function a(){var b=this._private.hls;var c=b.autoLevelEnabled;var d=b.manualLevel;var e=b.currentLevel;return b.levels.map(function(a,b){var g=a.height;var h=b==e;var i=h&&b==d;var j=h&&!i&&c;return{index:b,name:g+"p",videoWidth:a.width,videoHeight:g,bitrate:a.bitrate,rating:f.getRating(g),isCurrent:h,isManual:i,isAuto:j}})}},hlsSwitchLevel:{enumerable:true,value:function a(b){this.mrgVideoQualityLevel=b}},mrgVideoQualityLevel:{enumerable:true,get:function a(){return this._private.hls.currentLevel},set:function a(b){this._private.hls.currentLevel=b}}},events:{video:{abort:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},canplay:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},canplaythrough:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},durationchange:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},emptied:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},encrypted:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},ended:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},error:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},interruptbegin:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},interruptend:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},loadeddata:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},loadedmetadata:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},loadstart:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},pause:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},play:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},playing:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},progress:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},ratechange:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},seeked:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},seeking:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},stalled:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},suspend:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},timeupdate:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},volumechange:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))},waiting:function a(b){this.hlsElement.dispatchEvent(new c(b.type,b))}},hls:{hlsMediaAttaching:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsMediaAttached:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsMediaDetaching:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsMediaDetached:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsBufferReset:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsBufferCodecs:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsBufferAppending:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsBufferAppended:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsBufferEos:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsBufferFlushing:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsBufferFlushed:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsManifestLoading:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsManifestLoaded:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsManifestParsed:function a(b,d){var e=new c(b);this.setHlsStartLevel();e.data=d||{};this.hlsElement.dispatchEvent(e);this.emitMrgVideoQualityChange()},hlsLevelLoading:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsLevelLoaded:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsLevelUpdated:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsLevelPtsUpdated:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsLevelSwitching:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e);this.emitMrgVideoQualityChange()},hlsLevelSwitched:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e);this.emitMrgVideoQualityChange()},hlsFragLoading:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsFragLoadProgress:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsFragLoadEmergencyAborted:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsFragLoaded:function a(b,d){var e=this.hls;var g=e.levels[e.currentLevel];if(e.autoLevelEnabled&&g){f.setMaxAuto(g.height)}var h=new c(b);h.data=d||{};this.hlsElement.dispatchEvent(h)},hlsFragParsingInitSegment:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsFragParsingUserdata:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsFragParsingMetadata:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsFragParsingData:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsFragParsed:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsFragBuffered:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsFragChanged:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsFpsDrop:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsError:function a(b,f){var g=this.hlsElement;var h=new c(b);var j=i(d.getHlsErrorDetails(f),e(this.hls));h.data=j;g.dispatchEvent(h);if(j.fatal){this.error=new d(j);h=new c("error");g.dispatchEvent(h)}},hlsDestroying:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsKeyLoading:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)},hlsKeyLoaded:function a(b,d){var e=new c(b);e.data=d||{};this.hlsElement.dispatchEvent(e)}}},bindListeners:function(){var a=this;var b=this.events;Object.keys(this.events).forEach(function(c){var d=b[c];Object.keys(d).forEach(function(b){d[b]=d[b].bind(a)})})},listenVideoEvents:function(){var a=this.videoElement;var b=this.events.video;Object.keys(b).forEach(function(c){a.addEventListener(c,b[c])})},listenHlsEvents:function(){var a=this.events.hls;var b=this.hls;Object.keys(a).forEach(function(c){b.on(c,a[c])})},stopListeningHlsEvents:function(){var a=this.events.hls;var b=this.hls;Object.keys(a).forEach(function(c){b.off(c,a[c])})},emitMrgVideoQualityChange:function(){var a=this.hlsElement;var b=new c(this.EVENT_VIDEO_QUALITY_CHANGE);this.mrgVideoQualityChangeTimeoutId=setTimeout(function(){a.dispatchEvent(b)},0)},createVideoElement:function(){var a=document.createElement("video");this.videoElement=a;a._private=this;a.loop=false;a.preload="none";a.autoplay=false;a.controls=false;a.style.cssText="width: 100%; height: 100%; max-width: 100%; max-height: 100%;"},createHlsElement:function(){var a=document.createElement(this.tagName);this.hlsElement=a;a._private=this;Object.defineProperties(a,this.publicInterface);a.appendChild(this.videoElement);this.listenVideoEvents()},createHls:function(){var a=new b(this.config);this.hls=a;this.listenHlsEvents();return a},loadHls:function(){var a=this.hls;a.attachMedia(this.videoElement);a.loadSource(this.src)},destroyHls:function(){var a=this.hls;if(a){clearTimeout(this.mrgVideoQualityChangeTimeoutId);this.stopListeningHlsEvents();a.destroy();this.hls=null;this.error=null}},xhrSetup:function(a,b){a.withCredentials=true},getHlsLevelByHeight:function(a){var b=this.hls.levels;var c=b.length;while(c--){if(b[c].height==a){return c}}return-1},setHlsStartLevel:function(){var a=this.hls;var b=f.getMaxAuto();var c=f.getOptimal();var d=this.getHlsLevelByHeight(Math.max(c,b));if(d==-1){a.startLevel=a.firstLevel}else{a.startLevel=d}},applyConfig:function(a){var c={xhrSetup:this.xhrSetup};var d={};if(b.DefaultConfig.enableWorker){c.enableWorker=h.isAvailable}if(a.enableWorker){d.enableWorker=h.isAvailable}this.config=g(c,a,d)}};a.exports=j});define("turntable/plugins/JSHLS/JSHLS",function(require,exports,a){"use strict";var b=require("turntable/tools/log");var c=require("turntable/plugins/JSHLS/HlsElement");function d(a){this.config=a.config||{};this._isCanPlayHls=undefined;b.debug(this,"construct")}d.prototype={constructor:d,HLS_MIME_TYPE:"application/x-mpegurl",name:"JSHLS",_isCanPlayHls:undefined,_mediaElement:null,config:null,getMediaElement:function(){if(!this._mediaElement){this._mediaElement=new c(this.config)}return this._mediaElement},isCanPlay:function(a){var b=this.HLS_MIME_TYPE;var c=false;if(a==b){c=this._isCanPlayHls;if(c===undefined){var d=this.getMediaElement();c=Boolean(d.canPlayType(b));this._isCanPlayHls=c}}return c},hasVideoQualitySettings:function(){return true}};a.exports=d});define("turntable/PluginPicker",function(require,exports,a){"use strict";var b=require("turntable/tools/log");var c={FlashHLS:require("turntable/plugins/FlashHLS/FlashHLS"),TizenHLS:require("turntable/plugins/TizenHLS"),Native:require("turntable/plugins/Native"),JSHLS:require("turntable/plugins/JSHLS/JSHLS")};function d(a){return a.enabled}function e(a,b){return a.priority-b.priority}function f(a){return function(){return new c[a.name](a)}}function g(a){return Object.keys(a).map(function(b){var c=a[b];c.name=b;return c})}function h(a){return g(a).filter(d).sort(e).map(f)}function i(a){this._plugins=h(a);this._pickPluginCache={};b.debug(this,"construct")}i.prototype={constructor:i,name:"pluginPicker",_plugins:null,_pickPluginCache:null,pickPlugin:function(a){var b=this._pickPluginCache;a=a.toLowerCase();if(a in b){return b[a]}var c;var d=this._plugins;var e=d.length;var f;for(f=0;f<e;f++){c=d[f];if(c instanceof Function){c=new c;d[f]=c}if(c.isCanPlay(a)){b[a]=c;return c}}b[a]=null;return null},isCanPlay:function(a){return Boolean(this.pickPlugin(a))}};return i});define("turntable/tools/time",function(require,exports,a){"use strict";a.exports={secondsToTimeString:function(a){var b;var c;c=Math.floor(a/3600);a=a%3600;b=Math.floor(a/60);a=Math.floor(a%60);if(b<10){b="0"+b}if(a<10){a="0"+a}if(c){return c+":"+b+":"+a}return b+":"+a},interval:function(a,b,c){if(b&&c&&a>b){return c}var d=a<1e3?100:1e3;var e=a%d;a=a-e;if(e>=5*d/10){a+=d}return a}}});define("turntable/Turntable",function(require,exports,a){"use strict";var b=require("turntable/Config");var c=require("turntable/PluginPicker");var d=require("mrg-microevent");var e=require("turntable/tools/log");var f=require("turntable/tools/time");var g=require("turntable/tools/reflectStorage");var h=new b;var i;function j(a){if(!i){i=this;if(a){h.set(a)}this._pluginPicker=new c(h.plugins);this._restoreVolume();this._restoreMuted()}e.debug(i,"construct");return i}j.prototype={constructor:j,name:"turntable",KEY_MUTED:"turntable/media/muted",KEY_VOLUME:"turntable/media/volume",EVENT_ABORT:"abort",EVENT_CAN_PLAY:"canPlay",EVENT_DURATION_CHANGE:"durationChange",EVENT_EMPTIED:"emptied",EVENT_LOAD_START:"loadStart",EVENT_LOADED_DATA:"loadedData",EVENT_LOADED_METADATA:"loadedMetaData",EVENT_MEDIA_ERROR:"mediaError",EVENT_MUTE:"mute",EVENT_UNMUTE:"unmute",EVENT_VOLUME_CHANGE:"volumeChange",EVENT_PAUSE:"pause",EVENT_PLAY:"play",EVENT_PLAYING:"playing",EVENT_ENDED:"ended",EVENT_PLUGIN_READY:"pluginReady",EVENT_PLUGIN_ERROR:"pluginError",EVENT_PROGRESS:"progress",EVENT_VIDEO_QUALITY_CHANGE:"videoQualityChange",EVENT_RATE_CHANGE:"rateChange",EVENT_TIME_UPDATE:"timeUpdate",EVENT_TIME_INTERVAL_UPDATE:"timeIntervalUpdate",EVENT_SEEKED:"seeked",EVENT_SEEKING:"seeking",EVENT_SOURCE_CHANGE:"sourceChange",EVENT_STALLED:"stalled",EVENT_SUSPEND:"suspend",EVENT_WAITING:"waiting",EVENT_RESIZED:"resized",EVENT_ERROR:"error",ERROR_PLUGIN_NOT_FOUND:"unable to find a plugin to play the MIME type ",_pluginPicker:null,_plugin:null,_mimeType:"",_mediaElement:null,_isMetaDataLoaded:false,_isMuted:false,_volumeLevel:1,_lastPercentageCurrentTimeInterval:-1,_isFirstPlaying:true,_playCallTime:0,_loadDataStartTime:0,_loadMetaDataStartTime:0,_seekStartTime:0,_seekBuffered:false,_mediaEvents:{abort:"_onMediaAbort",canplay:"_onMediaCanPlay",canplaythrough:"_onMediaCanPlayThrough",durationchange:"_onMediaDurationChange",emptied:"_onMediaEmptied",ended:"_onMediaEnded",error:"_onMediaError",loadeddata:"_onMediaLoadedData",loadedmetadata:"_onMediaLoadedMetaData",loadstart:"_onMediaLoadStart",pause:"_onMediaPause",play:"_onMediaPlay",playing:"_onMediaPlaying",progress:"_onMediaProgress",ratechange:"_onMediaRateChange",seeked:"_onMediaSeeked",seeking:"_onMediaSeeking",stalled:"_onMediaStalled",suspend:"_onMediaSuspend",timeupdate:"_onMediaTimeUpdate",volumechange:"_onMediaVolumeChange",waiting:"_onMediaWaiting",hlsError:"_onMediaHlsError",mrgVideoQualityChange:"_onVideoQualityChange","-x-ready":"_onMediaPluginReady"},_onMediaAbort:function(a){this._emit(this.EVENT_ABORT,{})},_onMediaCanPlay:function(a){if(!this.isMetaDataLoaded()){this._onMediaLoadedMetaData()}this._emit(this.EVENT_CAN_PLAY,this._getPlaybackTime())},_onMediaCanPlayThrough:function(a){this._onMediaCanPlay(a)},_onMediaDurationChange:function(a){this._emit(this.EVENT_DURATION_CHANGE,this._getPlaybackTime())},_onMediaEmptied:function(a){this._emit(this.EVENT_EMPTIED,{})},_onMediaEnded:function(a){var b=this._getPlaybackTime();this._emit(this.EVENT_ENDED,b);this._checkPercentageCurrentTimeInterval(b)},_onMediaLoadedData:function(a){var b=this.getMetaData();var c=this._loadDataStartTime;if(c){b.waitingTime=Date.now()-c}else{b.waitingTime=0}this._loadDataStartTime=0;this._emit(this.EVENT_LOADED_DATA,b)},_onMediaLoadedMetaData:function(a){var b=this.getMetaData();var c=this._loadMetaDataStartTime;if(c){b.waitingTime=Date.now()-c}else{b.waitingTime=0}this._isMetaDataLoaded=true;this._loadMetaDataStartTime=0;this._emit(this.EVENT_LOADED_METADATA,b)},_onMediaLoadStart:function(a){var b=Date.now();this._loadDataStartTime=b;this._loadMetaDataStartTime=b;this._emit(this.EVENT_LOAD_START,{})},_onMediaPause:function(a){this._emit(this.EVENT_PAUSE,{})},_onMediaPlay:function(a){this._emit(this.EVENT_PLAY,{})},_onMediaPlaying:function(a){var b=this._getPlaybackTime();var c=this._playCallTime;if(c){b.waitingTime=Date.now()-c}else{b.waitingTime=0}this._playCallTime=0;b.isFirstTime=this._isFirstPlaying;this._isFirstPlaying=false;this._emit(this.EVENT_PLAYING,b)},_onMediaProgress:function(a){this._emit(this.EVENT_PROGRESS,this._getPlaybackTime())},_onMediaRateChange:function(a){this._emit(this.EVENT_RATE_CHANGE,{})},_onMediaSeeked:function(a){var b=this._getPlaybackTime();var c=this._seekStartTime;var d=this._seekBuffered;if(c){b.waitingTime=Date.now()-c}else{b.waitingTime=0}this._seekBuffered=false;this._seekStartTime=0;b.buffered=Boolean(d);this._emit(this.EVENT_SEEKED,b);if(!this.isPaused()){this._onMediaPlaying(a)}},_onMediaSeeking:function(a){var b=this._getPlaybackTime();var c=this.getBufferedTime()>this.getCurrentTime();this._seekStartTime=Date.now();this._seekBuffered=c;b.buffered=c;this._emit(this.EVENT_SEEKING,b)},_onMediaStalled:function(a){this._emit(this.EVENT_STALLED,{})},_onMediaSuspend:function(a){this._emit(this.EVENT_SUSPEND,{})},_onMediaTimeUpdate:function(a){var b=this._getPlaybackTime();this._emit(this.EVENT_TIME_UPDATE,b);this._checkPercentageCurrentTimeInterval(b)},_onMediaVolumeChange:function(a){this._emit(this.EVENT_VOLUME_CHANGE,this._getPlaybackVolume())},_onMediaWaiting:function(a){this._emit(this.EVENT_WAITING,this._getPlaybackTime())},_onMediaError:function(a){var b={plugin:this._plugin.name,error:this._mediaElement.error};this.pause();this._emit(this.EVENT_MEDIA_ERROR,b)},_onMediaHlsError:function(a){var b={plugin:this._plugin.name,error:a.data};this._emit(this.EVENT_PLUGIN_ERROR,b)},_onVideoQualityChange:function(a){this._emit(this.EVENT_VIDEO_QUALITY_CHANGE,this._getVideoPlaybackQuality())},_onMediaPluginReady:function(a){this._emit(this.EVENT_PLUGIN_READY,{pluginName:this._plugin.name})},_checkPercentageCurrentTimeInterval:function(a){var b=a.percentageCurrentTimeInterval;if(b!=this._lastPercentageCurrentTimeInterval){this._lastPercentageCurrentTimeInterval=b;this._emit(this.EVENT_TIME_INTERVAL_UPDATE,a)}},_emit:function(a,b){var c;var d=this._mediaElement;if(d){c=d._origin}if(c==undefined){b.origin="unknown"}else{b.origin=c}this.emit(a,b);e.event(this,a,b)},_getPlaybackTime:function(){return{currentTime:this.getCurrentTime(),currentTimeString:this.getCurrentTimeString(),percentageCurrentTime:this.getPercentageCurrentTime(),percentageCurrentTimeInterval:this.getPercentageCurrentTimeInterval(),bufferedTime:this.getBufferedTime(),percentageBufferedTime:this.getPercentageBufferedTime(),duration:this.getDuration(),durationTimeString:this.getDurationTimeString()}},_getPlaybackVolume:function(){return{volume:this.getVolume(),percentageVolume:this.getPercentageVolume(),isMuted:this.isMuted()}},_getVideoPlaybackQuality:function(){var a=this.getDimensions();if(this._plugin.hasVideoQualitySettings()){var b=this._mediaElement;a.levels=b.mrgVideoQualityLevels;a.currentLevel=b.mrgVideoQualityLevel}else{a.levels=[];a.currentLevel=-1}return a},_resetToDefaults:function(){this._playCallTime=0;this._isFirstPlaying=true;this._loadDataStartTime=0;this._loadMetaDataStartTime=0;this._isMetaDataLoaded=false;this._seekStartTime=0;this._seekBuffered=false;this._lastPercentageCurrentTimeInterval=-1},_resetMediaElementStyle:function(){var a=this._mediaElement;if(a){a.className="";a.style.cssText=""}},_updateMediaElement:function(a,b){a._origin=b||"unknown";if(this._mediaElement!==a){this._stopListeningMediaElement();this._resetMediaElementStyle();this._mediaElement=a;a.muted=this._isMuted;a.volume=this._volumeLevel;this._listenMediaElement()}},_listenMediaElement:function(){var a=this._mediaElement;if(a){Object.keys(this._mediaEvents).forEach(function(b){a.addEventListener(b,this)},this)}},_stopListeningMediaElement:function(){var a=this._mediaElement;if(a){Object.keys(this._mediaEvents).forEach(function(b){a.removeEventListener(b,this)},this)}},handleEvent:function(a){var b=this._mediaEvents;var c=a.type;if(c in b){this[b[c]](a)}},isCanPlay:function(a){return this._pluginPicker.isCanPlay(a)},hasVideoQualitySettings:function(){var a=this._plugin;if(a){return a.hasVideoQualitySettings()}return false},isPaused:function(){var a=this._mediaElement;if(a){return a.paused}return true},play:function(){var a=this._mediaElement;if(a&&this.isPaused()){this._playCallTime=Date.now();setTimeout(function(){var b=a.play();if(b){b["catch"](function(){})}},0)}},pause:function(){var a=this._mediaElement;if(a&&!this.isPaused()){this._playCallTime=0;a.pause()}},_setSource:function(a){var b=this._mediaElement;if(b){if(a){b.src=a}else{b.removeAttribute("src")}this._emit(this.EVENT_SOURCE_CHANGE,{target:b,url:a})}},setSource:function(a,b,c,d){this.pause();d=d||{};var e=this._pluginPicker.pickPlugin(a);if(e&&d.preload!==void 0&&e.setPreload){e.setPreload(d.preload)}if(!this._mediaElement||this._mediaElement&&this._mediaElement.src!==b){this._resetToDefaults();if(e){this._plugin=e;this._mimeType=a;this._updateMediaElement(e.getMediaElement(a),c);this._setSource(b)}else{this._emit(this.EVENT_ERROR,{error:new Error(this.ERROR_PLUGIN_NOT_FOUND+a),reason:"PLUGIN_NOT_FOUND",mimeType:a,url:b})}}return Boolean(e)},getSource:function(){var a=this._mediaElement;if(a){return a.src}return""},getMediaElement:function(){return this._mediaElement},getPluginName:function(){var a=this._plugin;if(a){return a.name}return""},_restoreMuted:function(){this._isMuted=g.get(this.KEY_MUTED)===true},_saveMuted:function(){g.set(this.KEY_MUTED,this._isMuted)},isMuted:function(){var a=this._mediaElement;if(a){this._isMuted=a.muted}return this._isMuted},mute:function(){if(!this.isMuted()){this._isMuted=true;this._saveMuted();var a=this._mediaElement;if(a){a.muted=true}else{this._onMediaVolumeChange()}this._emit(this.EVENT_MUTE,this._getPlaybackVolume())}},unmute:function(){if(this.isMuted()){this._isMuted=false;this._saveMuted();var a=this._mediaElement;if(a){a.muted=false}else{this._onMediaVolumeChange()}this._emit(this.EVENT_UNMUTE,this._getPlaybackVolume())}},_normalizeVolume:function(a){return Math.min(Math.max(a,0),1)},_restoreVolume:function(){var a=g.get(this.KEY_VOLUME);if(a==null){a=1}this._volumeLevel=this._normalizeVolume(a)},_saveVolume:function(){g.set(this.KEY_VOLUME,this._volumeLevel)},getVolume:function(){var a=this._mediaElement;if(a){this._volumeLevel=a.volume}return this._volumeLevel},getPercentageVolume:function(){return this.getVolume()*100},setVolume:function(a){a=this._normalizeVolume(a);if(this._volumeLevel!=a){this._volumeLevel=a;this._saveVolume(a);var b=this._mediaElement;if(b){b.volume=a}else{this._onMediaVolumeChange()}}},setPercentageVolume:function(a){this.setVolume(a/100)},getCurrentTime:function(){if(this.isMetaDataLoaded()){var a=this._mediaElement.currentTime;if(isFinite(a)){return a}}return 0},getPercentageCurrentTime:function(){var a=this.getCurrentTime()*100/this.getDuration();if(isFinite(a)){return Math.min(Math.max(a,0),100)}return 0},getPercentageCurrentTimeInterval:function(a){var b=Math.floor(this.getPercentageCurrentTime());if(isFinite(b)){if(!a){a=10}return b-b%a}return 0},getCurrentTimeString:function(){return f.secondsToTimeString(this.getCurrentTime())},setCurrentTime:function(a){if(this.isMetaDataLoaded()&&isFinite(a)){a=Math.min(Math.max(a,0),this.getDuration());this._mediaElement.currentTime=a}},setPercentageCurrentTime:function(a){var b=this.getDuration();var c=b*Math.min(Math.max(a,0),100)/100;this.setCurrentTime(c)},getBufferedTime:function(){if(this.isMetaDataLoaded()){var a=this._mediaElement.buffered;if(a){var b=this.getCurrentTime();var c=a.length;while(c--){var d=a.end(c);if(b>=a.start(c)&&b<=d){return d}}}}return 0},getPercentageBufferedTime:function(){var a=this.getBufferedTime()*100/this.getDuration();if(isFinite(a)){return Math.min(Math.max(a,0),100)}return 0},getDuration:function(){if(this.isMetaDataLoaded()){var a=this._mediaElement.duration;if(isFinite(a)){return a}}return 0},getDurationTimeString:function(){return f.secondsToTimeString(this.getDuration())},isMetaDataLoaded:function(){return this._mediaElement&&this._isMetaDataLoaded},getVideoQualityLevels:function(){var a=[];var b=this._plugin;if(b&&b.hasVideoQualitySettings()&&this.isMetaDataLoaded()){var c=this._mediaElement;if(c){a=c.mrgVideoQualityLevels}}return a},getVideoQualityLevel:function(){var a=-1;var b=this._plugin;if(b&&b.hasVideoQualitySettings()&&this.isMetaDataLoaded()){var c=this._mediaElement;if(c){a=c.mrgVideoQualityLevel}}return a},setVideoQualityLevel:function(a){var b=this._plugin;if(this.isMetaDataLoaded()&&b&&b.hasVideoQualitySettings()){var c=this._mediaElement;if(c){c.mrgVideoQualityLevel=a}}},getDimensions:function(){var a={aspectRatio:16/9,canvasHeight:0,canvasWidth:0,videoHeight:0,videoWidth:0};if(this.isMetaDataLoaded()){var b=this._mediaElement;var c=b.videoHeight;var d=b.videoWidth;if(d&&c){a.aspectRatio=d/c;a.videoHeight=c;a.videoWidth=d}a.canvasHeight=b.offsetHeight;a.canvasWidth=b.offsetWidth}return a},resizeTo:function(a,b,c,d){var e=this._mediaElement;if(e){var f=e.style;f.height=a;f.width=b;f.maxHeight=c||"100%";f.maxWidth=d||"100%";this._emit(this.EVENT_RESIZED,this.getDimensions())}},getMetaData:function(){var a=this.getDimensions();a.duration=this.getDuration();a.mimeType=this._mimeType;return a},reload:function(){var a=this._mediaElement;this.pause();if(a){a.load()}}};j.log=e;j.config=h;j.isCanPlay=function(a){if(!i){i=new j}return i.isCanPlay(a)};d.mixin(j);a.exports=j});define("toolkit/b-tooltip/b-tooltip",function(require){"use strict";var $=require("jquery");var a=require("toolkit/b-toolkit/b-toolkit");var b=require("toolkit/b-controls-group/b-controls-group");function c(a,b){return!(a.left<b.left||a.top<b.top||a.right>b.right||a.bottom>b.bottom)}a["b-tooltip"]=a.create("b-tooltip",{templateBlock:"b-tooltip",mods:["tc","lc","rc","bc"],offset:{x:10,y:10},init:function(){this._onCloseClick=this.bound("_onCloseClick");this._onOutsideClick=this.bound("_onOutsideClick")},assign:function(a){Object.assign(this,a)},_initControlsGroup:function(){if(this.controls){return}this.controls=new b({$el:this.$el});this.controls.on("close",this._onCloseClick)},_destroyControlsGroup:function(){if(this.controls){this.controls.undelegateEvents(this.$el)}},isVisible:function(){return this._state},moveTo:function(a){this.$el.css(a.rectangle);if(typeof a.corner!=="undefined"){this.$("__corner").css(a.corner)}return this},show:function(a){a=a||{};var b=!!a.recalc;if(b){this.$el.css({width:"",top:"",left:""})}this._toggleAnimateClass(true);var c=this.$el.width()+1;if(!this.$el.hasMod("flex")){this.$el.width(c)}this.setPosition(c);this._clearTimeout();this._initControlsGroup();if(this.$el.hasMod("closable")){setTimeout(this._bindOutsideClick.bind(this),0)}this.emit("show")},hide:function(a){if(a){this._clearTimeout();this._toggleAnimateClass(false);this.emit("hide")}else{this.animateId=setTimeout(function(){this._toggleAnimateClass(false);this.emit("hide")}.bind(this),200)}},_toggleAnimateClass:function(a){this.$el.toggleMod("animate",a);this._state=a},_onOutsideClick:function(a){if(!($.contains(this.$el[0],a.target)||this.$el[0]===a.target)){this.destroy()}},_bindOutsideClick:function(){$(document).on("click.tooltip",this._onOutsideClick)},_unbindOutsideClick:function(){$(document).off("click.tooltip",this._onOutsideClick)},_onCloseClick:function(){this.destroy()},destroy:function(){this._unbindOutsideClick();this._destroyControlsGroup();this.$el.remove()},_clearTimeout:function(){if(this.animateId){clearTimeout(this.animateId)}},setWidth:function(){this.$el.width(this.$el.width())},setPosition:function(a){var b,c;var d=this.getPositionInfo({relative:this.relative});if(this._mod){this.toggleMod(this._mod,false)}this._mod=d.mod;this.toggleMod(this._mod,true);if(this._mod==="lc"){b=d.rectangle.left+a;if(this.relative){b+=this.$target.offset().left}if(b>Math.min(document.documentElement.clientWidth,document.body.offsetWidth)){c=this.mods;this.mods=["tc"];this.setPosition(a);this.mods=c;return}}else if(this._mod==="rc"){b=d.rectangle.left;if(this.relative){b+=this.$target.offset().left}if(b<0){c=this.mods;this.mods=["tc"];this.setPosition(a);this.mods=c;return}}this.moveTo({rectangle:{top:d.rectangle.top,left:d.rectangle.left},corner:d.corner})},getPositionInfo:function(a){a=$.extend({mods:this.mods,$target:this.$target,offset:this.offset,fitIntoWindow:this.fitIntoWindow},a);function b(a,b,c){a=$.extend({},a);["left","top","bottom","right"].forEach(function(d){if(c){a.rectangle[d]-=b[d]}if(a.corner){a.corner[d]-=b[d]}});return{mod:a.mod,rectangle:a.rectangle,corner:a.corner}}function d(a,b){var c,d;var e=a.rectangle;c=Math.max(b.left-e.left,0);if(!c){c=Math.min(b.right-e.right,0)}d=Math.max(b.top-e.top,0);if(!d){d=Math.min(b.bottom-e.bottom,0)}if(c){e.left+=c;e.right+=c}if(d){e.top+=d;e.bottom+=d;if(a.corner){a.corner.top+=d;a.corner.bottom+=d}}return a}var e=a.offset;var f={width:this.$el.width(),height:this.$el.height()};var g;var h=function(a){var b=a.scrollLeft(),c=a.scrollTop();return{top:c,right:b+a.width(),bottom:c+a.height(),left:b}}($(window.$Scroll||window));var i=this._targetRectangle||function(b){var c=a.$target.offset(),d=b.outerWidth(),e=b.outerHeight(),f=c.left,g=c.top,i=f+d,j=g+e;if(f<h.right&&i>h.right){d=h.right-f}if(f<h.left&&i>h.left){d=i-h.left;f=h.left}return{top:g,right:i,bottom:j,left:f,width:d,height:e}}(a.$target);g=[{mod:"tc",rectangle:{left:i.left+i.width/2-f.width/2,top:i.top+i.height+e.y}},{mod:"tr",corner:{right:i.right+i.width/2,top:i.top},rectangle:{left:i.left+i.width-f.width,top:i.top+i.height+e.y}},{mod:"tl",corner:{left:i.left+i.width/2,top:i.top},rectangle:{left:i.left,top:i.top+i.height+e.y}},{mod:"lc",rectangle:{left:i.left+i.width+e.x,top:i.top+i.height/2-f.height/2}},{mod:"rc",rectangle:{left:i.left-f.width-e.x,top:i.top+i.height/2-f.height/2}},{mod:"bc",rectangle:{left:i.left+i.width/2-f.width/2,top:i.top-f.height-e.y}}].filter(function(b){b.rectangle.right=b.rectangle.left+f.width;b.rectangle.bottom=b.rectangle.top+f.height;return a.mods.includes(b.mod)}).sort(function(b,c){return a.mods.indexOf(b.mod)-a.mods.indexOf(c.mod)});g=g.filter(function(a){return c(a.rectangle,h)})[0]||(a.fitIntoWindow?d(g[0],h):g[0]);return b(g,i,a.relative)}});return a["b-tooltip"]});define("jukebox/b-jukebox/b-jukebox",["jquery","toolkit/b-toolkit/b-toolkit","toolkit/b-controls-group/b-controls-group","toolkit/b-tooltip/b-tooltip","ajs/ajs","ajs/__array/ajs__array"],function($,a,b,c){"use strict";return b.extend("b-jukebox",{_super:b.fn,EVENT_PLAY:"play",EVENT_PAUSE:"pause",EVENT_MUTE:"mute",EVENT_UNMUTE:"unmute",EVENT_VOLUME_CHANGE:"volumeChange",EVENT_TIME_CHANGE:"timeChange",EVENT_VIDEO_QUALITY_CHANGE:"videoQualityChange",EVENT_RESIZE:"resize",EVENT_READY:"ready",STATE_PLAYBACK_WAITING:"waiting",STATE_PLAYBACK_PLAYING:"playing",STATE_PLAYBACK_PAUSED:"paused",STATE_PLAYBACK_ERROR:"error",STATE_CONTENT_POSTER:"content_poster",STATE_CONTENT_POSTER_ERROR:"content_poster_error",STATE_CONTENT_POSTER_LOADING:"content_poster_loading",STATE_CONTENT_VIDEO:"content_video",STATE_CONTENT_ERROR:"content_error",STATE_SOUND_MUTED:"muted",STATE_SOUND_UNMUTED:"unmuted",STATE_FULLSCREEN:"fullscreen",STATE_FULLSCREEN_IDLE:"fullscreen-idle",STATE_FULLSCREEN_SUPPORTED:"fullscreen_supported",STATE_SETTINGS_SUPPORTED:"settings_supported",_elements:null,_mediaElement:null,_poster:null,_posterWidth:0,_posterHeight:0,_currentPlaybackState:null,_currentContentState:null,_oldContentState:null,_isPlaybackProgressCapturing:false,_isVolumeCapturing:false,_hasMediaElement:false,_isFullScreenIdle:false,fullScreenSupported:false,settingsSupported:false,_videoQualityLevels:[],type:"audio",settingsBlock:"",renderMode:"replace",boundAll:["_onVolumeChange","_onVolumeChangeEnd","_onVolumeChangeStart","_onPlaybackProgressChange","_onPlaybackProgressChangeEnd","_onPlaybackProgressChangeStart","_setState"],emptyImageSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",_findElements:function(){var a=this.$el;this._elements={caption:a.find(".js-caption"),content:a.find(".js-content"),duration:a.find(".js-duration"),error:a.find(".js-error"),errorCode:a.find(".js-error-code"),fullscreen:a.find(".js-fullscreen"),settings:a.find(".js-settings"),next:a.find(".js-next"),previous:a.find(".js-previous"),poster:a.find(".js-poster"),posterDummy:a.find(".js-poster-dummy"),progress:a.find(".js-progress"),progressAmount:a.find(".js-progress-amount"),progressBuffered:a.find(".js-progress-buffered"),shuffle:a.find(".js-shuffle"),time:a.find(".js-time"),video:a.find(".js-video"),volume:a.find(".js-volume"),volumeAmount:a.find(".js-volume-amount")}},onRender:function(a,b){this._findElements();this._setInitialState();this._listenGestures();this.emit(this.EVENT_READY,this)},_setInitialState:function(){var b=this.$el;{a.toggleMod(b,this.type,true);a.toggleMod(b,this.STATE_CONTENT_POSTER,true);a.toggleMod(b,this.STATE_FULLSCREEN_SUPPORTED,this.fullScreenSupported);a.toggleMod(b,this.STATE_SETTINGS_SUPPORTED,this.settingsSupported)}this.setSoundState(this.STATE_SOUND_UNMUTED);this.setPlaybackState(this.STATE_PLAYBACK_PAUSED);this.setTime(0);this.setDuration(0);this.setPlaybackProgress(0);this.setBufferingProgress(0);this.setFullScreenState(false)},_listenGestures:function(){this.$el.delegate(".js-volume",{mousedown:this._onVolumeChangeStart}).delegate(".js-progress",{mousedown:this._onPlaybackProgressChangeStart});$(document).on({mousemove:this._onVolumeChange,"mouseup mouseleave":this._onVolumeChangeEnd}).on({mousemove:this._onPlaybackProgressChange,"mouseup mouseleave":this._onPlaybackProgressChangeEnd})},_stopListeningGestures:function(){this.$el.undelegate(".js-volume",{mousedown:this._onVolumeChangeStart}).undelegate(".js-progress",{mousedown:this._onPlaybackProgressChangeStart});$(document).off({mousemove:this._onVolumeChange,"mouseup mouseleave":this._onVolumeChangeEnd}).off({mousemove:this._onPlaybackProgressChange,"mouseup mouseleave":this._onPlaybackProgressChangeEnd})},setVolume:function(a){this._elements.volumeAmount.width(a+"%")},_setVolume:function(a){var b=this._calcPercentageVolume(a);this.setVolume(b);return b},_emitVolumeChange:function(a){this.emit(this.EVENT_VOLUME_CHANGE,{percentageVolume:a})},_onVolumeChangeStart:function(a){this._isVolumeCapturing=true},_onVolumeChangeEnd:function(a){if(this._isVolumeCapturing){this._isVolumeCapturing=false;this._emitVolumeChange(this._setVolume(a))}},_onVolumeChange:function(a){if(this._isVolumeCapturing){a.preventDefault();this.log("info",{radarName:this.type+"_"+"volume",radars:[this._radarFilename+"=1","all=1"]});this._emitVolumeChange(this._setVolume(a))}},_calcVolumeLevel:function(a){return a.pageX-this._elements.volume.offset().left},_calcPercentageVolume:function(a){var b=this._calcVolumeLevel(a);var c=this._elements.volume.width();var d=b*100/c;return Math.min(100,d)},_onPlaybackProgressChangeStart:function(a){this._isPlaybackProgressCapturing=true;this._setPlaybackProgress(this._calcPercentagePlaybackProgress(a))},_onPlaybackProgressChangeEnd:function(a){if(this._isPlaybackProgressCapturing){this._isPlaybackProgressCapturing=false;var b=this._calcPercentagePlaybackProgress(a);this._setPlaybackProgress(b);this.emit(this.EVENT_TIME_CHANGE,{percentageTime:b})}},_onPlaybackProgressChange:function(a){if(this._isPlaybackProgressCapturing){a.preventDefault();this.log("info",{radarName:this.type+"_"+"progress",radars:[this._radarFilename+"=1","all=1"]});this._setPlaybackProgress(this._calcPercentagePlaybackProgress(a))}},_calcPlaybackProgress:function(a){return a.pageX-this._elements.progress.offset().left},_calcPercentagePlaybackProgress:function(a){var b=this._calcPlaybackProgress(a);var c=this._elements.progress.width();var d=b*100/c;return Math.min(100,d)},_setPlaybackProgress:function(a){this._elements.progressAmount.width(a+"%")},setPlaybackProgress:function(a){if(!this._isPlaybackProgressCapturing){this._setPlaybackProgress(a)}},onStatusIcon:function(a,b){switch(this._currentPlaybackState){case this.STATE_PLAYBACK_PAUSED:this.onPlay();this.emit(this.EVENT_PLAY,b);break;case this.STATE_PLAYBACK_PLAYING:case this.STATE_PLAYBACK_WAITING:this.onPause();this.emit(this.EVENT_PAUSE,b);break}},onPlay:function(){this.log("info",{radarName:this.type+"_"+"play",radars:[this._radarFilename+"=1","all=1"]});this.setPlaybackState(this.STATE_PLAYBACK_PLAYING)},onPause:function(){this.log("info",{radarName:this.type+"_"+"pause",radars:[this._radarFilename+"=1","all=1"]});this.setPlaybackState(this.STATE_PLAYBACK_PAUSED)},onMute:function(){this.log("info",{radarName:this.type+"_"+"mute",radars:[this._radarFilename+"=1","all=1"]});this.setSoundState(this.STATE_SOUND_MUTED)},onUnmute:function(){this.log("info",{radarName:this.type+"_"+"unmute",radars:[this._radarFilename+"=1","all=1"]});this.setSoundState(this.STATE_SOUND_UNMUTED)},onVideoQuality:function(a,b){this.log("info",{radarName:this.type+"_"+"quality",radars:[this._radarFilename+"=1","all=1"]});this._hideSettingsMenu();var c=parseInt(b.$el.attr("data-level"),10);if(isFinite(c)){this.emit(this.EVENT_VIDEO_QUALITY_CHANGE,{level:c})}},onSettings:function(a,b){this.log("info",{radarName:this.type+"_"+"settings",radars:[this._radarFilename+"=1","all=1"]});if(this._elements.settings.is(b.event.target)){this._showSettingsMenu()}},onFullscreen:function(){this.log("info",{radarName:this.type+"_"+"fullscreen",radars:[this.isFullScreen()+"_"+this._radarFilename+"=1",this.isFullScreen()+"_all=1"]})},toggleFullScreenState:function(){this.setFullScreenState(!this.isFullScreen())},isFullScreen:function(){return a.hasMod(this.el,this.STATE_FULLSCREEN)},setFullScreenState:function(b){var c=this.STATE_FULLSCREEN;a.toggleMod(this.el,c,b)},isFullScreenIdle:function(){return this._isFullScreenIdle},setFullScreenIdleState:function(b){var c=this.STATE_FULLSCREEN_IDLE;if(this._isFullScreenIdle!==b){this._isFullScreenIdle=b;a.toggleMod(this.el,c,b)}},getContentState:function(){return this._currentContentState},setContentState:function(a){this._currentContentState=a;clearTimeout(this._setContentStateTimeout);this._setContentStateTimeout=setTimeout(this._setState,200)},getPlaybackState:function(){return this._currentPlaybackState},setPlaybackState:function(a){this._currentPlaybackState=a;clearTimeout(this._setPlaybackStateTimeout);this._setPlaybackStateTimeout=setTimeout(this._setState,200)},_setState:function(){if(!a.hasMod(this.el,this._currentContentState)){this._setContentState()}if(!a.hasMod(this.el,this._currentPlaybackState)){this._setPlaybackState()}this._hideSettingsMenu()},_setContentState:function(){var b=this._currentContentState;var c=this._oldContentState;var d=this.STATE_CONTENT_POSTER;var e=this.STATE_CONTENT_POSTER_ERROR;var f=this.STATE_CONTENT_POSTER_LOADING;var g=this.STATE_CONTENT_VIDEO;var h=this.STATE_CONTENT_ERROR;a.toggleMod(this.el,d,b==d);a.toggleMod(this.el,e,b==e);a.toggleMod(this.el,g,b==g);a.toggleMod(this.el,h,b==h);a.toggleMod(this.el,f,b==f);if(d==b){this._updatePosterSize()}else if(c!=b){var i=b.replace(/_/gi,"-");this.log("info",{radarName:this.type+"_"+"state",radars:[i+"_"+this._radarFilename+"=1",i+"_all=1"]})}this._oldContentState=this._currentContentState},_setPlaybackState:function(){var b=this._currentPlaybackState;var c=this.STATE_PLAYBACK_WAITING;var d=this.STATE_PLAYBACK_PLAYING;var e=this.STATE_PLAYBACK_PAUSED;var f=this.STATE_PLAYBACK_ERROR;a.toggleMod(this.el,c,b==c);a.toggleMod(this.el,d,b==d);a.toggleMod(this.el,e,b==e);a.toggleMod(this.el,f,b==f);var g=this._mediaElement;if(g){var h;if(b==e){h="play"}else{h="pause"}g.setAttribute("data-name",h)}},setSoundState:function(b){var c=this.STATE_SOUND_UNMUTED;var d=this.STATE_SOUND_MUTED;a.toggleMod(this.el,c,b==c);a.toggleMod(this.el,d,b==d)},setDuration:function(a){this._elements.duration.text(a||"--:--")},setTime:function(a){this._elements.time.text(a||"00:00")},setBufferingProgress:function(a){this._elements.progressBuffered.width(a+"%")},setCaption:function(a){this._elements.caption.text(a)},setMediaElement:function(a){if(!this._hasMediaElement){this._hasMediaElement=true;this._mediaElement=a;if(this.type=="video"){if(!this._mediaElementClassName){this._mediaElementClassName=this._elements.video[0].className}a.className=this._mediaElementClassName;a.setAttribute("data-name","play");a.poster=this.emptyImageSrc;this._elements.video.replaceWith(this._mediaElement);this._elements.video=$(this._mediaElement)}}},removeMediaElement:function(){if(this._hasMediaElement){this._hasMediaElement=false;this._mediaElement=null;if(this.type=="video"){var a=$('<div class="js-video"/>');this._elements.video.replaceWith(a);this._elements.video=a}}},hasMediaElement:function(){return this._hasMediaElement},clearPoster:function(){if(this._poster){this._poster.onload=null;this._poster.onerror=null;this._poster.src=this.emptyImageSrc;this._poster=null}},showVideo:function(){this.setContentState(this.STATE_CONTENT_VIDEO)},showPoster:function(){var a=new $.Deferred,b=this.data.posterUrl;if(this._poster&&(this._poster.src==b||this._poster.src==this.emptyImageSrc)){this.setContentState(this._poster.src==this.emptyImageSrc?this.STATE_CONTENT_POSTER_ERROR:this.STATE_CONTENT_POSTER);return}if(!this._poster){this._poster=new Image}this.setContentState(this.STATE_CONTENT_POSTER_LOADING);this._poster.onload=function(){this._poster.onload=this._poster.onerror=null;this._elements.poster[0].src=b;if(this.getContentState()===this.STATE_CONTENT_POSTER_LOADING){this.setContentState(this.STATE_CONTENT_POSTER)}a.resolve()}.bind(this);this._poster.onerror=function(){this._poster.onload=this._poster.onerror=null;this._poster.src=this.emptyImageSrc;if(this.getContentState()===this.STATE_CONTENT_POSTER_LOADING){this.setContentState(this.STATE_CONTENT_POSTER_ERROR)}a.reject()}.bind(this);this._poster.src=b;return a},showError:function(a){this.setPlaybackState(this.STATE_PLAYBACK_ERROR);this.setContentState(this.STATE_CONTENT_ERROR);this._elements.errorCode.text(a||"")},_updatePosterSize:function(){if(this.type!=="video"){return}var a=this._poster.naturalWidth,b=this._poster.naturalHeight,c=$(this._elements.poster);if(a&&b){if(this._elements.content.width()/this._elements.content.height()<a/b){c.width("100%");c.height("auto")}else{c.width("auto");c.height("100%")}}if(this._poster.src==this.emptyImageSrc){this._posterHeight=0;this._posterWidth=0}else{this._posterHeight=c.height();this._posterWidth=c.width()}},getDimensions:function(){var a=this.$el;var b=this._elements.content;var c=Math.max(b.height(),176);var d=Math.max(b.width(),208);var e=this._posterHeight||c;var f=this._posterWidth||d;return{viewHeight:a.height(),viewWidth:a.width(),contentHeight:c,contentWidth:d,posterHeight:e,posterWidth:f,aspectRatio:f/e}},_getSettingsMenu:function(){var a=this._elements.settings.find(".b-tooltip");var b=a.getBlock();return b},_showSettingsMenu:function(){var a=this._getSettingsMenu();if(!a){a=new c({renderMode:"replace",template:"app",$target:this._elements.settings,relative:true,offset:{x:5,y:5},mods:["bc"],data:{mods:["closable","media-player-settings"],block:this.settingsBlock,levels:this._videoQualityLevels}});a.renderTo("<div/>");this._elements.settings.append(a.el);a.show()}},_hideSettingsMenu:function(){var a=this._getSettingsMenu();if(a){a.destroy()}},setVideoQualityLevels:function(a){var b=this.settingsBlock&&a.length;this.toggleMod(this.STATE_SETTINGS_SUPPORTED,b);a=a.slice(0);a.sort(function(a,b){if(a.videoHeight>b.videoHeight){return-1}if(a.videoHeight<b.videoHeight){return 1}return 0});this._videoQualityLevels=a},init:function(){this._elements={};this._super.init.call(this);this._radarFilename=(this.getData().filename.extension||"unknown").toLowerCase()},render:function(){this._super.render.call(this)},renderTo:function(a,b){this._super.renderTo.call(this,$("<div/>"),b);a.append(this.el)},reflow:function(){this._updatePosterSize();this._hideSettingsMenu();this.emit(this.EVENT_RESIZE,this.getDimensions())},getContentContainer:function(){return this._elements&&this._elements.content},destroy:function(){clearTimeout(this._setContentStateTimeout);clearTimeout(this._setPlaybackStateTimeout);this._stopListeningGestures();this._hideSettingsMenu();this.$el&&this.$el.remove();this._super.destroy.call(this)}})});define("jukebox/jukebox/jukebox",["mrg-microevent","turntable/Turntable","jukebox/b-jukebox/b-jukebox","turntable/tools/time","ajs/ajs"],function(a,b,c,d){"use strict";a:{window.Turntable=b}function e(a){this._origin="jukebox-"+Math.random().toString(36).slice(2);this._boundListeners={};this._setView(a.view);this._createPlayer(a);this._url=a.url;this._mimeType=a.mimeType;this._isCanPlay=this._player.isCanPlay(a.mimeType);this._listenView();this._listenPlayer();a:{window.turntable=this._player;window.jukebox=this}}e.prototype={constructor:e,EVENT_PLAY:"play",EVENT_PAUSE:"pause",EVENT_ENDED:"ended",minPercentageVolume:5,_origin:"",_view:null,_player:null,_isCanPlay:false,_pending:true,_isFullScreen:false,_userActivityLastTime:Date.now(),_userActivityIdleTime:5e3,_viewPlaybackState:null,_boundListeners:null,_playerEvents:{sourceChange:"_onPlayerSourceChange",loadStart:"_onPlayerLoadStart",seeking:"_onPlayerSeeking",waiting:"_onPlayerWaiting",playing:"_onPlayerPlaying",canPlay:"_onPlayerCanPlay",loadedData:"_onPlayerLoadedData",loadedMetaData:"_onPlayerLoadedMetaData",durationChange:"_onPlayerDurationChange",mute:"_onPlayerMute",unmute:"_onPlayerUnmute",volumeChange:"_onPlayerVolumeChange",play:"_onPlayerPlay",pause:"_onPlayerPause",progress:"_onPlayerProgress",timeUpdate:"_onPlayerTimeUpdate",timeIntervalUpdate:"_onPlayerTimeIntervalUpdate",ended:"_onPlayerEnded",seeked:"_onPlayerSeeked",qualityChange:"_onPlayerQualityChange",qualityListChange:"_onPlayerQualityListChange",emptied:"_onPlayerEmptied",abort:"_onPlayerAbort",error:"_onPlayerError",mediaError:"_onPlayerMediaError",pluginError:"_onPlayerPluginError",videoQualityChange:"_onPlayerVideoQualityChange"},_viewEvents:{play:"_onViewPlay",pause:"_onViewPause",retry:"_onViewRetry",mute:"_onViewMute",unmute:"_onViewUnmute",volumeChange:"_onViewVolumeChange",timeChange:"_onViewTimeChange",videoQualityChange:"_onViewVideoQualityChange",ready:"_onViewReady",resize:"_onViewResize"},_onPlayerSourceChange:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){d.setTime(0);d.setDuration(0);d.setPlaybackProgress(0);d.setBufferingProgress(0);this._setViewPlaybackState("paused")}},_onPlayerLoadStart:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){if(!c.isPaused()){this._setViewPlaybackState("waiting")}}},_onPlayerSeeking:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){if(!c.isPaused()){this._setViewPlaybackState("waiting")}}},_onPlayerWaiting:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){if(!c.isPaused()){this._setViewPlaybackState("waiting")}}},_onPlayerPlaying:function(a,b){var c=this._player;var e=this._view;if(this._origin==b.origin){this._setViewPlaybackState("playing");var f=a.type.toLowerCase();var g=b.waitingTime||0;if(b.isFirstTime){f+="_first-time"}this._log("info",f,g);f+="-"+d.interval(g,6e4,"over1m");this._log("info",f,g)}},_onPlayerCanPlay:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){d.setDuration(b.durationTimeString);d.setBufferingProgress(b.percentageBufferedTime);this.adjustVideoSize()}},_onPlayerLoadedData:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){d.setDuration(b.durationTimeString);d.setBufferingProgress(b.percentageBufferedTime)}},_onPlayerLoadedMetaData:function(a,b){var c=this._player;var e=this._view;if(this._origin==b.origin){e.setDuration(b.durationTimeString);e.setBufferingProgress(b.percentageBufferedTime);this.adjustVideoSize();var f=a.type.toLowerCase();var g=b.waitingTime||0;this._log("info",f,g);f+="-"+d.interval(g,6e4,"over1m");this._log("info",f,g)}},_onPlayerDurationChange:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){d.setDuration(b.durationTimeString);d.setBufferingProgress(b.percentageBufferedTime)}},_onPlayerMute:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){d.setSoundState("muted");d.setVolume(0)}},_onPlayerUnmute:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){d.setSoundState("unmuted");d.setVolume(b.percentageVolume)}},_onPlayerVolumeChange:function(a,b){var c=this._player;var d=this._view;if(b.isMuted){d.setSoundState("muted");d.setVolume(0)}else{d.setSoundState("unmuted");d.setVolume(b.percentageVolume)}},_onPlayerPlay:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){}},_onPlayerPause:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){this._setViewPlaybackState("paused")}},_onPlayerProgress:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){d.setTime(b.currentTimeString);d.setPlaybackProgress(b.percentageCurrentTime);d.setBufferingProgress(b.percentageBufferedTime)}},_onPlayerTimeUpdate:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){d.setTime(b.currentTimeString);d.setPlaybackProgress(b.percentageCurrentTime);d.setBufferingProgress(b.percentageBufferedTime);if(this._isFullScreen){var e=Date.now()-this._userActivityLastTime;if(e>this._userActivityIdleTime){d.setFullScreenIdleState(true)}else{d.setFullScreenIdleState(false)}}}},_onPlayerTimeIntervalUpdate:function(a,b){var c=this._player;var d=this._view;var e=Math.round(b.percentageCurrentTime);var f=b.percentageCurrentTimeInterval;var g=Math.round(b.duration);this._log("info","progress",e);this._log("info","progress-"+f,g)},_onPlayerEnded:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){d.setTime(b.durationTimeString);d.setPlaybackProgress(100);d.setBufferingProgress(100);this._setViewPlaybackState("paused");d.showPoster();d.setFullScreenIdleState(false);this.emit(this.EVENT_ENDED,{})}},_onPlayerSeeked:function(a,b){var c=this._player;var e=this._view;if(this._origin==b.origin){e.setTime(b.currentTimeString);e.setPlaybackProgress(b.percentageCurrentTime);e.setBufferingProgress(b.percentageBufferedTime);var f=b.waitingTime||0;var g=d.interval(f,6e4,"over1m");if(b.buffered){this._log("info","seek-buffered",f);this._log("info","seek-buffered-"+g,f)}else{this._log("info","seek-unbuffered",f);this._log("info","seek-unbuffered-"+g,f)}}},_onPlayerQualityChange:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){}},_onPlayerQualityListChange:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){}},_onPlayerEmptied:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){d.setTime(0);d.setDuration(0);d.setPlaybackProgress(0);d.setBufferingProgress(0)}},_onPlayerAbort:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){d.setTime(0);d.setPlaybackProgress(0)}},_onPlayerError:function(a,b){var c=this._player;var d=this._view;if(this._origin==b.origin){d.showError("player error");var e=String(b.reason).toLowerCase().replace(/_/g,"-");this._log("error","error-turntable_"+e)}},_getMediaErrorMessage:function(a){if(a&&window.MediaError){var b=a.code;var c=Object.keys(MediaError).filter(function(a){return/^MEDIA_ERR_/.test(a)}).reduce(function(a,b){var c=MediaError[b];if(typeof c=="number"){a[c]=c+":"+b}return a},{});return c[b]||"CODE"+b}return""},_getPreloadProgress:function(a,b){for(var c=0,d=a.length;c<d;c++){if(b>=a.start(c)&&b<=a.end(c)){return a.end(c)}}return 0},_round10:function(a,b){a=a.toString().split("e");a=Math.round(+(a[0]+"e"+(a[1]?+a[1]-b:-b)));a=a.toString().split("e");return+(a[0]+"e"+(a[1]?+a[1]+b:b))},_logFatalJSHLSErrorDetails:function(a){var b="error-jshls";if(typeof a.type==="string"){b+="-"+a.type.toLowerCase()}if(typeof a.details==="string"){b+="-"+a.details.toLowerCase()}this._log("error",b)},_logMediaError:function(a,b,c){var d=this._player;var e=this._view;var f=d.getMediaElement();var g=f.error;var h=f.buffered;var i=f.currentTime;a:{if(!i&&f.hlsGetPrevTimeInfo){var j=f.hlsGetPrevTimeInfo();h=j.buffered;i=j.currentTime}}this._log("error",a,1,b,{uniqueId:(Math.random()*1e9|0).toString(32)+"X"+this._round10(i,-3),errorMsg:this._getMediaErrorMessage(g)||(g?g.message:undefined),currentTime:i,mediaSrc:f.src,preloadProgress:h?this._getPreloadProgress(h,i):0,videoWidth:f.videoWidth,videoHeight:f.videoHeight,duration:f.duration,errorDetail:c.error,plugin:c.plugin});c.alreadySent=Date.now()},_onPlayerMediaError:function(a,b){var c=this._player;var d=this._view;if(!b.alreadySent&&this._origin==b.origin){d.showError("media error");var e="error-media";var f="Media-"+d.type+"-error";this._logMediaError(e,f,b)}},_onPlayerPluginError:function(a,b){var c=this._player;var d=this._view;if(!b.alreadySent&&this._origin==b.origin){var e=String(b.plugin).toLowerCase();var f="error-"+e;var g="Media-"+e+"-error";if(b.error&&b.error.fatal){this._log("error",f+"-fatal");if(b.plugin==="JSHLS"){this._logFatalJSHLSErrorDetails(b.error)}}this._logMediaError(f,g,b)}},_onPlayerVideoQualityChange:function(a,b){var c=this._view;if(this._origin==b.origin){c.setVideoQualityLevels(b.levels)}},_onViewRetry:function(a,b){var c=this._player;var d=this._view;var e=this;c.reload();window.setTimeout(function(){e._onViewPlay(a,b)},0)},_onViewPlay:function(a,b){var c=this._player;var d=this._view;var e=d.type=="video";if(this._getViewPlaybackState()=="error"){d.removeMediaElement()}if(this._isCanPlay){if(e){d.showVideo()}if(!d.hasMediaElement()){this._setSource();d.setMediaElement(c.getMediaElement())}if(e){this.adjustVideoSize()}this._setViewPlaybackState("waiting");c.play();this.emit(this.EVENT_PLAY,{});this._log("info","try-start")}else{d.showError("plugin error")}},_onViewPause:function(a,b){var c=this._player;var d=this._view;c.pause();this.emit(this.EVENT_PAUSE,{})},_onViewMute:function(a,b){var c=this._player;var d=this._view;c.mute();d.setVolume(0)},_onViewUnmute:function(a,b){var c=this._player;var d=this._view;c.unmute();d.setVolume(c.getPercentageVolume())},_onViewVolumeChange:function(a,b){var c=this._player;var d=this._view;var e=b.percentageVolume;if(e<this.minPercentageVolume){c.mute()}else{if(c.isMuted()){c.unmute()}c.setPercentageVolume(e)}},_onViewTimeChange:function(a,b){var c=this._player;var d=this._view;if(!this._pending){c.setPercentageCurrentTime(b.percentageTime)}else{d.setPlaybackProgress(0)}},_onViewVideoQualityChange:function(a,b){var c=this._player;c.setVideoQualityLevel(b.level)},_onViewReady:function(a,b){this._setViewInitialState()},_onViewResize:function(a,b){var c=this._player;var d=this._view;if(d.type=="video"){this.adjustVideoSize()}},_listen:function(a,b){var c=this._boundListeners;for(var d in b){if(b.hasOwnProperty(d)){var e=b[d];var f=c[e];if(!f){f=c[e]=this[e].bind(this)}a.on(d,f)}}},_stopListening:function(a,b){var c=this._boundListeners;for(var d in b){if(b.hasOwnProperty(d)){var e=b[d];var f=c[e];if(f){a.off(d,f);delete c[e]}}}},_listenPlayer:function(){this._listen(this._player,this._playerEvents)},_stopListeningPlayer:function(){this._stopListening(this._player,this._playerEvents)},_listenView:function(){this._listen(this._view,this._viewEvents)},_stopListeningView:function(){this._stopListening(this._view,this._viewEvents)},_createPlayer:function(a){this._player=new b({plugins:a.plugins||{}})},_setSource:function(a){var b=this._player;if(b.setSource(this._mimeType,this._url,this._origin,a)){this._pending=false}},_setView:function(a){if(a instanceof c){this._view=a}else{throw new TypeError("the view should be an instance of the b-jukebox")}},_setViewInitialState:function(){var a=this._player;var b=this._view;b.setTime(0);b.setDuration(0);b.setPlaybackProgress(0);b.setBufferingProgress(0);b.setFullScreenIdleState(false);this._setViewPlaybackState("paused");if(a.isMuted()){b.setSoundState("muted");b.setVolume(0)}else{b.setSoundState("unmuted");b.setVolume(a.getPercentageVolume())}},_setViewPlaybackState:function(a){this._view.setPlaybackState(a);this._viewPlaybackState=this._view.getPlaybackState()},_getViewPlaybackState:function(){return this._viewPlaybackState},adjustVideoSize:function(){var a=this._player;var b=this._view;if(!this._isCanPlay||!b.hasMediaElement()){return}var c=a.getDimensions();var d=b.getDimensions();var e=d.contentWidth;var f=d.contentHeight;var g;if(a.isMetaDataLoaded()){g=c.aspectRatio}else{g=d.aspectRatio}var h=e;var i=h/g;if(i>f){i=f;h=i*g}h=Math.round(h||1)+"px";i=Math.round(i||1)+"px";e+="px";f+="px";a.resizeTo(i,h,f,e)},getView:function(){return this._view},getPlayer:function(){return this._player},play:function(){if(this._player.isPaused()){this._onViewPlay()}},pause:function(){if(!this._player.isPaused()){this._onViewPause()}},togglePlayback:function(){if(this._player.isPaused()){this.play()}else{this.pause()}},enterFullscreen:function(){var a=this._view;a.setFullScreenState(true);this._isFullScreen=true;this._startTrackingUserActivity()},exitFullscreen:function(){var a=this._view;a.setFullScreenState(false);this._isFullScreen=false;this._stopTrackingUserActivity()},_startTrackingUserActivity:function(){this._userActivityLastTime=Date.now();document.addEventListener("mousedown",this);document.addEventListener("mousemove",this);document.addEventListener("keydown",this);window.addEventListener("resize",this)},_stopTrackingUserActivity:function(){document.removeEventListener("mousedown",this);document.removeEventListener("mousemove",this);document.removeEventListener("keydown",this);window.removeEventListener("resize",this)},_onUserActivity:function(){this._userActivityLastTime=Date.now()},handleEvent:function(a){switch(a.type){case"mousedown":case"mousemove":case"keydown":case"resize":this._onUserActivity(a);break}},_log:function(a,b,c,d,e){var f=this._player;var g=this._view;var h=f.getPluginName();if(c===undefined){c="1"}var i=[g._radarFilename+"="+c,"desktop"+"="+c,"all="+c];if(h){i.push(h.toLowerCase()+"="+c)}var j={radarName:g.type+"_"+b,radars:i};if(d&&e){j.kaktamName=d;j.kaktam=e}g.log(a,j)},renderTo:function(a,b){this._view.renderTo(a,b)},reflow:function(){var a=this._player;var b=this._view;b.reflow()},startLoading:function(a,b,c){var d=this._player;var e=this._view;if(e.type=="video"){e.showPoster().always(a)}else{if(c&&c.preload){this._setSingleSourceListeners(a,b);this._setSource(c)}else{a()}}},_setSingleSourceListeners:function(a,b){var c=this._player;var d="pluginError mediaError error";var e="loadedMetaData";c.off(d,this._sourceErrorHandler);c.off(e,this._sourceSuccessHandler);this._sourceErrorHandler=function(){b();f()};this._sourceSuccessHandler=function(){a();f()};var f=function(){c.off(d,this._sourceErrorHandler);c.off(e,this._sourceSuccessHandler)}.bind(this);c.on(d,this._sourceErrorHandler);c.on(e,this._sourceSuccessHandler)},stopLoading:function(){var a=this._player;var b=this._view;if(b.type=="video"){b.clearPoster()}},freeze:function(){var a=this._player;var b=this._view;a.pause();a.setSource(this._mimeType,"",this._origin);if(b.type=="video"){b.showPoster()}b.removeMediaElement();b.setVideoQualityLevels([])},unfreeze:function(){this._setViewInitialState()},destroy:function(){this.freeze();this._stopListeningView();this._stopListeningPlayer();if(this._isFullScreen){this.exitFullscreen()}this._view.destroy();delete this._view;delete this._player;a:{window.turntable=null;window.jukebox=null}}};a.mixin(e);return e});define("viewer/b-media-player-settings/b-media-player-settings",["toolkit/b-toolkit/b-toolkit"],function(a){return a.create("b-media-player-settings")});define("viewer/b-media-player/b-media-player",["jukebox/b-jukebox/b-jukebox","viewer/b-media-player-settings/b-media-player-settings"],function(a){return a.extend("b-media-player",{settingsBlock:"b-media-player-settings",reflow:function(){a.fn.reflow.apply(this,arguments);this._adjustControls()},_adjustControls:function(){}})});define("viewer/b-view/_video/b-view_video",["jquery","toolkit/b-toolkit/b-toolkit","viewer/b-view/b-view","jukebox/jukebox/jukebox","viewer/b-media-player/b-media-player","toolkit/b-resize-detector/b-resize-detector"],function($,a,b,c,d,e){return b.extend("b-view_video",{isPreloadable:true,boundAll:["_onFullScreen","_onResize","_onPlay","_onPause","_onEnded"],init:function(){b.fn.init.apply(this,arguments)},_createMediaPlayer:function(){var a=this.data;this._mediaPlayerView=new d({logLevels:this.logLevels,logHandler:this.logHandler,type:"video",template:this.template,fullScreenSupported:this.fullScreenEnabled,data:$.extend({},a,{sourceUrl:a.mediaUrl,posterUrl:a.posterUrl})});this._mediaPlayerView.on("fullscreen",this._onFullScreen);this._mediaPlayer=new c({view:this._mediaPlayerView,plugins:this.plugins,url:a.mediaUrl,mimeType:a.mimeType});if(!this._mediaPlayer._isCanPlay){this._showDummy()}else{this._mediaPlayer.on("play",this._onPlay);this._mediaPlayer.on("pause",this._onPause);this._mediaPlayer.on("ended",this._onEnded)}this._resizeDetector=new e({template:this.template,onResize:this._onResize})},_renderMediaPlayer:function(){this._mediaPlayer.renderTo(this.$viewVideo);this._resizeDetector.attachTo(this._mediaPlayerView.getContentContainer());this._mediaPlayer.startLoading(function(){},function(){});this._syncFullScreenState();if(this.isAutoplayEnabled()){this._mediaPlayer.play()}},_destroyMediaPlayer:function(){if(this._mediaPlayer){this._mediaPlayerView.off("fullscreen",this._onFullScreen);this._mediaPlayer.stopLoading();this._resizeDetector.destroy();this._mediaPlayer.off("play",this._onPlay);this._mediaPlayer.off("pause",this._onPause);this._mediaPlayer.off("ended",this._onEnded);this._mediaPlayer.destroy();this._mediaPlayer=this._mediaPlayerView=this._resizeDetector=null}},_startLoading:function(a,b){a()},_stopLoading:function(){},render:function(a){b.fn.render.call(this,a);this.$viewVideo=this.$el.find(".js-viewVideo");this._syncFullScreenState()},destroy:function(){b.fn.destroy.apply(this,arguments);this._destroyMediaPlayer()},_freeze:function(){var a=this._mediaPlayer;if(a){a.freeze()}},_unfreeze:function(){var a=this._mediaPlayer;if(a){a.unfreeze()}else{this._createMediaPlayer();this._renderMediaPlayer()}if(this.isAutoplayEnabled()){this._mediaPlayer.play()}},_onResize:function(){this._syncFullScreenState();this._mediaPlayer.reflow()},_syncFullScreenState:function(){var b=this.isFullScreen();var c=this._mediaPlayer;a.toggleMod(this.$viewVideo,"fullscreen",b);if(c){if(b){c.enterFullscreen()}else{c.exitFullscreen()}}},_onFullScreen:function(){this.onToggleFullScreen()},_onPlay:function(){this.enableAutoplay()},_onPause:function(){this.disableAutoplay()},_onEnded:function(){this.next()},onSpaceKey:function(a){if(this._mediaPlayer){this._mediaPlayer.togglePlayback()}}})});define("viewer/b-view/_audio/b-view_audio",["jquery","viewer/b-view/b-view","jukebox/jukebox/jukebox","viewer/b-media-player/b-media-player"],function($,a,b,c){var d=["audio/x-flac"];var e=["m4a","flac","aiff","wav"];return a.extend("b-view_audio",{isPreloadable:true,boundAll:["_onPlay","_onPause","_onEnded"],init:function(){a.fn.init.apply(this,arguments)},plugins:{Native:{ignoreCheckingMimeTypes:d}},_createMediaPlayer:function(){var a=this.data;this._mediaPlayerView=new c({type:"audio",logLevels:this.logLevels,logHandler:this.logHandler,template:this.template,data:$.extend({},a,{sourceUrl:a.viewUrl})});this._mediaPlayer=new b({view:this._mediaPlayerView,plugins:this.plugins,url:a.viewUrl,mimeType:a.mimeType||a.contentType});if(!this._mediaPlayer._isCanPlay){this._showDummy()}else{this._mediaPlayer.on("play",this._onPlay);this._mediaPlayer.on("pause",this._onPause);this._mediaPlayer.on("ended",this._onEnded)}},_renderMediaPlayer:function(){this._mediaPlayer.renderTo(this.$audioContent);if(this.isAutoplayEnabled()){this._mediaPlayer.play()}},_destroyMediaPlayer:function(){if(this._mediaPlayer){this._mediaPlayer.stopLoading();this._mediaPlayer.off("play",this._onPlay);this._mediaPlayer.off("pause",this._onPause);this._mediaPlayer.off("ended",this._onEnded);this._mediaPlayer.destroy();this._mediaPlayer=this._mediaPlayerView=this._resizeDetector=null}},_startLoading:function(a,b){a()},_stopLoading:function(){},render:function(b){a.fn.render.call(this,b);this.$viewAudio=this.$el.find(".js-viewAudio");this.$audioContent=this.$viewAudio.find(".js-audioContent")},destroy:function(){a.fn.destroy.apply(this,arguments);this._destroyMediaPlayer()},_freeze:function(){var a=this._mediaPlayer;if(a){a.freeze()}},_unfreeze:function(){var a=this._mediaPlayer;if(a){a.unfreeze()}else{this._createMediaPlayer();this._renderMediaPlayer()}var b={preload:false};if(e.indexOf(this.data.filename.extension)!==-1){b.preload=true;this._mediaPlayer.startLoading(function(){},function(){this._showDummy()}.bind(this),b)}if(this.isAutoplayEnabled()){this._mediaPlayer.play()}},_onPlay:function(){this.enableAutoplay()},_onPause:function(){this.disableAutoplay()},_onEnded:function(){this.next()},onSpaceKey:function(a){if(this._mediaPlayer){this._mediaPlayer.togglePlayback()}}})});define("viewer/b-view/_frame/b-view_frame",["jquery","viewer/b-view/b-view"],function($,a){var b=a.extend("b-view_frame",{isPreloadable:true,boundAll:["_onLoad","_onTimeout"],_timeout:3e4,init:function(){this._preloaded=false;a.fn.init.apply(this,arguments)},getData:function(){return $.extend(a.fn.getData.apply(this),{iframeUrl:this._isPreloadable()?"about:blank":this.data.viewUrl},this.data)},render:function(){a.fn.render.call(this);this._frame=this.el.querySelector(".js-viewIframeIframe")},_onLoad:function(){this._free();var a=this._frame;this._redrawTimeoutId=setTimeout(function(){a.style.position="absolute"}.bind(this),1e3);this._deferred.resolve()},_onTimeout:function(){this._stopListening();this._deferred.reject(new Error("time is out"))},_listen:function(){var a=this._frame;if(a){a.addEventListener("load",this._onLoad)}},_stopListening:function(){var a=this._frame;if(a){a.removeEventListener("load",this._onLoad)}},_setTimeout:function(a){this._timeoutId=window.setTimeout(this._onTimeout,a||this._timeout)},_clearTimeout:function(){window.clearTimeout(this._timeoutId)},_startLoading:function(a,b){this._deferred=(new $.Deferred).done(a).fail(b);this._free();this._setTimeout();this._listen();var c=this._frame;c.src=this.data.viewUrl},_stopLoading:function(){this._free();var a=this._frame;if(a){a.src="about:blank"}},_free:function(){this._clearTimeout();this._stopListening()},_showDummy:function(){this._stopLoading();$(this._frame).remove();this._frame=null;a.fn._showDummy.apply(this,arguments)},destroy:function(){this._stopLoading();if(this._redrawTimeoutId){clearTimeout(this._redrawTimeoutId);this._redrawTimeoutId=null}this._deferred=null;this._frame=null;a.fn.destroy.apply(this,arguments)}});return b});define("viewer/b-view/_text/b-view_text",["viewer/b-view/_frame/b-view_frame"],function(a){return a.extend("b-view_text",{})});define("ajs/__utils__pdf/ajs__utils__pdf",["ajs"],function(a){if(!a.utils){a.utils={}}var b={};var c=function(){var a=null;if(window.ActiveXObject){try{a=new ActiveXObject("AcroPDF.PDF")}catch(a){}if(!a){try{a=new ActiveXObject("PDF.PdfCtrl")}catch(a){}}if(a!==null){return true}}return false};var d=function(){if(navigator.plugins){var a,b=navigator.plugins,c=b.length,d=/Adobe Reader|Adobe PDF|Acrobat/gi;for(a=0;a<c;a++){if(d.test(b[a].name)){return true}}}return false};var e=function(){var a=navigator.mimeTypes["application/pdf"];return a&&a.enabledPlugin};var f=function(){var a=null;if(d()||c()){a="Adobe"}else if(e()){a="generic"}return a};var g=function(a,c){if(b.disabled){return false}c=c||{};c.url=c.url||"";c.width=c.width||"100%";c.height=c.height||"100%";var d=a.nodeType&&a.nodeType===1?a:document.getElementById(a);if(!d){return false}d.innerHTML='<object\tdata="'+c.url+'" type="application/pdf" width="'+c.width+'" height="'+c.height+'"></object>';return d.getElementsByTagName("object")[0]};function h(a){if(typeof Blob==="undefined"||typeof Uint8Array==="undefined"||typeof URL!=="object"&&typeof URL!=="function"||typeof URL.createObjectURL!=="function"){a(false);a=void 0;return}function b(){return b.blobUrl=URL.createObjectURL(new Blob([new Uint8Array([37,80,68,70,45,49,46,52,10,37,225,233,235,211,10,50,32,48,32,111,98,106,10,60,60,47,84,121,112,101,32,47,67,97,116,97,108,111,103,10,47,80,97,103,101,115,32,49,32,48,32,82,10,62,62,10,101,110,100,111,98,106,10,51,32,48,32,111,98,106,10,60,60,47,84,121,112,101,32,47,80,97,103,101,10,47,80,97,114,101,110,116,32,49,32,48,32,82,10,47,82,101,115,111,117,114,99,101,115,32,60,60,47,80,114,111,99,83,101,116,115,32,91,47,80,68,70,32,47,84,101,120,116,32,47,73,109,97,103,101,66,32,47,73,109,97,103,101,67,32,47,73,109,97,103,101,73,93,10,47,69,120,116,71,83,116,97,116,101,32,60,60,47,71,48,32,52,32,48,32,82,10,62,62,10,47,88,79,98,106,101,99,116,32,60,60,47,88,48,32,53,32,48,32,82,10,62,62,10,62,62,10,47,77,101,100,105,97,66,111,120,32,91,48,32,48,32,54,49,50,32,55,57,50,93,10,47,67,111,110,116,101,110,116,115,32,54,32,48,32,82,10,62,62,10,101,110,100,111,98,106,10,54,32,48,32,111,98,106,10,60,60,47,70,105,108,116,101,114,32,47,70,108,97,116,101,68,101,99,111,100,101,10,47,76,101,110,103,116,104,32,49,51,49,10,62,62,32,115,116,114,101,97,109,10,120,156,51,84,48,0,66,93,67,32,97,110,105,164,144,156,203,85,200,5,18,49,51,52,2,11,20,165,114,133,43,228,129,4,245,204,77,193,106,225,12,160,90,67,5,16,12,114,87,128,48,138,210,185,244,221,13,20,210,139,193,70,88,24,154,41,24,26,152,154,129,204,72,3,234,183,52,2,10,160,82,64,157,88,197,129,6,97,49,1,67,4,211,122,98,116,5,2,125,99,2,241,130,46,144,54,6,250,220,88,207,20,228,29,168,227,245,35,12,20,92,242,129,234,2,185,0,255,16,57,84,10,101,110,100,115,116,114,101,97,109,10,101,110,100,111,98,106,10,52,32,48,32,111,98,106,10,60,60,47,84,121,112,101,32,47,69,120,116,71,83,116,97,116,101,10,47,67,65,32,49,10,47,99,97,32,49,10,47,76,67,32,48,10,47,76,74,32,48,10,47,76,87,32,48,10,47,77,76,32,52,10,47,83,65,32,116,114,117,101,10,47,66,77,32,47,78,111,114,109,97,108,10,62,62,10,101,110,100,111,98,106,10,53,32,48,32,111,98,106,10,60,60,47,84,121,112,101,32,47,88,79,98,106,101,99,116,10,47,83,117,98,116,121,112,101,32,47,73,109,97,103,101,10,47,87,105,100,116,104,32,54,48,10,47,72,101,105,103,104,116,32,54,48,10,47,67,111,108,111,114,83,112,97,99,101,32,47,68,101,118,105,99,101,82,71,66,10,47,66,105,116,115,80,101,114,67,111,109,112,111,110,101,110,116,32,56,10,47,70,105,108,116,101,114,32,47,70,108,97,116,101,68,101,99,111,100,101,10,47,76,101,110,103,116,104,32,55,56,10,62,62,32,115,116,114,101,97,109,10,120,156,237,206,177,9,0,0,12,195,176,254,255,116,122,68,201,84,129,103,163,204,164,83,235,155,222,152,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,249,133,185,183,46,146,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,15,45,219,208,2,195,10,101,110,100,115,116,114,101,97,109,10,101,110,100,111,98,106,10,49,32,48,32,111,98,106,10,60,60,47,84,121,112,101,32,47,80,97,103,101,115,10,47,67,111,117,110,116,32,49,10,47,75,105,100,115,32,91,51,32,48,32,82,93,10,62,62,10,101,110,100,111,98,106,10,120,114,101,102,10,48,32,55,10,48,48,48,48,48,48,48,48,48,48,32,54,53,53,51,53,32,102,32,10,48,48,48,48,48,48,48,56,48,49,32,48,48,48,48,48,32,110,32,10,48,48,48,48,48,48,48,48,49,53,32,48,48,48,48,48,32,110,32,10,48,48,48,48,48,48,48,48,54,51,32,48,48,48,48,48,32,110,32,10,48,48,48,48,48,48,48,52,54,52,32,48,48,48,48,48,32,110,32,10,48,48,48,48,48,48,48,53,53,56,32,48,48,48,48,48,32,110,32,10,48,48,48,48,48,48,48,50,54,50,32,48,48,48,48,48,32,110,32,10,116,114,97,105,108,101,114,10,60,60,47,83,105,122,101,32,55,10,47,82,111,111,116,32,50,32,48,32,82,10,62,62,10,115,116,97,114,116,120,114,101,102,10,56,53,55,10,37,37,69,79,70])],{type:"application/pdf"}))}function c(){if(b.blobUrl){URL.revokeObjectURL(b.blobUrl);b.blobUrl=void 0}}function d(a,b){var c="background-color:transparent;background-image:none;vertical-align:baseline;outline-style:none;border-style:none;padding:0px;margin:0px;font-size:4px;line-height:4px;";var e=d.testIframe=document.createElement("iframe");e.style.cssText=c+"display:block;width:500px;height:4px;position:absolute;right:9999px;top:-9999px;";e.onload=function(){c=c+"display:inline;";try{e.contentDocument.body.insertAdjacentHTML("beforeend",'<span id="PDFDetect1" style="visibility:visible;'+c+'">'+'<object style="visibility:hidden;'+c+'" type="application/pdf" data="'+a+'" width="1" height="1">'+'<param name="src" value="'+a+'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</object></span>'+'<span id="PDFDetect2" style="visibility:visible;'+c+'">'+'<object style="visibility:hidden;'+c+'" type="application/dummymimepdf" width="1" height="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</object></span>')}catch(a){b(null,"","",true);return}b(e.contentDocument,"PDFDetect1","PDFDetect2")};document.body.appendChild(e)}function e(){if(d.testIframe&&d.testIframe.parentNode){d.testIframe.parentNode.removeChild(d.testIframe);d.testIframe=void 0}}function f(a){if(!a){return 0}var b=a.offsetWidth||0;return b>0?b:a.scrollWidth||0}function g(a,b,c,d,e){if(e===true||g.attempt>g.maxAttempts){a(false)}else{g.attempt++;var h=b.getElementById(c);var i=b.getElementById(d);var j=f(h);var k=f(i);if(j==0||k==0||j==1&&k==1){setTimeout(g.bind(null,a,b,c,d,false),g.interval);return}a(j==1&&j<k)}}g.attempt=0;g.maxAttempts=5;g.interval=150;function h(b){c();e();a(b);a=function(){}}setTimeout(h.bind(null,false),g.maxAttempts*g.interval*4+5e3);try{d(b(),g.bind(null,h))}catch(a){h(false)}}b.type=f();b.disabled=!b.type;b.embed=g;if(b.disabled||b.type=="Adobe"){b.isCheckDone=false;h(function(a){b.isCheckDone=true;if(a){b.type="pdfjs-like";b.disabled=false}h=void 0;var c=b._callbacks||[];for(var d=0,e=c.length;d<e;d++){var f=c[d];if(typeof f==="function"){try{f(a)}catch(a){}}}b._callbacks=void 0})}else{b.isCheckDone=true;h=void 0}b.checkEnable=function(a){if(b.isCheckDone===true){if(typeof a==="function"){a(!b.disabled)}}else{(b._callbacks||(b._callbacks=[])).push(a)}};a.utils.PDF=b;return a.utils.PDF});define("viewer/b-view/_pdf/b-view_pdf",["viewer/b-view/_frame/b-view_frame","ajs/__utils__pdf/ajs__utils__pdf"],function(a,b){var c=function(a){if(b.disabled){b.checkEnable(a)}else{a(true)}};return a.extend("b-view_pdf",{isPreloadable:true,_checking:false,init:function(){a.fn.init.apply(this,arguments)},getData:function(){return a.fn.getData.call(this)},_startLoading:function(b,d){this._checking=true;c(function(c){this.isDisabled=!c;if(this._checking){if(!this.isDisabled){a.fn._startLoading.call(this,b,d)}else{d()}}}.bind(this))},_stopLoading:function(){this._checking=false;a.fn._stopLoading.apply(this,arguments)}})});define("viewer/b-view/_document/b-view_document",["viewer/b-view/_frame/b-view_frame"],function(a){var b=a.extend("b-view_document",{_timeout:8e3,init:function(){},onRender:function(){a.fn.init.apply(this,arguments);b.heap.add(this)},_onLoad:function(){this._free();this._setTimeout(a.fn._timeout)},_onMessage:function(b){var c=String(b.data);var d=c.split(" ")[0];switch(d){case"app.started":case"loaded":break;case"rendered":a.fn._onLoad.call(this);break;case"fail":this._free();this._deferred.reject(new Error("js error"));break;case"status":this._free();this._deferred.reject(new Error(c));break}},_showDummy:function(){b.heap.remove(this);a.fn._showDummy.apply(this,arguments)},destroy:function(){b.heap.remove(this);a.fn.destroy.call(this)}});b.heap={_heap:[],findIndexByView:function(a){var b=this._heap;var c=b.length;while(c--){if(b[c]===a){return c}}return-1},findIndexByWindow:function(a){var b=this._heap;var c=b.length;while(c--){var d=b[c];var e=d._frame;if(e&&e.contentWindow===a){return c}}return-1},getByWindow:function(a){var b=this.findIndexByWindow(a);if(b!=-1){return this._heap[b]}return null},add:function(a){var b=this.findIndexByView(a);if(b===-1){this._heap.push(a)}},remove:function(a){var b=this.findIndexByView(a);if(b!=-1){this._heap.splice(b,1)}}};window.addEventListener("message",function(a){var c=a.source;var d=b.heap.getByWindow(c);if(d){d._onMessage(a)}});return b});define("viewer/b-datatree/b-datatree",["jquery","toolkit/b-toolkit/b-toolkit"],function($,a){return a.create("b-datatree",{render:function(b){a["b-toolkit"].fn.render.call(this,b);this.$el.undelegate();this.$el.delegate(".js-datatreeNode","tap",this._onNodeClick.bind(this));this.$el.delegate(".js-datatreeNodeAction","tap",this._onNodeActionClick.bind(this))},_onNodeClick:function(b){b.stopPropagation();var c=$(b.currentTarget),d=c.attr("data-id");if(c.find(".js-datatreeList").length){a.toggleMod(c,"collapsed")}else if(d){this.emit("nodeClick",[d])}},_onNodeActionClick:function(a){a.preventDefault();a.stopPropagation();var b=$(a.currentTarget),c=b.closest(".js-datatreeNode"),d=c.attr("data-id"),e=b.attr("data-name");this.emit("nodeActionClick",[d,e])}})});define("viewer/b-view/_archive/b-view_archive",["viewer/b-view/b-view","viewer/b-datatree/b-datatree"],function(a,b){return a.extend("b-view_archive",{render:function(){a.fn.render.call(this);this.$viewArchive=this.$el.find(".js-viewArchive");this.$archiveContents=this.$viewArchive.find(".js-archiveContents");this.$archiveContentsShow=this.$viewArchive.find(".js-archiveContentsShow");this.$archiveContentsShow.bind("tap",this.showContents.bind(this));this._rendered=true;if(this._dontForgetToShowContents){this._showContents()}if(this.data.datatreeData){this._renderContents(this.data.datatreeData)}},_renderContents:function(a){this.$archiveContents.empty();var c=new b({template:this.template,data:a,onNodeClick:function(a,b){this.emit("itemClick",[b])}.bind(this),onNodeActionClick:function(a,b,c){this.emit("itemActionClick",[b,c])}.bind(this)});c.renderTo(this.$archiveContents)},_showContents:function(){this.item.startProcessing();this.$archiveContents.empty().text(Lang.get("attachment-browser").loading);this.data.requestContents().done(function(a){this.item.stopProcessing();var b=[],c=function(a){var d={items:[]};a.forEach(function(a){var e;if("size"in a){var f=this.data.attachment.messageId+"-"+this.data.attachment.partIds.join(";")+"-"+a.getPath().join("-");e={id:f,filename:a.filename,icon:a.filename.extension,actions:[{name:"download",icon:"download",text:a.friendlySize,width:70}]};b.push({id:f,data:a})}else{e={filename:a.filename,icon:"folder",mods:["collapsed"],list:c(a._contents)}}if(a._contents){e.list=c(a._contents)}d.items.push(e)},this);return d}.bind(this),d={mods:["viewer"],list:c(a)};this._renderContents(d);this.emit("showContents",[b,d])}.bind(this)).fail(function(){this.$archiveContents.empty().text(Lang.get("attachment-browser").error);this.item.stopProcessing()}.bind(this))},showContents:function(){if(this._rendered){this._showContents()}else{this._dontForgetToShowContents=true}}})});define("viewer/b-view/_thumbnail/b-view_thumbnail",["toolkit/b-toolkit/b-toolkit","viewer/b-view/b-view","toolkit/b-thumb/b-thumb"],function(a,b,c){return b.extend("b-view_thumbnail",{isPreloadable:true,init:function(){b.fn.init.call(this);this._thumbnail=new c({template:this.template,renderMode:"append",data:{mods:["viewer"]}});this.data.src=this.data.getThumbnailImageUrl(160,120);this.isPreloadable=!!this.data.src},render:function(){b.fn.render.call(this);var c=this.data.getThumbnailImageUrl(160,120);this._thumbnail.renderTo(this.$el.find(".js-view"),{icon:this.data.icon||this.data.filename.extension,filename:{name:this.data.filename.name,extension:this.data.filename.extension,mods:["viewer"]},imageUrl:c,isDocument:c&&this.data.type!=="image",isDeferred:true,controls:{bottom:{left:{items:[{icon:"system_download",text:a.lang.get("btn.download"),href:this.data.downloadUrl,mods:["bare"],classes:["js-download"]}]}}},imageOverlay:this.imageOverlay});this.$el.delegate(".js-download","tap",this._onActionClick.bind(this))},_onActionClick:function(a){this.item.doAction("download");this.log("info",{radarName:"action_download",radars:[this._radarFilename+"=1","all=1"]});a.preventDefault();a.stopPropagation()},_startLoading:function(a,b){this._thumbnail.startLoading(a,function(){b({type:"thumbnail",extension:this.data.filename.extension})}.bind(this))},_stopLoading:function(){this._thumbnail.stopLoading()},_showDummy:function(){}})});define("viewer/b-viewer/b-viewer-item-factory",function(require,exports,a){var b={default:require("viewer/b-view/b-view"),image:require("viewer/b-view/_image/b-view_image"),video:require("viewer/b-view/_video/b-view_video"),audio:require("viewer/b-view/_audio/b-view_audio"),text:require("viewer/b-view/_text/b-view_text"),pdf:require("viewer/b-view/_pdf/b-view_pdf"),document:require("viewer/b-view/_document/b-view_document"),archive:require("viewer/b-view/_archive/b-view_archive"),thumbnail:require("viewer/b-view/_thumbnail/b-view_thumbnail")};var c=function(a,c){var d=c&&c.enabled&&b[a]||b["default"];return function a(){return new d(c)}};a.exports=c});define("viewer/b-viewer/b-viewer-item",["jquery","viewer/b-viewer/b-viewer-item-factory"],function($,a){function b(a,b){this.viewer=a;this.data=b;this._viewWaiting=[];this._thumbnailOptions=a.viewOptions["thumbnail"];this._viewOptions=$.extend({template:a.viewTemplate||a.template,logLevels:a.logLevels,logHandler:a.logHandler,fullScreenEnabled:a.isFullScreenEnabled(),onToggleFullScreen:a.toggleFullScreen,isFullScreen:a.isFullScreen,next:a.next,isAutoplayEnabled:a.isAutoplayEnabled,enableAutoplay:a.enableAutoplay,disableAutoplay:a.disableAutoplay,item:this,data:b,dummy:a.viewOptions&&a.viewOptions.dummy},a.viewOptions&&a.viewOptions[b.viewType||b.type])}var c=b.prototype;c._createView=function(){return function(){var b=this.data;this._view=this._view||a(b.viewType||b.kind,this._viewOptions)();this._viewWaiting.forEach(function(a,b,c){a(this._view);delete c[b]}.bind(this));return this._view}.bind(this)};c.getView=function(){return this._view};c._createThumbnail=function(){var b=$.extend(this._thumbnailOptions,this._viewOptions);b.enabled=true;return function(){this._thumbnail=this._thumbnail||a("thumbnail",b)();return this._thumbnail}.bind(this)};c.getThumbnail=function(){return this._thumbnail};c.update=function(a){for(var b in a){this.data[b]=a[b]}var c=this.getView(),d=this.getThumbnail();c.reset();c.render();c.start&&c.start();d.reset();d.render();d.start&&d.start();this.viewer._toolbox.updateToolbar()};c.startProcessing=function(){this._processing=true};c.stopProcessing=function(){this._processing=false};c.isProcessing=function(){return this._processing};c.getActions=function(){var a=(this.viewer.actions&&this.viewer.actions.common||[]).concat(this._viewOptions.actions||[]);if(this.viewer.actions&&this.viewer.actions.getActions){a=this.viewer.actions.getActions(a,this)}if(this._viewOptions.getActions){a=this._viewOptions.getActions(a,this)}if(this.data.getActions){a=this.data.getActions(a)}return a};c.getToolbarActions=function(){var a=this.getActions();function b(c){var d=[];c.forEach(function(c){c=$.extend(true,{},c);if(c.items){c.items=b(c.items);if(!c.name||~a.indexOf(c.name)){d.push(c)}}else if(a.indexOf(c.name)!==-1){d.push(c)}});return d}var c=b(this.viewer.actions&&this.viewer.actions.toolbarActions||[]);if(this.viewer.actions&&this.viewer.actions.getToolbarActions){c=this.viewer.actions.getToolbarActions(c,this)}if(this._viewOptions.getToolbarActions){c=this._viewOptions.getToolbarActions(c,this)}if(this.data.getToolbarActions){c=this.data.getToolbarActions(c)}return c};c.getViewActions=function(){var a=this.getActions();var b=(this.viewer.actions&&this.viewer.actions.viewActions||[]).filter(function(b){return~a.indexOf(b.name)});if(this.viewer.actions&&this.viewer.actions.getViewActions){b=this.viewer.actions.getViewActions(b,this)}if(this._viewOptions.getViewActions){b=this._viewOptions.getViewActions(b,this)}if(this.data.getViewActions){b=this.data.getViewActions(b)}return b};c.doAction=function(a,b){var c=this.viewer.actions&&this.viewer.actions.handlers&&this.viewer.actions.handlers[a];if(c){c(this,b)}};c.getDummyOptions=function(){return this._viewOptions.dummy||{}};c.waitForView=function(a){if(this._view){a(this._view);return}this._viewWaiting.push(a)};return b});define("viewer/b-slider/__item/b-slider__item",function(){function a(a){a||(a={});this._viewFactory=a.viewFactory;this._view=null;this._state=null;this._visibilityState=null;this.id=a.id;if(a.$el){this.setEl(a.$el)}}var b=a.prototype;b.createView=function(){this._view=this._view||this._viewFactory()};b.getView=function(){if(!this._view){this.createView()}return this._view};b.destroyView=function(){if(this._view){this._view.destroy();this._view=null;this._state="destroyed";this._container.empty()}};b.renderView=function(){this.createView();this._view.renderTo(this._container);this._state="rendered"};b.isViewRendered=function(){return this._state=="rendered"};b.setEl=function(a){this.$el=a;this.$el.attr("data-id",this.id);this._container=this.$el.find(".js-sliderItemContent")};b.destroy=function(){this._viewFactory=null;this.destroyView();this.$el.remove()};b.freeze=function(){this._view&&this._view.freeze()};b.unfreeze=function(){this._view&&this._view.unfreeze()};b.getVisibilityState=function(){return this._visibilityState};b.setVisibilityState=function(a){this._visibilityState=a};return a});define("viewer/b-slider/b-slider",["jquery","toolkit/b-toolkit/b-toolkit","viewer/b-deferred-collection/b-deferred-collection","viewer/b-slider/__item/b-slider__item","toolkit-common/keymaster/keymaster"],function($,a,b,c){return b.extend("b-slider",{loadCount:1,loadThreshold:0,unloadThreshold:Infinity,logHandler:function(a,b){b[0].radarName=this.bemName+(b[0].radarName?"_"+b[0].radarName:"")},init:function(){b.fn.init.call(this);this._onBackClick=this._onBackClick.bind(this);this._onForwardClick=this._onForwardClick.bind(this);this._onSpaceKey=this._onSpaceKey.bind(this);this._onItemClick=this._onItemClick.bind(this);this._onContainerScroll=this._onContainerScroll.bind(this);this._onResize=this._onResize.bind(this);this._onContentTransitionend=this._onContentTransitionend.bind(this);this._updateContent=this._updateContent.bind(this);if(this.keys){key("left",this.keyScope||this._onBackClick,this.keyScope&&this._onBackClick);key("right",this.keyScope||this._onForwardClick,this.keyScope&&this._onForwardClick)}if(this.keys||this.mediaKeys){key("space",this.keyScope||this._onSpaceKey,this.keyScope&&this._onSpaceKey)}this._onContainerScroll=this._onContainerScroll.debounce(150);this._updateContent=this._updateContent.debounce(150);this.reset()},destroy:function(){if(this.keys){key.unbind("left",this.keyScope||this._onBackClick,this.keyScope&&this._onBackClick);key.unbind("right",this.keyScope||this._onForwardClick,this.keyScope&&this._onForwardClick);key.unbind("space",this.keyScope||this._onSpaceKey,this.keyScope&&this._onSpaceKey)}this.reset();b.fn.destroy.call(this)},reset:function(){b.fn.reset.call(this);this._selectedItemId=null;this._scrollPosition=null;this._scrollOffset=null;this._renderedItems={}},getData:function(){return $.extend({fit:this.fit,mods:this.mods},this.data)},render:function(){b.fn.render.call(this);this.$container=this.$el.find(".js-sliderContainer");this.$content=this.$el.find(".js-sliderContent");this.$arrowBack=this.$el.find(".js-sliderArrowBack");this.$arrowForward=this.$el.find(".js-sliderArrowForward");this.$item=this.$el.find(".js-sliderItemTemplate > .js-sliderItem");this.$container.bind("scroll",this._onContainerScroll);this.$content.bind("transitionend",this._onContentTransitionend);this.$arrowBack.bind("tap",this._onBackClick);this.$arrowForward.bind("tap",this._onForwardClick);this.$el.delegate(".js-sliderItem","tap",this._onItemClick);$(window).bind("resize",this._onResize);if(!this.fit){this.$container.css({"overflow-x":"scroll",bottom:-a.scrollbarHeight()+"px"})}this._updateContent()},_getItemOffsetWidth:function(){if(!this._itemOffsetWidth){this.$item.parent().show();this._itemOffsetWidth=this.$item[0].offsetWidth;this.$item.parent().hide()}return this._itemOffsetWidth},_onBackClick:function(a){this.log("info",{radarName:"arrow_back",radars:[(a.type==="keydown"?"key":"tap")+"=1","all=1"]});if(this.fit){this.selectItem(this.getOffsetItemId(this.getSelectedItemId(),-1))}else{if(!this.isScrolledToLeft()){this.scrollToItem(this.getItemId(this.getVisibleItemIds().shift()),"retrospective")}}},_onForwardClick:function(a){this.log("info",{radarName:"arrow_forward",radars:[(a.type==="keydown"?"key":"tap")+"=1","all=1"]});this.next()},next:function(){if(this.fit){this.selectItem(this.getOffsetItemId(this.getSelectedItemId(),1))}else{if(!this.isScrolledToRight()){this.scrollToItem(this.getItemId(this.getVisibleItemIds().pop()),"prospective")}}},_onSpaceKey:function(a){if(this.fit&&this._selectedItemId){var b=this._selectedItemId;var c=this.getResolvedItems([b])[b];var d;if(c){d=c.getView();if(d.onSpaceKey){this.log("info",{radarName:"space-key",radars:["all=1"]});a.preventDefault();d.onSpaceKey(a)}}}},_onItemClick:function(a){if(!this.fit){var b=$(a.target).closest(".js-sliderItem").attr("data-id");this.selectItem(b);this.log("info",{radarName:"itemClick",radars:["all=1"]})}},_onResize:function(a){this._containerWidth=this._contentWidth=null},_onContainerScroll:function(a){this._scrollPosition=this.$container[0].scrollLeft;this._updateScroll()},_onContentTransitionend:function(a){var b=this.$content.css("transition");var c=a===true?-this.$content.css("transform").split(",")[4]||0:this._scrollOffset;this.$content.css("transition","none");this.$content.css("transform","translateX(0)");this._scrollPosition=this._scrollPosition+c;this._scrollOffset=0;this.$container[0].scrollLeft=this._scrollPosition;this.$content.css("transition",b)},_checkThreshold:function(){var a=this.getVisibleItems(),b=this.getItemCount();if(a.some(function(a){var b=this.getItemIndex(a);if(b<this.threshold||itemsCount-b<this.threshold){return true}},this)){}},_updateArrows:function(){var b,c=false,d=false;if(this.fit){b=this.getItemIndex(this._selectedItemId);c=!b;d=b===this.getIds().length-1}else{c=this.isScrolledToLeft();d=this.isScrolledToRight()}a.toggleMod(this.$arrowBack,"disabled",c);a.toggleMod(this.$arrowForward,"disabled",d);a.toggleMod(this.$arrowBack,"loading",!!(this._moreItemsRequestPromises.retrospective&&c));a.toggleMod(this.$arrowForward,"loading",!!(this._moreItemsRequestPromises.prospective&&d))},_updateScroll:function(){this._updateContent()},_updateContent:function(){var b=(new Date).getTime();if(this.$content&&this.$content.length&&this._index.length){this.getContentWidth();this._updateItems(true);if(!this.getResolvedItemCount()){return}var c=null,d=this.getRenderableItemsIds(),e=this.getItemIndex(this._selectedItemId),f=this._resetItemsPositions===void 0||this._resetItemsPositions===true,g=this.getItemIndex(this.getVisibleItemIds()[0]),h=!!this._renderedItems.length;if(this.fit&&!this.showArrows){a.toggleMod(this.el,"single",d.length==1)}var i=this.getIds();i.forEach(function(a,b){var e=this._deferredItems[a],g=this.getItemContainer(a);if(!g){g=this._renderedItems[a]=this.$item.clone().attr("data-id",a);g._visible=false;if(!this.fit){if(c){g.insertAfter(c)}else{g.prependTo(this.$content)}c=g}}if(!this.fit&&f){g.css("left",this._getItemOffsetWidth()*this.getItemIndex(a))}if(this._selectedItemId===a){this._itemHighlight(g,true)}var h=this.getDeferredItemState(a),i=this.isItemVisible(a);if(d.indexOf(a)!==-1&&h!=="rejected"){if(this.fit&&!g.parent().length){g.appendTo(this.$content)}var j=function(b){if(!b.$el){b.setEl(g)}var c=b.isViewRendered();if(!c){b.renderView()}var d=b.getView();var e=i?"visible":"preload";b.setVisibilityState(e);if(!c){this.emit("itemStateChange",[a,e])}if(!c&&d.getData().filename){this.log("info",{radarName:i?"show":"preload",radars:[(d.getData().filename.extension||"unknown").toLowerCase()+"=1","all=1"]})}if(this.getSelectedItemId()==a&&this.fit){b.unfreeze()}}.bind(this);if(h=="resolved"){j(this.getResolvedItems([a])[a])}else{e.done(j)}}else{this.getDeferredItems([a])[a].always(function(b){if(this.fit){g.detach()}b&&b.destroyView();if(h=="rejected"){b&&b.setVisibilityState("dropped");this.emit("itemStateChange",[a,"dropped"])}else if(!i){b&&b.setVisibilityState("invisible");this.emit("itemStateChange",[a,"invisible"])}}.bind(this))}g._visible=i},this);this._resetItemsPositions=false;this._updateArrows();b=(new Date).getTime()-b;this.log("info",{radarName:"updateContent",radars:["time="+b,"time_"+Math.floor(i.length/100)*100+"="+b]})}},_updateItems:function(a){var b=this.getVisibleItemIds();if(!b.length){return}var c=this.getItemIndex(b[0])-this.loadThreshold,d=this.getItemIndex(b[b.length-1])+this.loadThreshold,e;var f;if(c<0){c=0;f=this.requestMoreItems("retrospective");if(f){f.done(this.onDataChanged.bind(this))}}if(d>this.getIds().length){d=this.getIds().length;f=this.requestMoreItems("prospective");if(f){f.done(this.onDataChanged.bind(this))}}e=this.getIds().slice(c,d+1);this.requestItems(e,a)},onDataChanged:function(a,b){this._resetItemsPositions=true;this._onResize();this._updateContent()},_createItem:function(a){return new c(a)},isItemVisible:function(a){if(this.fit){return this.getSelectedItemId()===a}var b=this.getItemIndex(a),c,d,e,f;if(b!=-1&&this.$container.length){c=this._getItemOffsetWidth()*b;d=this._getItemOffsetWidth();e=this.getContainerWidth();f=this._scrollPosition+this._scrollOffset;return c<f+e&&f<c+d}return false},isItemRenderable:function(a){var b=this.getVisibleItemIds(),c=this.getIds(),d=Math.max(this.getItemIndex(b[0])-this.unloadThreshold,0),e=Math.min(this.getItemIndex(b[b.length-1])+this.unloadThreshold,c.length),f=c.indexOf(a);return f>=d&&f<=e},getRenderableItemsIds:function(){var a=this.getVisibleItemIds(),b=this.getIds(),c=Math.max(this.getItemIndex(a[0])-this.unloadThreshold,0),d=Math.min(this.getItemIndex(a[a.length-1])+this.unloadThreshold,b.length);return b.slice(c,d+1)},_itemHighlight:function(b,c){a.toggleMod(b,"selected",c)},selectItem:function(a,b,c){if(this._selectedItemId==a){return}var d;if(this.fit&&(d=this.getSelectedItem())){d.freeze()}var e=this.getItemIndex(a);if(~e){if(this._selectedItemId){this._itemHighlight(this.getItemContainer(this._selectedItemId),false)}this._selectedItemId=a;this._itemHighlight(this.getItemContainer(this._selectedItemId),true);if(this.fit){this._updateContent();this._updateArrows()}else if(!c){this.scrollToItem(a)}if(!b){this.emit("selectItem",[a])}}},removeItems:function(a,c){a=Array.isArray(a)?a:[a];var d,e;a.forEach(function(b){var c=this._renderedItems[b];if(c){var f=this.getIds()[this.getItemIndex(b)-1];if(f&&a.indexOf(f)==-1){e=f}var g=this.getResolvedItems([b])[b];if(g){g.destroy()}delete this._renderedItems[b];if(this._selectedItemId==b){d=e?e:null}}},this);b.fn.removeItems.call(this,a,true);if(d===null){d=this.getIds()[0]}if(d){this.selectItem(d,void 0,true)}if(!c){this.emit("dataChanged",{removedItems:a})}},getSelectedItemId:function(){return this._selectedItemId},getSelectedItem:function(){var a=this.getResolvedItems([this._selectedItemId]);return a[this._selectedItemId]},getVisibleItemIds:function(a){if(this.fit){return[this.getSelectedItemId()]}var b=this.getIds(),c=this.getScrollPosition(),d=this.getContainerWidth(),e=Math.floor(c/this._getItemOffsetWidth()),f=Math.ceil((c+d)/this._getItemOffsetWidth());return b.slice(e,f+1)},getItemContainer:function(a){return this._renderedItems[a]},scrollToItem:function(a,b){var c=this.getItemIndex(a);if(~c){var d,e,f;if(this.$content.length){d=this._getItemOffsetWidth()*c;e=this._getItemOffsetWidth();f=this.getContainerWidth();switch(b){case"prospective":this.scrollTo(d);break;case"retrospective":this.scrollTo(d+e-f);break;default:this.scrollTo(Math.round(d+e/2-f/2))}}}},_scrollToTimeout:null,_scrollToTime:0,scrollTo:function(a){if(this.$container.length&&this.$content.length){(window.cancelRequestAnimationFrame||clearTimeout)(this._scrollToTimeout);this._scrollToTimeout=(window.requestAnimationFrame||setTimeout)(function(){this._onContentTransitionend(true);var b=(new Date).getTime();var c=0,d=Math.max(0,this.getContentWidth()-this.getContainerWidth());var e=Math.min(d,Math.max(c,a))-this._scrollPosition;if(this.disableTransition){this._scrollPosition=this._scrollPosition+e;this.$container[0].scrollLeft=this._scrollPosition}else{if(this._scrollOffset==e){this._onContainerScroll()}this._scrollOffset=e;if(b-this._scrollToTime<250){this._onContentTransitionend()}else{this.$content.css("transform","translateX("+-e+"px)")}}this._scrollToTime=b}.bind(this),16)}},isScrolledToLeft:function(){return!this.getScrollPosition()},isScrolledToRight:function(){return this.getScrollPosition()>=this.getContentWidth()-this.getContainerWidth()},getContainerWidth:function(){if(!this._containerWidth){this._containerWidth=this.$container[0].clientWidth}return this._containerWidth},getContentWidth:function(){var a;if(!this.fit){a=this.getIds().length*this._getItemOffsetWidth();if(this._contentWidth!=a){this.$content.width(a)}this._contentWidth=a}else{if(!this._contentWidth){this._contentWidth=this.$content[0].offsetWidth}a=this._contentWidth}return a},getScrollPosition:function(){return this._scrollPosition+this._scrollOffset}})});define("toolkit/b-filename/b-filename",["toolkit/b-toolkit/b-toolkit"],function(a){"use strict";var b="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==";var c=a.create("b-filename",{init:function(){this._timeout=null;this._loaded=false},startLoading:function(a,b){if(!this._loaded&&this.data.previewImage){var c=new Image;var d=this.$("__thumb");this._timeout=setTimeout(function(){c.onerror()}.bind(this),3e4);c.onload=function(){clearTimeout(this._timeout);this._loaded=true;d[0].style.backgroundImage="url("+c.src+")";a&&a()}.bind(this);c.onerror=function(){clearTimeout(this._timeout);this.stopLoading();b&&b()}.bind(this);c.src=this.data.previewImage;this._image=c}else{a&&a()}},stopLoading:function(){if(this._image){clearTimeout(this._timeout);this._image.onload=null;this._image.onerror=null;this._image.src=b;delete this._image}},destroy:function(){this.stopLoading();a["b-toolkit"].fn.destroy.apply(this,arguments)}});return c});define("viewer/b-viewer/__viewport/__fullscreen/b-viewer__viewport__fullscreen",function(){"use strict";function a(a,b){var c=b.length;while(c--){var d=Object.getOwnPropertyDescriptor(a,b[c]);if(d){return d}}}function b(a){var b={};if(a){if("configurable"in a){b.configurable=a.configurable}if("enumbarable"in a){b.enumbarable=a.enumbarable}}return b}function c(a){var b=a.length;return function(){for(var c=0;c<b;c++){var d=a[c];if(d in this){return this[d]}}return undefined}}function d(a,d){var e=b(a);e.get=c(d);return e}function e(b,c,e){try{var f=Object.getOwnPropertyDescriptor(b,c);if(!f){var g=a(b,e);if(g){if(g.get||g.value){Object.defineProperty(b,c,g)}else{Object.defineProperty(b,c,d(g,e))}}}}catch(a){}}[window.Node&&Node.prototype,window.Element&&Element.prototype,window.HTMLElement&&HTMLElement.prototype,window.Document&&Document.prototype,document.constructor.prototype,document].forEach(function(a){e(a,"fullscreenEnabled",["msFullscreenEnabled","mozFullScreenEnabled","webkitIsFullScreen","webkitFullScreenEnabled","webkitFullscreenEnabled"]);e(a,"fullscreenElement",["msFullscreenElement","mozFullScreenElement","webkitCurrentFullScreenElement","webkitFullScreenElement","webkitFullscreenElement"]);e(a,"exitFullscreen",["msExitFullscreen","mozCancelFullScreen","webkitCancelFullScreen","webkitCancelFullscreen","webkitExitFullScreen","webkitExitFullscreen"]);e(a,"requestFullscreen",["msRequestFullscreen","mozRequestFullScreen","webkitRequestFullScreen","webkitRequestFullscreen"])});return{fullscreenchange:"fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",fullscreenerror:"fullscreenerror webkitfullscreenerror mozfullscreenerror MSFullscreenError"}});define("viewer/b-viewer/b-viewer-viewport",["jquery","toolkit/b-toolkit/b-toolkit","viewer/b-slider/b-slider","toolkit/b-filename/b-filename","viewer/b-viewer/__viewport/__fullscreen/b-viewer__viewport__fullscreen"],function($,a,b,c,d){function e(a){var c=this;this._viewer=a;this._filename=null;this.keys=this._viewer.keys;this.mediaKeys=this._viewer.mediaKeys;this.keyScope=this._viewer.keyScope;this._fullscreen=false;this.onFullScreen=this.onFullScreen.bind(this);$(document).on(d.fullscreenchange,this.onFullScreen);this._slider=new b({renderMode:"replace",showArrows:a.showArrows,template:this._viewer.sliderTemplate||this._viewer.template,keyScope:this.keyScope,mods:["viewer"],logLevels:this._viewer.logLevels,logHandler:function(a,b){b[0].radarName="viewport"+(this.isFullScreen()?"-fullscreen":"")+(b[0].radarName?"_"+b[0].radarName:"");c._viewer.log(a,b[0])}.bind(this),fit:true,keys:this.keys,mediaKeys:this.mediaKeys,loadCount:2,loadThreshold:1,unloadThreshold:4,_requestItem:function(a){var b=$.Deferred();c._viewer.requestItems(a).done(function(c){b.resolve(this._createItem({id:a,viewFactory:c[a]._createView()}))}.bind(this));return b},_requestMoreItems:function(a){return c._viewer.requestMoreItems(a)},onSelectItem:function(a,b){c._viewer.selectItem(b)},onShowItem:function(a,b){},onItemStateChange:function(a,b,d){this.getDeferredItems(b)[b].done(function(a){var b=a.getView();if(d==="dropped"||d=="invisible"){c._viewer._conveyor.remove(b)}else{c._viewer._conveyor.enqueue(b,{visible:{image:12,video:11}[a.kind]||10,preload:{image:6,video:5}[a.kind]||4}[d]||0,"V "+b.data.title,{type:b.bemName.split("_")[1],extension:b._radarFilename,state:a.getVisibilityState()})}})}});this._onCloseClick=this._onCloseClick.bind(this);if(this.keys){key("escape",this.keyScope||this._onCloseClick,this.keyScope&&this._onCloseClick)}}var f=e.prototype;f.destroy=function(){this._slider.destroy();$(document).unbind(d.fullscreenchange,this.onFullScreen);this.$close.unbind("tap",this._onCloseClick);if(this.keys){key.unbind("escape",this.keyScope||this._onCloseClick,this.keyScope&&this._onCloseClick)}this._slider=this._viewer=this.$el=this.$title=this.$close=this.$content=null};f._onCloseClick=function(a){if(!this.isFullScreen()){var b=Math.round(((new Date).getTime()-this._viewer._startDate)/1e3);this._viewer.log("info",{radarName:"close",radars:[(this._viewer._currentItem.data.filename.extension||"unknown")+"="+b,(a.type==="keydown"?"key":"tap")+"="+b,"elapsed="+b]});this._viewer.emit("close")}};f.render=function(){this.$el=this._viewer.$el.find(".js-viewerViewport");this.$title=this.$el.find(".js-viewerViewportTitle");this.$fileName=this.$el.find(".js-viewerViewportFileName");this.$close=this.$el.find(".js-viewerViewportClose");this.$content=this.$el.find(".js-viewerViewportContent");this._slider.renderTo(".js-viewerViewportContentPlaceholder");this.$close.bind("tap",this._onCloseClick);if(this._viewer.viewportOptions&&this._viewer.viewportOptions.hideCloseBtn){this.$close.hide()}};f.setTitle=function(a){var b=a.title;var d=a.titleUrl;var e=a.filename;this._filename&&this._filename.destroy();if(b){var f=$("<"+(d?"a":"span")+">").attr({target:"_blank",href:d}).text(b);this.$title.html(f)}else if(e){this._filename=new c({template:this._viewer.sliderTemplate||this._viewer.template});this._filename.renderTo(this.$fileName,e)}this.$title[b?"show":"hide"]();this.$fileName[!b&&e?"show":"hide"]()};f.selectItem=function(a){if(this._slider){if(this._slider.getSelectedItemId()!==a){this._slider.selectItem(a,true)}}};f.shrink=function(b){this._shrinked=b===undefined?!this._shrinked:!!b;a.toggleMod(this.$el,"shrinked",this._shrinked)};f.removeItems=function(){if(this._slider){this._slider.removeItems.apply(this._slider,arguments)}};f.addItems=function(){if(this._slider){this._slider.addItems.apply(this._slider,arguments)}else{this._needSync=true}};f.onFullScreen=function(){this._fullscreen=!!document.fullscreenElement;this._slider.toggleMod("chromeless",this._fullscreen);a.toggleMod(this.$content,"fullscreen",this._fullscreen);this._slider.log("info",{radarName:"fullscreen",radars:[(this._fullscreen?"enter":"exit")+"=1"]})};f.toggleFullScreen=function(){var a=this.$content[0];if(!document.fullscreenElement){if(a.requestFullscreen){a.requestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}}else{if(document.exitFullscreen){document.exitFullscreen()}}};f.isFullScreen=function(){return this._fullscreen};return e});define("toolkit/b-toolbar/b-toolbar",["toolkit/b-toolkit/b-toolkit","toolkit/b-controls-group/b-controls-group"],function(a){"use strict";a["b-toolbar"]=a["b-controls-group"].extend({bemName:"b-toolbar"});return a["b-toolbar"]});define("viewer/b-viewer/b-viewer-toolbox",["jquery","toolkit/b-toolkit/b-toolkit","toolkit/b-toolbar/b-toolbar","viewer/b-slider/b-slider"],function($,a,b,c){function d(a,b){a.forEach(function(a){if(!(a.mods&&a.mods.includes(b))){a.mods=a.mods||[];a.mods.push(b)}if(a.items){d(a.items,b)}});return a}function e(a){var c=this;this._viewer=a;this.keys=this._viewer.keys;this.mediaKeys=this._viewer.mediaKeys;this.keyScope=this._viewer.keyScope;this._toolbar=new b({template:this._viewer.toolbarTemplate||this._viewer.template});if(this._viewer.actions&&Object.isObject(this._viewer.actions.handlers)){Object.keys(this._viewer.actions.handlers).forEach(function(a){this._toolbar[$.camelCase("on-"+a)]=function(b,c){var d=c.group?c.name:"";var e=this._viewer.getSelectedItemId();this._viewer.requestItems(e).then(function(b){var c=b[e];c.doAction(a,d);if(this._slider){this._slider.log("info",{radarName:"action_"+a,radars:[(c.data.filename.extension||"unknown")+"=1","all=1"]})}}.bind(this))}.bind(this)},this)}this._onUpKey=this._onUpKey.bind(this);this._onDownKey=this._onDownKey.bind(this);if(this.keys){key("up",this.keyScope||this._onUpKey,this.keyScope&&this._onUpKey);key("down",this.keyScope||this._onDownKey,this.keyScope&&this._onDownKey)}}var f=e.prototype;f.destroy=function(){clearTimeout(this._createTimeout);this._slider&&this._slider.destroy();this._toolbar.destroy();this.$toolbar.unbind("tap");this.$el=this.$toolbar=this.$content=null;if(this.keys){key.unbind("up",this.keyScope||this._onUpKey,this.keyScope&&this._onUpKey);key.unbind("down",this.keyScope||this._onDownKey,this.keyScope&&this._onDownKey)}};f._onUpKey=function(){this._viewer.expandToolbox(true)};f._onDownKey=function(){this._viewer.expandToolbox(false)};f._createSlider=function(a){if(this._slider){return}var b=this;this._slider=new c({template:this._viewer.sliderTemplate||this._viewer.template,mods:["viewer"],logLevels:this._viewer.logLevels,logHandler:function(a,c){c[0].radarName="toolbox"+(c[0].radarName?"_"+c[0].radarName:"");b._viewer.log(a,c[0])},loadCount:20,loadThreshold:30,unloadThreshold:40,_requestItem:function(a){var c=$.Deferred();b._viewer.requestItems(a).done(function(b){c.resolve(this._createItem({id:a,viewFactory:b[a]._createThumbnail()}))}.bind(this));return c},_requestMoreItems:function(a){return b._viewer.requestMoreItems(a)},onSelectItem:function(a,c){b._viewer.selectItem(c)},onItemStateChange:function(a,c,d){this.getDeferredItems(c)[c].done(function(a){var c=a.getView();if(d==="dropped"||d=="invisible"){b._viewer._conveyor.remove(c)}else{b._viewer._conveyor.enqueue(c,{visible:{image:9,video:8}[a.kind]||7,preload:{image:3,video:2}[a.kind]||1}[d]||0,"T "+c.data.title,{type:c.bemName.split("_")[1],extension:c._radarFilename,state:a.getVisibilityState()})}})}});this._slider.log("info",{radarName:"create",radars:["all=1"]});if(!a){this._renderSlider()}if(this._viewer.getIds()){this._slider.addIds(this._viewer.getIds(),0,true)}if(this._viewer.getSelectedItemId()){this._slider.selectItem(this._viewer.getSelectedItemId(),true)}};f.render=function(){this.$el=this._viewer.$el.find(".js-viewerToolbox");this.$toolbar=this.$el.find(".js-viewerToolboxToolbar");this.$content=this.$el.find(".js-viewerToolboxContent");this.$toolbar.bind("tap",function(b){if($(b.target).parents(".b-toolbar__group_viewer_left").add(b.target).is(".b-toolbar__group_viewer_left")){if(a.hasMod(this.$toolbar,"expand")){this._viewer.expandToolbox()}}}.bind(this));this._createTimeout=setTimeout(this._createSlider.bind(this),3*1e3)};f._renderSlider=function(){if(this._slider){this._slider.renderTo(this.$content)}};f.selectItem=function(a){if(this._slider){this._slider.selectItem(a,true)}this.updateToolbar()};f.updateToolbar=function(){var b=this._viewer.getSelectedItemId();this._viewer.requestItems(b).then(function(c){var d=c[b];if(!d){return}var e=this._viewer.getIds().length>1;a.toggleMod(this.$toolbar,"expand",e);this._toolbar.setData({mods:["viewer"],items:[{group:"right",mods:["viewer_right"],items:d.getToolbarActions()},{group:"left",mods:["viewer_left"],items:[e?{block:"b-toolbar__btn",mods:["viewer_left"],params:{name:"expand",icon:this._viewer.actions.expandIcon||"viewer_clip",text:this._viewer.showCurrentIndex?this._viewer.getItemIndex(b)+1+(this._viewer._total?" из "+this._viewer._total:""):this._viewer._total||"",mods:this._expanded?["pushed"]:[]}}:null,{block:"b-breadcrumbs",mods:["viewer_right"],params:{type:d.data.type,filename:d.data.filename,icon:d.data.icon||d.data.filename.extension}}]}]});this._toolbar.renderTo(this.$toolbar);this._viewer.emit("toolbarRender",this._toolbar.getData())}.bind(this))}.debounce(0);f.expand=function(b){this._expanded=b===undefined?!this._expanded:!!b;a.toggleMod(this.$el,"expanded",this._expanded);this.updateToolbar()};f.removeItems=function(){if(this._slider){this._slider.removeItems.apply(this._slider,arguments)}};f.addItems=function(){if(this._slider){this._slider.addItems.apply(this._slider,arguments)}};f.addIds=function(){if(this._slider){this._slider.addIds.apply(this._slider,arguments)}};return e});define("viewer/b-viewer/b-viewer",["toolkit/b-toolkit/b-toolkit","viewer/b-deferred-collection/b-deferred-collection","viewer/b-viewer/b-viewer-conveyor","viewer/b-viewer/b-viewer-item","viewer/b-viewer/b-viewer-viewport","viewer/b-viewer/b-viewer-toolbox"],function(a,b,c,d,e,f){var g=b.extend("b-viewer",{logHandler:function(a,b){b[0].radarName=this.bemName+(b[0].radarName?"_"+b[0].radarName:"")},boundAll:["toggleFullScreen","isFullScreen","next","isAutoplayEnabled","enableAutoplay","disableAutoplay"],viewOnly:false,withAdvertLine:false,showCurrentIndex:false,keys:true,mediaKeys:true,enableFullScreen:false,fullScreenEnabled:false,init:function(){b.fn.init.call(this);this._conveyor=new c(this,5);this._viewport=new e(this);if(!this.viewOnly){this._toolbox=new f(this)}this._fullScreenEnabled=this.enableFullScreen&&g.isFullScreenSupported();this.log("info",{radarName:"open",radars:[(this.viewOnly?"single":"multy")+"-mode=1","all=1"]})},destroy:function(){this.$el.empty();this._conveyor.destroy();this._viewport.destroy();this._toolbox&&this._toolbox.destroy();this._conveyor=null;this._viewport=null;this._toolbox=null;b.fn.destroy.call(this)},render:function(c){b.fn.render.call(this,c);this._viewport.render();if(this._toolbox){this._toolbox.render()}if(this.viewOnly){a.toggleMod(this.el.firstChild,"view-only",true);a.toggleMod(this.$el.find(".js-viewerViewport"),"view-only",true)}if(this.withAdvertLine){a.toggleMod(this.el.firstChild,"advert-line",true)}this._startDate=(new Date).getTime()},_createItem:function(a){return new d(this,a)},toggleFullScreen:function(){if(this.enableFullScreen){this._viewport.toggleFullScreen()}},isFullScreen:function(){return this._viewport.isFullScreen()},isFullScreenEnabled:function(){return this._fullScreenEnabled},addItems:function(a,c,d){this.log("info",{radarName:"add-items",radars:["added="+a.length,"all="+this._viewport._slider.getIds().length]});b.fn.addItems.call(this,a,c,d);function e(a){return a.id}this._viewport._slider.addIds(a.map(e),c,d);if(this._toolbox){this._toolbox.addIds(a.map(e),c,d)}},removeItems:function(a,c){this.log("info",{radarName:"remove-items",radars:["removed="+a.length,"all="+this._viewport._slider.getIds().length]});b.fn.removeItems.call(this,a,c);this._viewport._slider.removeItems(a,c);if(this._toolbox){this._toolbox.removeItems(a,c)}},selectItem:function(a,b){return this.isIdExists(a)&&this.requestItems(a).done(function(c){var d=c[a].data;this._viewport.setTitle(d);this._viewport.selectItem(a);if(this._toolbox){this._toolbox.selectItem(a)}this._currentItem=c[a];if(!b){this.emit("selectItem",[a])}}.bind(this))},getSelectedItemId:function(){return this._viewport._slider.getSelectedItemId()},next:function(){this._viewport._slider.next()},expandToolbox:function(a){if(!this._toolbox){return}this._toolboxExpanded=a===undefined?!this._toolboxExpanded:!!a;this.log("info",{radarName:"expandToolbox",radars:[this._toolboxExpanded+"=1"]});this._viewport.shrink(this._toolboxExpanded);this._toolbox.expand(this._toolboxExpanded)},updateToolbar:function(){this._toolbox&&this._toolbox.updateToolbar()},setTotal:function(a){if(a!=this._total){this._total=a;this.updateToolbar()}},_isAutoplayEnabled:false,isAutoplayEnabled:function(){return this._isAutoplayEnabled},enableAutoplay:function(){this._isAutoplayEnabled=true},disableAutoplay:function(){this._isAutoplayEnabled=false}});g.isFullScreenSupported=function(){return"requestFullscreen"in document.documentElement};return g});define("jssdk-zipview/utils/index",["RPC","request"],function(a,b){"use strict";var c={getTokenRequest:function(c,d){d=d||{};return a.token().then(function(a){d.token=a;return b(c,d,{type:"GET",withoutRequestId:true,xhrFields:{withCredentials:true}})}.bind(this))}};return c});define("jssdk-zipview/actions/Process/Process",["RPC","Action","request","jssdk-zipview/utils/index"],function(a,b,c,d){"use strict";var e=250;var f=b.extend({_infoTimeout:e,getInfo:function(a,b){if(!this.infoLink){b(new Error("has not info link"))}d.getTokenRequest(this.infoLink).then(function(c){var d=JSON.parse(c.responseText);if(d.status===6){this.hash=d.hash;this.ttl=d.ttl;var e=this.ttl*1e3;clearInterval(this._interval);delete this._interval;a(d)}else if(d.status<0){clearInterval(this._interval);delete this._interval;return Promise.reject(new Error("invalidate"))}else{this._interval=setTimeout(this.getInfo.bind(this,a,b),this._infoTimeout*=2)}}.bind(this)).catch(function(a){b(a)}.bind(this))},operation:function(a){var b=a.zipviewHost;var c;var e={};if(a.nested){c="/process_nested";e.hash=a.hash;e.path_hash=a.pathHash}else{c="/process";e.url=a.url}return new Promise(function(a,f){d.getTokenRequest(b+c,e).then(function(b){var c=JSON.parse(b.responseText);this.hash=c.hash;this.prolongLink=c.prolong_link;this.ttl=c.ttl;this.infoLink=c.info_link;setTimeout(this.getInfo.bind(this,a,f),this._infoTimeout)}.bind(this)).catch(function(a){f(a)}.bind(this))}.bind(this))}});b.register("garage.Process",f);f.version="0.1.0";return f});define("helpers/zipview",["exports","request","service/radars/index","cfg","jssdk-zipview/actions/Process/Process","jssdk-zipview/utils/index"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=k(a);var g=k(b);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}function l(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var m=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var n=250;var o=12e4;var p=h.default.get("urls")||{},q=p.zipViewUrl;var r=function a(b){(0,g.default)(["zipview"].concat(b))};var s=function(){function a(b){l(this,a);this._infoTimeout=n;this._onInvalidate=b}m(a,[{key:"_clearProlongInterval",value:function a(){clearInterval(this._prolongInterval);delete this._prolongInterval}},{key:"prolong",value:function a(){var b=this;r(["prolong","start"]);if(!this.prolongLink){r(["prolong","error","no-link"]);this._clearProlongInterval();return}return j.default.getTokenRequest(this.prolongLink).then(function(a){r(["prolong","success"]);return a}).catch(function(a){r(["prolong","error"]);if(b._onInvalidate){b._onInvalidate()}b._clearProlongInterval();return Promise.reject(a)})}},{key:"process",value:function a(b){var c=this;var d=b.src,e=b.hash,f=b.pathHash,g=b.nested;r(["process","start"]);return i.default.execute({nested:g,hash:e,pathHash:f,url:d,zipviewHost:q}).then(function(a){r(["process","success"]);var b=a.ttl*1e3||o;c._prolongInterval=setInterval(c.prolong.bind(c),b/2);c.prolongLink=a.prolongLink;c.hash=a.hash;return a.result}).catch(function(a){r(["process","error"]);return Promise.reject(a)})}}],[{key:"getRedirectUrl",value:function a(b){r(["get-redirect-url","start"]);return(0,f.default)(b,{ajax_call:1},{type:"GET"}).then(function(a){r(["get-redirect-url","success"]);return a.body[2]},function(a){r(["get-redirect-url","success"]);return Promise.reject(a)})}}]);return a}();exports.default=s});define("ui-block/viewer/ViewerAttachment",["exports","mrg-mime-types","cfg","Promise","helpers/zipview","helpers/object-to-query","helpers/opener","mail/Attachment","RPC","service/radars/index","feast-mod/file-size","default-values"],function(exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var l=t(b);var m=t(c);var n=t(d);var o=t(e);var p=t(f);var q=t(g);var r=t(h);var s=t(i);function t(a){return a&&a.__esModule?a:{default:a}}function u(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var v=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var w=function a(b){(0,s.default)(["viewer-attachment"].concat(b))};var x=void 0;var y=/^.+api\/v1\//;var z=function(){function b(c){var d=c.type,e=c.entry,f=c.title,g=c.messageId,h=c.router,i=c.isTemporary;u(this,b);this.router=h;this.type=d;this.kind=d;this.entry=e;this.size=e.get("size");this.title=f;this.downloadUrl=e.getDownloadUrl();this.mimeType=(0,a.getContentType)(e.getExtension());this.friendlySize=(0,j.fileSize)(this.size);this.isTemporary=i;this.filename={extension:e.getExtension(),name:e.getName()};this.messageId=g;this.hideUnpackButton=true;this.actions=["download","edit"];this.zipviewHelper=new n.default;this.attachment={messageId:this.getMessageId(),partIds:this.getId()?this.getId().split(";"):[]}}v(b,[{key:"download",value:function a(){var b=this.entry.getDownloadUrl();if(this.entry.isCloud()||k.VIEWER_OPEN_DOWNLOAD_IN_NEW_WINDOW){return(0,p.default)(b)}if(!x){x=document.createElement("iframe");x.style.display="none";document.body.appendChild(x)}x.src=b}},{key:"getThumbnailImageUrl",value:function a(c,d){if(this.isInArchive()){var e=this.viewUrl||this.downloadUrl;return e}var f=c+"x"+d;if(this.entry.isFromDocs()){f=b.THUMBNAIL_SIZE_L}var g=this.entry.getThumbnailUrl(f);if(this.entry.isFromDocs()&&this.entry.isCloudStock()){return}if(k.DISABLE_DOCS_PREVIEWS&&(this.entry.isFromDocs()||this.entry.isPreviewFromDocs())){return}return g}},{key:"getViewUrl",value:function a(){var b=this;var c=this.entry.getPreviewUrl();if(this.entry.isImage()&&!this.entry.isPreviewFromDocs()&&!this.entry.isCloudStock()){c=this.entry.getThumbnailUrl(q.default.THUMBNAIL_SIZE_ORIGINAL)}var d=void 0;if(this.entry.isCloudStock()&&k.VIEWERS_AVAILABLE.includes("cloud")){d=this.entry.get("editors.cloud.url")}else{d=(k.VIEWERS_AVAILABLE.map(function(a){return b.entry.get("editors."+a+".url")}).filter(function(a){return a})[0]||"").replace(y,"")}if(this.isInArchive()){if(this.type=="document"){var e=this.parentArchive.zipviewHelper.hash;var f=this.pathHash;var g=this.contentType;var h=this.filename.filename;d="https://"+location.host+"/api/v1/documents/view?viewer="+k.VIEWERS_AVAILABLE[0]+"&archive_id="+e+"&file_id="+f+"&name="+h+"&type="+g}else{c=this.viewUrl||this.downloadUrl}}else if(!d&&this.type=="document"){var i=this.downloadUrl.replace(/[^?]+\?/,"");var j=JSON.parse('{"'+decodeURI(i.replace(/&/g,'","').replace(/=/g,'":"'))+'"}');var n={file:j.file,id:j.id,mode:"msv",type:{document:"doc",spreadsheet:"excel",ppt:"pp"}[this.type],frame:1};i=(0,o.default)(n);d="/cgi-bin/getattach?"+i}if(this.type==="audio"){c=c||this.entry.get("href.download")}if(l.default.isLocalDev&&d){d=d.replace("https://octavius.mail.ru/api/v1/","")}if(d){c=r.default.call(d).then(function(a){return r.default.addXEmail(a.body.url)})}return m.default.resolve(c)}},{key:"canForward",value:function a(){return!this.entry.isCloudStock()}},{key:"requestContents",value:function a(){var c=this;w(["request","start"]);if(this.type==="archive"&&!this.getEntry().isCloudStock()){if(!this._cacheRequestContents){this._cacheRequestContents=this.getViewUrl().then(function(a){w(["request","get-url"]);if(l.default.isLocalDev){a=a.replace("octavius","local.octavius")}if(c.isInArchive()||c.isTemporary){return a}return n.default.getRedirectUrl(a)}).then(function(a){w(["request","get-redirect"]);if(c.isInArchive()){return c.zipviewHelper.process({nested:true,hash:c.parentArchive.zipviewHelper.hash,pathHash:c.pathHash})}return c.zipviewHelper.process({src:a})}).then(function(a){w(["request","get-zip"]);return b.createZipviewEntries(a.structure.files,c.messageId,c,c.isTemporary)}).catch(function(a){w(["request","error"]);return m.default.reject(a)})}return this._cacheRequestContents}w(["request","reject"]);return m.default.reject()}},{key:"getEntry",value:function a(){return this.entry}},{key:"getId",value:function a(){return this.entry.id}},{key:"getMessageId",value:function a(){return this.messageId}},{key:"getType",value:function a(){return this.entry.get("type")}},{key:"isInArchive",value:function a(){return!!this.parentArchive}},{key:"getPath",value:function a(){if(this.isInArchive()){return this.parentArchive.getPath().concat(this.pathHash)}return[]}}],[{key:"createZipviewEntries",value:function a(c,d,e,f){var g=[];c.forEach(function(a){var c=new q.default({type:a.type,size:a.size,name:a.name,id:e.getId()});var h=new b({type:a.type,entry:c,title:a.name,messageId:d,isTemporary:f});h.filename={filename:a.name,name:c.getName(),extension:c.getExtension()};h.parentArchive=e;h.pathHash=a.path_hash;if(a.type==="directory"){h.type="directory";h._contents=b.createZipviewEntries(a.files,d,e,f);delete h.size}else{var i=c.getPrimitiveType();if(i==="picture"){i="image"}if(i==="spreadsheet"||i==="presentation"){i="document"}h.type=i;h.kind=h.type;h.size=a.unpacked_size;h.contentType=a.content_type;h.unsafe=a.unsafe;h.downloadUrl=a.content_link;h.previewUrl=a.preview_link;h.viewUrl=a.view_link;c.set("href.download",a.content_link+"?download=1");h.viewUrl=h.type!=="pdf"&&a.view_link||a.content_link;if(a.archive){h.alreadyProcessed=a.archive}}g.push(h)});return g}}]);return b}();exports.default=z});(function(a){"use strict";if(typeof define==="function"&&define.amd){define("ply/Ply",a)}else{window["Ply"]=a()}})(function(){"use strict";var a=1,b=function(){},c=window,d=c.document,e=c.setTimeout,f={ok:"OK",cancel:"Cancel",cross:"✖"},g=function(){var a={},b=d.createElement("div").style,c="opacity transition transform perspective transformStyle transformOrigin backfaceVisibility".split(" "),e=["Webkit","Moz","O","MS"];s(c,function(c,d){a[c]=c in b&&c;if(!a[c]){for(d=0;d<4;d++){var f=e[d]+c.charAt(0).toUpperCase()+c.substr(1);if(a[c]=f in b&&f){break}}}});return a}(),h={esc:27},i="data-ply";var $=window.jQuery||window.Zepto||window.ender||window.$;var j={clone:true,zIndex:1e4,rootTag:"form",baseHtml:true,layer:{},wrapper:{},overlay:{opacity:.6,backgroundColor:"rgb(0, 0, 0)"},flags:{closeBtn:true,bodyScroll:false,closeByEsc:true,closeByOverlay:true,hideLayerInStack:true,visibleOverlayInStack:false},oninit:b,onopen:b,onclose:b,ondestroy:b,onaction:b};var k=window.Promise,l=window.Deferred||k;function m(a){if(l){return new l(a)}else{var b=$.Deferred();a(b.resolve,b.reject);return b}}function n(a){return l?l.all(a):$.when.apply($,a)}function o(a){return m(function(b){return b(a)})}function p(a){return a&&a.then?a:o(a)}var q=o();if(k&&!q.always){l=function(a){var b=new k(a);b.__proto__=this.__proto__;return b};l.prototype=Object.create(k.prototype);l.prototype.constructor=l;l.prototype.then=function(a,b){var c=k.prototype.then.call(this,a,b);c.__proto__=this.__proto__;return c};l.prototype.done=function(a){this.then(a);return this};l.prototype.fail=function(a){this["catch"](a);return this};l.prototype.always=function(a){this.then(a,a);return this};["all","cast","reject","resolve"].forEach(function(a){l[a]=k[a]})}function r(a){return typeof a==="function"}function s(a,b){if(a){for(var c in a){if(a.hasOwnProperty(c)){b(a[c],c,a)}}}}function t(a){var b={};s(a,function(a,c){if(r(a)){b[c]=a}else if(a instanceof Object){b[c]=t(a)}else{b[c]=a}});return b}function u(a){var b=Array.prototype.slice;var c=b.call(arguments,1);var d=0,e=c.length;for(;d<e;d++){s(c[d],function(b,c){a[c]=b})}return a}var v=/^(\w+)?(#\w+)?((?:\.[\w_-]+)*)/i;function w(a,b){try{return(b||d).querySelector(a)}catch(c){return $(a,b)[0]}}function x(a,b){return a.getElementsByTagName(b)}function y(a,b){try{a&&b&&a.appendChild(b)}catch(a){}}function z(a){if(a&&a.parentNode){a.parentNode.removeChild(a)}}function A(a,b,c){var e=c.handle=c.handle||function(b){if(!b.target){b.target=b.srcElement||d}if(b.target.nodeType===3){b.target=b.target.parentNode}if(!b.preventDefault){b.preventDefault=function(){b.returnValue=false}}if(!b.stopPropagation){b.stopPropagation=function(){b.cancelBubble=true}}c.call(a,b)};if(a.addEventListener){a.addEventListener(b,e,false)}else{a.attachEvent("on"+b,e)}}function B(a,b,c){var d=c.handle;if(d){if(a.removeEventListener){a.removeEventListener(b,d,false)}else{a.detachEvent("on"+b,d)}}}function C(a){if(a==null){a="div"}if(a.appendChild){return a}else if(a.skip){return d.createDocumentFragment()}if(typeof a==="string"){a={tag:a}}var b,c=a.children,e=v.exec(a.tag||"");delete a.children;a.tag=e[1]||"div";a.id=a.id||(e[2]||"").substr(1);e=(e[3]||"").split(".");e[0]=a.className||"";a.className=e.join(" ");b=d.createElement(a.tag);delete a.tag;s(a,function(c,e){if(c){if(e==="css"){G(b,a.css)}else if(e==="text"){c!=null&&y(b,d.createTextNode(c))}else if(e==="html"){c!=null&&(b.innerHTML=c)}else if(e==="ply"){b.setAttribute(i,c)}else if(e in b){try{b[e]=c}catch(a){b.setAttribute(e,c)}}else if(/^data-/.test(e)){b.setAttribute(e,c)}}});if(c&&c.appendChild){y(b,c)}else{s(c,function(a,c){if(a){if(typeof a==="string"){a={text:a}}else if(typeof a!=="object"){a={}}if(typeof c==="string"){a.tag=a.tag||c}y(b,C(a))}})}return b}function D(a){var b=x(a,"input"),c=0,d=b.length,e,f;for(;c<d;c++){e=b[c];if(e.type==="submit"){!f&&(f=e)}else if(!/hidden|check|radio/.test(e.type)&&e.value==""){f=e;break}}if(!f){f=x(a,"button")[0]}try{f.focus()}catch(a){}}function E(a){H(true);return m(function(b){var c=x(a,"img"),d=c.length,e=d,f,g=function(){if(--e<=0){d=c.length;while(d--){f=c[d];B(f,"load",g);B(f,"error",g)}H(false);b()}};while(d--){f=c[d];if(f.complete){e--}else{A(f,"load",g);A(f,"error",g)}}!e&&g()})}var F={opacity:!g.opacity&&function(a,b){a.zoom=1;a.filter="alpha(opacity="+b*100+")"}};function G(a,b,c){if(a&&a.style&&b){if(b instanceof Object){for(var e in b){G(a,e,b[e])}}else if(c===void 0){if(d.defaultView&&d.defaultView.getComputedStyle){c=d.defaultView.getComputedStyle(a,"")}else if(a.currentStyle){c=a.currentStyle}return b===void 0?c:c[b]}else if(F[b]){F[b](a.style,c)}else{a.style[g[b]||b]=c}}}function H(a){var b=H.get();clearTimeout(H.pid);if(a){H.pid=e(function(){y(d.body,b)},100)}else{H.pid=e(function(){z(b)},100)}}H.get=function(){return H.el||(H.el=C({tag:".ply-global-loading",children:{".ply-loading-spinner":true}}))};function I(a,b){return C({css:u({padding:"20px 20px 40px",display:"inline-block",position:"relative",textAlign:"left",whiteSpace:"normal",verticalAlign:"middle",transform:"translate3d(0, 0, 0)"},b.wrapper),children:b.baseHtml?[{ply:":layer",tag:".ply-layer",className:b.mod,css:u({overflow:"hidden",position:"relative",backfaceVisibility:"hidden"},b.layer),children:[b.flags.closeBtn&&{ply:":close",tag:".ply-x",text:f.cross},{tag:".ply-inside",children:a}]}]:a})}function J(a){return C({ply:":overlay",tag:".ply-overlay",css:{top:0,left:0,right:0,bottom:0,position:"fixed"},children:[{tag:"div",css:u({width:"100%",height:"100%"},a)}]})}function K(a,b,c){a.wrapEl=C({tag:b.rootTag,css:{whiteSpace:"nowrap",zIndex:b.zIndex},method:"post",action:"/"});if(!c){a.overlayEl=J(b.overlay);a.overlayBoxEl=a.overlayEl.firstChild;y(a.wrapEl,a.overlayEl)}var e=C();G(e,{height:"100%",display:"inline-block",verticalAlign:"middle"});y(a.wrapEl,e);var f=b.el;a.el=f&&f.cloneNode?b.clone?f.cloneNode(true):f:C({html:f||""});a.layerEl=I(a.el,b);a.contentEl=L(a.layerEl);a.context=new Q(a.layerEl);y(a.wrapEl,a.layerEl);a.bodyEl=b.body&&w(b.body)||d.body;a.wrapEl.tabIndex=-1;G(a.wrapEl,{top:0,left:0,right:0,bottom:0,position:"fixed",textAlign:"center",overflow:"auto",outline:0});return a}function L(a){return a.firstChild.lastChild.firstChild}function M(b,c){c=b instanceof Object?b:c||{};c.el=c.el||b;var d=this;d.cid="c"+a++;j.zIndex++;d.options=c=u({},j,c);c.flags=u({},j.flags,c.flags);K(d,c);d.setEffect(c.effect);d.fx=function(a){return!(d.fx.queue=d.fx.queue.then(a,a).then(function(){return d}))};d.fx.queue=o();d.on("click",":overlay",function(){d.hasFlag("closeByOverlay")&&d.closeBy("overlay")});d.on("click",":close",function(a,b){a.preventDefault();d.closeBy(b.nodeName==="BUTTON"?"cancel":"x")});d.options.oninit(this)}M.fn=M.prototype={constructor:M,_activate:function(){if(!this.hasFlag("bodyScroll")){var a=this.bodyEl,b=C({css:{overflow:"auto",visibility:"hidden",height:"5px"},children:[{tag:"div",css:{height:"100px"}}]});this.__overflow=G(a,"overflow");this.__paddingRight=G(a,"paddingRight");y(a,b);G(a,{overflow:"hidden",paddingRight:b.offsetWidth-b.firstChild.offsetWidth+"px"});z(b)}A(this.wrapEl,"submit",this._getHandleEvent("submit"))},_deactivate:function(){if(!this.hasFlag("bodyScroll")){G(this.bodyEl,{overflow:this.__overflow,paddingRight:this.__paddingRight})}B(this.layerEl,"submit",this._getHandleEvent("submit"))},_getHandleEvent:function(a){var b=this,c=b.__handleEvent||(b.__handleEvent={});if(!c[a]){c[a]=function(c){b._handleEvent(a,c)}}return c[a]},_handleEvent:function(a,b){b.preventDefault();this.closeBy(a)},$:function(a){return $(a,this.layerEl)},find:function(a){return w(a,this.layerEl)},applyEffect:function(a,b,c){a=this[a]||a;if(!a.nodeType){c=b;b=a;a=this.layerEl}c=M.effects.get(c||this.effects);return M.effects.apply.call(c,a,b)},closeBy:function(a){var b=this;var c={by:a,state:a==="submit",data:this.context.toJSON(),widget:this,context:this.context},d=this.el,e=this.options.onaction(c);if(!this.__lock){this.__lock=true;this.el.className+=" ply-loading";p(e).done(function(a){if(a!==false){b.result=c;b.close()}}).always(function(){b.__lock=false;b.el.className=b.el.className.replace(/\s?ply-loading/,"")})}},on:function(a,b,c){var d=this;if(!c){c=b;b=":layer"}c["_"+b]=function(a){var e=a.target;do{if(e.nodeType===1){if(e.getAttribute(i)===b){return c.call(d,a,e)}}}while(e!==d.wrapEl&&(e=e.parentNode))};A(d.wrapEl,a,c["_"+b]);return d},off:function(a,c,d){if(!d){d=c;c="layer"}B(this.wrapEl,a,d["_"+c]||b);return this},hasFlag:function(a){return!!this.options.flags[a]},setEffect:function(a){this.effects=M.effects.get(a);return this},_toggleState:function(a,b){var c=this,d=a?"open":"close",e=M.stack.last;if(c.visible!=a){c.visible=a;c[a?"_activate":"_deactivate"]();M.stack[a?"add":"remove"](c);c.fx(function(){return E(c.wrapEl).then(function(){var f=M.stack.length===(a?1:0),g=e&&e.hasFlag("hideLayerInStack"),h=f||c.hasFlag("visibleOverlayInStack");if(a){!h&&z(c.overlayBoxEl);y(c.bodyEl,c.wrapEl);c.wrapEl.focus();D(c.layerEl);if(g){e.applyEffect("close.layer",b).then(function(){z(e.layerEl)})}}else if(e=M.stack.last){y(e.wrapEl,e.layerEl);e.hasFlag("hideLayerInStack")&&e.applyEffect("open.layer",b).then(function(){D(e.el)})}return n([c.applyEffect(d+".layer",b),h&&c.applyEffect("overlayEl",d+".overlay",b)]).then(function(){if(!a){z(c.wrapEl);y(c.overlayEl,c.overlayBoxEl)}c.options["on"+d](c)})})})}return c.fx.queue},open:function(a){this.result=null;return this._toggleState(true,a)},close:function(a){return this._toggleState(false,a)},_swap:function(a,b,c,d,e){var f=this;if(f.visible){f.fx(function(){return E(b).then(function(){d();return n([f.applyEffect(a,"close.layer",c),f.applyEffect(b,"open.layer",c)]).then(function(){z(a);e();f.wrapEl.focus();D(b)})})})}else{e()}return f.fx.queue},swap:function(a,b){a=u({},this.options,a);var c=this,d=K({},a,true),e=b||a.effect?M.effects.get(b||a.effect):c.effects,f=c.layerEl,g=d.layerEl;return c._swap(f,g,e,function(){y(c.bodyEl,c.wrapEl);y(c.bodyEl,d.wrapEl)},function(){z(d.wrapEl);y(c.wrapEl,g);c.el=d.el;c.layerEl=g;c.contentEl=L(g);c.context.el=g})},innerSwap:function(a,c){a=u({},this.options,a);var d=this,e=K({},a,true),f=c||a.effect?M.effects.get(c||a.effect):d.effects,g=w(".ply-inside",e.layerEl),h=w(".ply-inside",d.layerEl);return d._swap(h,g,f,function(){G(h,{width:h.offsetWidth+"px",position:"absolute"});y(h.parentNode,g)},b)},destroy:function(){z(this.wrapEl);this._deactivate();M.stack.remove(this);this.visible=false;this.options.ondestroy(this)}};var N=[],O=N.push,P=N.splice;M.stack={_idx:{},last:null,length:0,_pop:function(a){var b=M.stack.last;if(a.keyCode===h.esc&&b.hasFlag("closeByEsc")){b.closeBy("esc")}},add:function(a){var b=O.call(this,a);this.last=a;this._idx[a.cid]=b-1;if(b===1){A(d,"keyup",this._pop)}},remove:function(a){var b=this._idx[a.cid];if(b>=0){P.call(this,b,1);delete this._idx[a.cid];this.last=this[this.length-1];if(!this.last){B(d,"keyup",this._pop)}}}};M.effects={defaults:{duration:300,open:{layer:null,overlay:null},close:{layer:null,overlay:null}},setup:function(a){this.defaults=this.get(a)},set:function(a){u(this,a)},get:function(a){var b=t(this.defaults);function c(a){var b=/^([\w_-]+)(?::(\d+%?))?(\[[^\]]+\])?/.exec(a)||[];return{name:b[1]||a,duration:b[2]||null,args:JSON.parse(b[3]||"null")||{}}}function d(b,d,e){var f=c(d),g=b[f.name]||e||{},h=f.duration||g.duration||b.duration||a.duration;if(typeof g==="string"){g=c(g);delete g.args}if(/%/.test(g.duration)){g.duration=parseInt(g.duration,10)/100*h}g.duration=(g.duration||h)|0;return g}if(typeof a==="string"){var e=c(a);a=t(this[e.name]||{open:{},close:{}});a.duration=e.duration||a.duration;a.open.args=e.args[0];a.close.args=e.args[1]}else if(a instanceof Array){var f=c(a[0]),g=c(a[1]),h=this[f.name],i=this[g.name];a={open:t(h&&h.open||{layer:a[0],overlay:a[0]}),close:t(i&&i.close||{layer:a[1],overlay:a[1]})};a.open.args=f.args[0];a.close.args=g.args[0]}else if(!(a instanceof Object)){a={}}a.duration=(a.duration||b.duration)|0;for(var j in{open:0,close:0}){var k=a[j]||b[j]||{};if(typeof k==="string"){k={layer:k}}k.layer=d(k,"layer",b[j].layer);k.overlay=d(k,"overlay",b[j].overlay);if(k.args===void 0){delete k.args}a[j]=k}return a},apply:function(a,b){b=b.split(".");var c=this[b[0]],d=a.firstChild,f=[a.getAttribute("style"),d&&d.getAttribute("style")],h,i;if(g.transition&&c&&(i=c[b[1]])&&(h=M.effects[i.name])){if(h["to"]||h["from"]){h=t(h);G(a,"transition","none");G(d,"transition","none");s(h["to"],function(b,c,d){if(b==="&"){d[c]=G(a,c)}});if(r(h["from"])){h["from"](a,c.args)}else if(h["from"]){G(a,h["from"])}return m(function(b){h.width=a.offsetWidth;G(a,"transition","all "+i.duration+"ms");G(d,"transition","all "+i.duration+"ms");if(r(h["to"])){h["to"](a,c.args)}else{G(a,h["to"])}e(b,i.duration)}).then(function(){a.setAttribute("style",f[0]);d&&d.setAttribute("style",f[1])})}}return o()}};M.effects.set({fade:{open:{layer:"fade-in:80%",overlay:"fade-in:100%"},close:{layer:"fade-out:60%",overlay:"fade-out:60%"}},scale:{open:{layer:"scale-in",overlay:"fade-in"},close:{layer:"scale-out",overlay:"fade-out"}},fall:{open:{layer:"fall-in",overlay:"fade-in"},close:{layer:"fall-out",overlay:"fade-out"}},slide:{open:{layer:"slide-in",overlay:"fade-in"},close:{layer:"slide-out",overlay:"fade-out"}},"3d-flip":{open:{layer:"3d-flip-in",overlay:"fade-in"},close:{layer:"3d-flip-out",overlay:"fade-out"}},"3d-sign":{open:{layer:"3d-sign-in",overlay:"fade-in"},close:{layer:"3d-sign-out",overlay:"fade-out"}},inner:{open:{layer:"inner-in"},close:{layer:"inner-out"}},"fade-in":{from:{opacity:0},to:{opacity:"&"}},"fade-out":{to:{opacity:0}},"slide-in":{from:{opacity:0,transform:"translateY(20%)"},to:{opacity:"&",transform:"translateY(0)"}},"slide-out":{to:{opacity:0,transform:"translateY(20%)"}},"fall-in":{from:{opacity:0,transform:"scale(1.3)"},to:{opacity:"&",transform:"scale(1)"}},"fall-out":{to:{opacity:0,transform:"scale(1.3)"}},"scale-in":{from:{opacity:0,transform:"scale(0.7)"},to:{opacity:"&",transform:"scale(1)"}},"scale-out":{to:{opacity:0,transform:"scale(0.7)"}},rotate3d:function(a,b,c,d,e){G(a,{perspective:"1300px"});G(a.firstChild,{opacity:b,transform:"rotate"+c+"("+d+"deg)",transformStyle:"preserve-3d",transformOrigin:e?"50% 0":"50%"})},"3d-sign-in":{from:function(a){M.effects.rotate3d(a,0,"X",-60,"50% 0")},to:function(a){G(a.firstChild,{opacity:1,transform:"rotateX(0)"})}},"3d-sign-out":{from:function(a){M.effects.rotate3d(a,1,"X",0,"50% 0")},to:function(a){G(a.firstChild,{opacity:0,transform:"rotateX(-60deg)"})}},"3d-flip-in":{from:function(a,b){M.effects.rotate3d(a,0,"Y",b||-70)},to:function(a){G(a.firstChild,{opacity:1,transform:"rotateY(0)"})}},"3d-flip-out":{from:function(a){M.effects.rotate3d(a,1,"Y",0)},to:function(a,b){G(a.firstChild,{opacity:0,transform:"rotateY("+(b||70)+"deg)"})}},"inner-in":{from:function(a){G(a,"transform","translateX(100%)")},to:function(a){G(a,"transform","translateX(0%)")}},"inner-out":{from:function(a){G(a,"transform","translateX(0%)")},to:function(a){G(a,"transform","translateX(-100%)")}}});function Q(a){this.el=a}Q.fn=Q.prototype={constructor:Q,getEl:function(a){if(this.el){return w("["+i+'-name="'+a+'"]',this.el)}},val:function(a,b){var c=typeof a==="string"?this.getEl(a):a;if(c&&c.value==null){c=x(c,"input")[0]||x(c,"textarea")[0]||x(c,"select")[0]}if(c&&b!=null){c.value=b}return c&&c.value||""},toJSON:function(){var a=this.el.querySelectorAll("["+i+"-name]"),b={},c,d=a.length;while(d--){c=a[d];b[c.getAttribute(i+"-name")]=this.val(c)}return b}};"use strict";function R(a){return a&&a.appendChild}function S(a,b){if(a==null){return{skip:true}}if(typeof a==="string"){a={text:a}}if(typeof a==="object"){a.name=a.name||b}return a}function T(a,b,c){var d=T[a],e;if(!d){a=a.split(/\s+/).slice(0,-1).join(" ");d=b&&(T[a+" [name="+b.name+"]"]||T[a+" [type="+b.type+"]"])||T[a+" *"]||T[":default"]}e=C(d(b,c));if(b&&b.name){e.setAttribute(i+"-name",b.name)}e.className+=" ply-ui";return e}T.factory=function(a,b,c){T[a.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ")]=function(e,f){var g=d.createDocumentFragment(),h;if(e!=null||a===":root"){e=c?e:S(e);s(c?e:e.children,function(b,c){var d=((f||a)+" "+c).replace(/^:\w+\s+/,""),e=R(b)?b:T(d,S(b,c),d);y(g,e)});if(!c){delete e.children}h=b(e,g);if(!R(h)){u(h,e)}return h}return g}};T.factory(":default",function(a,b){a.children=b;return a});T.factory(":root",function(a){return{tag:".ply-form",className:a.mod,children:[T(":header",a.header),T(":content",a.content),a.ctrls&&T(":default",{tag:"div.ply-footer",children:a.ctrls})]}});T.factory(":header",function(a,b){return{tag:".ply-header",text:a.text,children:b}});T.factory(":content",function(a,b){return{tag:".ply-content",children:b}},true);T.factory("ok",function(a){return{ply:":ok",tag:"button.ply-ctrl.ply-ok",text:a===true?f.ok:a}});T.factory("cancel",function(a){return{ply:":close",tag:"button.ply-ctrl.ply-cancel",type:"reset",text:a===true?f.cancel:a}});function U(a,b){U["_"+a]=b;U[a]=function(a,c){return m(function(d,e){b(a,c,d,e)}).then(function(a){if(!R(a)){a=T(":root",a)}return a})}}U.use=function(a,b,c,d,e){U["_"+a](b,c,d,e)};function V(a,b,c,d){b.mod=a;b.effect=b.effect||"slide";b.flags=u({closeBtn:false},b.flags);return{header:c.title,content:c.form?{"dialog-form":{children:c.form}}:{el:c.text||c},ctrls:{ok:c.ok||d.ok,cancel:c.cancel===false?null:c.cancel||d.cancel}}}U("default",function(a,b,c){c(b||{})});U("base",function(a,b,c){c(V("base",a,b))});U("alert",function(a,b,c){c(V("alert",a,b,{ok:true}))});U("confirm",function(a,b,c){c(V("confirm",a,b,{ok:true,cancel:true}))});U("prompt",function(a,b,c){c(V("prompt",a,b,{ok:true,cancel:true}))});T.factory("dialog-form *",function(a){return{tag:"input.ply-input",type:a.type||"text",name:a.name,value:a.value,required:true,placeholder:a.hint||a.text}});M.create=function(a,b,c){if(R(a)){return o(new M(u(b||{},{el:a})))}if(!c){c=b;b={}}var d=U[a]||U["default"];return d(b,c).then(function(a){return new M(u(b,{el:a}))})};M.open=function(a,b,c){return M.create(a,b,c).then(function(a){return a.open()})};M.dialog=function(a,c,d){if(a instanceof Object&&!R(a)){c=c||{};return m(function(d,e){var f=c.initState,g,h,i,j=a,k={},l=function(a,d){(c.progress||b)(u({name:g.$name,index:g.$index,length:n,stack:j,current:g,widget:d},a),k)},m=function(a,c,d){var e=JSON.parse(JSON.stringify(a.data));g=a;i=true;(a.prepare||b)(e,k);M.create(a.ui||"alert",a.options||{},e).then(function(b){var e;if(h){e=h[/^inner/.test(c)?"innerSwap":"swap"](b,c)}else{h=b;e=h.open()}e.then(function(){k[a.$name].el=h.layerEl;i=false});d(h)})};var n=0;s(j,function(a,b){f=f||b;a.effects=a.effects||{};a.$name=b;a.$index=n++;k[b]=new M.Context});j.$length=n;m(j[f],null,function(a){l({},a);h.options.onaction=function(a){if(i){return false}var b=a.state||g.back==="next",c=j[g[b?"next":"back"]];if(c){m(c,g[b?"nextEffect":"backEffect"],function(b){l(a,b)});return false}else{(a.state?d:e)(a,k)}}})})}else{if(!d&&!R(a)){d=c||{};c={}}return M.open(a,c,d).then(function(a){return m(function(b,c){a.options.onclose=function(){(a.result.state?b:c)(a.result)}})})}};M.ui=T;M.factory=U;M.lang=f;M.css=G;M.cssHooks=F;M.keys=h;M.noop=b;M.each=s;M.extend=u;M.promise=m;M.Promise=l;M.support=g;M.defaults=j;M.attrName=i;M.Context=Q;M.dom={build:C,append:y,remove:z,addEvent:A,removeEvent:B};M.version="0.6.1";return M});define("ply",["ply/Ply"],function(a){return a});define("ui-block/viewer/viewer",["exports","@mail/adman","feast","Promise","feast-tpl!./viewer.html","logger","service/auth","default-values","viewer/b-viewer/b-viewer","ui-block/viewer/ViewerAttachment","mrg-mime-types","ply","service/radars/index","service/adv/config","helpers/encode-uri-component","helpers/decode-uri-component","service/editors"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var q=D(a);var r=D(b);var s=D(c);var t=D(d);var u=D(e);var v=D(f);var w=D(h);var x=D(i);var y=D(k);var z=D(l);var A=D(n);var B=D(o);var C=D(p);function D(a){return a&&a.__esModule?a:{default:a}}var E=function a(b){(0,z.default)(["viewer"].concat(b))};exports.default=r.default.Block.extend({name:"viewer",template:t.default,viewer:null,blocks:{},defaults:{modal:false},didMount:function a(){this.originalFragment=Array.from(this.el.children);this.initUIViewerBlock()},destroy:function a(){var b=this;if(this.destroyed){return}this.viewer&&this.viewer.destroy();this.viewer=null;this.el.innerHTML="";this.originalFragment.forEach(function(a){return b.el.appendChild(a)});r.default.Block.prototype.destroy.call(this)},createToolkitViewer:function a(b){var c=this;var d=this.get("temporary");var e=function a(b,c){var e=[].concat(b);if(d){return e}if(c.data.isInArchive()){return e}var f=c.data.getEntry().get("size");var g=c.data.filename.extension;var h=Object.keys(C.default.all).filter(function(a){var c=e.indexOf(a);var d=C.default.all[a];if(b.includes(a)){if(!d.isDisabled&&(0,j.isIn)(d.supportedTypes,g)){if(a==="office"){if(g==="docx"&&f>25*1024*1024){return false}else if(g==="xlsx"&&f>5*1024*1024){return false}else{return true}}if(a==="owa"){if((g==="xlsx"||g==="xls")&&f>10*1024*1024){return false}else{return true}}return true}else{e.splice(c,1)}}return false});if(h.length){e.push("edit");var i=function a(b){return C.default.all[b].priority};h.sort(function(a,b){return i(b)>i(a)?1:-1});c.defaultEditor=h[0]}return e};var f={enabled:!g.DISABLE_DOCUMENTS_VIEW,actions:Object.keys(C.default.all),getActions:e};var h=this.get("router");var i=[{name:"download",icon:"viewer_download",text:i18n("Скачать"),mods:["main"]},{name:"saveToCloud",icon:"viewer_save-to-cloud",text:i18n("Сохранить в Облако")},{name:"edit",icon:"viewer_edit-document",text:i18n("Редактировать")},{name:"forward",icon:"viewer_forward",text:i18n("Переслать")}];var k=[{name:"download",icon:"viewer_download",text:i18n("Скачать")},{name:"saveToCloud",icon:"viewer_save-to-cloud",text:i18n("Сохранить в Облако")}];if(g.DISABLE_SAVE_TO_CLOUD){i=i.filter(function(a){var b=a.name;return b!=="saveToCloud"});k=k.filter(function(a){var b=a.name;return b!=="saveToCloud"})}if(g.DISABLE_DOCUMENTS_EDIT){i=i.filter(function(a){var b=a.name;return b!=="edit"});k=k.filter(function(a){var b=a.name;return b!=="edit"})}return new w.default({template:"mailru-toolkit.lego",templateBlock:"b-viewer",withAdvertLine:q.default.placement("attach-line"),init:function a(){w.default.fn.init.call(this);this.archiveCache={};this._itemsMap={}},onClose:function a(){if(!c.is("modal")){c.destroy();return}window.setTimeout(function(){window.close()},200)},_requestItem:function a(c){var d=this;var e=c.split("-");var f=e[1];var g=e[2];var h=void 0;if(g){h=this.archiveCache[c]}else{h=b[c]||b[f]}return h.getViewUrl().then(function(a){h.viewUrl=a}).catch(function(a){E(["request-item","error"]);u.default.add("requestItem.error",a);return s.default.resolve()}).then(function(){return d._createItem(h)})},_createItem:function a(b){b.titleUrl=h.getUrl("#!septimaReadmsg",{letterId:b.getMessageId()});return w.default.prototype._createItem.call(this,b)},actions:{toolbarActions:[{block:"b-toolbar__btn",name:"unpack",text:i18n("Показать файлы")},{block:"b-toolbar__btn",name:"read",text:i18n("Прочитать")},{block:"b-toolbar__btn",items:i}],viewActions:k,handlers:{read:function a(b){var c=b.data;window.open(h.getUrl("#!septimaReadmsg",{letterId:c.getMessageId()+";"+c.getId()}))},download:function a(b){b.data.download()},edit:function a(b){var c=b.data.filename.name+"."+b.data.filename.extension;var d=i18n("Для редактирования «{filename}» будет создана копия этого файла\\n в Облаке Mail.ru в папке «Почтовые вложения». Исходный файл не будет изменен.",{filename:c});return y.default.dialog("prompt",{},{title:d}).then(function(){window.open(h.getUrl("#attachment-editor",{message:b.data.getMessageId(),id:b.data.getId()},{editor:b.defaultEditor,type:b.data.getType()}))})},saveToCloud:function a(b){c.broadcast("attachments:tocloud",{message:c.get("message"),attachments:[b.data.getEntry()]})}},common:["download","saveToCloud"],getActions:function a(b,c){return b.filter(function(a){if(a==="forward"){return c.data.canForward()}else if(a==="saveToCloud"){return!c.data.getEntry().isCloud()&&!c.data.isInArchive()&&!d}else{return true}})}},viewOptions:{link:{enabled:false},image:{enabled:true,preloadable:true,actions:["print"],getActions:e,getToolbarActions:function a(b){(function a(b){return b.some(function(b){if(b.name==="edit"){if(d){return false}b.icon="viewer_edit-image";return true}else if(b.items){return a(b.items)}else{return false}})})(b);return b}},pdf:{enabled:true,view:"iframe"},text:{enabled:true},archive:{enabled:true,actions:["print"],onShowContents:function a(b,c,d){var e=this;var f=this.item.viewer.getItemIndex(this.item.viewer.getItemId(this.item))+1;var g=[];c.forEach(function(a){g.push(a.id);e.item.viewer.archiveCache[a.id]=a.data});this.item.viewer.addIds(g,f);this.item.datatreeData=d;if(this.item._onShowContents){this.item._onShowContents();delete this.item._onShowContents}},onItemClick:function a(b,c){this.item.viewer.selectItem(c)},onItemActionClick:function a(b,c,d){if(d==="download"){var e=this.item.viewer.getResolvedItems(c)[c];e.data.download()}}},audio:{enabled:true},video:{enabled:false},email:{enabled:true,actions:["read","print"],getActions:function a(b,c){var e=c.data;var f=e.getEntry();return b.filter(function(a){if(a==="read"){if(d){return false}return f.get("flags").eml}return true})}},document:f,xls:f,ppt:f,doc:f},onItemAdded:function a(b,c){var d=c.split("-");var e=d[0];var f=d[1];var g=d.slice(2);this._itemsMap[c]={messageId:e,partIds:f,contentPath:g}},onSelectItem:function a(b,c){var d=this.getResolvedItems(c)[c];d.waitForView(function(a){if(a.showContents){a.showContents()}})}})},getViewerAttachments:function a(b,c){var d=this;var e={};b.forEach(function(a){var b=a.getPrimitiveType();if(b==="picture"){b="image"}if(b==="spreadsheet"||b==="presentation"){b="document"}if(b==="plain-text"){b="text"}if(a.isLink()||a.isCloud()){b="link"}var f=void 0;var g="";if(c){var h=c.get("correspondents.from");if(h.length){f=h[0].name}g=c.get("subject")||i18n("<Без темы>")}var i=d.get("messageId");var j=d.get("temporary");e[a.id]=new x.default({type:b,entry:a,messageId:i,title:(f?f+":":"")+" "+g,isTemporary:j})});return e},initUIViewerBlock:function a(){var b=this;var c=this.get("models");var d=this.get("attachment");var e=this.get("message");var f=this.get("messageId");var g=void 0;if(c&&d){g=this.getViewerAttachments(c,e)}var h=this.createToolkitViewer(g);h.renderTo(this.refs.viewer,{});var i=q.default.placement("attach-line");if(i){i.attachToContainer(h.$("__advert__line")[0]);i.wakeUp();i.render(true);q.default.broker.setTheme(new q.default.Theme(m.defaultViewerTheme))}if(c&&d){h.setTotal(c.length);h.addIds(Object.keys(g));h.selectItem(d.id)}var j=this.get("temporary");h.on("selectItem",function(a,c){var d=b.get("router");var g=h._itemsMap[c];var i={"x-email":v.default.user.getEmail()};if(e){i["folder-id"]=e.get("folder")}if(g&&g.contentPath.length){d.go(j?"#attachment-temporary":"#attachment",{message:f,id:(0,A.default)(g.partIds),path:(0,A.default)(g.contentPath.map(function(a){return(0,A.default)(a)}).join("/"))},i)}else{d.go(j?"#attachment-temporary":"#attachment",{message:f,id:(0,A.default)(c),path:""},i)}});this.viewer=h;var k=this.get("router");var l=k.request.params,n=l.path,o=l.id,p=l.message;var r=(0,B.default)(o);if(n){var s=(0,B.default)(n);var t=s.split("/");this._waitForContents(p,r,t)}},_waitForContents:function a(b,c,d,e){var f=this;var g=e?b+"-"+c:""+c;this.viewer.requestItems(""+g).then(function(a){a[""+g]._onShowContents=function(){c=c+"-"+d[0];f.viewer.selectItem(b+"-"+c,true);var a=d.slice(1);if(a.length){f._waitForContents(b,c,a,true)}};if(e){a[g].waitForView(function(a){if(a.showContents){a.showContents()}})}})}})});define("ui-block/viewer/viewer.spec",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={keywords:"attachments аттачи атачи просмоторщик",cases:{base:{attrs:{}}}}});define("ui-block/viewer/ViewerAttachment",["exports","mrg-mime-types","cfg","Promise","helpers/zipview","helpers/object-to-query","helpers/opener","mail/Attachment","RPC","service/radars/index","feast-mod/file-size","default-values"],function(exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var l=t(b);var m=t(c);var n=t(d);var o=t(e);var p=t(f);var q=t(g);var r=t(h);var s=t(i);function t(a){return a&&a.__esModule?a:{default:a}}function u(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var v=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var w=function a(b){(0,s.default)(["viewer-attachment"].concat(b))};var x=void 0;var y=/^.+api\/v1\//;var z=function(){function b(c){var d=c.type,e=c.entry,f=c.title,g=c.messageId,h=c.router,i=c.isTemporary;u(this,b);this.router=h;this.type=d;this.kind=d;this.entry=e;this.size=e.get("size");this.title=f;this.downloadUrl=e.getDownloadUrl();this.mimeType=(0,a.getContentType)(e.getExtension());this.friendlySize=(0,j.fileSize)(this.size);this.isTemporary=i;this.filename={extension:e.getExtension(),name:e.getName()};this.messageId=g;this.hideUnpackButton=true;this.actions=["download","edit"];this.zipviewHelper=new n.default;this.attachment={messageId:this.getMessageId(),partIds:this.getId()?this.getId().split(";"):[]}}v(b,[{key:"download",value:function a(){var b=this.entry.getDownloadUrl();if(this.entry.isCloud()||k.VIEWER_OPEN_DOWNLOAD_IN_NEW_WINDOW){return(0,p.default)(b)}if(!x){x=document.createElement("iframe");x.style.display="none";document.body.appendChild(x)}x.src=b}},{key:"getThumbnailImageUrl",value:function a(c,d){if(this.isInArchive()){var e=this.viewUrl||this.downloadUrl;return e}var f=c+"x"+d;if(this.entry.isFromDocs()){f=b.THUMBNAIL_SIZE_L}var g=this.entry.getThumbnailUrl(f);if(this.entry.isFromDocs()&&this.entry.isCloudStock()){return}if(k.DISABLE_DOCS_PREVIEWS&&(this.entry.isFromDocs()||this.entry.isPreviewFromDocs())){return}return g}},{key:"getViewUrl",value:function a(){var b=this;var c=this.entry.getPreviewUrl();if(this.entry.isImage()&&!this.entry.isPreviewFromDocs()&&!this.entry.isCloudStock()){c=this.entry.getThumbnailUrl(q.default.THUMBNAIL_SIZE_ORIGINAL)}var d=void 0;if(this.entry.isCloudStock()&&k.VIEWERS_AVAILABLE.includes("cloud")){d=this.entry.get("editors.cloud.url")}else{d=(k.VIEWERS_AVAILABLE.map(function(a){return b.entry.get("editors."+a+".url")}).filter(function(a){return a})[0]||"").replace(y,"")}if(this.isInArchive()){if(this.type=="document"){var e=this.parentArchive.zipviewHelper.hash;var f=this.pathHash;var g=this.contentType;var h=this.filename.filename;d="https://"+location.host+"/api/v1/documents/view?viewer="+k.VIEWERS_AVAILABLE[0]+"&archive_id="+e+"&file_id="+f+"&name="+h+"&type="+g}else{c=this.viewUrl||this.downloadUrl}}else if(!d&&this.type=="document"){var i=this.downloadUrl.replace(/[^?]+\?/,"");var j=JSON.parse('{"'+decodeURI(i.replace(/&/g,'","').replace(/=/g,'":"'))+'"}');var n={file:j.file,id:j.id,mode:"msv",type:{document:"doc",spreadsheet:"excel",ppt:"pp"}[this.type],frame:1};i=(0,o.default)(n);d="/cgi-bin/getattach?"+i}if(this.type==="audio"){c=c||this.entry.get("href.download")}if(l.default.isLocalDev&&d){d=d.replace("https://octavius.mail.ru/api/v1/","")}if(d){c=r.default.call(d).then(function(a){return r.default.addXEmail(a.body.url)})}return m.default.resolve(c)}},{key:"canForward",value:function a(){return!this.entry.isCloudStock()}},{key:"requestContents",value:function a(){var c=this;w(["request","start"]);if(this.type==="archive"&&!this.getEntry().isCloudStock()){if(!this._cacheRequestContents){this._cacheRequestContents=this.getViewUrl().then(function(a){w(["request","get-url"]);if(l.default.isLocalDev){a=a.replace("octavius","local.octavius")}if(c.isInArchive()||c.isTemporary){return a}return n.default.getRedirectUrl(a)}).then(function(a){w(["request","get-redirect"]);if(c.isInArchive()){return c.zipviewHelper.process({nested:true,hash:c.parentArchive.zipviewHelper.hash,pathHash:c.pathHash})}return c.zipviewHelper.process({src:a})}).then(function(a){w(["request","get-zip"]);return b.createZipviewEntries(a.structure.files,c.messageId,c,c.isTemporary)}).catch(function(a){w(["request","error"]);return m.default.reject(a)})}return this._cacheRequestContents}w(["request","reject"]);return m.default.reject()}},{key:"getEntry",value:function a(){return this.entry}},{key:"getId",value:function a(){return this.entry.id}},{key:"getMessageId",value:function a(){return this.messageId}},{key:"getType",value:function a(){return this.entry.get("type")}},{key:"isInArchive",value:function a(){return!!this.parentArchive}},{key:"getPath",value:function a(){if(this.isInArchive()){return this.parentArchive.getPath().concat(this.pathHash)}return[]}}],[{key:"createZipviewEntries",value:function a(c,d,e,f){var g=[];c.forEach(function(a){var c=new q.default({type:a.type,size:a.size,name:a.name,id:e.getId()});var h=new b({type:a.type,entry:c,title:a.name,messageId:d,isTemporary:f});h.filename={filename:a.name,name:c.getName(),extension:c.getExtension()};h.parentArchive=e;h.pathHash=a.path_hash;if(a.type==="directory"){h.type="directory";h._contents=b.createZipviewEntries(a.files,d,e,f);delete h.size}else{var i=c.getPrimitiveType();if(i==="picture"){i="image"}if(i==="spreadsheet"||i==="presentation"){i="document"}h.type=i;h.kind=h.type;h.size=a.unpacked_size;h.contentType=a.content_type;h.unsafe=a.unsafe;h.downloadUrl=a.content_link;h.previewUrl=a.preview_link;h.viewUrl=a.view_link;c.set("href.download",a.content_link+"?download=1");h.viewUrl=h.type!=="pdf"&&a.view_link||a.content_link;if(a.archive){h.alreadyProcessed=a.archive}}g.push(h)});return g}}]);return b}();exports.default=z});define("packages/viewer/b-breadcrumbs/b-breadcrumbs",[],function(){});define("viewer/b-datatree/b-datatree",["jquery","toolkit/b-toolkit/b-toolkit"],function($,a){return a.create("b-datatree",{render:function(b){a["b-toolkit"].fn.render.call(this,b);this.$el.undelegate();this.$el.delegate(".js-datatreeNode","tap",this._onNodeClick.bind(this));this.$el.delegate(".js-datatreeNodeAction","tap",this._onNodeActionClick.bind(this))},_onNodeClick:function(b){b.stopPropagation();var c=$(b.currentTarget),d=c.attr("data-id");if(c.find(".js-datatreeList").length){a.toggleMod(c,"collapsed")}else if(d){this.emit("nodeClick",[d])}},_onNodeActionClick:function(a){a.preventDefault();a.stopPropagation();var b=$(a.currentTarget),c=b.closest(".js-datatreeNode"),d=c.attr("data-id"),e=b.attr("data-name");this.emit("nodeActionClick",[d,e])}})});define("packages/viewer/b-datatree/b-datatree",["viewer/b-datatree/b-datatree"],function(a){return a});define("viewer/b-deferred-collection/b-deferred-collection",["jquery","toolkit/b-toolkit/b-toolkit"],function($,a){return a.create("b-deferred-collection",{init:function(){this._deferredItems={};this._resolvedItems={};this._index=[];this._moreItemsRequestPromises={}},reset:function(){Object.forEach(this._deferredItems,function(a,b){a.reject();delete this._deferredItems[b]},this);Object.forEach(this._resolvedItems,function(a,b){delete this._resolvedItems[b];if(a.destroy){a.destroy()}},this);this._index.length=0;Object.forEach(this._moreItemsRequestPromises,function(a,b){delete this._moreItemsRequestPromises[b]},this)},_requestItem:function(a){return $.Deferred().reject()},_createItem:function(a){return{}},_resolveItem:function(a,b){this._resolvedItems[a]=b;this.emit("itemResolved",[a,b])},syncItems:function(a,b){var c=[],d=[],e={},f=false;var g=this.getIds();g.forEach(function(b){if(a.indexOf(b)==-1){c.push(b)}});if(c.length){this.removeItems(c,b);g=this.getIds()}var h=null;a.forEach(function(a){if(g.indexOf(a)==-1){if(!e[h]){e[h]=[];f=true}e[h].push(a)}else{h=a}},this);if(f){d=Object.keys(e);d.forEach(function(a){this.addIds(e[a],a==="null"?0:g.indexOf(a)+1,b)},this)}return{added:d,removed:c}},addItems:function(a,b,c){a=Array.isArray(a)?a:[a];var d=[],e=false;a.forEach(function(a){if(a.id&&!this._deferredItems[a.id]){if(a.data){this._deferredItems[a.id]=$.Deferred().resolve(this._createItem(a.data)).done(this._resolveItem.bind(this,a.id))}else{this._deferredItems[a.id]=$.Deferred().reject()}d.push(a.id);this.emit("itemAdded",[a.id]);e=true}},this);Array.prototype.splice.apply(this._index,[b===undefined?this._index.length:b,0].concat(d));if(!c&&e){this.emit("dataChanged")}},addIds:function(a,b,c){a=Array.isArray(a)?a:[a];this.addItems(a.map(function(a){return{id:a,data:null}}),b,c)},requestItems:function(a,b){a=Array.isArray(a)?a:[a];var c=$.Deferred(),d=false,e=[],f=[];a.forEach(function(a){if(this._deferredItems[a]){if(this.getDeferredItemState(a)==="rejected"){this._deferredItems[a]=this._requestItem(a).done(this._resolveItem.bind(this,a));d=true}e.push(a);f.push(this._deferredItems[a])}},this);$.when.apply($,f).done(function(){var a={},f=Array.prototype.slice.call(arguments);e.forEach(function(b,c){a[b]=f[c]});c.resolve(a);if(!b&&d){this.emit("dataChanged")}}.bind(this)).fail(function(){c.reject()});return c.promise()},getIds:function(){return this._index},isIdExists:function(a){return this._index.includes(a)},getItemId:function(a){var b;Object.forEach(this._deferredItems,function(c,d){if(c===a){b=d}},this);if(b){return b}Object.forEach(this._resolvedItems,function(c,d){if(c===a){b=d}},this);if(b){return b}if(~this._index.indexOf(a)){return a}},getOffsetItemId:function(a,b){var c=this.getItemIndex(a);return this.getIds()[~c?Math.max(0,Math.min(this.getIds().length-1,+(c+b)||0)):0]},getItemIndex:function(a){return this._index.indexOf(a)},getDeferredItemCount:function(){return Object.keys(this._deferredItems).length},getResolvedItemCount:function(){return Object.keys(this._resolvedItems).length},getDeferredItems:function(a){a=Array.isArray(a)?a:[a];var b={};a.forEach(function(a){if(this._deferredItems[a]){b[a]=this._deferredItems[a]}},this);return b},getResolvedItems:function(a){a=Array.isArray(a)?a:[a];var b={};a.forEach(function(a){if(this._resolvedItems[a]){b[a]=this._resolvedItems[a]}},this);return b},getDeferredItemState:function(a){var b=this._deferredItems[a];if(b.state){return b.state()}if(b.isResolved&&b.isResolved()){return"resolved"}else if(b.isRejected&&b.isRejected()){return"rejected"}else{return"pending"}},removeItems:function(a,b){a=Array.isArray(a)?a:[a];a.forEach(function(a){if(this._deferredItems[a]){this._deferredItems[a].reject();delete this._deferredItems[a];delete this._resolvedItems[a]}},this);this._index=this._index.filter(function(b){return a.indexOf(b)==-1});if(!b){this.emit("dataChanged")}},_requestMoreItems:function(a){return $.Deferred().reject()},requestMoreItems:function(a){var b=this._moreItemsRequestPromises[a];if(b===undefined){b=this._moreItemsRequestPromises[a]=this._requestMoreItems(a);if(b.then){b.then(function(){delete this._moreItemsRequestPromises[a]}.bind(this),function(){this._moreItemsRequestPromises[a]=false}.bind(this))}}return b}})});define("packages/viewer/b-deferred-collection/b-deferred-collection",["viewer/b-deferred-collection/b-deferred-collection"],function(a){return a});define("viewer/b-media-player-settings/b-media-player-settings",["toolkit/b-toolkit/b-toolkit"],function(a){return a.create("b-media-player-settings")});define("packages/viewer/b-media-player-settings/b-media-player-settings",["viewer/b-media-player-settings/b-media-player-settings"],function(a){return a});define("viewer/b-media-player/b-media-player",["jukebox/b-jukebox/b-jukebox","viewer/b-media-player-settings/b-media-player-settings"],function(a){return a.extend("b-media-player",{settingsBlock:"b-media-player-settings",reflow:function(){a.fn.reflow.apply(this,arguments);this._adjustControls()},_adjustControls:function(){}})});define("packages/viewer/b-media-player/b-media-player",["viewer/b-media-player/b-media-player"],function(a){return a});define("viewer/b-slider/b-slider",["jquery","toolkit/b-toolkit/b-toolkit","viewer/b-deferred-collection/b-deferred-collection","viewer/b-slider/__item/b-slider__item","toolkit-common/keymaster/keymaster"],function($,a,b,c){return b.extend("b-slider",{loadCount:1,loadThreshold:0,unloadThreshold:Infinity,logHandler:function(a,b){b[0].radarName=this.bemName+(b[0].radarName?"_"+b[0].radarName:"")},init:function(){b.fn.init.call(this);this._onBackClick=this._onBackClick.bind(this);this._onForwardClick=this._onForwardClick.bind(this);this._onSpaceKey=this._onSpaceKey.bind(this);this._onItemClick=this._onItemClick.bind(this);this._onContainerScroll=this._onContainerScroll.bind(this);this._onResize=this._onResize.bind(this);this._onContentTransitionend=this._onContentTransitionend.bind(this);this._updateContent=this._updateContent.bind(this);if(this.keys){key("left",this.keyScope||this._onBackClick,this.keyScope&&this._onBackClick);key("right",this.keyScope||this._onForwardClick,this.keyScope&&this._onForwardClick)}if(this.keys||this.mediaKeys){key("space",this.keyScope||this._onSpaceKey,this.keyScope&&this._onSpaceKey)}this._onContainerScroll=this._onContainerScroll.debounce(150);this._updateContent=this._updateContent.debounce(150);this.reset()},destroy:function(){if(this.keys){key.unbind("left",this.keyScope||this._onBackClick,this.keyScope&&this._onBackClick);key.unbind("right",this.keyScope||this._onForwardClick,this.keyScope&&this._onForwardClick);key.unbind("space",this.keyScope||this._onSpaceKey,this.keyScope&&this._onSpaceKey)}this.reset();b.fn.destroy.call(this)},reset:function(){b.fn.reset.call(this);this._selectedItemId=null;this._scrollPosition=null;this._scrollOffset=null;this._renderedItems={}},getData:function(){return $.extend({fit:this.fit,mods:this.mods},this.data)},render:function(){b.fn.render.call(this);this.$container=this.$el.find(".js-sliderContainer");this.$content=this.$el.find(".js-sliderContent");this.$arrowBack=this.$el.find(".js-sliderArrowBack");this.$arrowForward=this.$el.find(".js-sliderArrowForward");this.$item=this.$el.find(".js-sliderItemTemplate > .js-sliderItem");this.$container.bind("scroll",this._onContainerScroll);this.$content.bind("transitionend",this._onContentTransitionend);this.$arrowBack.bind("tap",this._onBackClick);this.$arrowForward.bind("tap",this._onForwardClick);this.$el.delegate(".js-sliderItem","tap",this._onItemClick);$(window).bind("resize",this._onResize);if(!this.fit){this.$container.css({"overflow-x":"scroll",bottom:-a.scrollbarHeight()+"px"})}this._updateContent()},_getItemOffsetWidth:function(){if(!this._itemOffsetWidth){this.$item.parent().show();this._itemOffsetWidth=this.$item[0].offsetWidth;this.$item.parent().hide()}return this._itemOffsetWidth},_onBackClick:function(a){this.log("info",{radarName:"arrow_back",radars:[(a.type==="keydown"?"key":"tap")+"=1","all=1"]});if(this.fit){this.selectItem(this.getOffsetItemId(this.getSelectedItemId(),-1))}else{if(!this.isScrolledToLeft()){this.scrollToItem(this.getItemId(this.getVisibleItemIds().shift()),"retrospective")}}},_onForwardClick:function(a){this.log("info",{radarName:"arrow_forward",radars:[(a.type==="keydown"?"key":"tap")+"=1","all=1"]});this.next()},next:function(){if(this.fit){this.selectItem(this.getOffsetItemId(this.getSelectedItemId(),1))}else{if(!this.isScrolledToRight()){this.scrollToItem(this.getItemId(this.getVisibleItemIds().pop()),"prospective")}}},_onSpaceKey:function(a){if(this.fit&&this._selectedItemId){var b=this._selectedItemId;var c=this.getResolvedItems([b])[b];var d;if(c){d=c.getView();if(d.onSpaceKey){this.log("info",{radarName:"space-key",radars:["all=1"]});a.preventDefault();d.onSpaceKey(a)}}}},_onItemClick:function(a){if(!this.fit){var b=$(a.target).closest(".js-sliderItem").attr("data-id");this.selectItem(b);this.log("info",{radarName:"itemClick",radars:["all=1"]})}},_onResize:function(a){this._containerWidth=this._contentWidth=null},_onContainerScroll:function(a){this._scrollPosition=this.$container[0].scrollLeft;this._updateScroll()},_onContentTransitionend:function(a){var b=this.$content.css("transition");var c=a===true?-this.$content.css("transform").split(",")[4]||0:this._scrollOffset;this.$content.css("transition","none");this.$content.css("transform","translateX(0)");this._scrollPosition=this._scrollPosition+c;this._scrollOffset=0;this.$container[0].scrollLeft=this._scrollPosition;this.$content.css("transition",b)},_checkThreshold:function(){var a=this.getVisibleItems(),b=this.getItemCount();if(a.some(function(a){var b=this.getItemIndex(a);if(b<this.threshold||itemsCount-b<this.threshold){return true}},this)){}},_updateArrows:function(){var b,c=false,d=false;if(this.fit){b=this.getItemIndex(this._selectedItemId);c=!b;d=b===this.getIds().length-1}else{c=this.isScrolledToLeft();d=this.isScrolledToRight()}a.toggleMod(this.$arrowBack,"disabled",c);a.toggleMod(this.$arrowForward,"disabled",d);a.toggleMod(this.$arrowBack,"loading",!!(this._moreItemsRequestPromises.retrospective&&c));a.toggleMod(this.$arrowForward,"loading",!!(this._moreItemsRequestPromises.prospective&&d))},_updateScroll:function(){this._updateContent()},_updateContent:function(){var b=(new Date).getTime();if(this.$content&&this.$content.length&&this._index.length){this.getContentWidth();this._updateItems(true);if(!this.getResolvedItemCount()){return}var c=null,d=this.getRenderableItemsIds(),e=this.getItemIndex(this._selectedItemId),f=this._resetItemsPositions===void 0||this._resetItemsPositions===true,g=this.getItemIndex(this.getVisibleItemIds()[0]),h=!!this._renderedItems.length;if(this.fit&&!this.showArrows){a.toggleMod(this.el,"single",d.length==1)}var i=this.getIds();i.forEach(function(a,b){var e=this._deferredItems[a],g=this.getItemContainer(a);if(!g){g=this._renderedItems[a]=this.$item.clone().attr("data-id",a);g._visible=false;if(!this.fit){if(c){g.insertAfter(c)}else{g.prependTo(this.$content)}c=g}}if(!this.fit&&f){g.css("left",this._getItemOffsetWidth()*this.getItemIndex(a))}if(this._selectedItemId===a){this._itemHighlight(g,true)}var h=this.getDeferredItemState(a),i=this.isItemVisible(a);if(d.indexOf(a)!==-1&&h!=="rejected"){if(this.fit&&!g.parent().length){g.appendTo(this.$content)}var j=function(b){if(!b.$el){b.setEl(g)}var c=b.isViewRendered();if(!c){b.renderView()}var d=b.getView();var e=i?"visible":"preload";b.setVisibilityState(e);if(!c){this.emit("itemStateChange",[a,e])}if(!c&&d.getData().filename){this.log("info",{radarName:i?"show":"preload",radars:[(d.getData().filename.extension||"unknown").toLowerCase()+"=1","all=1"]})}if(this.getSelectedItemId()==a&&this.fit){b.unfreeze()}}.bind(this);if(h=="resolved"){j(this.getResolvedItems([a])[a])}else{e.done(j)}}else{this.getDeferredItems([a])[a].always(function(b){if(this.fit){g.detach()}b&&b.destroyView();if(h=="rejected"){b&&b.setVisibilityState("dropped");this.emit("itemStateChange",[a,"dropped"])}else if(!i){b&&b.setVisibilityState("invisible");this.emit("itemStateChange",[a,"invisible"])}}.bind(this))}g._visible=i},this);this._resetItemsPositions=false;this._updateArrows();b=(new Date).getTime()-b;this.log("info",{radarName:"updateContent",radars:["time="+b,"time_"+Math.floor(i.length/100)*100+"="+b]})}},_updateItems:function(a){var b=this.getVisibleItemIds();if(!b.length){return}var c=this.getItemIndex(b[0])-this.loadThreshold,d=this.getItemIndex(b[b.length-1])+this.loadThreshold,e;var f;if(c<0){c=0;f=this.requestMoreItems("retrospective");if(f){f.done(this.onDataChanged.bind(this))}}if(d>this.getIds().length){d=this.getIds().length;f=this.requestMoreItems("prospective");if(f){f.done(this.onDataChanged.bind(this))}}e=this.getIds().slice(c,d+1);this.requestItems(e,a)},onDataChanged:function(a,b){this._resetItemsPositions=true;this._onResize();this._updateContent()},_createItem:function(a){return new c(a)},isItemVisible:function(a){if(this.fit){return this.getSelectedItemId()===a}var b=this.getItemIndex(a),c,d,e,f;if(b!=-1&&this.$container.length){c=this._getItemOffsetWidth()*b;d=this._getItemOffsetWidth();e=this.getContainerWidth();f=this._scrollPosition+this._scrollOffset;return c<f+e&&f<c+d}return false},isItemRenderable:function(a){var b=this.getVisibleItemIds(),c=this.getIds(),d=Math.max(this.getItemIndex(b[0])-this.unloadThreshold,0),e=Math.min(this.getItemIndex(b[b.length-1])+this.unloadThreshold,c.length),f=c.indexOf(a);return f>=d&&f<=e},getRenderableItemsIds:function(){var a=this.getVisibleItemIds(),b=this.getIds(),c=Math.max(this.getItemIndex(a[0])-this.unloadThreshold,0),d=Math.min(this.getItemIndex(a[a.length-1])+this.unloadThreshold,b.length);return b.slice(c,d+1)},_itemHighlight:function(b,c){a.toggleMod(b,"selected",c)},selectItem:function(a,b,c){if(this._selectedItemId==a){return}var d;if(this.fit&&(d=this.getSelectedItem())){d.freeze()}var e=this.getItemIndex(a);if(~e){if(this._selectedItemId){this._itemHighlight(this.getItemContainer(this._selectedItemId),false)}this._selectedItemId=a;this._itemHighlight(this.getItemContainer(this._selectedItemId),true);if(this.fit){this._updateContent();this._updateArrows()}else if(!c){this.scrollToItem(a)}if(!b){this.emit("selectItem",[a])}}},removeItems:function(a,c){a=Array.isArray(a)?a:[a];var d,e;a.forEach(function(b){var c=this._renderedItems[b];if(c){var f=this.getIds()[this.getItemIndex(b)-1];if(f&&a.indexOf(f)==-1){e=f}var g=this.getResolvedItems([b])[b];if(g){g.destroy()}delete this._renderedItems[b];if(this._selectedItemId==b){d=e?e:null}}},this);b.fn.removeItems.call(this,a,true);if(d===null){d=this.getIds()[0]}if(d){this.selectItem(d,void 0,true)}if(!c){this.emit("dataChanged",{removedItems:a})}},getSelectedItemId:function(){return this._selectedItemId},getSelectedItem:function(){var a=this.getResolvedItems([this._selectedItemId]);return a[this._selectedItemId]},getVisibleItemIds:function(a){if(this.fit){return[this.getSelectedItemId()]}var b=this.getIds(),c=this.getScrollPosition(),d=this.getContainerWidth(),e=Math.floor(c/this._getItemOffsetWidth()),f=Math.ceil((c+d)/this._getItemOffsetWidth());return b.slice(e,f+1)},getItemContainer:function(a){return this._renderedItems[a]},scrollToItem:function(a,b){var c=this.getItemIndex(a);if(~c){var d,e,f;if(this.$content.length){d=this._getItemOffsetWidth()*c;e=this._getItemOffsetWidth();f=this.getContainerWidth();switch(b){case"prospective":this.scrollTo(d);break;case"retrospective":this.scrollTo(d+e-f);break;default:this.scrollTo(Math.round(d+e/2-f/2))}}}},_scrollToTimeout:null,_scrollToTime:0,scrollTo:function(a){if(this.$container.length&&this.$content.length){(window.cancelRequestAnimationFrame||clearTimeout)(this._scrollToTimeout);this._scrollToTimeout=(window.requestAnimationFrame||setTimeout)(function(){this._onContentTransitionend(true);var b=(new Date).getTime();var c=0,d=Math.max(0,this.getContentWidth()-this.getContainerWidth());var e=Math.min(d,Math.max(c,a))-this._scrollPosition;if(this.disableTransition){this._scrollPosition=this._scrollPosition+e;this.$container[0].scrollLeft=this._scrollPosition}else{if(this._scrollOffset==e){this._onContainerScroll()}this._scrollOffset=e;if(b-this._scrollToTime<250){this._onContentTransitionend()}else{this.$content.css("transform","translateX("+-e+"px)")}}this._scrollToTime=b}.bind(this),16)}},isScrolledToLeft:function(){return!this.getScrollPosition()},isScrolledToRight:function(){return this.getScrollPosition()>=this.getContentWidth()-this.getContainerWidth()},getContainerWidth:function(){if(!this._containerWidth){this._containerWidth=this.$container[0].clientWidth}return this._containerWidth},getContentWidth:function(){var a;if(!this.fit){a=this.getIds().length*this._getItemOffsetWidth();if(this._contentWidth!=a){this.$content.width(a)}this._contentWidth=a}else{if(!this._contentWidth){this._contentWidth=this.$content[0].offsetWidth}a=this._contentWidth}return a},getScrollPosition:function(){return this._scrollPosition+this._scrollOffset}})});define("packages/viewer/b-slider/b-slider",["viewer/b-slider/b-slider"],function(a){return a});define("viewer/b-view/b-view__item",function(){function a(){}var b=a.prototype;return a});define("packages/viewer/b-view/b-view__item",["viewer/b-view/b-view__item"],function(a){return a});define("viewer/b-view/b-view",["jquery","toolkit/b-toolkit/b-toolkit","toolkit/b-spinner/b-spinner"],function($,a,b){var c=a.create("b-view",{isPreloadable:false,isDisabled:false,_isPreloadable:function(){if(typeof this.isPreloadable==="function"){return this.isPreloadable()}else{return this.isPreloadable}},_isDisabled:function(){if(typeof this.isDisabled==="function"){return this.isDisabled()}else{return this.isDisabled}},logHandler:function(a,b){b[0].radarName=this.bemName+(b[0].radarName?"_"+b[0].radarName:"")},init:function(){a["b-toolkit"].fn.init.call(this);if(c.prototype.bemName==this.bemName){this.isDisabled=true}this._radarFilename=(this.getData().filename.extension||"unknown").toLowerCase();this.reset()},reset:function(){this._loading=false;this._loaded=false;this._loadDeferred=$.Deferred()},getData:function(){return $.extend({isPreloadable:this._isPreloadable(),isDisabled:this._isDisabled(),viewActions:this.item.getViewActions(),dummy:this.item.getDummyOptions()},this.data)},_startLoading:function(a,b){b()},_stopLoading:function(){},start:function(){if(this._isDisabled()){a.toggleMod(this.$view,"loading",false);this._showDummy();this.log("info",{radarName:"show_disabled",radars:[this._radarFilename+"=1","all=1"]});this._loadDeferred.reject()}else if(this._isPreloadable()){var b=(new Date).getTime();if(!this._loading&&!this._loaded){this._startLoadTimeout=setTimeout(function(){if(this._loading&&!this._loaded){this._loading=false;this._loadDeferred.reject();a.toggleMod(this.$view,"loading",false);this.stop();b=(new Date).getTime()-b;this.log("info",{radarName:"show_timeout",radars:[this._radarFilename+"="+b,"all="+b]})}}.bind(this),6e4);this._loading=true;a.toggleMod(this.$view,"loading",true);this._startLoading(function(c){clearTimeout(this._startLoadTimeout);this._loading=false;this._loaded=true;this._loadDeferred.resolve(c);a.toggleMod(this.$view,"loading",false);b=(new Date).getTime()-b;this.log("info",{radarName:"show_success",radars:[this._radarFilename+"="+b,"all="+b]})}.bind(this),function(c){clearTimeout(this._startLoadTimeout);this._loading=false;this._loadDeferred.reject(c);a.toggleMod(this.$view,"loading",false);this._showDummy();b=(new Date).getTime()-b;this.log("info",{radarName:"show_fail",radars:[this._radarFilename+"="+b,"all="+b]})}.bind(this))}}else{this._loaded=true;a.toggleMod(this.$view,"loading",false);this._loadDeferred.resolve();this.log("info",{radarName:"show_not-preloadable",radars:[this._radarFilename+"=1","all=1"]})}return this._loadDeferred.promise()},_stop:function(){clearTimeout(this._startLoadTimeout);this._stopLoading();a.toggleMod(this.$view,"loading",false);if(this._loading){this.log("info",{radarName:"stop",radars:[this._radarFilename+"=1","all=1"]})}this._loading=false;this._loadDeferred.reject()},stop:function(){this._stop();this._showDummy()},destroy:function(){this._stop();this._loaded=false;this._loading=false},render:function(){a["b-toolkit"].fn.render.call(this);this.$view=this.$el.find(".js-view");if(this._isPreloadable()){a.toggleMod(this.$view,"loading",true);this._spinner=new b({template:this.template,el:this.$view[0],renderMode:"append",data:{mods:["black","viewer"]}});this._spinner.render()}this.$el.delegate(".js-viewAction","tap",function(a){var b=a.currentTarget.getAttribute("data-name");this.item.doAction(b);this.log("info",{radarName:"action_"+b,radars:[this._radarFilename+"=1","all=1"]})}.bind(this))},_showDummy:function(){if(!this.$view){return}if(!this.$viewDummy){var a=this.getData(),b=$.fest(this.template,{block:"b-view__dummy",params:{filename:a.filename,icon:a.icon,viewActions:a.viewActions,fileInfo:a.dummy.getInfo&&a.dummy.getInfo(this.item.data)}});this.$view.prepend(b);this.$viewDummy=this.$el.find(".js-viewDummy")}else{this.$view.prepend(this.$viewDummy);this.$viewDummy=this.$el.find(".js-viewDummy")}this.$viewDummy.css("display","block");this.log("info",{radarName:"dummy",radars:[this._radarFilename+"=1","all=1"]})},isFreezed:function(){return this._freezed},freeze:function(){if(this._freezed){return}this._freezed=true;this._freeze&&this._freeze()},unfreeze:function(){if(this._freezed===false){return}this._freezed=false;this._unfreeze&&this._unfreeze()},onSpaceKey:function(a){}});return c});define("packages/viewer/b-view/b-view",["viewer/b-view/b-view"],function(a){return a});define("viewer/b-viewer/b-viewer-conveyor-worker",["jquery"],function($){function a(b,c,d,e){var f=this;this._conveyor=b;this.id=a._ids++;if(e){this._$status=$("<div>").appendTo(e)}this._current={};function g(){f._current.item=null;f._current.priority=null;f._current.title=null;f._current.deferred=null;f._waitTimeout=setTimeout(function(){f._logStatus("Waiting");c().done(function(a){var b=$.Deferred();f._current.item=a.item;f._current.priority=a.priority;f._current.title=a.title;f._current.deferred=b;f._logStatus("Processing("+f._current.priority+") "+f._current.title);f._current.deferred.done(function(){d(a);g()}).fail(function(){g()});var c=a.item.start&&a.item.start();var e=a.log;var h;var i=(new Date).getTime();if(c){c.done(function(){h="load";b.resolve()}).fail(function(){h="fail";b.reject()}).always(function(){if(e&&e.type){i=(new Date).getTime()-i;f._conveyor._viewer.log("info",{radarName:"conveyor_"+h+"_"+e.type+"_"+e.state,radars:[e.extension+"="+i,"all="+i],itemId:a.item&&a.item.data&&a.item.data.id})}})}else{b.resolve()}})},0)}g()}a._ids=0;var b=a.prototype;b.destroy=function(){clearTimeout(this._waitTimeout);this._current.item&&this._current.item.stop&&this._current.item.stop();this._current.item=null;this._current.priority=null;this._current.title=null;this._current.deferred=null};b.interrupt=function(){if(this._current.item){if(this._current.item.stop){this._current.item.stop()}if(this._current.deferred){this._current.deferred.reject()}}};b.getCurrentBundle=function(){return{item:this._current.item,priority:this._current.priority,title:this._current.title}};b.setCurrentPriority=function(a){this._current.priority=a;this._logStatus("Processing("+this._current.priority+") "+this._current.title)};b.setCurrentTitle=function(a){this._current.title=a;this._logStatus("Processing("+this._current.priority+") "+this._current.title)};b._logStatus=function(a){if(this._$status){this._$status.text(a);console&&console.info&&console.info("Worker "+this.id+": ",a)}};return a});define("packages/viewer/b-viewer/b-viewer-conveyor-worker",["viewer/b-viewer/b-viewer-conveyor-worker"],function(a){return a});define("viewer/b-viewer/b-viewer-conveyor",["jquery","viewer/b-viewer/b-viewer-conveyor-worker"],function($,a){function b(b,c){var d;var e;this._viewer=b;try{d=!!JSON.parse(window.localStorage.getItem("ShowConveyorStatus"))}catch(a){}if(d){e=$("<div>").css({position:"fixed",left:0,top:0,padding:2,fontFamily:"sans-serif",fontSize:10,color:"rgba(255, 255, 255, 0.5)",zIndex:999999}).appendTo($(document.body))}this._workers=[];this._waiters=[];this._input=[];this._output=[];this._wait=this._wait.bind(this);this._done=this._done.bind(this);while(c--){this._workers.push(new a(this,this._wait,this._done,e))}}var c=b.prototype;c.destroy=function(){this._workers.forEach(function(a){a.destroy()});this._workers=[];this._waiters=[];this._input=[];this._output=[];this._wait=null;this._done=null};c._wait=function(){var a=$.Deferred();if(this._input.length){var b=this._input.shift();a.resolve(b)}else{this._waiters.push(a)}return a};c._done=function(a){this._output.push(a)};c._fulfillWaiters=function(){while(this._waiters.length&&this._input.length){this._waiters.shift().resolve(this._input.shift())}};c._asyncFulfillWaiters=function(){var a=0;return function(){var b=this;window.clearTimeout(a);a=window.setTimeout(function(){b._fulfillWaiters()})}}();c._addToInput=function(a){this._input=this._input.concat(a).sort(function(a,b){return b.priority-a.priority});this._asyncFulfillWaiters()};c._removeFromInput=function(a){this._input=this._input.filter(function(b){return b.item!==a},this)};c._removeFromOutput=function(a){this._output=this._output.filter(function(b){return b.item!==a},this)};c._isInInput=function(a){return this._input.some(function(b){return b.item===a},this)};c._isInOutput=function(a){return this._output.some(function(b){return b.item===a},this)};c._getBusyWorker=function(a){var b;this._workers.some(function(c){var d=c.getCurrentBundle();if(d.item===a){b=c;return true}},this);return b};c._getAvailableWorker=function(a){var b;if(!this._waiters.length){b=[].concat(this._workers).sort(function(a,b){return a.getCurrentBundle().priority-b.getCurrentBundle().priority})[0];var c=b.getCurrentBundle();if(c.item&&c.priority<=a){return b}}};c.enqueue=function(a,b,c,d){var e=this._getBusyWorker(a),f={item:a,priority:b,title:c,log:d};if(e){if(e.getCurrentBundle().priority>b){this._addToInput([f]);e.interrupt()}else{e.setCurrentPriority(b);e.setCurrentTitle(c)}}else if(!this._isInOutput(a)){this._removeFromInput(a);e=this._getAvailableWorker(b);if(e){this._addToInput([f,e.getCurrentBundle()]);e.interrupt()}else{this._addToInput([f])}}};c.remove=function(a){var b=this._getBusyWorker(a);if(b){b.interrupt()}else{this._removeFromInput(a);this._removeFromOutput(a)}};return b});define("packages/viewer/b-viewer/b-viewer-conveyor",["viewer/b-viewer/b-viewer-conveyor"],function(a){return a});define("viewer/b-viewer/b-viewer-item-factory",function(require,exports,a){var b={default:require("viewer/b-view/b-view"),image:require("viewer/b-view/_image/b-view_image"),video:require("viewer/b-view/_video/b-view_video"),audio:require("viewer/b-view/_audio/b-view_audio"),text:require("viewer/b-view/_text/b-view_text"),pdf:require("viewer/b-view/_pdf/b-view_pdf"),document:require("viewer/b-view/_document/b-view_document"),archive:require("viewer/b-view/_archive/b-view_archive"),thumbnail:require("viewer/b-view/_thumbnail/b-view_thumbnail")};var c=function(a,c){var d=c&&c.enabled&&b[a]||b["default"];return function a(){return new d(c)}};a.exports=c});define("packages/viewer/b-viewer/b-viewer-item-factory",["viewer/b-viewer/b-viewer-item-factory"],function(a){return a});define("viewer/b-viewer/b-viewer-item",["jquery","viewer/b-viewer/b-viewer-item-factory"],function($,a){function b(a,b){this.viewer=a;this.data=b;this._viewWaiting=[];this._thumbnailOptions=a.viewOptions["thumbnail"];this._viewOptions=$.extend({template:a.viewTemplate||a.template,logLevels:a.logLevels,logHandler:a.logHandler,fullScreenEnabled:a.isFullScreenEnabled(),onToggleFullScreen:a.toggleFullScreen,isFullScreen:a.isFullScreen,next:a.next,isAutoplayEnabled:a.isAutoplayEnabled,enableAutoplay:a.enableAutoplay,disableAutoplay:a.disableAutoplay,item:this,data:b,dummy:a.viewOptions&&a.viewOptions.dummy},a.viewOptions&&a.viewOptions[b.viewType||b.type])}var c=b.prototype;c._createView=function(){return function(){var b=this.data;this._view=this._view||a(b.viewType||b.kind,this._viewOptions)();this._viewWaiting.forEach(function(a,b,c){a(this._view);delete c[b]}.bind(this));return this._view}.bind(this)};c.getView=function(){return this._view};c._createThumbnail=function(){var b=$.extend(this._thumbnailOptions,this._viewOptions);b.enabled=true;return function(){this._thumbnail=this._thumbnail||a("thumbnail",b)();return this._thumbnail}.bind(this)};c.getThumbnail=function(){return this._thumbnail};c.update=function(a){for(var b in a){this.data[b]=a[b]}var c=this.getView(),d=this.getThumbnail();c.reset();c.render();c.start&&c.start();d.reset();d.render();d.start&&d.start();this.viewer._toolbox.updateToolbar()};c.startProcessing=function(){this._processing=true};c.stopProcessing=function(){this._processing=false};c.isProcessing=function(){return this._processing};c.getActions=function(){var a=(this.viewer.actions&&this.viewer.actions.common||[]).concat(this._viewOptions.actions||[]);if(this.viewer.actions&&this.viewer.actions.getActions){a=this.viewer.actions.getActions(a,this)}if(this._viewOptions.getActions){a=this._viewOptions.getActions(a,this)}if(this.data.getActions){a=this.data.getActions(a)}return a};c.getToolbarActions=function(){var a=this.getActions();function b(c){var d=[];c.forEach(function(c){c=$.extend(true,{},c);if(c.items){c.items=b(c.items);if(!c.name||~a.indexOf(c.name)){d.push(c)}}else if(a.indexOf(c.name)!==-1){d.push(c)}});return d}var c=b(this.viewer.actions&&this.viewer.actions.toolbarActions||[]);if(this.viewer.actions&&this.viewer.actions.getToolbarActions){c=this.viewer.actions.getToolbarActions(c,this)}if(this._viewOptions.getToolbarActions){c=this._viewOptions.getToolbarActions(c,this)}if(this.data.getToolbarActions){c=this.data.getToolbarActions(c)}return c};c.getViewActions=function(){var a=this.getActions();var b=(this.viewer.actions&&this.viewer.actions.viewActions||[]).filter(function(b){return~a.indexOf(b.name)});if(this.viewer.actions&&this.viewer.actions.getViewActions){b=this.viewer.actions.getViewActions(b,this)}if(this._viewOptions.getViewActions){b=this._viewOptions.getViewActions(b,this)}if(this.data.getViewActions){b=this.data.getViewActions(b)}return b};c.doAction=function(a,b){var c=this.viewer.actions&&this.viewer.actions.handlers&&this.viewer.actions.handlers[a];if(c){c(this,b)}};c.getDummyOptions=function(){return this._viewOptions.dummy||{}};c.waitForView=function(a){if(this._view){a(this._view);return}this._viewWaiting.push(a)};return b});define("packages/viewer/b-viewer/b-viewer-item",["viewer/b-viewer/b-viewer-item"],function(a){return a});define("viewer/b-viewer/b-viewer-provider",["jquery","toolkit/b-toolkit/b-toolkit"],function($,a){function b(){this._promisedItems={};this._resolvedItems={};this._index=[];this._moreItemsRequestPromises={}}var c=b.prototype;c.reset=function(){for(var a in this._promisedItems){this._promisedItems[a].reject();delete this._promisedItems[a]}for(var a in this._resolvedItems){delete this._resolvedItems[a]}this._index.length=0;for(var a in this._moreItemsRequestPromises){delete this._moreItemsRequestPromises[a]}};return b;return a.create("b-deferred-collection",{init:function(){},reset:function(){},_requestItem:function(a){return $.Deferred().reject()},_createItem:function(a){return{}},_resolveItem:function(a,b){this._resolvedItems[a]=b;this.emit("itemResolved",[a,b])},addItems:function(a,b,c){a=Array.isArray(a)?a:[a];var d=[],e=false;a.forEach(function(a){if(a.id&&!this._deferredItems[a.id]){if(a.data){this._deferredItems[a.id]=$.Deferred().resolve(this._createItem(a.data)).done(this._resolveItem.bind(this,a.id))}else{this._deferredItems[a.id]=$.Deferred().reject()}d.push(a.id);this.emit("itemAdded",[a.id]);e=true}},this);Array.prototype.splice.apply(this._index,[b===undefined?this._index.length:b,0].concat(d));if(!c&&e){this.emit("dataChanged")}},addIds:function(a,b,c){a=Array.isArray(a)?a:[a];this.addItems(a.map(function(a){return{id:a,data:null}}),b,c)},requestItems:function(a,b){a=Array.isArray(a)?a:[a];var c=$.Deferred(),d=false,e=[],f=[];a.forEach(function(a){if(this._deferredItems[a]){if(this.getDeferredItemState(a)==="rejected"){this._deferredItems[a]=this._requestItem(a).done(this._resolveItem.bind(this,a));d=true}e.push(a);f.push(this._deferredItems[a])}},this);$.when.apply($,f).done(function(){var a={},b=Array.prototype.slice.call(arguments);e.forEach(function(c,d){a[c]=b[d]});c.resolve(a)}).fail(function(){c.reject()});if(!b&&d){this.emit("dataChanged")}return c.promise()},getIds:function(){return this._index},isIdExists:function(a){return this._index.includes(a)},getItemId:function(a){var b;Object.forEach(this._deferredItems,function(c,d){if(c===a){b=d}},this);if(b){return b}Object.forEach(this._resolvedItems,function(c,d){if(c===a){b=d}},this);if(b){return b}if(~this._index.indexOf(a)){return a}},getOffsetItemId:function(a,b){var c=this.getItemIndex(a);return this.getIds()[~c?Math.max(0,Math.min(this.getIds().length-1,+(c+b)||0)):0]},getItemIndex:function(a){return this._index.indexOf(a)},getDeferredItemCount:function(){return Object.keys(this._deferredItems).length},getResolvedItemCount:function(){return Object.keys(this._resolvedItems).length},getDeferredItems:function(a){a=Array.isArray(a)?a:[a];var b={};a.forEach(function(a){if(this._deferredItems[a]){b[a]=this._deferredItems[a]}},this);return b},getResolvedItems:function(a){a=Array.isArray(a)?a:[a];var b={};a.forEach(function(a){if(this._resolvedItems[a]){b[a]=this._resolvedItems[a]}},this);return b},getDeferredItemState:function(a){var b=this._deferredItems[a];if(b.state){return b.state()}if(b.isResolved&&b.isResolved()){return"resolved"}else if(b.isRejected&&b.isRejected()){return"rejected"}else{return"pending"}},removeItems:function(a){a=Array.isArray(a)?a:[a];a.forEach(function(a){if(this._deferredItems[a]){this._deferredItems[a].reject();delete this._deferredItems[a];delete this._resolvedItems[a]}},this)},_requestMoreItems:function(a){return $.Deferred().reject()},requestMoreItems:function(a){var b=this._moreItemsRequestPromises[a];if(b===undefined){b=this._moreItemsRequestPromises[a]=this._requestMoreItems(a);if(b.then){b.then(function(){delete this._moreItemsRequestPromises[a]}.bind(this),function(){this._moreItemsRequestPromises[a]=false}.bind(this))}}return b}})});define("packages/viewer/b-viewer/b-viewer-provider",["viewer/b-viewer/b-viewer-provider"],function(a){return a});define("viewer/b-viewer/b-viewer-toolbox",["jquery","toolkit/b-toolkit/b-toolkit","toolkit/b-toolbar/b-toolbar","viewer/b-slider/b-slider"],function($,a,b,c){function d(a,b){a.forEach(function(a){if(!(a.mods&&a.mods.includes(b))){a.mods=a.mods||[];a.mods.push(b)}if(a.items){d(a.items,b)}});return a}function e(a){var c=this;this._viewer=a;this.keys=this._viewer.keys;this.mediaKeys=this._viewer.mediaKeys;this.keyScope=this._viewer.keyScope;this._toolbar=new b({template:this._viewer.toolbarTemplate||this._viewer.template});if(this._viewer.actions&&Object.isObject(this._viewer.actions.handlers)){Object.keys(this._viewer.actions.handlers).forEach(function(a){this._toolbar[$.camelCase("on-"+a)]=function(b,c){var d=c.group?c.name:"";var e=this._viewer.getSelectedItemId();this._viewer.requestItems(e).then(function(b){var c=b[e];c.doAction(a,d);if(this._slider){this._slider.log("info",{radarName:"action_"+a,radars:[(c.data.filename.extension||"unknown")+"=1","all=1"]})}}.bind(this))}.bind(this)},this)}this._onUpKey=this._onUpKey.bind(this);this._onDownKey=this._onDownKey.bind(this);if(this.keys){key("up",this.keyScope||this._onUpKey,this.keyScope&&this._onUpKey);key("down",this.keyScope||this._onDownKey,this.keyScope&&this._onDownKey)}}var f=e.prototype;f.destroy=function(){clearTimeout(this._createTimeout);this._slider&&this._slider.destroy();this._toolbar.destroy();this.$toolbar.unbind("tap");this.$el=this.$toolbar=this.$content=null;if(this.keys){key.unbind("up",this.keyScope||this._onUpKey,this.keyScope&&this._onUpKey);key.unbind("down",this.keyScope||this._onDownKey,this.keyScope&&this._onDownKey)}};f._onUpKey=function(){this._viewer.expandToolbox(true)};f._onDownKey=function(){this._viewer.expandToolbox(false)};f._createSlider=function(a){if(this._slider){return}var b=this;this._slider=new c({template:this._viewer.sliderTemplate||this._viewer.template,mods:["viewer"],logLevels:this._viewer.logLevels,logHandler:function(a,c){c[0].radarName="toolbox"+(c[0].radarName?"_"+c[0].radarName:"");b._viewer.log(a,c[0])},loadCount:20,loadThreshold:30,unloadThreshold:40,_requestItem:function(a){var c=$.Deferred();b._viewer.requestItems(a).done(function(b){c.resolve(this._createItem({id:a,viewFactory:b[a]._createThumbnail()}))}.bind(this));return c},_requestMoreItems:function(a){return b._viewer.requestMoreItems(a)},onSelectItem:function(a,c){b._viewer.selectItem(c)},onItemStateChange:function(a,c,d){this.getDeferredItems(c)[c].done(function(a){var c=a.getView();if(d==="dropped"||d=="invisible"){b._viewer._conveyor.remove(c)}else{b._viewer._conveyor.enqueue(c,{visible:{image:9,video:8}[a.kind]||7,preload:{image:3,video:2}[a.kind]||1}[d]||0,"T "+c.data.title,{type:c.bemName.split("_")[1],extension:c._radarFilename,state:a.getVisibilityState()})}})}});this._slider.log("info",{radarName:"create",radars:["all=1"]});if(!a){this._renderSlider()}if(this._viewer.getIds()){this._slider.addIds(this._viewer.getIds(),0,true)}if(this._viewer.getSelectedItemId()){this._slider.selectItem(this._viewer.getSelectedItemId(),true)}};f.render=function(){this.$el=this._viewer.$el.find(".js-viewerToolbox");this.$toolbar=this.$el.find(".js-viewerToolboxToolbar");this.$content=this.$el.find(".js-viewerToolboxContent");this.$toolbar.bind("tap",function(b){if($(b.target).parents(".b-toolbar__group_viewer_left").add(b.target).is(".b-toolbar__group_viewer_left")){if(a.hasMod(this.$toolbar,"expand")){this._viewer.expandToolbox()}}}.bind(this));this._createTimeout=setTimeout(this._createSlider.bind(this),3*1e3)};f._renderSlider=function(){if(this._slider){this._slider.renderTo(this.$content)}};f.selectItem=function(a){if(this._slider){this._slider.selectItem(a,true)}this.updateToolbar()};f.updateToolbar=function(){var b=this._viewer.getSelectedItemId();this._viewer.requestItems(b).then(function(c){var d=c[b];if(!d){return}var e=this._viewer.getIds().length>1;a.toggleMod(this.$toolbar,"expand",e);this._toolbar.setData({mods:["viewer"],items:[{group:"right",mods:["viewer_right"],items:d.getToolbarActions()},{group:"left",mods:["viewer_left"],items:[e?{block:"b-toolbar__btn",mods:["viewer_left"],params:{name:"expand",icon:this._viewer.actions.expandIcon||"viewer_clip",text:this._viewer.showCurrentIndex?this._viewer.getItemIndex(b)+1+(this._viewer._total?" из "+this._viewer._total:""):this._viewer._total||"",mods:this._expanded?["pushed"]:[]}}:null,{block:"b-breadcrumbs",mods:["viewer_right"],params:{type:d.data.type,filename:d.data.filename,icon:d.data.icon||d.data.filename.extension}}]}]});this._toolbar.renderTo(this.$toolbar);this._viewer.emit("toolbarRender",this._toolbar.getData())}.bind(this))}.debounce(0);f.expand=function(b){this._expanded=b===undefined?!this._expanded:!!b;a.toggleMod(this.$el,"expanded",this._expanded);this.updateToolbar()};f.removeItems=function(){if(this._slider){this._slider.removeItems.apply(this._slider,arguments)}};f.addItems=function(){if(this._slider){this._slider.addItems.apply(this._slider,arguments)}};f.addIds=function(){if(this._slider){this._slider.addIds.apply(this._slider,arguments)}};return e});define("packages/viewer/b-viewer/b-viewer-toolbox",["viewer/b-viewer/b-viewer-toolbox"],function(a){return a});define("viewer/b-viewer/b-viewer-viewport",["jquery","toolkit/b-toolkit/b-toolkit","viewer/b-slider/b-slider","toolkit/b-filename/b-filename","viewer/b-viewer/__viewport/__fullscreen/b-viewer__viewport__fullscreen"],function($,a,b,c,d){function e(a){var c=this;this._viewer=a;this._filename=null;this.keys=this._viewer.keys;this.mediaKeys=this._viewer.mediaKeys;this.keyScope=this._viewer.keyScope;this._fullscreen=false;this.onFullScreen=this.onFullScreen.bind(this);$(document).on(d.fullscreenchange,this.onFullScreen);this._slider=new b({renderMode:"replace",showArrows:a.showArrows,template:this._viewer.sliderTemplate||this._viewer.template,keyScope:this.keyScope,mods:["viewer"],logLevels:this._viewer.logLevels,logHandler:function(a,b){b[0].radarName="viewport"+(this.isFullScreen()?"-fullscreen":"")+(b[0].radarName?"_"+b[0].radarName:"");c._viewer.log(a,b[0])}.bind(this),fit:true,keys:this.keys,mediaKeys:this.mediaKeys,loadCount:2,loadThreshold:1,unloadThreshold:4,_requestItem:function(a){var b=$.Deferred();c._viewer.requestItems(a).done(function(c){b.resolve(this._createItem({id:a,viewFactory:c[a]._createView()}))}.bind(this));return b},_requestMoreItems:function(a){return c._viewer.requestMoreItems(a)},onSelectItem:function(a,b){c._viewer.selectItem(b)},onShowItem:function(a,b){},onItemStateChange:function(a,b,d){this.getDeferredItems(b)[b].done(function(a){var b=a.getView();if(d==="dropped"||d=="invisible"){c._viewer._conveyor.remove(b)}else{c._viewer._conveyor.enqueue(b,{visible:{image:12,video:11}[a.kind]||10,preload:{image:6,video:5}[a.kind]||4}[d]||0,"V "+b.data.title,{type:b.bemName.split("_")[1],extension:b._radarFilename,state:a.getVisibilityState()})}})}});this._onCloseClick=this._onCloseClick.bind(this);if(this.keys){key("escape",this.keyScope||this._onCloseClick,this.keyScope&&this._onCloseClick)}}var f=e.prototype;f.destroy=function(){this._slider.destroy();$(document).unbind(d.fullscreenchange,this.onFullScreen);this.$close.unbind("tap",this._onCloseClick);if(this.keys){key.unbind("escape",this.keyScope||this._onCloseClick,this.keyScope&&this._onCloseClick)}this._slider=this._viewer=this.$el=this.$title=this.$close=this.$content=null};f._onCloseClick=function(a){if(!this.isFullScreen()){var b=Math.round(((new Date).getTime()-this._viewer._startDate)/1e3);this._viewer.log("info",{radarName:"close",radars:[(this._viewer._currentItem.data.filename.extension||"unknown")+"="+b,(a.type==="keydown"?"key":"tap")+"="+b,"elapsed="+b]});this._viewer.emit("close")}};f.render=function(){this.$el=this._viewer.$el.find(".js-viewerViewport");this.$title=this.$el.find(".js-viewerViewportTitle");this.$fileName=this.$el.find(".js-viewerViewportFileName");this.$close=this.$el.find(".js-viewerViewportClose");this.$content=this.$el.find(".js-viewerViewportContent");this._slider.renderTo(".js-viewerViewportContentPlaceholder");this.$close.bind("tap",this._onCloseClick);if(this._viewer.viewportOptions&&this._viewer.viewportOptions.hideCloseBtn){this.$close.hide()}};f.setTitle=function(a){var b=a.title;var d=a.titleUrl;var e=a.filename;this._filename&&this._filename.destroy();if(b){var f=$("<"+(d?"a":"span")+">").attr({target:"_blank",href:d}).text(b);this.$title.html(f)}else if(e){this._filename=new c({template:this._viewer.sliderTemplate||this._viewer.template});this._filename.renderTo(this.$fileName,e)}this.$title[b?"show":"hide"]();this.$fileName[!b&&e?"show":"hide"]()};f.selectItem=function(a){if(this._slider){if(this._slider.getSelectedItemId()!==a){this._slider.selectItem(a,true)}}};f.shrink=function(b){this._shrinked=b===undefined?!this._shrinked:!!b;a.toggleMod(this.$el,"shrinked",this._shrinked)};f.removeItems=function(){if(this._slider){this._slider.removeItems.apply(this._slider,arguments)}};f.addItems=function(){if(this._slider){this._slider.addItems.apply(this._slider,arguments)}else{this._needSync=true}};f.onFullScreen=function(){this._fullscreen=!!document.fullscreenElement;this._slider.toggleMod("chromeless",this._fullscreen);a.toggleMod(this.$content,"fullscreen",this._fullscreen);this._slider.log("info",{radarName:"fullscreen",radars:[(this._fullscreen?"enter":"exit")+"=1"]})};f.toggleFullScreen=function(){var a=this.$content[0];if(!document.fullscreenElement){if(a.requestFullscreen){a.requestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}}else{if(document.exitFullscreen){document.exitFullscreen()}}};f.isFullScreen=function(){return this._fullscreen};return e});define("packages/viewer/b-viewer/b-viewer-viewport",["viewer/b-viewer/b-viewer-viewport"],function(a){return a});define("viewer/b-viewer/b-viewer",["toolkit/b-toolkit/b-toolkit","viewer/b-deferred-collection/b-deferred-collection","viewer/b-viewer/b-viewer-conveyor","viewer/b-viewer/b-viewer-item","viewer/b-viewer/b-viewer-viewport","viewer/b-viewer/b-viewer-toolbox"],function(a,b,c,d,e,f){var g=b.extend("b-viewer",{logHandler:function(a,b){b[0].radarName=this.bemName+(b[0].radarName?"_"+b[0].radarName:"")},boundAll:["toggleFullScreen","isFullScreen","next","isAutoplayEnabled","enableAutoplay","disableAutoplay"],viewOnly:false,withAdvertLine:false,showCurrentIndex:false,keys:true,mediaKeys:true,enableFullScreen:false,fullScreenEnabled:false,init:function(){b.fn.init.call(this);this._conveyor=new c(this,5);this._viewport=new e(this);if(!this.viewOnly){this._toolbox=new f(this)}this._fullScreenEnabled=this.enableFullScreen&&g.isFullScreenSupported();this.log("info",{radarName:"open",radars:[(this.viewOnly?"single":"multy")+"-mode=1","all=1"]})},destroy:function(){this.$el.empty();this._conveyor.destroy();this._viewport.destroy();this._toolbox&&this._toolbox.destroy();this._conveyor=null;this._viewport=null;this._toolbox=null;b.fn.destroy.call(this)},render:function(c){b.fn.render.call(this,c);this._viewport.render();if(this._toolbox){this._toolbox.render()}if(this.viewOnly){a.toggleMod(this.el.firstChild,"view-only",true);a.toggleMod(this.$el.find(".js-viewerViewport"),"view-only",true)}if(this.withAdvertLine){a.toggleMod(this.el.firstChild,"advert-line",true)}this._startDate=(new Date).getTime()},_createItem:function(a){return new d(this,a)},toggleFullScreen:function(){if(this.enableFullScreen){this._viewport.toggleFullScreen()}},isFullScreen:function(){return this._viewport.isFullScreen()},isFullScreenEnabled:function(){return this._fullScreenEnabled},addItems:function(a,c,d){this.log("info",{radarName:"add-items",radars:["added="+a.length,"all="+this._viewport._slider.getIds().length]});b.fn.addItems.call(this,a,c,d);function e(a){return a.id}this._viewport._slider.addIds(a.map(e),c,d);if(this._toolbox){this._toolbox.addIds(a.map(e),c,d)}},removeItems:function(a,c){this.log("info",{radarName:"remove-items",radars:["removed="+a.length,"all="+this._viewport._slider.getIds().length]});b.fn.removeItems.call(this,a,c);this._viewport._slider.removeItems(a,c);if(this._toolbox){this._toolbox.removeItems(a,c)}},selectItem:function(a,b){return this.isIdExists(a)&&this.requestItems(a).done(function(c){var d=c[a].data;this._viewport.setTitle(d);this._viewport.selectItem(a);if(this._toolbox){this._toolbox.selectItem(a)}this._currentItem=c[a];if(!b){this.emit("selectItem",[a])}}.bind(this))},getSelectedItemId:function(){return this._viewport._slider.getSelectedItemId()},next:function(){this._viewport._slider.next()},expandToolbox:function(a){if(!this._toolbox){return}this._toolboxExpanded=a===undefined?!this._toolboxExpanded:!!a;this.log("info",{radarName:"expandToolbox",radars:[this._toolboxExpanded+"=1"]});this._viewport.shrink(this._toolboxExpanded);this._toolbox.expand(this._toolboxExpanded)},updateToolbar:function(){this._toolbox&&this._toolbox.updateToolbar()},setTotal:function(a){if(a!=this._total){this._total=a;this.updateToolbar()}},_isAutoplayEnabled:false,isAutoplayEnabled:function(){return this._isAutoplayEnabled},enableAutoplay:function(){this._isAutoplayEnabled=true},disableAutoplay:function(){this._isAutoplayEnabled=false}});g.isFullScreenSupported=function(){return"requestFullscreen"in document.documentElement};return g});define("packages/viewer/b-viewer/b-viewer",["viewer/b-viewer/b-viewer"],function(a){return a});